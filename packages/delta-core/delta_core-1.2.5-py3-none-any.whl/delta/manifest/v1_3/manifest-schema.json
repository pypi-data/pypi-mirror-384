{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "http://www.gael-systems.com/delta-twin/manifest.json",
  "type": "object",
  "title": "DeltaTwin Manifest Schema",
  "required": [
    "name",
    "description",
    "license",
    "owner"
  ],
  "additionalProperties": false,
  "properties": {
    "deltaVersion": {
      "enum": ["1.3"]
    },
    "name": {
      "type": "string",
      "title": "The name of the Delta twin",
      "description": "The name of this delta twin used to be displayed to the end users."
    },
    "description": {
      "type": "string",
      "title": "The description of the Delta Twin",
      "description": "The details regarding this Delta Twin"
    },
    "short_description": {
      "type": "string",
      "title": "The short description of the Delta Twin",
      "description": "A short summary of the Delta Twin"
    },
    "license": {
      "type": "object",
      "title": "This delta twin license",
      "required": [
        "name",
        "url",
        "copyrights"
      ],
      "properties": {
        "name": {
          "type": "string",
          "default": "LGPLv3",
          "title": "The license name",
          "description": "The name of the license applied to this Delta Twin"
        },
        "description": {
          "type": "string",
          "default": "The default license for DeltaTwin is LGPLv3",
          "title": "The description of the license",
          "description": "The description of the license applied to this Delta Twin"
        },
        "url": {
          "type": "string",
          "default": "https://www.gnu.org/licenses/gpl-3.0.txt",
          "title": "The url to licence",
          "description": "The URL to the license applied to this Delta Twin"
        },
        "copyrights": {
          "type": "array",
          "default": [
            {
              "years": [
                2021,
                2022,
                2023,
                2024
              ],
              "company": "GAEL Systems"
            },
            {
              "years": [
                2021
              ],
              "company": "ESA/ESRIN"
            }
          ],
          "title": "This Delta Twin copyrights",
          "description": "Declare who owns the intellectual property of this delta twin, it includes the effective date of the ownership.",
          "items": {
            "type": "object",
            "required": [
              "years",
              "company"
            ],
            "properties": {
              "years": {
                "type": "array",
                "description": "List of the effective dates of the ownership.",
                "items": {
                  "type": "integer",
                  "$ref": "#/$defs/year"
                },
                "uniqueItems": true,
                "title": "The year Schema"
              },
              "company": {
                "type": "string",
                "title": "The company Schema",
                "description": "The owner company name."
              }
            }
          }
        }
      }
    },
    "owner": {
      "type": "string",
      "title": "The owner of the Delta twin",
      "description": "The name of the owner who created this delta twin."
    },
    "resources": {
      "type": "object",
      "patternProperties": {
        "[a-z][A-Za-z0-9_-]*": {
          "$ref": "#/$defs/resourceParameter"
        }
      },
      "description": "Resources needed by this delta twin."
    },
    "inputs": {
      "type": "object",
      "patternProperties": {
        "[a-z][A-Za-z0-9_-]*": {
          "$ref": "#/$defs/inputParameter"
        }
      },
      "description": "Inputs produced by this delta twin."
    },
    "outputs": {
      "type": "object",
      "patternProperties": {
        "[a-z][A-Za-z0-9_-]*": {
          "$ref": "#/$defs/outputParameter"
        }
      },
      "description": "Outputs produced by this delta twin."
    },
    "models": {
      "type": "object",
      "patternProperties": {
        "[a-z][A-Za-z0-9_-]*": {
          "$ref": "#/$defs/model"
        }
      }
    },
    "dependencies": {
      "type": "object",
      "patternProperties": {
        "[a-z][A-Za-z0-9_-]*": {
          "$ref": "#/$defs/dependency"
        }
      }
    }
  },
  "$defs": {
    "year": {
      "type": "number",
      "minimum": 1970,
      "maximum": 2100
    },
    "parameter": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string"
        },
        "description": {
          "type": "string"
        }
      },
      "required": [
        "type"
      ]
    },
    "inputParameter": {
      "$ref": "#/$defs/parameter",
      "properties": {
        "value": {
          "type": [
            "boolean",
            "integer",
            "number",
            "string",
            "object",
            "array"
          ]
        }
      },
      "unevaluatedProperties": true
    },
    "inputModel": {
      "$ref": "#/$defs/inputParameter",
      "properties": {
        "prefix": {
          "type": "string"
        }
      },
      "unevaluatedProperties": false
    },
    "resourceParameter": {
      "$ref": "#/$defs/inputParameter",
      "required": [
        "value"
      ],
      "unevaluatedProperties": false
    },
    "outputParameter": {
      "$ref": "#/$defs/parameter",
      "unevaluatedProperties": true
    },
    "outputModel": {
      "$ref": "#/$defs/outputParameter",
      "properties": {
        "glob": {
          "type": "string"
        }
      },
      "unevaluatedProperties": false
    },
    "model": {
      "type": "object",
      "description": "Model to be executed to run this delta twin.",
      "properties": {
        "path": {
          "type": "string",
          "title": "path where is located the models"
        },
        "type": {
          "type": "string",
          "title": "name of the runner model (nifi, python or shell)"
        },
        "parameters": {
          "type": "object",
          "title": "runner parameters (depends of the runner implementation"
        },
        "inputs": {
          "type": "object",
          "patternProperties": {
            "[a-z][A-Za-z0-9_-]*": {
              "$ref": "#/$defs/inputModel"
            }
          }
        },
        "outputs": {
          "type": "object",
          "patternProperties": {
            "[a-z][A-Za-z0-9_-]*": {
              "$ref": "#/$defs/outputModel"
            }
          }
        }
      },
      "additionalProperties": false,
      "required": [
        "path",
        "type",
        "parameters"
      ]
    },
    "dependency": {
      "type": "object",
      "description": "dependencies to be executed to run this delta twin.",
      "properties": {
        "id": {
          "type": "string",
          "title": "DeltaTwin id of the dependency"
        },
        "version": {
          "type": "string",
          "title": "DeltaTwin version of the dependency"
        }
      }
    }
  }
}