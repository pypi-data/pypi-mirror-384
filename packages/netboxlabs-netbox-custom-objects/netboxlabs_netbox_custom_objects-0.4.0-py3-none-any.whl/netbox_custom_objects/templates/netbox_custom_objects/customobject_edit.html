{% extends 'generic/object_edit.html' %}
{% load form_helpers %}
{% load i18n %}

{% block title %}
  {% if object.pk %}
    {% trans "Editing" %} {{ object.custom_object_type.display_name.lower }} {{ object }}
  {% else %}
    {% blocktrans trimmed with custom_object_type=object.custom_object_type.display_name %}
      Add a new {{ custom_object_type }}
    {% endblocktrans %}
  {% endif %}
{% endblock title %}

{% block form %}
  {% if branch_warning %}
    {% include 'netbox_custom_objects/inc/branch_warning.html' %}
  {% endif %}

  {# Render hidden fields #}
  {% for field in form.hidden_fields %}
    {{ field }}
  {% endfor %}

  {# Render all fields grouped by group_name #}
  <div class="field-group mb-5">
    {% for group, fields in form.custom_object_type_field_groups.items %}
      {% if group %}
      <div class="row">
        <h3 class="col-9 offset-3 mb-3 h4">{{ group }}</h3>
      </div>
      {% endif %}
      {% for name in fields %}
        {% render_field form|getfield:name %}
      {% endfor %}
    {% endfor %}
    
    {# Render regular model fields (non-custom fields) that are not in any group #}
    {% for field in form %}
      {% if field.name not in form.custom_object_type_fields %}
        {# Only render fields that are meant for user input #}
        {% if not field.field.widget.is_hidden and not field.field.disabled and field.field.widget.input_type != 'hidden' %}
          {% render_field field %}
        {% endif %}
      {% endif %}
    {% endfor %}
  </div>
{% endblock form %}

{% block buttons %}
  <a href="{{ return_url }}" class="btn btn-outline-secondary btn-float">{% trans "Cancel" %}</a>
  {% if object.pk %}
    <button type="submit" name="_update" class="btn btn-primary"{% if branch_warning %} disabled{% endif %}>
      {% trans "Save" %}
    </button>
  {% else %}
    <div class="btn-group" role="group" aria-label="{% trans "Actions" %}">
      <button type="submit" name="_create" class="btn btn-primary"{% if branch_warning %} disabled{% endif %}>
        {% trans "Create" %}
      </button>
      <button type="submit" name="_addanother" class="btn btn-outline-primary btn-float"{% if branch_warning %} disabled{% endif %}>
        {% trans "Create & Add Another" %}
      </button>
    </div>
  {% endif %}
{% endblock buttons %}