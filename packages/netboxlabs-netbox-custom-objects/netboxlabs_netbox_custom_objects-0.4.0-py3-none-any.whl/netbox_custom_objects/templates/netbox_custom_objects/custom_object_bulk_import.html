{% extends 'generic/bulk_import.html' %}
{% load form_helpers %}
{% load helpers %}
{% load i18n %}


{% block content %}

  {# Data Import Form #}
  <div class="tab-pane show active" id="import-form" role="tabpanel" aria-labelledby="import-form-tab">
    <div class="col col-md-12 col-lg-10 offset-lg-1">

      {% if branch_warning %}
      {% include 'netbox_custom_objects/inc/branch_warning.html' %}
      {% endif %}

      <form action="" method="post" enctype="multipart/form-data" class="form">
        {% csrf_token %}
        <input type="hidden" name="import_method" value="direct" />

        {# Form fields #}
        {% render_field form.data %}
        {% render_field form.format %}
        {% render_field form.csv_delimiter %}

        {# Meta fields #}
        <div class="bg-primary-subtle border border-primary rounded-1 pt-3 px-3 mb-3">
          {% if form.changelog_message %}
            {% render_field form.changelog_message %}
          {% endif %}
          {% render_field form.background_job %}
        </div>

        <div class="form-group">
          <div class="col col-md-12 text-end">
            {% if return_url %}
              <a href="{{ return_url }}" class="btn btn-outline-secondary">{% trans "Cancel" %}</a>
            {% endif %}
            <button type="submit" name="data_submit" class="btn btn-primary"{% if branch_warning %} disabled{% endif %}>{% trans "Submit" %}</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  {# File Upload Form #}
  <div class="tab-pane show" id="upload-form" role="tabpanel" aria-labelledby="upload-form-tab">
    <div class="col col-md-12 col-lg-10 offset-lg-1">
      <form action="" method="post" enctype="multipart/form-data" class="form">
        {% csrf_token %}
        <input type="hidden" name="import_method" value="upload" />

        {# Form fields #}
        {% render_field form.upload_file %}
        {% render_field form.format %}
        {% render_field form.csv_delimiter %}

        {# Meta fields #}
        {# Background jobs not supported with file uploads #}
        {% if form.changelog_message %}
          <div class="bg-primary-subtle border border-primary rounded-1 pt-3 px-3 mb-3">
            {% render_field form.changelog_message %}
          </div>
        {% endif %}

        <div class="form-group">
          <div class="col col-md-12 text-end">
            {% if return_url %}
              <a href="{{ return_url }}" class="btn btn-outline-secondary">{% trans "Cancel" %}</a>
            {% endif %}
            <button type="submit" name="file_submit" class="btn btn-primary"{% if branch_warning %} disabled{% endif %}>{% trans "Submit" %}</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  {# DataFile Form #}
  <div class="tab-pane show" id="datafile-form" role="tabpanel" aria-labelledby="datafile-form-tab">
    <div class="col col-md-12 col-lg-10 offset-lg-1">
      <form action="" method="post" enctype="multipart/form-data" class="form">
        {% csrf_token %}
        <input type="hidden" name="import_method" value="datafile" />

        {# Form fields #}
        {% render_field form.data_source %}
        {% render_field form.data_file %}
        {% render_field form.format %}
        {% render_field form.csv_delimiter %}

        {# Meta fields #}
        <div class="bg-primary-subtle border border-primary rounded-1 pt-3 px-3 mb-3">
          {% if form.changelog_message %}
            {% render_field form.changelog_message %}
          {% endif %}
          {% render_field form.background_job %}
        </div>

        <div class="form-group">
          <div class="col col-md-12 text-end">
            {% if return_url %}
              <a href="{{ return_url }}" class="btn btn-outline-secondary">{% trans "Cancel" %}</a>
            {% endif %}
            <button type="submit" name="file_submit" class="btn btn-primary"{% if branch_warning %} disabled{% endif %}>{% trans "Submit" %}</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  {% if fields %}
  <div class="row my-3">
    <div class="col col-md-12">
      <div class="card">
        <h2 class="card-header">{% trans "Field Options" %}</h2>
        <table class="table">
          <thead>
            <tr>
              <th>{% trans "Field" %}</th>
              <th>{% trans "Required" %}</th>
              <th>{% trans "Accessor" %}</th>
              <th>{% trans "Description" %}</th>
            </tr>
          </thead>
          <tbody>
            {% for name, field in fields.items %}
              <tr>
                <td class="font-monospace{% if field.required %} fw-bold{% endif %}">
                  {{ name }}
                </td>
                <td>
                  {% if field.required %}
                    {% checkmark True true="Required" %}
                  {% else %}
                    {{ ''|placeholder }}
                  {% endif %}
                </td>
                {% if field.to_field_name %}
                  <td class="font-monospace">{{ field.to_field_name }}</td>
                {% else %}
                  <td>{{ ''|placeholder }}</td>
                {% endif %}
                <td>
                  {% if field.help_text %}
                    {{ field.help_text }}
                  {% elif field.label %}
                    {{ field.label }}
                  {% endif %}
                  {% if field.STATIC_CHOICES %}
                    <a href="#" data-bs-toggle="modal" data-bs-target="#{{ name }}_choices" aria-label="{{ name }} {% trans "choices" %}"><i class="mdi mdi-help-circle"></i></a>
                    <div class="modal fade" id="{{ name }}_choices" tabindex="-1" role="dialog">
                      <div class="modal-dialog" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title">
                              <span class="font-monospace">{{ name }}</span> {% trans "Choices" %}
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                            <table class="table table-striped modal-body">
                              <thead>
                                <tr>
                                  <th>{% trans "Import Value" %}</th>
                                  <th>{% trans "Label" %}</th>
                                </tr>
                              </thead>
                              <tbody>
                                {% for value, label in field.choices %}
                                  {% if value %}
                                    <tr>
                                      <td><samp>{{ value }}</samp></td>
                                      <td>{{ label }}</td>
                                    </tr>
                                  {% endif %}
                                {% endfor %}
                              </tbody>
                            </table>
                        </div>
                      </div>
                    </div>
                  {% endif %}
                  {% if field|widget_type == 'dateinput' %}
                    <br /><small class="text-muted">{% trans "Format: YYYY-MM-DD" %}</small>
                  {% elif field|widget_type == 'checkboxinput' %}
                    <br /><small class="text-muted">{% trans "Specify true or false" %}</small>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <p class="small text-muted">
    <i class="mdi mdi-check-bold text-success"></i>
    {% blocktrans trimmed %}
      Required fields <strong>must</strong> be specified for all objects.
    {% endblocktrans %}
  </p>
  <p class="small text-muted">
    <i class="mdi mdi-information-outline"></i>
    {% blocktrans trimmed with example="vrf.rd" %}
      Related objects may be referenced by any unique attribute. For example, <code>{{ example }}</code> would identify a VRF by its route distinguisher.
    {% endblocktrans %}
  </p>
  {% endif %}

{% endblock content %}
