import{M as St}from"./spark-md5-14lME80B.js";import{v as Tn}from"./vuvuzela-B_IKHO1D.js";import{E as Oe}from"./events-DDgEnNRw.js";var Qe,_r=new Uint8Array(16);function gr(){if(!Qe&&(Qe=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Qe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Qe(_r)}const mr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function yr(e){return typeof e=="string"&&mr.test(e)}var ue=[];for(var ut=0;ut<256;++ut)ue.push((ut+256).toString(16).substr(1));function pr(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(ue[e[t+0]]+ue[e[t+1]]+ue[e[t+2]]+ue[e[t+3]]+"-"+ue[e[t+4]]+ue[e[t+5]]+"-"+ue[e[t+6]]+ue[e[t+7]]+"-"+ue[e[t+8]]+ue[e[t+9]]+"-"+ue[e[t+10]]+ue[e[t+11]]+ue[e[t+12]]+ue[e[t+13]]+ue[e[t+14]]+ue[e[t+15]]).toLowerCase();if(!yr(n))throw TypeError("Stringified UUID is invalid");return n}function Kt(e,t,n){e=e||{};var r=e.random||(e.rng||gr)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return pr(r)}function wr(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer||typeof Blob<"u"&&e instanceof Blob}function br(e){return e instanceof ArrayBuffer?e.slice(0):e.slice(0,e.size,e.type)}var Pn=Function.prototype.toString,Sr=Pn.call(Object);function kr(e){var t=Object.getPrototypeOf(e);if(t===null)return!0;var n=t.constructor;return typeof n=="function"&&n instanceof n&&Pn.call(n)==Sr}function se(e){var t,n,r;if(!e||typeof e!="object")return e;if(Array.isArray(e)){for(t=[],n=0,r=e.length;n<r;n++)t[n]=se(e[n]);return t}if(e instanceof Date&&isFinite(e))return e.toISOString();if(wr(e))return br(e);if(!kr(e))return e;t={};for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=se(e[n]);typeof i<"u"&&(t[n]=i)}return t}function Rn(e){var t=!1;return function(...n){if(t)throw new Error("once called more than once");t=!0,e.apply(this,n)}}function Bn(e){return function(...t){t=se(t);var n=this,r=typeof t[t.length-1]=="function"?t.pop():!1,i=new Promise(function(a,s){var u;try{var c=Rn(function(l,g){l?s(l):a(g)});t.push(c),u=e.apply(n,t),u&&typeof u.then=="function"&&a(u)}catch(l){s(l)}});return r&&i.then(function(a){r(null,a)},r),i}}function qr(e,t,n){if(e.constructor.listeners("debug").length){for(var r=["api",e.name,t],i=0;i<n.length-1;i++)r.push(n[i]);e.constructor.emit("debug",r);var a=n[n.length-1];n[n.length-1]=function(s,u){var c=["api",e.name,t];c=c.concat(s?["error",s]:["success",u]),e.constructor.emit("debug",c),a(s,u)}}}function te(e,t){return Bn(function(...n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return qr(r,e,n),this.taskqueue.isReady?t.apply(this,n):new Promise(function(i,a){r.taskqueue.addTask(function(s){s?a(s):i(r[e].apply(r,n))})})})}function Je(e,t){for(var n={},r=0,i=t.length;r<i;r++){var a=t[r];a in e&&(n[a]=e[a])}return n}var Ar=6;function tn(e){return e}function Or(e){return[{ok:e}]}function In(e,t,n){var r=t.docs,i=new Map;r.forEach(function(S){i.has(S.id)?i.get(S.id).push(S):i.set(S.id,[S])});var a=i.size,s=0,u=new Array(a);function c(){var S=[];u.forEach(function(_){_.docs.forEach(function(d){S.push({id:_.id,docs:[d]})})}),n(null,{results:S})}function l(){++s===a&&c()}function g(S,_,d){u[S]={id:_,docs:d},l()}var o=[];i.forEach(function(S,_){o.push(_)});var f=0;function v(){if(!(f>=o.length)){var S=Math.min(f+Ar,o.length),_=o.slice(f,S);p(_,f),f+=_.length}}function p(S,_){S.forEach(function(d,m){var y=_+m,O=i.get(d),q=Je(O[0],["atts_since","attachments"]);q.open_revs=O.map(function(T){return T.rev}),q.open_revs=q.open_revs.filter(tn);var x=tn;q.open_revs.length===0&&(delete q.open_revs,x=Or),["revs","attachments","binary","ajax","latest"].forEach(function(T){T in t&&(q[T]=t[T])}),e.get(d,q,function(T,P){var D;T?D=[{error:T}]:D=x(P),g(y,d,D),v()})})}v()}var kt;try{localStorage.setItem("_pouch_check_localstorage",1),kt=!!localStorage.getItem("_pouch_check_localstorage")}catch{kt=!1}function Ze(){return kt}const qe=typeof queueMicrotask=="function"?queueMicrotask:function(t){Promise.resolve().then(t)};class Cr extends Oe{constructor(){super(),this._listeners={},Ze()&&addEventListener("storage",t=>{this.emit(t.key)})}addListener(t,n,r,i){if(this._listeners[n])return;var a=!1,s=this;function u(){if(!s._listeners[n])return;if(a){a="waiting";return}a=!0;var c=Je(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);function l(){a=!1}r.changes(c).on("change",function(g){g.seq>i.since&&!i.cancelled&&(i.since=g.seq,i.onChange(g))}).on("complete",function(){a==="waiting"&&qe(u),a=!1}).on("error",l)}this._listeners[n]=u,this.on(t,u)}removeListener(t,n){n in this._listeners&&(super.removeListener(t,this._listeners[n]),delete this._listeners[n])}notifyLocalWindows(t){Ze()&&(localStorage[t]=localStorage[t]==="a"?"b":"a")}notify(t){this.emit(t),this.notifyLocalWindows(t)}}function _e(e){if(typeof console<"u"&&typeof console[e]=="function"){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function Dr(e,t){var n=6e5;e=parseInt(e,10)||0,t=parseInt(t,10),t!==t||t<=e?t=(e||1)<<1:t=t+1,t>n&&(e=n>>1,t=n);var r=Math.random(),i=t-e;return~~(i*r+e)}function Er(e){var t=0;return e||(t=2e3),Dr(e,t)}function qt(e,t){_e("info","The above "+e+" is totally normal. "+t)}class V extends Error{constructor(t,n,r){super(),this.status=t,this.name=n,this.message=r,this.error=!0}toString(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})}}new V(401,"unauthorized","Name or password is incorrect.");var xr=new V(400,"bad_request","Missing JSON list of 'docs'"),he=new V(404,"not_found","missing"),Ne=new V(409,"conflict","Document update conflict"),jn=new V(400,"bad_request","_id field must contain a string"),Tr=new V(412,"missing_id","_id is required for puts"),Pr=new V(400,"bad_request","Only reserved document ids may start with underscore.");new V(412,"precondition_failed","Database not open");var Ft=new V(500,"unknown_error","Database encountered an unknown error"),$n=new V(500,"badarg","Some query argument is invalid");new V(400,"invalid_request","Request was invalid");var Rr=new V(400,"query_parse_error","Some query parameter is invalid"),nn=new V(500,"doc_validation","Bad special document member"),rt=new V(400,"bad_request","Something wrong with the request"),ct=new V(400,"bad_request","Document must be a JSON object");new V(404,"not_found","Database not found");var Gt=new V(500,"indexed_db_went_bad","unknown");new V(500,"web_sql_went_bad","unknown");new V(500,"levelDB_went_went_bad","unknown");new V(403,"forbidden","Forbidden by design doc validate_doc_update function");var Xe=new V(400,"bad_request","Invalid rev format");new V(412,"file_exists","The database could not be created, the file already exists.");var Br=new V(412,"missing_stub","A pre-existing attachment stub wasn't found");new V(413,"invalid_url","Provided URL is invalid");function M(e,t){function n(r){for(var i=Object.getOwnPropertyNames(e),a=0,s=i.length;a<s;a++)typeof e[i[a]]!="function"&&(this[i[a]]=e[i[a]]);this.stack===void 0&&(this.stack=new Error().stack),r!==void 0&&(this.reason=r)}return n.prototype=V.prototype,new n(t)}function Ke(e){if(typeof e!="object"){var t=e;e=Ft,e.data=t}return"error"in e&&e.error==="conflict"&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),"stack"in e||(e.stack=new Error().stack),e}function Ir(e,t,n){try{return!e(t,n)}catch(i){var r="Filter function threw: "+i.toString();return M(rt,r)}}function Mt(e){var t={},n=e.filter&&typeof e.filter=="function";return t.query=e.query_params,function(i){i.doc||(i.doc={});var a=n&&Ir(e.filter,i.doc,t);if(typeof a=="object")return a;if(a)return!1;if(!e.include_docs)delete i.doc;else if(!e.attachments)for(var s in i.doc._attachments)Object.prototype.hasOwnProperty.call(i.doc._attachments,s)&&(i.doc._attachments[s].stub=!0);return!0}}function Ln(e){var t;if(e?typeof e!="string"?t=M(jn):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=M(Pr)):t=M(Tr),t)throw t}function ke(e){return typeof e._remote=="boolean"?e._remote:typeof e.type=="function"?(_e("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),e.type()==="http"):!1}function jr(e,t){return"listenerCount"in e?e.listenerCount(t):Oe.listenerCount(e,t)}function At(e){if(!e)return null;var t=e.split("/");return t.length===2?t:t.length===1?[e,e]:null}function rn(e){var t=At(e);return t?t.join("/"):null}var an=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],sn="queryKey",$r=/(?:^|&)([^&=]*)=?([^&]*)/g,Lr=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function Nn(e){for(var t=Lr.exec(e),n={},r=14;r--;){var i=an[r],a=t[r]||"",s=["user","password"].indexOf(i)!==-1;n[i]=s?decodeURIComponent(a):a}return n[sn]={},n[an[12]].replace($r,function(u,c,l){c&&(n[sn][c]=l)}),n}function Ut(e,t){var n=[],r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n.push(i),r.push(t[i]));return n.push(e),Function.apply(null,n).apply(null,r)}function Ve(e,t,n){return e.get(t).catch(function(r){if(r.status!==404)throw r;return{}}).then(function(r){var i=r._rev,a=n(r);return a?(a._id=t,a._rev=i,Nr(e,a,n)):{updated:!1,rev:i}})}function Nr(e,t,n){return e.put(t).then(function(r){return{updated:!0,rev:r.rev}},function(r){if(r.status!==409)throw r;return Ve(e,t._id,n)})}var Jt=function(e){return atob(e)},ze=function(e){return btoa(e)};function zt(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(a){if(a.name!=="TypeError")throw a;for(var n=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,r=new n,i=0;i<e.length;i+=1)r.append(e[i]);return r.getBlob(t.type)}}function Kr(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function Qt(e,t){return zt([Kr(e)],{type:t})}function Wt(e,t){return Qt(Jt(e),t)}function Fr(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t}function Kn(e,t){var n=new FileReader,r=typeof n.readAsBinaryString=="function";n.onloadend=function(i){var a=i.target.result||"";if(r)return t(a);t(Fr(a))},r?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function Fn(e,t){Kn(e,function(n){t(n)})}function Ht(e,t){Fn(e,function(n){t(ze(n))})}function Gr(e,t){var n=new FileReader;n.onloadend=function(r){var i=r.target.result||new ArrayBuffer(0);t(i)},n.readAsArrayBuffer(e)}var Mr=self.setImmediate||self.setTimeout,Ur=32768;function Jr(e){return ze(e)}function zr(e,t,n,r,i){(n>0||r<t.size)&&(t=t.slice(n,r)),Gr(t,function(a){e.append(a),i()})}function Qr(e,t,n,r,i){(n>0||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t),i()}function Xt(e,t){var n=typeof e=="string",r=n?e.length:e.size,i=Math.min(Ur,r),a=Math.ceil(r/i),s=0,u=n?new St:new St.ArrayBuffer,c=n?Qr:zr;function l(){Mr(o)}function g(){var f=u.end(!0),v=Jr(f);t(v),u.destroy()}function o(){var f=s*i,v=f+i;s++,s<a?c(u,e,f,v,l):c(u,e,f,v,g)}o()}function Gn(e){return St.hash(e)}function Mn(e,t){if(!t)return Kt().replace(/-/g,"").toLowerCase();var n=Object.assign({},e);return delete n._rev_tree,Gn(JSON.stringify(n))}var it=Kt;function Re(e){for(var t,n,r,i=e.rev_tree.slice(),a;a=i.pop();){var s=a.ids,u=s[2],c=a.pos;if(u.length){for(var l=0,g=u.length;l<g;l++)i.push({pos:c+1,ids:u[l]});continue}var o=!!s[1].deleted,f=s[0];(!t||(r!==o?r:n!==c?n<c:t<f))&&(t=f,n=c,r=o)}return n+"-"+t}function Be(e,t){for(var n=e.slice(),r;r=n.pop();)for(var i=r.pos,a=r.ids,s=a[2],u=t(s.length===0,i,a[0],r.ctx,a[1]),c=0,l=s.length;c<l;c++)n.push({pos:i+1,ids:s[c],ctx:u})}function Wr(e,t){return e.pos-t.pos}function Yt(e){var t=[];Be(e,function(i,a,s,u,c){i&&t.push({rev:a+"-"+s,pos:a,opts:c})}),t.sort(Wr).reverse();for(var n=0,r=t.length;n<r;n++)delete t[n].pos;return t}function Zt(e){for(var t=Re(e),n=Yt(e.rev_tree),r=[],i=0,a=n.length;i<a;i++){var s=n[i];s.rev!==t&&!s.opts.deleted&&r.push(s.rev)}return r}function Hr(e){var t=[];return Be(e.rev_tree,function(n,r,i,a,s){s.status==="available"&&!n&&(t.push(r+"-"+i),s.status="missing")}),t}function Xr(e,t){let n=[];const r=e.slice();let i;for(;i=r.pop();){const{pos:a,ids:s}=i,u=`${a}-${s[0]}`,c=s[2];if(n.push(u),u===t){if(c.length!==0)throw new Error("The requested revision is not a leaf");return n.reverse()}(c.length===0||c.length>1)&&(n=[]);for(let l=0,g=c.length;l<g;l++)r.push({pos:a+1,ids:c[l]})}if(n.length===0)throw new Error("The requested revision does not exist");return n.reverse()}function Un(e){for(var t=[],n=e.slice(),r;r=n.pop();){var i=r.pos,a=r.ids,s=a[0],u=a[1],c=a[2],l=c.length===0,g=r.history?r.history.slice():[];g.push({id:s,opts:u}),l&&t.push({pos:i+1-g.length,ids:g});for(var o=0,f=c.length;o<f;o++)n.push({pos:i+1,ids:c[o],history:g})}return t.reverse()}function Yr(e,t){return e.pos-t.pos}function Zr(e,t,n){for(var r=0,i=e.length,a;r<i;)a=r+i>>>1,n(e[a],t)<0?r=a+1:i=a;return r}function Vr(e,t,n){var r=Zr(e,t,n);e.splice(r,0,t)}function on(e,t){for(var n,r,i=t,a=e.length;i<a;i++){var s=e[i],u=[s.id,s.opts,[]];r?(r[2].push(u),r=u):n=r=u}return n}function ei(e,t){return e[0]<t[0]?-1:1}function un(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var i=n.pop(),a=i.tree1,s=i.tree2;(a[1].status||s[1].status)&&(a[1].status=a[1].status==="available"||s[1].status==="available"?"available":"missing");for(var u=0;u<s[2].length;u++){if(!a[2][0]){r="new_leaf",a[2][0]=s[2][u];continue}for(var c=!1,l=0;l<a[2].length;l++)a[2][l][0]===s[2][u][0]&&(n.push({tree1:a[2][l],tree2:s[2][u]}),c=!0);c||(r="new_branch",Vr(a[2],s[2][u],ei))}}return{conflicts:r,tree:e}}function Jn(e,t,n){var r=[],i=!1,a=!1,s;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var u=0,c=e.length;u<c;u++){var l=e[u];if(l.pos===t.pos&&l.ids[0]===t.ids[0])s=un(l.ids,t.ids),r.push({pos:l.pos,ids:s.tree}),i=i||s.conflicts,a=!0;else if(n!==!0){var g=l.pos<t.pos?l:t,o=l.pos<t.pos?t:l,f=o.pos-g.pos,v=[],p=[];for(p.push({ids:g.ids,diff:f,parent:null,parentIdx:null});p.length>0;){var S=p.pop();if(S.diff===0){S.ids[0]===o.ids[0]&&v.push(S);continue}for(var _=S.ids[2],d=0,m=_.length;d<m;d++)p.push({ids:_[d],diff:S.diff-1,parent:S.ids,parentIdx:d})}var y=v[0];y?(s=un(y.ids,o.ids),y.parent[2][y.parentIdx]=s.tree,r.push({pos:g.pos,ids:g.ids}),i=i||s.conflicts,a=!0):r.push(l)}else r.push(l)}return a||r.push(t),r.sort(Yr),{tree:r,conflicts:i||"internal_node"}}function ti(e,t){for(var n=Un(e),r,i,a=0,s=n.length;a<s;a++){var u=n[a],c=u.ids,l;if(c.length>t){r||(r={});var g=c.length-t;l={pos:u.pos+g,ids:on(c,g)};for(var o=0;o<g;o++){var f=u.pos+o+"-"+c[o].id;r[f]=!0}}else l={pos:u.pos,ids:on(c,0)};i?i=Jn(i,l,!0).tree:i=[l]}return r&&Be(i,function(v,p,S){delete r[p+"-"+S]}),{tree:i,revs:r?Object.keys(r):[]}}function zn(e,t,n){var r=Jn(e,t),i=ti(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function ni(e,t){for(var n=e.slice(),r=t.split("-"),i=parseInt(r[0],10),a=r[1],s;s=n.pop();){if(s.pos===i&&s.ids[0]===a)return!0;for(var u=s.ids[2],c=0,l=u.length;c<l;c++)n.push({pos:s.pos+1,ids:u[c]})}return!1}function ri(e){return e.ids}function Ae(e,t){t||(t=Re(e));for(var n=t.substring(t.indexOf("-")+1),r=e.rev_tree.map(ri),i;i=r.pop();){if(i[0]===n)return!!i[1].deleted;r=r.concat(i[2])}}function Pe(e){return typeof e=="string"&&e.startsWith("_local/")}function ii(e,t){for(var n=t.rev_tree.slice(),r;r=n.pop();){var i=r.pos,a=r.ids,s=a[0],u=a[1],c=a[2],l=c.length===0,g=r.history?r.history.slice():[];if(g.push({id:s,pos:i,opts:u}),l)for(var o=0,f=g.length;o<f;o++){var v=g[o],p=v.pos+"-"+v.id;if(p===e)return i+"-"+s}for(var S=0,_=c.length;S<_;S++)n.push({pos:i+1,ids:c[S],history:g})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}function ai(e,t,n,r){try{e.emit("change",t,n,r)}catch(i){_e("error",'Error in .on("change", function):',i)}}function si(e,t,n){var r=[{rev:e._rev}];n.style==="all_docs"&&(r=Yt(t.rev_tree).map(function(a){return{rev:a.rev}}));var i={id:t.id,changes:r,doc:e};return Ae(t,e._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=Zt(t),i.doc._conflicts.length||delete i.doc._conflicts),i}class oi extends Oe{constructor(t,n,r){super(),this.db=t,n=n?se(n):{};var i=n.complete=Rn((u,c)=>{u?jr(this,"error")>0&&this.emit("error",u):this.emit("complete",c),this.removeAllListeners(),t.removeListener("destroyed",a)});r&&(this.on("complete",function(u){r(null,u)}),this.on("error",r));const a=()=>{this.cancel()};t.once("destroyed",a),n.onChange=(u,c,l)=>{this.isCancelled||ai(this,u,c,l)};var s=new Promise(function(u,c){n.complete=function(l,g){l?c(l):u(g)}});this.once("cancel",function(){t.removeListener("destroyed",a),n.complete(null,{status:"cancelled"})}),this.then=s.then.bind(s),this.catch=s.catch.bind(s),this.then(function(u){i(null,u)},i),t.taskqueue.isReady?this.validateChanges(n):t.taskqueue.addTask(u=>{u?n.complete(u):this.isCancelled?this.emit("cancel"):this.validateChanges(n)})}cancel(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")}validateChanges(t){var n=t.complete;J._changesFilterPlugin?J._changesFilterPlugin.validate(t,r=>{if(r)return n(r);this.doChanges(t)}):this.doChanges(t)}doChanges(t){var n=t.complete;if(t=se(t),"live"in t&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=si,t.since==="latest"&&(t.since="now"),t.since||(t.since=0),t.since==="now"){this.db.info().then(i=>{if(this.isCancelled){n(null,{status:"cancelled"});return}t.since=i.update_seq,this.doChanges(t)},n);return}if(J._changesFilterPlugin){if(J._changesFilterPlugin.normalize(t),J._changesFilterPlugin.shouldFilter(this,t))return J._changesFilterPlugin.filter(this,t)}else["doc_ids","filter","selector","view"].forEach(function(i){i in t&&_e("warn",'The "'+i+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in t||(t.descending=!1),t.limit=t.limit===0?1:t.limit,t.complete=n;var r=this.db._changes(t);if(r&&typeof r.cancel=="function"){const i=this.cancel;this.cancel=(...a)=>{r.cancel(),i.apply(this,a)}}}}function ft(e,t){return function(n,r){n||r[0]&&r[0].error?(n=n||r[0],n.docId=t,e(n)):e(null,r.length?r[0]:r)}}function ui(e){for(var t=0;t<e.length;t++){var n=e[t];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var a=r[i];n._attachments[a]=Je(n._attachments[a],["data","digest","content_type","length","revpos","stub"])}}}function ci(e,t){if(e._id===t._id){const n=e._revisions?e._revisions.start:0,r=t._revisions?t._revisions.start:0;return n-r}return e._id<t._id?-1:1}function fi(e){var t={},n=[];return Be(e,function(r,i,a,s){var u=i+"-"+a;return r&&(t[u]=0),s!==void 0&&n.push({from:s,to:u}),u}),n.reverse(),n.forEach(function(r){t[r.from]===void 0?t[r.from]=1+t[r.to]:t[r.from]=Math.min(t[r.from],1+t[r.to])}),t}function li(e){var t="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;e.keys=t,e.skip=0,delete e.limit,e.descending&&(t.reverse(),e.descending=!1)}function Qn(e){var t=e._compactionQueue[0],n=t.opts,r=t.callback;e.get("_local/compaction").catch(function(){return!1}).then(function(i){i&&i.last_seq&&(n.last_seq=i.last_seq),e._compact(n,function(a,s){a?r(a):r(null,s),qe(function(){e._compactionQueue.shift(),e._compactionQueue.length&&Qn(e)})})})}function di(e,t,n){return e.get("_local/purges").then(function(r){const i=r.purgeSeq+1;return r.purges.push({docId:t,rev:n,purgeSeq:i}),r.purges.length>self.purged_infos_limit&&r.purges.splice(0,r.purges.length-self.purged_infos_limit),r.purgeSeq=i,r}).catch(function(r){if(r.status!==404)throw r;return{_id:"_local/purges",purges:[{docId:t,rev:n,purgeSeq:0}],purgeSeq:0}}).then(function(r){return e.put(r)})}function hi(e){return e.charAt(0)==="_"?e+" is not a valid attachment name, attachment names cannot start with '_'":!1}function lt(e){return e===null||typeof e!="object"||Array.isArray(e)}const vi=/^\d+-[^-]*$/;function dt(e){return typeof e=="string"&&vi.test(e)}class Wn extends Oe{_setup(){this.post=te("post",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),lt(t))return r(M(ct));this.bulkDocs({docs:[t]},n,ft(r,t._id))}).bind(this),this.put=te("put",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),lt(t))return r(M(ct));if(Ln(t._id),"_rev"in t&&!dt(t._rev))return r(M(Xe));if(Pe(t._id)&&typeof this._putLocal=="function")return t._deleted?this._removeLocal(t,r):this._putLocal(t,r);const i=s=>{typeof this._put=="function"&&n.new_edits!==!1?this._put(t,n,s):this.bulkDocs({docs:[t]},n,ft(s,t._id))};n.force&&t._rev?(a(),i(function(s){var u=s?null:{ok:!0,id:t._id,rev:t._rev};r(s,u)})):i(r);function a(){var s=t._rev.split("-"),u=s[1],c=parseInt(s[0],10),l=c+1,g=Mn();t._revisions={start:l,ids:[g,u]},t._rev=l+"-"+g,n.new_edits=!1}}).bind(this),this.putAttachment=te("putAttachment",function(t,n,r,i,a){var s=this;typeof a=="function"&&(a=i,i=r,r=null),typeof a>"u"&&(a=i,i=r,r=null),a||_e("warn","Attachment",n,"on document",t,"is missing content_type");function u(c){var l="_rev"in c?parseInt(c._rev,10):0;return c._attachments=c._attachments||{},c._attachments[n]={content_type:a,data:i,revpos:++l},s.put(c)}return s.get(t).then(function(c){if(c._rev!==r)throw M(Ne);return u(c)},function(c){if(c.reason===he.message)return u({_id:t});throw c})}).bind(this),this.removeAttachment=te("removeAttachment",function(t,n,r,i){this.get(t,(a,s)=>{if(a){i(a);return}if(s._rev!==r){i(M(Ne));return}if(!s._attachments)return i();delete s._attachments[n],Object.keys(s._attachments).length===0&&delete s._attachments,this.put(s,i)})}).bind(this),this.remove=te("remove",function(t,n,r,i){var a;typeof n=="string"?(a={_id:t,_rev:n},typeof r=="function"&&(i=r,r={})):(a=t,typeof n=="function"?(i=n,r={}):(i=r,r=n)),r=r||{},r.was_delete=!0;var s={_id:a._id,_rev:a._rev||r.rev};if(s._deleted=!0,Pe(s._id)&&typeof this._removeLocal=="function")return this._removeLocal(a,i);this.bulkDocs({docs:[s]},r,ft(i,s._id))}).bind(this),this.revsDiff=te("revsDiff",function(t,n,r){typeof n=="function"&&(r=n,n={});var i=Object.keys(t);if(!i.length)return r(null,{});var a=0,s=new Map;function u(l,g){s.has(l)||s.set(l,{missing:[]}),s.get(l).missing.push(g)}function c(l,g){var o=t[l].slice(0);Be(g,function(f,v,p,S,_){var d=v+"-"+p,m=o.indexOf(d);m!==-1&&(o.splice(m,1),_.status!=="available"&&u(l,d))}),o.forEach(function(f){u(l,f)})}i.forEach(function(l){this._getRevisionTree(l,function(g,o){if(g&&g.status===404&&g.message==="missing")s.set(l,{missing:t[l]});else{if(g)return r(g);c(l,o)}if(++a===i.length){var f={};return s.forEach(function(v,p){f[p]=v}),r(null,f)}})},this)}).bind(this),this.bulkGet=te("bulkGet",function(t,n){In(this,t,n)}).bind(this),this.compactDocument=te("compactDocument",function(t,n,r){this._getRevisionTree(t,(i,a)=>{if(i)return r(i);var s=fi(a),u=[],c=[];Object.keys(s).forEach(function(l){s[l]>n&&u.push(l)}),Be(a,function(l,g,o,f,v){var p=g+"-"+o;v.status==="available"&&u.indexOf(p)!==-1&&c.push(p)}),this._doCompaction(t,c,r)})}).bind(this),this.compact=te("compact",function(t,n){typeof t=="function"&&(n=t,t={}),t=t||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:t,callback:n}),this._compactionQueue.length===1&&Qn(this)}).bind(this),this.get=te("get",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),n=n||{},typeof t!="string")return r(M(jn));if(Pe(t)&&typeof this._getLocal=="function")return this._getLocal(t,r);var i=[];const a=()=>{var c=[],l=i.length;if(!l)return r(null,c);i.forEach(g=>{this.get(t,{rev:g,revs:n.revs,latest:n.latest,attachments:n.attachments,binary:n.binary},function(o,f){if(o)c.push({missing:g});else{for(var v,p=0,S=c.length;p<S;p++)if(c[p].ok&&c[p].ok._rev===f._rev){v=!0;break}v||c.push({ok:f})}l--,l||r(null,c)})})};if(n.open_revs){if(n.open_revs==="all")this._getRevisionTree(t,function(c,l){if(c)return r(c);i=Yt(l).map(function(g){return g.rev}),a()});else if(Array.isArray(n.open_revs)){i=n.open_revs;for(var s=0;s<i.length;s++){var u=i[s];if(!dt(u))return r(M(Xe))}a()}else return r(M(Ft,"function_clause"));return}return this._get(t,n,(c,l)=>{if(c)return c.docId=t,r(c);var g=l.doc,o=l.metadata,f=l.ctx;if(n.conflicts){var v=Zt(o);v.length&&(g._conflicts=v)}if(Ae(o,g._rev)&&(g._deleted=!0),n.revs||n.revs_info){for(var p=g._rev.split("-"),S=parseInt(p[0],10),_=p[1],d=Un(o.rev_tree),m=null,y=0;y<d.length;y++){var O=d[y];const $=O.ids.findIndex(L=>L.id===_);var q=$===S-1;(q||!m&&$!==-1)&&(m=O)}if(!m)return c=new Error("invalid rev tree"),c.docId=t,r(c);const j=g._rev.split("-")[1],U=m.ids.findIndex($=>$.id===j)+1;var x=m.ids.length-U;if(m.ids.splice(U,x),m.ids.reverse(),n.revs&&(g._revisions={start:m.pos+m.ids.length-1,ids:m.ids.map(function($){return $.id})}),n.revs_info){var T=m.pos+m.ids.length;g._revs_info=m.ids.map(function($){return T--,{rev:T+"-"+$.id,status:$.opts.status}})}}if(n.attachments&&g._attachments){var P=g._attachments,D=Object.keys(P).length;if(D===0)return r(null,g);Object.keys(P).forEach(j=>{this._getAttachment(g._id,j,P[j],{binary:n.binary,metadata:o,ctx:f},function(U,$){var L=g._attachments[j];L.data=$,delete L.stub,delete L.length,--D||r(null,g)})})}else{if(g._attachments)for(var K in g._attachments)Object.prototype.hasOwnProperty.call(g._attachments,K)&&(g._attachments[K].stub=!0);r(null,g)}})}).bind(this),this.getAttachment=te("getAttachment",function(t,n,r,i){r instanceof Function&&(i=r,r={}),this._get(t,r,(a,s)=>{if(a)return i(a);if(s.doc._attachments&&s.doc._attachments[n])r.ctx=s.ctx,r.binary=!0,r.metadata=s.metadata,this._getAttachment(t,n,s.doc._attachments[n],r,i);else return i(M(he))})}).bind(this),this.allDocs=te("allDocs",function(t,n){if(typeof t=="function"&&(n=t,t={}),t.skip=typeof t.skip<"u"?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return n(new TypeError("options.keys must be an array"));var r=["startkey","endkey","key"].filter(function(i){return i in t})[0];if(r){n(M(Rr,"Query parameter `"+r+"` is not compatible with multi-get"));return}if(!ke(this)&&(li(t),t.keys.length===0))return this._allDocs({limit:0},n)}return this._allDocs(t,n)}).bind(this),this.close=te("close",function(t){return this._closed=!0,this.emit("closed"),this._close(t)}).bind(this),this.info=te("info",function(t){this._info((n,r)=>{if(n)return t(n);r.db_name=r.db_name||this.name,r.auto_compaction=!!(this.auto_compaction&&!ke(this)),r.adapter=this.adapter,t(null,r)})}).bind(this),this.id=te("id",function(t){return this._id(t)}).bind(this),this.bulkDocs=te("bulkDocs",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),n=n||{},Array.isArray(t)&&(t={docs:t}),!t||!t.docs||!Array.isArray(t.docs))return r(M(xr));for(var i=0;i<t.docs.length;++i){const c=t.docs[i];if(lt(c))return r(M(ct));if("_rev"in c&&!dt(c._rev))return r(M(Xe))}var a;if(t.docs.forEach(function(c){c._attachments&&Object.keys(c._attachments).forEach(function(l){a=a||hi(l),c._attachments[l].content_type||_e("warn","Attachment",l,"on document",c._id,"is missing content_type")})}),a)return r(M(rt,a));"new_edits"in n||("new_edits"in t?n.new_edits=t.new_edits:n.new_edits=!0);var s=this;!n.new_edits&&!ke(s)&&t.docs.sort(ci),ui(t.docs);var u=t.docs.map(function(c){return c._id});this._bulkDocs(t,n,function(c,l){if(c)return r(c);if(n.new_edits||(l=l.filter(function(f){return f.error})),!ke(s))for(var g=0,o=l.length;g<o;g++)l[g].id=l[g].id||u[g];r(null,l)})}).bind(this),this.registerDependentDatabase=te("registerDependentDatabase",function(t,n){var r=se(this.__opts);this.__opts.view_adapter&&(r.adapter=this.__opts.view_adapter);var i=new this.constructor(t,r);function a(s){return s.dependentDbs=s.dependentDbs||{},s.dependentDbs[t]?!1:(s.dependentDbs[t]=!0,s)}Ve(this,"_local/_pouch_dependentDbs",a).then(function(){n(null,{db:i})}).catch(n)}).bind(this),this.destroy=te("destroy",function(t,n){typeof t=="function"&&(n=t,t={});var r="use_prefix"in this?this.use_prefix:!0;const i=()=>{this._destroy(t,(a,s)=>{if(a)return n(a);this._destroyed=!0,this.emit("destroyed"),n(null,s||{ok:!0})})};if(ke(this))return i();this.get("_local/_pouch_dependentDbs",(a,s)=>{if(a)return a.status!==404?n(a):i();var u=s.dependentDbs,c=this.constructor,l=Object.keys(u).map(g=>{var o=r?g.replace(new RegExp("^"+c.prefix),""):g;return new c(o,this.__opts).destroy()});Promise.all(l).then(i,n)})}).bind(this)}_compact(t,n){var r={return_docs:!1,last_seq:t.last_seq||0,since:t.last_seq||0},i=[],a,s=0;const u=g=>{this.activeTasks.update(a,{completed_items:++s}),i.push(this.compactDocument(g.id,0))},c=g=>{this.activeTasks.remove(a,g),n(g)},l=g=>{var o=g.last_seq;Promise.all(i).then(()=>Ve(this,"_local/compaction",f=>!f.last_seq||f.last_seq<o?(f.last_seq=o,f):!1)).then(()=>{this.activeTasks.remove(a),n(null,{ok:!0})}).catch(c)};this.info().then(g=>{a=this.activeTasks.add({name:"database_compaction",total_items:g.update_seq-r.last_seq}),this.changes(r).on("change",u).on("complete",l).on("error",c)})}changes(t,n){return typeof t=="function"&&(n=t,t={}),t=t||{},t.return_docs="return_docs"in t?t.return_docs:!t.live,new oi(this,t,n)}type(){return typeof this._type=="function"?this._type():this.adapter}}Wn.prototype.purge=te("_purge",function(e,t,n){if(typeof this._purge>"u")return n(M(Ft,"Purge is not implemented in the "+this.adapter+" adapter."));var r=this;r._getRevisionTree(e,(i,a)=>{if(i)return n(i);if(!a)return n(M(he));let s;try{s=Xr(a,t)}catch(u){return n(u.message||u)}r._purge(e,s,(u,c)=>{if(u)return n(u);di(r,e,t).then(function(){return n(null,c)})})})});class _i{constructor(){this.isReady=!1,this.failed=!1,this.queue=[]}execute(){var t;if(this.failed)for(;t=this.queue.shift();)t(this.failed);else for(;t=this.queue.shift();)t()}fail(t){this.failed=t,this.execute()}ready(t){this.isReady=!0,this.db=t,this.execute()}addTask(t){this.queue.push(t),this.failed&&this.execute()}}function gi(e,t){var n=e.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=J.adapters,i=J.preferredAdapters,a=J.prefix,s=t.adapter;if(!s)for(var u=0;u<i.length;++u){if(s=i[u],s==="idb"&&"websql"in r&&Ze()&&localStorage["_pouch__websqldb_"+a+e]){_e("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}var c=r[s],l=c&&"use_prefix"in c?c.use_prefix:!0;return{name:l?a+e:e,adapter:s}}function mi(e,t){e.prototype=Object.create(t.prototype,{constructor:{value:e}})}function Hn(e,t){let n=function(...r){if(!(this instanceof n))return new n(...r);t.apply(this,r)};return mi(n,e),n}function yi(e){function t(r){e.removeListener("closed",n),r||e.constructor.emit("destroyed",e.name)}function n(){e.removeListener("destroyed",t),e.constructor.emit("unref",e)}e.once("destroyed",t),e.once("closed",n),e.constructor.emit("ref",e)}class cn extends Wn{constructor(t,n){super(),this._setup(t,n)}_setup(t,n){if(super._setup(),n=n||{},t&&typeof t=="object"&&(n=t,t=n.name,delete n.name),n.deterministic_revs===void 0&&(n.deterministic_revs=!0),this.__opts=n=se(n),this.auto_compaction=n.auto_compaction,this.purged_infos_limit=n.purged_infos_limit||1e3,this.prefix=J.prefix,typeof t!="string")throw new Error("Missing/invalid DB name");var r=(n.prefix||"")+t,i=gi(r,n);if(n.name=i.name,n.adapter=n.adapter||i.adapter,this.name=t,this._adapter=n.adapter,J.emit("debug",["adapter","Picked adapter: ",n.adapter]),!J.adapters[n.adapter]||!J.adapters[n.adapter].valid())throw new Error("Invalid Adapter: "+n.adapter);if(n.view_adapter&&(!J.adapters[n.view_adapter]||!J.adapters[n.view_adapter].valid()))throw new Error("Invalid View Adapter: "+n.view_adapter);this.taskqueue=new _i,this.adapter=n.adapter,J.adapters[n.adapter].call(this,n,a=>{if(a)return this.taskqueue.fail(a);yi(this),this.emit("created",this),J.emit("created",this.name),this.taskqueue.ready(this)})}}const J=Hn(cn,function(e,t){cn.prototype._setup.call(this,e,t)});var Xn=fetch,$e=Headers;class pi{constructor(){this.tasks={}}list(){return Object.values(this.tasks)}add(t){const n=Kt();return this.tasks[n]={id:n,name:t.name,total_items:t.total_items,created_at:new Date().toJSON()},n}get(t){return this.tasks[t]}remove(t,n){return delete this.tasks[t],this.tasks}update(t,n){const r=this.tasks[t];if(typeof r<"u"){const i={id:r.id,name:r.name,created_at:r.created_at,total_items:n.total_items||r.total_items,completed_items:n.completed_items||r.completed_items,updated_at:new Date().toJSON()};this.tasks[t]=i}return this.tasks}}J.adapters={};J.preferredAdapters=[];J.prefix="_pouch_";var fn=new Oe;function wi(e){Object.keys(Oe.prototype).forEach(function(n){typeof Oe.prototype[n]=="function"&&(e[n]=fn[n].bind(fn))});var t=e._destructionListeners=new Map;e.on("ref",function(r){t.has(r.name)||t.set(r.name,[]),t.get(r.name).push(r)}),e.on("unref",function(r){if(t.has(r.name)){var i=t.get(r.name),a=i.indexOf(r);a<0||(i.splice(a,1),i.length>1?t.set(r.name,i):t.delete(r.name))}}),e.on("destroyed",function(r){if(t.has(r)){var i=t.get(r);t.delete(r),i.forEach(function(a){a.emit("destroyed",!0)})}})}wi(J);J.adapter=function(e,t,n){t.valid()&&(J.adapters[e]=t,n&&J.preferredAdapters.push(e))};J.plugin=function(e){if(typeof e=="function")e(J);else{if(typeof e!="object"||Object.keys(e).length===0)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach(function(t){J.prototype[t]=e[t]})}return this.__defaults&&(J.__defaults=Object.assign({},this.__defaults)),J};J.defaults=function(e){let t=Hn(J,function(n,r){r=r||{},n&&typeof n=="object"&&(r=n,n=r.name,delete r.name),r=Object.assign({},t.__defaults,r),J.call(this,n,r)});return t.preferredAdapters=J.preferredAdapters.slice(),Object.keys(J).forEach(function(n){n in t||(t[n]=J[n])}),t.__defaults=Object.assign({},this.__defaults,e),t};J.fetch=function(e,t){return Xn(e,t)};J.prototype.activeTasks=J.activeTasks=new pi;var bi="9.0.0";function Vt(e,t){for(var n=e,r=0,i=t.length;r<i;r++){var a=t[r];if(n=n[a],!n)break}return n}function Si(e,t){return e<t?-1:e>t?1:0}function en(e){for(var t=[],n="",r=0,i=e.length;r<i;r++){var a=e[r];r>0&&e[r-1]==="\\"&&(a==="$"||a===".")?n=n.substring(0,n.length-1)+a:a==="."?(t.push(n),n=""):n+=a}return t.push(n),t}var ki=["$or","$nor","$not"];function Yn(e){return ki.indexOf(e)>-1}function Zn(e){return Object.keys(e)[0]}function qi(e){return e[Zn(e)]}function Ue(e){var t={},n={$or:!0,$nor:!0};return e.forEach(function(r){Object.keys(r).forEach(function(i){var a=r[i];if(typeof a!="object"&&(a={$eq:a}),Yn(i))if(a instanceof Array){if(n[i]){n[i]=!1,t[i]=a;return}var s=[];t[i].forEach(function(c){Object.keys(a).forEach(function(l){var g=a[l],o=Math.max(Object.keys(c).length,Object.keys(g).length),f=Ue([c,g]);Object.keys(f).length<=o||s.push(f)})}),t[i]=s}else t[i]=Ue([a]);else{var u=t[i]=t[i]||{};Object.keys(a).forEach(function(c){var l=a[c];if(c==="$gt"||c==="$gte")return Ai(c,l,u);if(c==="$lt"||c==="$lte")return Oi(c,l,u);if(c==="$ne")return Ci(l,u);if(c==="$eq")return Di(l,u);if(c==="$regex")return Ei(l,u);u[c]=l})}})}),t}function Ai(e,t,n){typeof n.$eq<"u"||(typeof n.$gte<"u"?e==="$gte"?t>n.$gte&&(n.$gte=t):t>=n.$gte&&(delete n.$gte,n.$gt=t):typeof n.$gt<"u"?e==="$gte"?t>n.$gt&&(delete n.$gt,n.$gte=t):t>n.$gt&&(n.$gt=t):n[e]=t)}function Oi(e,t,n){typeof n.$eq<"u"||(typeof n.$lte<"u"?e==="$lte"?t<n.$lte&&(n.$lte=t):t<=n.$lte&&(delete n.$lte,n.$lt=t):typeof n.$lt<"u"?e==="$lte"?t<n.$lt&&(delete n.$lt,n.$lte=t):t<n.$lt&&(n.$lt=t):n[e]=t)}function Ci(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}function Di(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}function Ei(e,t){"$regex"in t?t.$regex.push(e):t.$regex=[e]}function Vn(e){for(var t in e){if(Array.isArray(e))for(var n in e)e[n].$and&&(e[n]=Ue(e[n].$and));var r=e[t];typeof r=="object"&&Vn(r)}return e}function er(e,t){for(var n in e){n==="$and"&&(t=!0);var r=e[n];typeof r=="object"&&(t=er(r,t))}return t}function xi(e){var t=se(e);er(t,!1)&&(t=Vn(t),"$and"in t&&(t=Ue(t.$and))),["$or","$nor"].forEach(function(s){s in t&&t[s].forEach(function(u){for(var c=Object.keys(u),l=0;l<c.length;l++){var g=c[l],o=u[g];(typeof o!="object"||o===null)&&(u[g]={$eq:o})}})}),"$not"in t&&(t.$not=Ue([t.$not]));for(var n=Object.keys(t),r=0;r<n.length;r++){var i=n[r],a=t[i];(typeof a!="object"||a===null)&&(a={$eq:a}),t[i]=a}return Ot(t),t}function Ot(e){Object.keys(e).forEach(function(t){var n=e[t];Array.isArray(n)?n.forEach(function(r){r&&typeof r=="object"&&Ot(r)}):t==="$ne"?e.$ne=[n]:t==="$regex"?e.$regex=[n]:n&&typeof n=="object"&&Ot(n)})}function Ti(e,t,n){for(var r="",i=n-e.length;r.length<i;)r+=t;return r}function Pi(e,t,n){var r=Ti(e,t,n);return r+e}var tr=-324,Ct=3,Dt="";function ne(e,t){if(e===t)return 0;e=Ie(e),t=Ie(t);var n=Et(e),r=Et(t);if(n-r!==0)return n-r;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return Li(e,t)}return Array.isArray(e)?$i(e,t):Ni(e,t)}function Ie(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=new Array(n);for(var r=0;r<n;r++)e[r]=Ie(t[r])}else{if(e instanceof Date)return e.toJSON();if(e!==null){e={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=t[i];typeof a<"u"&&(e[i]=Ie(a))}}}}return e}function Ri(e){if(e!==null)switch(typeof e){case"boolean":return e?1:0;case"number":return Ki(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),r=-1,i=n.length,a="";if(t)for(;++r<i;)a+=ye(n[r]);else for(;++r<i;){var s=n[r];a+=ye(s)+ye(e[s])}return a}return""}function ye(e){var t="\0";return e=Ie(e),Et(e)+Dt+Ri(e)+t}function Bi(e,t){var n=t,r,i=e[t]==="1";if(i)r=0,t++;else{var a=e[t]==="0";t++;var s="",u=e.substring(t,t+Ct),c=parseInt(u,10)+tr;for(a&&(c=-c),t+=Ct;;){var l=e[t];if(l==="\0")break;s+=l,t++}s=s.split("."),s.length===1?r=parseInt(s,10):r=parseFloat(s[0]+"."+s[1]),a&&(r=r-10),c!==0&&(r=parseFloat(r+"e"+c))}return{num:r,length:t-n}}function Ii(e,t){var n=e.pop();if(t.length){var r=t[t.length-1];n===r.element&&(t.pop(),r=t[t.length-1]);var i=r.element,a=r.index;if(Array.isArray(i))i.push(n);else if(a===e.length-2){var s=e.pop();i[s]=n}else e.push(n)}}function ji(e){for(var t=[],n=[],r=0;;){var i=e[r++];if(i==="\0"){if(t.length===1)return t.pop();Ii(t,n);continue}switch(i){case"1":t.push(null);break;case"2":t.push(e[r]==="1"),r++;break;case"3":var a=Bi(e,r);t.push(a.num),r+=a.length;break;case"4":for(var s="";;){var u=e[r];if(u==="\0")break;s+=u,r++}s=s.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(s);break;case"5":var c={element:[],index:t.length};t.push(c.element),n.push(c);break;case"6":var l={element:{},index:t.length};t.push(l.element),n.push(l);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function $i(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=ne(e[r],t[r]);if(i!==0)return i}return e.length===t.length?0:e.length>t.length?1:-1}function Li(e,t){return e===t?0:e>t?1:-1}function Ni(e,t){for(var n=Object.keys(e),r=Object.keys(t),i=Math.min(n.length,r.length),a=0;a<i;a++){var s=ne(n[a],r[a]);if(s!==0||(s=ne(e[n[a]],t[r[a]]),s!==0))return s}return n.length===r.length?0:n.length>r.length?1:-1}function Et(e){var t=["boolean","number","string","object"],n=t.indexOf(typeof e);if(~n)return e===null?1:Array.isArray(e)?5:n<3?n+2:n+3;if(Array.isArray(e))return 5}function Ki(e){if(e===0)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),r=e<0,i=r?"0":"2",a=(r?-n:n)-tr,s=Pi(a.toString(),"0",Ct);i+=Dt+s;var u=Math.abs(parseFloat(t[0]));r&&(u=10-u);var c=u.toFixed(20);return c=c.replace(/\.?0+$/,""),i+=Dt+c,i}function Fi(e){function t(n){return e.map(function(r){var i=Zn(r),a=en(i),s=Vt(n,a);return s})}return function(n,r){var i=t(n.doc),a=t(r.doc),s=ne(i,a);return s!==0?s:Si(n.doc._id,r.doc._id)}}function Gi(e,t,n){if(e=e.filter(function(s){return Le(s.doc,t.selector,n)}),t.sort){var r=Fi(t.sort);e=e.sort(r),typeof t.sort[0]!="string"&&qi(t.sort[0])==="desc"&&(e=e.reverse())}if("limit"in t||"skip"in t){var i=t.skip||0,a=("limit"in t?t.limit:e.length)+i;e=e.slice(i,a)}return e}function Le(e,t,n){return n.every(function(r){var i=t[r],a=en(r),s=Vt(e,a);return Yn(r)?Mi(r,i,e):et(i,e,a,s)})}function et(e,t,n,r){return e?typeof e=="object"?Object.keys(e).every(function(i){var a=e[i];if(i.indexOf("$")===0)return ln(i,t,a,n,r);var s=en(i);if(r===void 0&&typeof a!="object"&&s.length>0)return!1;var u=Vt(r,s);return typeof a=="object"?et(a,t,n,u):ln("$eq",t,a,s,u)}):e===r:!0}function Mi(e,t,n){return e==="$or"?t.some(function(r){return Le(n,r,Object.keys(r))}):e==="$not"?!Le(n,t,Object.keys(t)):!t.find(function(r){return Le(n,r,Object.keys(r))})}function ln(e,t,n,r,i){if(!hn[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return hn[e](t,n,r,i)}function Ge(e){return typeof e<"u"&&e!==null}function Ce(e){return typeof e<"u"}function Ui(e,t){if(typeof e!="number"||parseInt(e,10)!==e)return!1;var n=t[0],r=t[1];return e%n===r}function dn(e,t){return t.some(function(n){return e instanceof Array?e.some(function(r){return ne(n,r)===0}):ne(n,e)===0})}function Ji(e,t){return t.every(function(n){return e.some(function(r){return ne(n,r)===0})})}function zi(e,t){return e.length===t}function Qi(e,t){var n=new RegExp(t);return n.test(e)}function Wi(e,t){switch(t){case"null":return e===null;case"boolean":return typeof e=="boolean";case"number":return typeof e=="number";case"string":return typeof e=="string";case"array":return e instanceof Array;case"object":return{}.toString.call(e)==="[object Object]"}}var hn={$elemMatch:function(e,t,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.some(function(i){return Le(i,t,Object.keys(t))}):r.some(function(i){return et(t,e,n,i)})},$allMatch:function(e,t,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.every(function(i){return Le(i,t,Object.keys(t))}):r.every(function(i){return et(t,e,n,i)})},$eq:function(e,t,n,r){return Ce(r)&&ne(r,t)===0},$gte:function(e,t,n,r){return Ce(r)&&ne(r,t)>=0},$gt:function(e,t,n,r){return Ce(r)&&ne(r,t)>0},$lte:function(e,t,n,r){return Ce(r)&&ne(r,t)<=0},$lt:function(e,t,n,r){return Ce(r)&&ne(r,t)<0},$exists:function(e,t,n,r){return t?Ce(r):!Ce(r)},$mod:function(e,t,n,r){return Ge(r)&&Ui(r,t)},$ne:function(e,t,n,r){return t.every(function(i){return ne(r,i)!==0})},$in:function(e,t,n,r){return Ge(r)&&dn(r,t)},$nin:function(e,t,n,r){return Ge(r)&&!dn(r,t)},$size:function(e,t,n,r){return Ge(r)&&Array.isArray(r)&&zi(r,t)},$all:function(e,t,n,r){return Array.isArray(r)&&Ji(r,t)},$regex:function(e,t,n,r){return Ge(r)&&typeof r=="string"&&t.every(function(i){return Qi(r,i)})},$type:function(e,t,n,r){return Wi(r,t)}};function Hi(e,t){if(typeof t!="object")throw new Error("Selector error: expected a JSON object");t=xi(t);var n={doc:e},r=Gi([n],{selector:t},Object.keys(t));return r&&r.length===1}function Xi(e){return Ut(`"use strict";
return `+e+";",{})}function Yi(e){var t=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join(`
`);return Ut(t,{})}function Zi(e,t){if(e.selector&&e.filter&&e.filter!=="_selector"){var n=typeof e.filter=="string"?e.filter:"function";return t(new Error('selector invalid for filter "'+n+'"'))}t()}function Vi(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&typeof e.filter=="string"&&(e.filter==="_view"?e.view=rn(e.view):e.filter=rn(e.filter))}function ea(e,t){return t.filter&&typeof t.filter=="string"&&!t.doc_ids&&!ke(e.db)}function ta(e,t){var n=t.complete;if(t.filter==="_view"){if(!t.view||typeof t.view!="string"){var r=M(rt,"`view` filter parameter not found or invalid.");return n(r)}var i=At(t.view);e.db.get("_design/"+i[0],function(s,u){if(e.isCancelled)return n(null,{status:"cancelled"});if(s)return n(Ke(s));var c=u&&u.views&&u.views[i[1]]&&u.views[i[1]].map;if(!c)return n(M(he,u.views?"missing json key: "+i[1]:"missing json key: views"));t.filter=Yi(c),e.doChanges(t)})}else if(t.selector)t.filter=function(s){return Hi(s,t.selector)},e.doChanges(t);else{var a=At(t.filter);e.db.get("_design/"+a[0],function(s,u){if(e.isCancelled)return n(null,{status:"cancelled"});if(s)return n(Ke(s));var c=u&&u.filters&&u.filters[a[1]];if(!c)return n(M(he,u&&u.filters?"missing json key: "+a[1]:"missing json key: filters"));t.filter=Xi(c),e.doChanges(t)})}}function na(e){e._changesFilterPlugin={validate:Zi,normalize:Vi,shouldFilter:ea,filter:ta}}J.plugin(na);J.version=bi;function ra(e,t,n){return new Promise(function(r){var i=zt([""]);let a;{const s=n;a=e.objectStore(t).put(i,s)}a.onsuccess=function(){var s=navigator.userAgent.match(/Chrome\/(\d+)/),u=navigator.userAgent.match(/Edge\//);r(u||!s||parseInt(s[1],10)>=43)},a.onerror=e.onabort=function(s){s.preventDefault(),s.stopPropagation(),r(!1)}}).catch(function(){return!1})}function nr(e){return e.reduce(function(t,n){return t[n]=!0,t},{})}var ia=nr(["_id","_rev","_access","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),aa=nr(["_access","_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function vn(e){if(!/^\d+-/.test(e))return M(Xe);var t=e.indexOf("-"),n=e.substring(0,t),r=e.substring(t+1);return{prefix:parseInt(n,10),id:r}}function sa(e,t){for(var n=e.start-e.ids.length+1,r=e.ids,i=[r[0],t,[]],a=1,s=r.length;a<s;a++)i=[r[a],{status:"missing"},[i]];return[{pos:n,ids:i}]}function rr(e,t,n){n||(n={deterministic_revs:!0});var r,i,a,s={status:"available"};if(e._deleted&&(s.deleted=!0),t)if(e._id||(e._id=it()),i=Mn(e,n.deterministic_revs),e._rev){if(a=vn(e._rev),a.error)return a;e._rev_tree=[{pos:a.prefix,ids:[a.id,{status:"missing"},[[i,s,[]]]]}],r=a.prefix+1}else e._rev_tree=[{pos:1,ids:[i,s,[]]}],r=1;else if(e._revisions&&(e._rev_tree=sa(e._revisions,s),r=e._revisions.start,i=e._revisions.ids[0]),!e._rev_tree){if(a=vn(e._rev),a.error)return a;r=a.prefix,i=a.id,e._rev_tree=[{pos:r,ids:[i,s,[]]}]}Ln(e._id),e._rev=r+"-"+i;var u={metadata:{},data:{}};for(var c in e)if(Object.prototype.hasOwnProperty.call(e,c)){var l=c[0]==="_";if(l&&!ia[c]){var g=M(nn,c);throw g.message=nn.message+": "+c,g}else l&&!aa[c]?u.metadata[c.slice(1)]=e[c]:u.data[c]=e[c]}return u}function oa(e){try{return Jt(e)}catch{var t=M($n,"Attachment is not a valid base64 string");return{error:t}}}function ua(e,t,n){var r=oa(e.data);if(r.error)return n(r.error);e.length=r.length,t==="blob"?e.data=Qt(r,e.content_type):t==="base64"?e.data=ze(r):e.data=r,Xt(r,function(i){e.digest="md5-"+i,n()})}function ca(e,t,n){Xt(e.data,function(r){e.digest="md5-"+r,e.length=e.data.size||e.data.length||0,t==="binary"?Fn(e.data,function(i){e.data=i,n()}):t==="base64"?Ht(e.data,function(i){e.data=i,n()}):n()})}function fa(e,t,n){if(e.stub)return n();typeof e.data=="string"?ua(e,t,n):ca(e,t,n)}function la(e,t,n){if(!e.length)return n();var r=0,i;e.forEach(function(s){var u=s.data&&s.data._attachments?Object.keys(s.data._attachments):[],c=0;if(!u.length)return a();function l(o){i=o,c++,c===u.length&&a()}for(var g in s.data._attachments)Object.prototype.hasOwnProperty.call(s.data._attachments,g)&&fa(s.data._attachments[g],t,l)});function a(){r++,e.length===r&&(i?n(i):n())}}function da(e,t,n,r,i,a,s,u){if(ni(t.rev_tree,n.metadata.rev)&&!u)return r[i]=n,a();var c=t.winningRev||Re(t),l="deleted"in t?t.deleted:Ae(t,c),g="deleted"in n.metadata?n.metadata.deleted:Ae(n.metadata),o=/^1-/.test(n.metadata.rev);if(l&&!g&&u&&o){var f=n.data;f._rev=c,f._id=n.metadata.id,n=rr(f,u)}var v=zn(t.rev_tree,n.metadata.rev_tree[0],e),p=u&&(l&&g&&v.conflicts!=="new_leaf"||!l&&v.conflicts!=="new_leaf"||l&&!g&&v.conflicts==="new_branch");if(p){var S=M(Ne);return r[i]=S,a()}var _=n.metadata.rev;n.metadata.rev_tree=v.tree,n.stemmedRevs=v.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var d=Re(n.metadata),m=Ae(n.metadata,d),y=l===m?0:l<m?-1:1,O;_===d?O=m:O=Ae(n.metadata,_),s(n,d,m,O,!0,y,i,a)}function ha(e){return e.metadata.rev_tree[0].ids[1].status==="missing"}function va(e,t,n,r,i,a,s,u,c){e=e||1e3;function l(S,_,d){var m=Re(S.metadata),y=Ae(S.metadata,m);if("was_delete"in u&&y)return a[_]=M(he,"deleted"),d();var O=g&&ha(S);if(O){var q=M(Ne);return a[_]=q,d()}var x=y?0:1;s(S,m,y,y,!1,x,_,d)}var g=u.new_edits,o=new Map,f=0,v=t.length;function p(){++f===v&&c&&c()}t.forEach(function(S,_){if(S._id&&Pe(S._id)){var d=S._deleted?"_removeLocal":"_putLocal";n[d](S,{ctx:i},function(y,O){a[_]=y||O,p()});return}var m=S.metadata.id;o.has(m)?(v--,o.get(m).push([S,_])):o.set(m,[[S,_]])}),o.forEach(function(S,_){var d=0;function m(){++d<S.length?y():p()}function y(){var O=S[d],q=O[0],x=O[1];if(r.has(_))da(e,r.get(_),q,a,x,m,s,g);else{var T=zn([],q.metadata.rev_tree[0],e);q.metadata.rev_tree=T.tree,q.stemmedRevs=T.stemmedRevs||[],l(q,x,m)}}y()})}var _a=5,ie="document-store",ce="by-sequence",ve="attach-store",xe="attach-seq-store",fe="meta-store",be="local-store",ht="detect-blob-support";function ga(e){try{return JSON.parse(e)}catch{return Tn.parse(e)}}function ma(e){try{return JSON.stringify(e)}catch{return Tn.stringify(e)}}function Se(e){return function(t){var n="unknown_error";t.target&&t.target.error&&(n=t.target.error.name||t.target.error.message),e(M(Gt,n,t.type))}}function xt(e,t,n){return{data:ma(e),winningRev:t,deletedOrLocal:n?"1":"0",seq:e.seq,id:e.id}}function Te(e){if(!e)return null;var t=ga(e.data);return t.winningRev=e.winningRev,t.deleted=e.deletedOrLocal==="1",t.seq=e.seq,t}function tt(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function ir(e,t,n,r){n?r(e?typeof e!="string"?e:Wt(e,t):zt([""],{type:t})):e?typeof e!="string"?Kn(e,function(i){r(ze(i))}):r(e):r("")}function ar(e,t,n,r){var i=Object.keys(e._attachments||{});if(!i.length)return r&&r();var a=0;function s(){++a===i.length&&r&&r()}function u(c,l){var g=c._attachments[l],o=g.digest,f=n.objectStore(ve).get(o);f.onsuccess=function(v){g.body=v.target.result.body,s()}}i.forEach(function(c){t.attachments&&t.include_docs?u(e,c):(e._attachments[c].stub=!0,s())})}function Tt(e,t){return Promise.all(e.map(function(n){if(n.doc&&n.doc._attachments){var r=Object.keys(n.doc._attachments);return Promise.all(r.map(function(i){var a=n.doc._attachments[i];if("body"in a){var s=a.body,u=a.content_type;return new Promise(function(c){ir(s,u,t,function(l){n.doc._attachments[i]=Object.assign(Je(a,["digest","content_type"]),{data:l}),c()})})}}))}}))}function sr(e,t,n){var r=[],i=n.objectStore(ce),a=n.objectStore(ve),s=n.objectStore(xe),u=e.length;function c(){u--,u||l()}function l(){r.length&&r.forEach(function(g){var o=s.index("digestSeq").count(IDBKeyRange.bound(g+"::",g+"::￿",!1,!1));o.onsuccess=function(f){var v=f.target.result;v||a.delete(g)}})}e.forEach(function(g){var o=i.index("_doc_id_rev"),f=t+"::"+g;o.getKey(f).onsuccess=function(v){var p=v.target.result;if(typeof p!="number")return c();i.delete(p);var S=s.index("seq").openCursor(IDBKeyRange.only(p));S.onsuccess=function(_){var d=_.target.result;if(d){var m=d.value.digestSeq.split("::")[0];r.push(m),s.delete(d.primaryKey),d.continue()}else c()}}})}function pe(e,t,n){try{return{txn:e.transaction(t,n)}}catch(r){return{error:r}}}var Me=new Cr;function ya(e,t,n,r,i,a){for(var s=t.docs,u,c,l,g,o,f,v,p,S=0,_=s.length;S<_;S++){var d=s[S];d._id&&Pe(d._id)||(d=s[S]=rr(d,n.new_edits,e),d.error&&!v&&(v=d))}if(v)return a(v);var m=!1,y=0,O=new Array(s.length),q=new Map,x=!1,T=r._meta.blobSupport?"blob":"base64";la(s,T,function(k){if(k)return a(k);P()});function P(){var k=[ie,ce,ve,be,xe,fe],E=pe(i,k,"readwrite");if(E.error)return a(E.error);u=E.txn,u.onabort=Se(a),u.ontimeout=Se(a),u.oncomplete=$,c=u.objectStore(ie),l=u.objectStore(ce),g=u.objectStore(ve),o=u.objectStore(xe),f=u.objectStore(fe),f.get(fe).onsuccess=function(I){p=I.target.result,j()},z(function(I){if(I)return x=!0,a(I);U()})}function D(){m=!0,j()}function K(){va(e.revs_limit,s,r,q,u,O,Q,n,D)}function j(){!p||!m||(p.docCount+=y,f.put(p))}function U(){if(!s.length)return;var k=0;function E(){++k===s.length&&K()}function I(B){var N=Te(B.target.result);N&&q.set(N.id,N),E()}for(var G=0,R=s.length;G<R;G++){var b=s[G];if(b._id&&Pe(b._id)){E();continue}var A=c.get(b.metadata.id);A.onsuccess=I}}function $(){x||(Me.notify(r._meta.name),a(null,O))}function L(k,E){var I=g.get(k);I.onsuccess=function(G){if(G.target.result)E();else{var R=M(Br,"unknown stub attachment with digest "+k);R.status=412,E(R)}}}function z(k){var E=[];if(s.forEach(function(b){b.data&&b.data._attachments&&Object.keys(b.data._attachments).forEach(function(A){var B=b.data._attachments[A];B.stub&&E.push(B.digest)})}),!E.length)return k();var I=0,G;function R(){++I===E.length&&k(G)}E.forEach(function(b){L(b,function(A){A&&!G&&(G=A),R()})})}function Q(k,E,I,G,R,b,A,B){k.metadata.winningRev=E,k.metadata.deleted=I;var N=k.data;N._id=k.metadata.id,N._rev=k.metadata.rev,G&&(N._deleted=!0);var F=N._attachments&&Object.keys(N._attachments).length;if(F)return h(k,E,I,R,A,B);y+=b,j(),W(k,E,I,R,A,B)}function W(k,E,I,G,R,b){var A=k.data,B=k.metadata;A._doc_id_rev=B.id+"::"+B.rev,delete A._id,delete A._rev;function N(re){var le=k.stemmedRevs||[];G&&r.auto_compaction&&(le=le.concat(Hr(k.metadata))),le&&le.length&&sr(le,k.metadata.id,u),B.seq=re.target.result;var we=xt(B,E,I),X=c.put(we);X.onsuccess=Y}function F(re){re.preventDefault(),re.stopPropagation();var le=l.index("_doc_id_rev"),we=le.getKey(A._doc_id_rev);we.onsuccess=function(X){var H=l.put(A,X.target.result);H.onsuccess=N}}function Y(){O[R]={ok:!0,id:B.id,rev:B.rev},q.set(k.metadata.id,k.metadata),w(k,B.seq,b)}var ee=l.put(A);ee.onsuccess=N,ee.onerror=F}function h(k,E,I,G,R,b){var A=k.data,B=0,N=Object.keys(A._attachments);function F(){B===N.length&&W(k,E,I,G,R,b)}function Y(){B++,F()}N.forEach(function(ee){var re=k.data._attachments[ee];if(re.stub)B++,F();else{var le=re.data;delete re.data,re.revpos=parseInt(E,10);var we=re.digest;C(we,le,Y)}})}function w(k,E,I){var G=0,R=Object.keys(k.data._attachments||{});if(!R.length)return I();function b(){++G===R.length&&I()}function A(N){var F=k.data._attachments[N].digest,Y=o.put({seq:E,digestSeq:F+"::"+E});Y.onsuccess=b,Y.onerror=function(ee){ee.preventDefault(),ee.stopPropagation(),b()}}for(var B=0;B<R.length;B++)A(R[B])}function C(k,E,I){var G=g.count(k);G.onsuccess=function(R){var b=R.target.result;if(b)return I();var A={digest:k,body:E},B=g.put(A);B.onsuccess=I}}}function or(e,t,n,r,i){r===-1&&(r=1e3);var a=typeof e.getAll=="function"&&typeof e.getAllKeys=="function"&&r>1&&!n,s,u,c;function l(v){u=v.target.result,s&&i(s,u,c)}function g(v){s=v.target.result,u&&i(s,u,c)}function o(){if(!s.length)return i();var v=s[s.length-1],p;if(t&&t.upper)try{p=IDBKeyRange.bound(v,t.upper,!0,t.upperOpen)}catch(S){if(S.name==="DataError"&&S.code===0)return i()}else p=IDBKeyRange.lowerBound(v,!0);t=p,s=null,u=null,e.getAll(t,r).onsuccess=l,e.getAllKeys(t,r).onsuccess=g}function f(v){var p=v.target.result;if(!p)return i();i([p.key],[p.value],p)}a?(c={continue:o},e.getAll(t,r).onsuccess=l,e.getAllKeys(t,r).onsuccess=g):n?e.openCursor(t,"prev").onsuccess=f:e.openCursor(t).onsuccess=f}function pa(e,t,n){if(typeof e.getAll=="function"){e.getAll(t).onsuccess=n;return}var r=[];function i(a){var s=a.target.result;s?(r.push(s.value),s.continue()):n({target:{result:r}})}e.openCursor(t).onsuccess=i}function wa(e,t,n){var r=new Array(e.length),i=0;e.forEach(function(a,s){t.get(a).onsuccess=function(u){u.target.result?r[s]=u.target.result:r[s]={key:a,error:"not_found"},i++,i===e.length&&n(e,r,{})}})}function ba(e,t,n,r,i){try{if(e&&t)return i?IDBKeyRange.bound(t,e,!n,!1):IDBKeyRange.bound(e,t,!1,!n);if(e)return i?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return i?IDBKeyRange.lowerBound(t,!n):IDBKeyRange.upperBound(t,!n);if(r)return IDBKeyRange.only(r)}catch(a){return{error:a}}return null}function Sa(e,t,n){var r="startkey"in e?e.startkey:!1,i="endkey"in e?e.endkey:!1,a="key"in e?e.key:!1,s="keys"in e?e.keys:!1,u=e.skip||0,c=typeof e.limit=="number"?e.limit:-1,l=e.inclusive_end!==!1,g,o;if(!s&&(g=ba(r,i,l,a,e.descending),o=g&&g.error,o&&!(o.name==="DataError"&&o.code===0)))return n(M(Gt,o.name,o.message));var f=[ie,ce,fe];e.attachments&&f.push(ve);var v=pe(t,f,"readonly");if(v.error)return n(v.error);var p=v.txn;p.oncomplete=U,p.onabort=Se(n);var S=p.objectStore(ie),_=p.objectStore(ce),d=p.objectStore(fe),m=_.index("_doc_id_rev"),y=[],O,q;d.get(fe).onsuccess=function($){O=$.target.result.docCount},e.update_seq&&(_.openKeyCursor(null,"prev").onsuccess=$=>{var L=$.target.result;L&&L.key&&(q=L.key)});function x($,L,z){var Q=$.id+"::"+z;m.get(Q).onsuccess=function(h){if(L.doc=tt(h.target.result)||{},e.conflicts){var w=Zt($);w.length&&(L.doc._conflicts=w)}ar(L.doc,e,p)}}function T($,L){var z={id:L.id,key:L.id,value:{rev:$}},Q=L.deleted;Q?s&&(y.push(z),z.value.deleted=!0,z.doc=null):u--<=0&&(y.push(z),e.include_docs&&x(L,z,$))}function P($){for(var L=0,z=$.length;L<z&&y.length!==c;L++){var Q=$[L];if(Q.error&&s){y.push(Q);continue}var W=Te(Q),h=W.winningRev;T(h,W)}}function D($,L,z){z&&(P(L),y.length<c&&z.continue())}function K($){var L=$.target.result;e.descending&&(L=L.reverse()),P(L)}function j(){var $={total_rows:O,offset:e.skip,rows:y};e.update_seq&&q!==void 0&&($.update_seq=q),n(null,$)}function U(){e.attachments?Tt(y,e.binary).then(j):j()}if(!(o||c===0)){if(s)return wa(s,S,D);if(c===-1)return pa(S,g,K);or(S,g,e.descending,c+u,D)}}function ka(e,t){var n=e.objectStore(ie).index("deletedOrLocal");n.count(IDBKeyRange.only("0")).onsuccess=function(r){t(r.target.result)}}var Pt=!1,Rt=[];function qa(e,t,n,r){try{e(t,n)}catch(i){r.emit("error",i)}}function _n(){Pt||!Rt.length||(Pt=!0,Rt.shift()())}function Aa(e,t,n){Rt.push(function(){e(function(a,s){qa(t,a,s,n),Pt=!1,qe(function(){_n()})})}),_n()}function Oa(e,t,n,r){if(e=se(e),e.continuous){var i=n+":"+it();return Me.addListener(n,i,t,e),Me.notify(n),{cancel:function(){Me.removeListener(n,i)}}}var a=e.doc_ids&&new Set(e.doc_ids);e.since=e.since||0;var s=e.since,u="limit"in e?e.limit:-1;u===0&&(u=1);var c=[],l=0,g=Mt(e),o=new Map,f,v,p,S;function _(P,D,K){if(!K||!P.length)return;var j=new Array(P.length),U=new Array(P.length);function $(Q,W){var h=e.processChange(W,Q,e);s=h.seq=Q.seq;var w=g(h);return typeof w=="object"?Promise.reject(w):w?(l++,e.return_docs&&c.push(h),e.attachments&&e.include_docs?new Promise(function(C){ar(W,e,f,function(){Tt([h],e.binary).then(function(){C(h)})})}):Promise.resolve(h)):Promise.resolve()}function L(){for(var Q=[],W=0,h=j.length;W<h&&l!==u;W++){var w=j[W];if(w){var C=U[W];Q.push($(C,w))}}Promise.all(Q).then(function(k){for(var E=0,I=k.length;E<I;E++)k[E]&&e.onChange(k[E])}).catch(e.complete),l!==u&&K.continue()}var z=0;D.forEach(function(Q,W){var h=tt(Q),w=P[W];m(h,w,function(C,k){U[W]=C,j[W]=k,++z===P.length&&L()})})}function d(P,D,K,j){if(K.seq!==D)return j();if(K.winningRev===P._rev)return j(K,P);var U=P._id+"::"+K.winningRev,$=S.get(U);$.onsuccess=function(L){j(K,tt(L.target.result))}}function m(P,D,K){if(a&&!a.has(P._id))return K();var j=o.get(P._id);if(j)return d(P,D,j,K);p.get(P._id).onsuccess=function(U){j=Te(U.target.result),o.set(P._id,j),d(P,D,j,K)}}function y(){e.complete(null,{results:c,last_seq:s})}function O(){!e.continuous&&e.attachments?Tt(c).then(y):y()}var q=[ie,ce];e.attachments&&q.push(ve);var x=pe(r,q,"readonly");if(x.error)return e.complete(x.error);f=x.txn,f.onabort=Se(e.complete),f.oncomplete=O,v=f.objectStore(ce),p=f.objectStore(ie),S=v.index("_doc_id_rev");var T=e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null;or(v,T,e.descending,u,_)}var je=new Map,vt,_t=new Map;function ur(e,t){var n=this;Aa(function(r){Ca(n,e,r)},t,n.constructor)}function Ca(e,t,n){var r=t.name,i=null,a=null;e._meta=null;function s(_){return function(d,m){d&&d instanceof Error&&!d.reason&&a&&(d.reason=a),_(d,m)}}function u(_){var d=_.createObjectStore(ie,{keyPath:"id"});_.createObjectStore(ce,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),_.createObjectStore(ve,{keyPath:"digest"}),_.createObjectStore(fe,{keyPath:"id",autoIncrement:!1}),_.createObjectStore(ht),d.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),_.createObjectStore(be,{keyPath:"_id"});var m=_.createObjectStore(xe,{autoIncrement:!0});m.createIndex("seq","seq"),m.createIndex("digestSeq","digestSeq",{unique:!0})}function c(_,d){var m=_.objectStore(ie);m.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),m.openCursor().onsuccess=function(y){var O=y.target.result;if(O){var q=O.value,x=Ae(q);q.deletedOrLocal=x?"1":"0",m.put(q),O.continue()}else d()}}function l(_){_.createObjectStore(be,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function g(_,d){var m=_.objectStore(be),y=_.objectStore(ie),O=_.objectStore(ce),q=y.openCursor();q.onsuccess=function(x){var T=x.target.result;if(T){var P=T.value,D=P.id,K=Pe(D),j=Re(P);if(K){var U=D+"::"+j,$=D+"::",L=D+"::~",z=O.index("_doc_id_rev"),Q=IDBKeyRange.bound($,L,!1,!1),W=z.openCursor(Q);W.onsuccess=function(h){if(W=h.target.result,!W)y.delete(T.primaryKey),T.continue();else{var w=W.value;w._doc_id_rev===U&&m.put(w),O.delete(W.primaryKey),W.continue()}}}else T.continue()}else d&&d()}}function o(_){var d=_.createObjectStore(xe,{autoIncrement:!0});d.createIndex("seq","seq"),d.createIndex("digestSeq","digestSeq",{unique:!0})}function f(_,d){var m=_.objectStore(ce),y=_.objectStore(ve),O=_.objectStore(xe),q=y.count();q.onsuccess=function(x){var T=x.target.result;if(!T)return d();m.openCursor().onsuccess=function(P){var D=P.target.result;if(!D)return d();for(var K=D.value,j=D.primaryKey,U=Object.keys(K._attachments||{}),$={},L=0;L<U.length;L++){var z=K._attachments[U[L]];$[z.digest]=!0}var Q=Object.keys($);for(L=0;L<Q.length;L++){var W=Q[L];O.put({seq:j,digestSeq:W+"::"+j})}D.continue()}}}function v(_){function d(q){return q.data?Te(q):(q.deleted=q.deletedOrLocal==="1",q)}var m=_.objectStore(ce),y=_.objectStore(ie),O=y.openCursor();O.onsuccess=function(q){var x=q.target.result;if(!x)return;var T=d(x.value);T.winningRev=T.winningRev||Re(T);function P(){var K=T.id+"::",j=T.id+"::￿",U=m.index("_doc_id_rev").openCursor(IDBKeyRange.bound(K,j)),$=0;U.onsuccess=function(L){var z=L.target.result;if(!z)return T.seq=$,D();var Q=z.primaryKey;Q>$&&($=Q),z.continue()}}function D(){var K=xt(T,T.winningRev,T.deleted),j=y.put(K);j.onsuccess=function(){x.continue()}}if(T.seq)return D();P()}}e._remote=!1,e.type=function(){return"idb"},e._id=Bn(function(_){_(null,e._meta.instanceId)}),e._bulkDocs=function(d,m,y){ya(t,d,m,e,i,s(y))},e._get=function(d,m,y){var O,q,x,T=m.ctx;if(!T){var P=pe(i,[ie,ce,ve],"readonly");if(P.error)return y(P.error);T=P.txn}function D(){y(x,{doc:O,metadata:q,ctx:T})}T.objectStore(ie).get(d).onsuccess=function(K){if(q=Te(K.target.result),!q)return x=M(he,"missing"),D();var j;if(m.rev)j=m.latest?ii(m.rev,q):m.rev;else{j=q.winningRev;var U=Ae(q);if(U)return x=M(he,"deleted"),D()}var $=T.objectStore(ce),L=q.id+"::"+j;$.index("_doc_id_rev").get(L).onsuccess=function(z){if(O=z.target.result,O&&(O=tt(O)),!O)return x=M(he,"missing"),D();D()}}},e._getAttachment=function(_,d,m,y,O){var q;if(y.ctx)q=y.ctx;else{var x=pe(i,[ie,ce,ve],"readonly");if(x.error)return O(x.error);q=x.txn}var T=m.digest,P=m.content_type;q.objectStore(ve).get(T).onsuccess=function(D){var K=D.target.result.body;ir(K,P,y.binary,function(j){O(null,j)})}},e._info=function(d){var m,y,O=pe(i,[fe,ce],"readonly");if(O.error)return d(O.error);var q=O.txn;q.objectStore(fe).get(fe).onsuccess=function(x){y=x.target.result.docCount},q.objectStore(ce).openKeyCursor(null,"prev").onsuccess=function(x){var T=x.target.result;m=T?T.key:0},q.oncomplete=function(){d(null,{doc_count:y,update_seq:m,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(d,m){Sa(d,i,s(m))},e._changes=function(d){return Oa(d,e,r,i)},e._close=function(_){i.close(),je.delete(r),_()},e._getRevisionTree=function(_,d){var m=pe(i,[ie],"readonly");if(m.error)return d(m.error);var y=m.txn,O=y.objectStore(ie).get(_);O.onsuccess=function(q){var x=Te(q.target.result);x?d(null,x.rev_tree):d(M(he))}},e._doCompaction=function(_,d,m){var y=[ie,ce,ve,xe],O=pe(i,y,"readwrite");if(O.error)return m(O.error);var q=O.txn,x=q.objectStore(ie);x.get(_).onsuccess=function(T){var P=Te(T.target.result);Be(P.rev_tree,function(j,U,$,L,z){var Q=U+"-"+$;d.indexOf(Q)!==-1&&(z.status="missing")}),sr(d,_,q);var D=P.winningRev,K=P.deleted;q.objectStore(ie).put(xt(P,D,K))},q.onabort=Se(m),q.oncomplete=function(){m()}},e._getLocal=function(_,d){var m=pe(i,[be],"readonly");if(m.error)return d(m.error);var y=m.txn,O=y.objectStore(be).get(_);O.onerror=Se(d),O.onsuccess=function(q){var x=q.target.result;x?(delete x._doc_id_rev,d(null,x)):d(M(he))}},e._putLocal=function(_,d,m){typeof d=="function"&&(m=d,d={}),delete _._revisions;var y=_._rev,O=_._id;y?_._rev="0-"+(parseInt(y.split("-")[1],10)+1):_._rev="0-1";var q=d.ctx,x;if(!q){var T=pe(i,[be],"readwrite");if(T.error)return m(T.error);q=T.txn,q.onerror=Se(m),q.oncomplete=function(){x&&m(null,x)}}var P=q.objectStore(be),D;y?(D=P.get(O),D.onsuccess=function(K){var j=K.target.result;if(!j||j._rev!==y)m(M(Ne));else{var U=P.put(_);U.onsuccess=function(){x={ok:!0,id:_._id,rev:_._rev},d.ctx&&m(null,x)}}}):(D=P.add(_),D.onerror=function(K){m(M(Ne)),K.preventDefault(),K.stopPropagation()},D.onsuccess=function(){x={ok:!0,id:_._id,rev:_._rev},d.ctx&&m(null,x)})},e._removeLocal=function(_,d,m){typeof d=="function"&&(m=d,d={});var y=d.ctx;if(!y){var O=pe(i,[be],"readwrite");if(O.error)return m(O.error);y=O.txn,y.oncomplete=function(){q&&m(null,q)}}var q,x=_._id,T=y.objectStore(be),P=T.get(x);P.onerror=Se(m),P.onsuccess=function(D){var K=D.target.result;!K||K._rev!==_._rev?m(M(he)):(T.delete(x),q={ok:!0,id:x,rev:"0-0"},d.ctx&&m(null,q))}},e._destroy=function(_,d){Me.removeAllListeners(r);var m=_t.get(r);m&&m.result&&(m.result.close(),je.delete(r));var y=indexedDB.deleteDatabase(r);y.onsuccess=function(){_t.delete(r),Ze()&&r in localStorage&&delete localStorage[r],d(null,{ok:!0})},y.onerror=Se(d)};var p=je.get(r);if(p)return i=p.idb,e._meta=p.global,qe(function(){n(null,e)});var S=indexedDB.open(r,_a);_t.set(r,S),S.onupgradeneeded=function(_){var d=_.target.result;if(_.oldVersion<1)return u(d);var m=_.currentTarget.transaction;_.oldVersion<3&&l(d),_.oldVersion<4&&o(d);var y=[c,g,f,v],O=_.oldVersion;function q(){var x=y[O-1];O++,x&&x(m,q)}q()},S.onsuccess=function(_){i=_.target.result,i.onversionchange=function(){i.close(),je.delete(r)},i.onabort=function(D){_e("error","Database has a global failure",D.target.error),a=D.target.error,i.close(),je.delete(r)};var d=i.transaction([fe,ht,ie],"readwrite"),m=!1,y,O,q,x;function T(){typeof q>"u"||!m||(e._meta={name:r,instanceId:x,blobSupport:q},je.set(r,{idb:i,global:e._meta}),n(null,e))}function P(){if(!(typeof O>"u"||typeof y>"u")){var D=r+"_id";D in y?x=y[D]:y[D]=x=it(),y.docCount=O,d.objectStore(fe).put(y)}}d.objectStore(fe).get(fe).onsuccess=function(D){y=D.target.result||{id:fe},P()},ka(d,function(D){O=D,P()}),vt||(vt=ra(d,ht,"key")),vt.then(function(D){q=D,T()}),d.oncomplete=function(){m=!0,T()},d.onabort=Se(n)},S.onerror=function(_){var d=_.target.error&&_.target.error.message;d?d.indexOf("stored database is a higher version")!==-1&&(d=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):d="Failed to open indexedDB, are you in private browsing mode?",_e("error",d),n(M(Gt,d))}}ur.valid=function(){try{return typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}};function Da(e){e.adapter("idb",ur,!0)}function Ea(e,t){return new Promise(function(n,r){var i=0,a=0,s=0,u=e.length,c;function l(){i++,e[a++]().then(o,f)}function g(){++s===u?c?r(c):n():v()}function o(){i--,g()}function f(p){i--,c=c||p,g()}function v(){for(;i<t&&a<u;)l()}v()})}const xa=25,Ta=50,We=5e3,Pa=1e4,gt={};function mt(e){const t=e.doc||e.ok,n=t&&t._attachments;n&&Object.keys(n).forEach(function(r){const i=n[r];i.data=Wt(i.data,i.content_type)})}function De(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):e.startsWith("_local/")?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function gn(e){return!e._attachments||!Object.keys(e._attachments)?Promise.resolve():Promise.all(Object.keys(e._attachments).map(function(t){const n=e._attachments[t];if(n.data&&typeof n.data!="string")return new Promise(function(r){Ht(n.data,r)}).then(function(r){n.data=r})}))}function Ra(e){if(!e.prefix)return!1;const t=Nn(e.prefix).protocol;return t==="http"||t==="https"}function Ba(e,t){if(Ra(t)){const i=t.name.substr(t.prefix.length);e=t.prefix.replace(/\/?$/,"/")+encodeURIComponent(i)}const n=Nn(e);(n.user||n.password)&&(n.auth={username:n.user,password:n.password});const r=n.path.replace(/(^\/|\/$)/g,"").split("/");return n.db=r.pop(),n.db.indexOf("%")===-1&&(n.db=encodeURIComponent(n.db)),n.path=r.join("/"),n}function ae(e,t){return Ye(e,e.db+"/"+t)}function Ye(e,t){const n=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+n+t}function He(e){const t=Object.keys(e);return t.length===0?"":"?"+t.map(n=>n+"="+encodeURIComponent(e[n])).join("&")}function Ia(e){const t=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=t.indexOf("msie")!==-1,r=t.indexOf("trident")!==-1,i=t.indexOf("edge")!==-1,a=!("method"in e)||e.method==="GET";return(n||r||i)&&a}function Bt(e,t){const n=this,r=Ba(e.name,e),i=ae(r,"");e=se(e);const a=async function(o,f){if(f=f||{},f.headers=f.headers||new $e,f.credentials="include",e.auth||r.auth){const S=e.auth||r.auth,_=S.username+":"+S.password,d=ze(unescape(encodeURIComponent(_)));f.headers.set("Authorization","Basic "+d)}const v=e.headers||{};return Object.keys(v).forEach(function(S){f.headers.append(S,v[S])}),Ia(f)&&(o+=(o.indexOf("?")===-1?"?":"&")+"_nonce="+Date.now()),await(e.fetch||Xn)(o,f)};function s(o,f){return te(o,function(...v){l().then(function(){return f.apply(this,v)}).catch(function(p){v.pop()(p)})}).bind(n)}async function u(o,f){const v={};f=f||{},f.headers=f.headers||new $e,f.headers.get("Content-Type")||f.headers.set("Content-Type","application/json"),f.headers.get("Accept")||f.headers.set("Accept","application/json");const p=await a(o,f);v.ok=p.ok,v.status=p.status;const S=await p.json();if(v.data=S,!v.ok)throw v.data.status=v.status,Ke(v.data);return Array.isArray(v.data)&&(v.data=v.data.map(function(_){return _.error||_.missing?Ke(_):_})),v}let c;async function l(){return e.skip_setup?Promise.resolve():c||(c=u(i).catch(function(o){return o&&o.status&&o.status===404?(qt(404,"PouchDB is just detecting if the remote exists."),u(i,{method:"PUT"})):Promise.reject(o)}).catch(function(o){return o&&o.status&&o.status===412?!0:Promise.reject(o)}),c.catch(function(){c=null}),c)}qe(function(){t(null,n)}),n._remote=!0,n.type=function(){return"http"},n.id=s("id",async function(o){let f;try{f=await(await a(Ye(r,""))).json()}catch{f={}}const v=f&&f.uuid?f.uuid+r.db:ae(r,"");o(null,v)}),n.compact=s("compact",async function(o,f){typeof o=="function"&&(f=o,o={}),o=se(o),await u(ae(r,"_compact"),{method:"POST"});function v(){n.info(function(p,S){S&&!S.compact_running?f(null,{ok:!0}):setTimeout(v,o.interval||200)})}v()}),n.bulkGet=te("bulkGet",function(o,f){const v=this;async function p(m){const y={};o.revs&&(y.revs=!0),o.attachments&&(y.attachments=!0),o.latest&&(y.latest=!0);try{const O=await u(ae(r,"_bulk_get"+He(y)),{method:"POST",body:JSON.stringify({docs:o.docs})});o.attachments&&o.binary&&O.data.results.forEach(function(q){q.docs.forEach(mt)}),m(null,O.data)}catch(O){m(O)}}function S(){const m=Ta,y=Math.ceil(o.docs.length/m);let O=0;const q=new Array(y);function x(T){return function(P,D){q[T]=D.results,++O===y&&f(null,{results:q.flat()})}}for(let T=0;T<y;T++){const P=Je(o,["revs","attachments","binary","latest"]);P.docs=o.docs.slice(T*m,Math.min(o.docs.length,(T+1)*m)),In(v,P,x(T))}}const _=Ye(r,""),d=gt[_];typeof d!="boolean"?p(function(m,y){m?(gt[_]=!1,qt(m.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),S()):(gt[_]=!0,f(null,y))}):d?p(f):S()}),n._info=async function(o){try{await l();const v=await(await a(ae(r,""))).json();v.host=ae(r,""),o(null,v)}catch(f){o(f)}},n.fetch=async function(o,f){await l();const v=o.substring(0,1)==="/"?Ye(r,o.substring(1)):ae(r,o);return a(v,f)},n.get=s("get",async function(o,f,v){typeof f=="function"&&(v=f,f={}),f=se(f);const p={};f.revs&&(p.revs=!0),f.revs_info&&(p.revs_info=!0),f.latest&&(p.latest=!0),f.open_revs&&(f.open_revs!=="all"&&(f.open_revs=JSON.stringify(f.open_revs)),p.open_revs=f.open_revs),f.rev&&(p.rev=f.rev),f.conflicts&&(p.conflicts=f.conflicts),f.update_seq&&(p.update_seq=f.update_seq),o=De(o);function S(m){const y=m._attachments,O=y&&Object.keys(y);if(!y||!O.length)return;async function q(T){const P=y[T],D=De(m._id)+"/"+g(T)+"?rev="+m._rev,K=await a(ae(r,D));let j;"buffer"in K?j=await K.buffer():j=await K.blob();let U;if(f.binary){const $=Object.getOwnPropertyDescriptor(j.__proto__,"type");(!$||$.set)&&(j.type=P.content_type),U=j}else U=await new Promise(function($){Ht(j,$)});delete P.stub,delete P.length,P.data=U}const x=O.map(function(T){return function(){return q(T)}});return Ea(x,5)}function _(m){return Array.isArray(m)?Promise.all(m.map(function(y){if(y.ok)return S(y.ok)})):S(m)}const d=ae(r,o+He(p));try{const m=await u(d);f.attachments&&await _(m.data),v(null,m.data)}catch(m){m.docId=o,v(m)}}),n.remove=s("remove",async function(o,f,v,p){let S;typeof f=="string"?(S={_id:o,_rev:f},typeof v=="function"&&(p=v,v={})):(S=o,typeof f=="function"?(p=f,v={}):(p=v,v=f));const _=S._rev||v.rev,d=ae(r,De(S._id))+"?rev="+_;try{const m=await u(d,{method:"DELETE"});p(null,m.data)}catch(m){p(m)}});function g(o){return o.split("/").map(encodeURIComponent).join("/")}n.getAttachment=s("getAttachment",async function(o,f,v,p){typeof v=="function"&&(p=v,v={});const S=v.rev?"?rev="+v.rev:"",_=ae(r,De(o))+"/"+g(f)+S;let d;try{const m=await a(_,{method:"GET"});if(!m.ok)throw m;d=m.headers.get("content-type");let y;if(typeof process<"u"&&!process.browser&&typeof m.buffer=="function"?y=await m.buffer():y=await m.blob(),typeof process<"u"&&!process.browser){const O=Object.getOwnPropertyDescriptor(y.__proto__,"type");(!O||O.set)&&(y.type=d)}p(null,y)}catch(m){p(m)}}),n.removeAttachment=s("removeAttachment",async function(o,f,v,p){const S=ae(r,De(o)+"/"+g(f))+"?rev="+v;try{const _=await u(S,{method:"DELETE"});p(null,_.data)}catch(_){p(_)}}),n.putAttachment=s("putAttachment",async function(o,f,v,p,S,_){typeof S=="function"&&(_=S,S=p,p=v,v=null);const d=De(o)+"/"+g(f);let m=ae(r,d);if(v&&(m+="?rev="+v),typeof p=="string"){let y;try{y=Jt(p)}catch{return _(M($n,"Attachment is not a valid base64 string"))}p=y?Qt(y,S):""}try{const y=await u(m,{headers:new $e({"Content-Type":S}),method:"PUT",body:p});_(null,y.data)}catch(y){_(y)}}),n._bulkDocs=async function(o,f,v){o.new_edits=f.new_edits;try{await l(),await Promise.all(o.docs.map(gn));const p=await u(ae(r,"_bulk_docs"),{method:"POST",body:JSON.stringify(o)});v(null,p.data)}catch(p){v(p)}},n._put=async function(o,f,v){try{await l(),await gn(o);const p=await u(ae(r,De(o._id)),{method:"PUT",body:JSON.stringify(o)});v(null,p.data)}catch(p){p.docId=o&&o._id,v(p)}},n.allDocs=s("allDocs",async function(o,f){typeof o=="function"&&(f=o,o={}),o=se(o);const v={};let p,S="GET";o.conflicts&&(v.conflicts=!0),o.update_seq&&(v.update_seq=!0),o.descending&&(v.descending=!0),o.include_docs&&(v.include_docs=!0),o.attachments&&(v.attachments=!0),o.key&&(v.key=JSON.stringify(o.key)),o.start_key&&(o.startkey=o.start_key),o.startkey&&(v.startkey=JSON.stringify(o.startkey)),o.end_key&&(o.endkey=o.end_key),o.endkey&&(v.endkey=JSON.stringify(o.endkey)),typeof o.inclusive_end<"u"&&(v.inclusive_end=!!o.inclusive_end),typeof o.limit<"u"&&(v.limit=o.limit),typeof o.skip<"u"&&(v.skip=o.skip);const _=He(v);typeof o.keys<"u"&&(S="POST",p={keys:o.keys});try{const d=await u(ae(r,"_all_docs"+_),{method:S,body:JSON.stringify(p)});o.include_docs&&o.attachments&&o.binary&&d.data.rows.forEach(mt),f(null,d.data)}catch(d){f(d)}}),n._changes=function(o){const f="batch_size"in o?o.batch_size:xa;o=se(o),o.continuous&&!("heartbeat"in o)&&(o.heartbeat=Pa);let v="timeout"in o?o.timeout:30*1e3;"timeout"in o&&o.timeout&&v-o.timeout<We&&(v=o.timeout+We),"heartbeat"in o&&o.heartbeat&&v-o.heartbeat<We&&(v=o.heartbeat+We);const p={};"timeout"in o&&o.timeout&&(p.timeout=o.timeout);const S=typeof o.limit<"u"?o.limit:!1;let _=S;if(o.style&&(p.style=o.style),(o.include_docs||o.filter&&typeof o.filter=="function")&&(p.include_docs=!0),o.attachments&&(p.attachments=!0),o.continuous&&(p.feed="longpoll"),o.seq_interval&&(p.seq_interval=o.seq_interval),o.conflicts&&(p.conflicts=!0),o.descending&&(p.descending=!0),o.update_seq&&(p.update_seq=!0),"heartbeat"in o&&o.heartbeat&&(p.heartbeat=o.heartbeat),o.filter&&typeof o.filter=="string"&&(p.filter=o.filter),o.view&&typeof o.view=="string"&&(p.filter="_view",p.view=o.view),o.query_params&&typeof o.query_params=="object")for(const P in o.query_params)Object.prototype.hasOwnProperty.call(o.query_params,P)&&(p[P]=o.query_params[P]);let d="GET",m;o.doc_ids?(p.filter="_doc_ids",d="POST",m={doc_ids:o.doc_ids}):o.selector&&(p.filter="_selector",d="POST",m={selector:o.selector});const y=new AbortController;let O;const q=async function(P,D){if(o.aborted)return;p.since=P,typeof p.since=="object"&&(p.since=JSON.stringify(p.since)),o.descending?S&&(p.limit=_):p.limit=!S||_>f?f:_;const K=ae(r,"_changes"+He(p)),j={signal:y.signal,method:d,body:JSON.stringify(m)};if(O=P,!o.aborted)try{await l();const U=await u(K,j);D(null,U.data)}catch(U){D(U)}},x={results:[]},T=function(P,D){if(o.aborted)return;let K=0;if(D&&D.results){K=D.results.length,x.last_seq=D.last_seq;let U=null,$=null;typeof D.pending=="number"&&(U=D.pending),(typeof x.last_seq=="string"||typeof x.last_seq=="number")&&($=x.last_seq),o.query_params,D.results=D.results.filter(function(L){_--;const z=Mt(o)(L);return z&&(o.include_docs&&o.attachments&&o.binary&&mt(L),o.return_docs&&x.results.push(L),o.onChange(L,U,$)),z})}else if(P){o.aborted=!0,o.complete(P);return}D&&D.last_seq&&(O=D.last_seq);const j=S&&_<=0||D&&K<f||o.descending;o.continuous&&!(S&&_<=0)||!j?qe(function(){q(O,T)}):o.complete(null,x)};return q(o.since||0,T),{cancel:function(){o.aborted=!0,y.abort()}}},n.revsDiff=s("revsDiff",async function(o,f,v){typeof f=="function"&&(v=f,f={});try{const p=await u(ae(r,"_revs_diff"),{method:"POST",body:JSON.stringify(o)});v(null,p.data)}catch(p){v(p)}}),n._close=function(o){o()},n._destroy=async function(o,f){try{const v=await u(ae(r,""),{method:"DELETE"});f(null,v)}catch(v){v.status===404?f(null,{ok:!0}):f(v)}}}Bt.valid=function(){return!0};function ja(e){e.adapter("http",Bt,!1),e.adapter("https",Bt,!1)}class Ee extends Error{constructor(t){super(),this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,Ee)}catch{}}}class at extends Error{constructor(t){super(),this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,at)}catch{}}}class st extends Error{constructor(t){super(),this.status=500,this.name="invalid_value",this.message=t,this.error=!0;try{Error.captureStackTrace(this,st)}catch{}}}function cr(e,t){return t&&e.then(function(n){qe(function(){t(null,n)})},function(n){qe(function(){t(n)})}),e}function $a(e){return function(...t){var n=t.pop(),r=e.apply(this,t);return typeof n=="function"&&cr(r,n),r}}function La(e,t){return e.then(function(n){return t().then(function(){return n})},function(n){return t().then(function(){throw n})})}function yt(e,t){return function(){var n=arguments,r=this;return e.add(function(){return t.apply(r,n)})}}function mn(e){var t=new Set(e),n=new Array(t.size),r=-1;return t.forEach(function(i){n[++r]=i}),n}function pt(e){var t=new Array(e.size),n=-1;return e.forEach(function(r,i){t[++n]=i}),t}function yn(e){var t="builtin "+e+" function requires map values to be numbers or number arrays";return new st(t)}function It(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];if(typeof i!="number")if(Array.isArray(i)){t=typeof t=="number"?[t]:t;for(var a=0,s=i.length;a<s;a++){var u=i[a];if(typeof u!="number")throw yn("_sum");typeof t[a]>"u"?t.push(u):t[a]+=u}}else throw yn("_sum");else typeof t=="number"?t+=i:t[0]+=i}return t}var Na=_e.bind(null,"log"),Ka=Array.isArray,Fa=JSON.parse;function fr(e,t){return Ut("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:It,log:Na,isArray:Ka,toJSON:Fa})}class jt{constructor(){this.promise=Promise.resolve()}add(t){return this.promise=this.promise.catch(()=>{}).then(()=>t()),this.promise}finish(){return this.promise}}function pn(e){if(!e)return"undefined";switch(typeof e){case"function":return e.toString();case"string":return e.toString();default:return JSON.stringify(e)}}function Ga(e,t){return pn(e)+pn(t)+"undefined"}async function wn(e,t,n,r,i,a){const s=Ga(n,r);let u;if(!i&&(u=e._cachedViews=e._cachedViews||{},u[s]))return u[s];const c=e.info().then(async function(l){const g=l.db_name+"-mrview-"+(i?"temp":Gn(s));function o(_){_.views=_.views||{};let d=t;d.indexOf("/")===-1&&(d=t+"/"+t);const m=_.views[d]=_.views[d]||{};if(!m[g])return m[g]=!0,_}await Ve(e,"_local/"+a,o);const v=(await e.registerDependentDatabase(g)).db;v.auto_compaction=!0;const p={name:g,db:v,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:r};let S;try{S=await p.db.get("_local/lastSeq")}catch(_){if(_.status!==404)throw _}return p.seq=S?S.seq:0,u&&p.db.once("destroyed",function(){delete u[s]}),p});return u&&(u[s]=c),c}const bn={},Sn=new jt,Ma=50;function wt(e){return e.indexOf("/")===-1?[e,e]:e.split("/")}function Ua(e){return e.length===1&&/^1-/.test(e[0].rev)}function kn(e,t,n){try{e.emit("error",t)}catch{_e("error",`The user's map/reduce function threw an uncaught error.
You can debug this error by doing:
myDatabase.on('error', function (err) { debugger; });
Please double-check your map/reduce function.`),_e("error",t,n)}}function Ja(e,t,n,r){function i(h,w,C){try{w(C)}catch(k){kn(h,k,{fun:w,doc:C})}}function a(h,w,C,k,E){try{return{output:w(C,k,E)}}catch(I){return kn(h,I,{fun:w,keys:C,values:k,rereduce:E}),{error:I}}}function s(h,w){const C=ne(h.key,w.key);return C!==0?C:ne(h.value,w.value)}function u(h,w,C){return C=C||0,typeof w=="number"?h.slice(C,w+C):C>0?h.slice(C):h}function c(h){const w=h.value;return w&&typeof w=="object"&&w._id||h.id}function l(h){for(const w of h.rows){const C=w.doc&&w.doc._attachments;if(C)for(const k of Object.keys(C)){const E=C[k];C[k].data=Wt(E.data,E.content_type)}}}function g(h){return function(w){return h.include_docs&&h.attachments&&h.binary&&l(w),w}}function o(h,w,C,k){let E=w[h];typeof E<"u"&&(k&&(E=encodeURIComponent(JSON.stringify(E))),C.push(h+"="+E))}function f(h){if(typeof h<"u"){const w=Number(h);return!isNaN(w)&&w===parseInt(h,10)?w:h}}function v(h){return h.group_level=f(h.group_level),h.limit=f(h.limit),h.skip=f(h.skip),h}function p(h){if(h){if(typeof h!="number")return new Ee(`Invalid value for integer: "${h}"`);if(h<0)return new Ee(`Invalid value for positive integer: "${h}"`)}}function S(h,w){const C=h.descending?"endkey":"startkey",k=h.descending?"startkey":"endkey";if(typeof h[C]<"u"&&typeof h[k]<"u"&&ne(h[C],h[k])>0)throw new Ee("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(w.reduce&&h.reduce!==!1){if(h.include_docs)throw new Ee("{include_docs:true} is invalid for reduce");if(h.keys&&h.keys.length>1&&!h.group&&!h.group_level)throw new Ee("Multi-key fetches for reduce views must use {group: true}")}for(const E of["group_level","limit","skip"]){const I=p(h[E]);if(I)throw I}}async function _(h,w,C){let k=[],E,I="GET",G;if(o("reduce",C,k),o("include_docs",C,k),o("attachments",C,k),o("limit",C,k),o("descending",C,k),o("group",C,k),o("group_level",C,k),o("skip",C,k),o("stale",C,k),o("conflicts",C,k),o("startkey",C,k,!0),o("start_key",C,k,!0),o("endkey",C,k,!0),o("end_key",C,k,!0),o("inclusive_end",C,k),o("key",C,k,!0),o("update_seq",C,k),k=k.join("&"),k=k===""?"":"?"+k,typeof C.keys<"u"){const B=`keys=${encodeURIComponent(JSON.stringify(C.keys))}`;B.length+k.length+1<=2e3?k+=(k[0]==="?"?"&":"?")+B:(I="POST",typeof w=="string"?E={keys:C.keys}:w.keys=C.keys)}if(typeof w=="string"){const A=wt(w),B=await h.fetch("_design/"+A[0]+"/_view/"+A[1]+k,{headers:new $e({"Content-Type":"application/json"}),method:I,body:JSON.stringify(E)});G=B.ok;const N=await B.json();if(!G)throw N.status=B.status,Ke(N);for(const F of N.rows)if(F.value&&F.value.error&&F.value.error==="builtin_reduce_error")throw new Error(F.reason);return new Promise(function(F){F(N)}).then(g(C))}E=E||{};for(const A of Object.keys(w))Array.isArray(w[A])?E[A]=w[A]:E[A]=w[A].toString();const R=await h.fetch("_temp_view"+k,{headers:new $e({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(E)});G=R.ok;const b=await R.json();if(!G)throw b.status=R.status,Ke(b);return new Promise(function(A){A(b)}).then(g(C))}function d(h,w,C){return new Promise(function(k,E){h._query(w,C,function(I,G){if(I)return E(I);k(G)})})}function m(h){return new Promise(function(w,C){h._viewCleanup(function(k,E){if(k)return C(k);w(E)})})}function y(h){return function(w){if(w.status===404)return h;throw w}}async function O(h,w,C){const k="_local/doc_"+h,E={_id:k,keys:[]},I=C.get(h),G=I[0],R=I[1];function b(){return Ua(R)?Promise.resolve(E):w.db.get(k).catch(y(E))}function A(Y){return Y.keys.length?w.db.allDocs({keys:Y.keys,include_docs:!0}):Promise.resolve({rows:[]})}function B(Y,ee){const re=[],le=new Set;for(const X of ee.rows){const H=X.doc;if(H&&(re.push(H),le.add(H._id),H._deleted=!G.has(H._id),!H._deleted)){const Z=G.get(H._id);"value"in Z&&(H.value=Z.value)}}const we=pt(G);for(const X of we)if(!le.has(X)){const H={_id:X},Z=G.get(X);"value"in Z&&(H.value=Z.value),re.push(H)}return Y.keys=mn(we.concat(Y.keys)),re.push(Y),re}const N=await b(),F=await A(N);return B(N,F)}function q(h){return h.sourceDB.get("_local/purges").then(function(w){const C=w.purgeSeq;return h.db.get("_local/purgeSeq").then(function(k){return k._rev}).catch(y(void 0)).then(function(k){return h.db.put({_id:"_local/purgeSeq",_rev:k,purgeSeq:C})})}).catch(function(w){if(w.status!==404)throw w})}function x(h,w,C){var k="_local/lastSeq";return h.db.get(k).catch(y({_id:k,seq:0})).then(function(E){var I=pt(w);return Promise.all(I.map(function(G){return O(G,h,w)})).then(function(G){var R=G.flat();return E.seq=C,R.push(E),h.db.bulkDocs({docs:R})}).then(()=>q(h))})}function T(h){const w=typeof h=="string"?h:h.name;let C=bn[w];return C||(C=bn[w]=new jt),C}async function P(h,w){return yt(T(h),function(){return D(h,w)})()}async function D(h,w){let C,k,E;function I(X,H){const Z={id:k._id,key:Ie(X)};typeof H<"u"&&H!==null&&(Z.value=Ie(H)),C.push(Z)}const G=t(h.mapFun,I);let R=h.seq||0;function b(){return h.sourceDB.info().then(function(X){E=h.sourceDB.activeTasks.add({name:"view_indexing",total_items:X.update_seq-R})})}function A(X,H){return function(){return x(h,X,H)}}let B=0;const N={view:h.name,indexed_docs:B};h.sourceDB.emit("indexing",N);const F=new jt;async function Y(){const X=await h.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:R,limit:w.changes_batch_size}),H=await ee();return re(X,H)}function ee(){return h.db.get("_local/purgeSeq").then(function(X){return X.purgeSeq}).catch(y(-1)).then(function(X){return h.sourceDB.get("_local/purges").then(function(H){const Z=H.purges.filter(function(de,oe){return oe>X}).map(de=>de.docId),ge=Z.filter(function(de,oe){return Z.indexOf(de)===oe});return Promise.all(ge.map(function(de){return h.sourceDB.get(de).then(function(oe){return{docId:de,doc:oe}}).catch(y({docId:de}))}))}).catch(y([]))})}function re(X,H){const Z=X.results;if(!Z.length&&!H.length)return;for(const oe of H)if(Z.findIndex(function(Fe){return Fe.id===oe.docId})<0){const Fe={_id:oe.docId,doc:{_id:oe.docId,_deleted:1},changes:[]};oe.doc&&(Fe.doc=oe.doc,Fe.changes.push({rev:oe.doc._rev})),Z.push(Fe)}const ge=le(Z);F.add(A(ge,R)),B=B+Z.length;const de={view:h.name,last_seq:X.last_seq,results_count:Z.length,indexed_docs:B};if(h.sourceDB.emit("indexing",de),h.sourceDB.activeTasks.update(E,{completed_items:B}),!(Z.length<w.changes_batch_size))return Y()}function le(X){const H=new Map;for(const Z of X){if(Z.doc._id[0]!=="_"){C=[],k=Z.doc,k._deleted||i(h.sourceDB,G,k),C.sort(s);const ge=we(C);H.set(Z.doc._id,[ge,Z.changes])}R=Z.seq}return H}function we(X){const H=new Map;let Z;for(let ge=0,de=X.length;ge<de;ge++){const oe=X[ge],ot=[oe.key,oe.id];ge>0&&ne(oe.key,Z)===0&&ot.push(ge),H.set(ye(ot),oe),Z=oe.key}return H}try{await b(),await Y(),await F.finish(),h.seq=R,h.sourceDB.activeTasks.remove(E)}catch(X){h.sourceDB.activeTasks.remove(E,X)}}function K(h,w,C){C.group_level===0&&delete C.group_level;const k=C.group||C.group_level,E=n(h.reduceFun),I=[],G=isNaN(C.group_level)?Number.POSITIVE_INFINITY:C.group_level;for(const R of w){const b=I[I.length-1];let A=k?R.key:null;if(k&&Array.isArray(A)&&(A=A.slice(0,G)),b&&ne(b.groupKey,A)===0){b.keys.push([R.key,R.id]),b.values.push(R.value);continue}I.push({keys:[[R.key,R.id]],values:[R.value],groupKey:A})}w=[];for(const R of I){const b=a(h.sourceDB,E,R.keys,R.values,!1);if(b.error&&b.error instanceof st)throw b.error;w.push({value:b.error?null:b.output,key:R.groupKey})}return{rows:u(w,C.limit,C.skip)}}function j(h,w){return yt(T(h),function(){return U(h,w)})()}async function U(h,w){let C;const k=h.reduceFun&&w.reduce!==!1,E=w.skip||0;typeof w.keys<"u"&&!w.keys.length&&(w.limit=0,delete w.keys);async function I(R){R.include_docs=!0;const b=await h.db.allDocs(R);return C=b.total_rows,b.rows.map(function(A){if("value"in A.doc&&typeof A.doc.value=="object"&&A.doc.value!==null){const N=Object.keys(A.doc.value).sort(),F=["id","key","value"];if(!(N<F||N>F))return A.doc.value}const B=ji(A.doc._id);return{key:B[0],id:B[1],value:"value"in A.doc?A.doc.value:null}})}async function G(R){let b;if(k?b=K(h,R,w):typeof w.keys>"u"?b={total_rows:C,offset:E,rows:R}:b={total_rows:C,offset:E,rows:u(R,w.limit,w.skip)},w.update_seq&&(b.update_seq=h.seq),w.include_docs){const A=mn(R.map(c)),B=await h.sourceDB.allDocs({keys:A,include_docs:!0,conflicts:w.conflicts,attachments:w.attachments,binary:w.binary}),N=new Map;for(const F of B.rows)N.set(F.id,F.doc);for(const F of R){const Y=c(F),ee=N.get(Y);ee&&(F.doc=ee)}}return b}if(typeof w.keys<"u"){const b=w.keys.map(function(N){const F={startkey:ye([N]),endkey:ye([N,{}])};return w.update_seq&&(F.update_seq=!0),I(F)}),B=(await Promise.all(b)).flat();return G(B)}else{const R={descending:w.descending};w.update_seq&&(R.update_seq=!0);let b,A;if("start_key"in w&&(b=w.start_key),"startkey"in w&&(b=w.startkey),"end_key"in w&&(A=w.end_key),"endkey"in w&&(A=w.endkey),typeof b<"u"&&(R.startkey=w.descending?ye([b,{}]):ye([b])),typeof A<"u"){let N=w.inclusive_end!==!1;w.descending&&(N=!N),R.endkey=ye(N?[A,{}]:[A])}if(typeof w.key<"u"){const N=ye([w.key]),F=ye([w.key,{}]);R.descending?(R.endkey=N,R.startkey=F):(R.startkey=N,R.endkey=F)}k||(typeof w.limit=="number"&&(R.limit=w.limit),R.skip=E);const B=await I(R);return G(B)}}async function $(h){return(await h.fetch("_view_cleanup",{headers:new $e({"Content-Type":"application/json"}),method:"POST"})).json()}async function L(h){try{const w=await h.get("_local/"+e),C=new Map;for(const b of Object.keys(w.views)){const A=wt(b),B="_design/"+A[0],N=A[1];let F=C.get(B);F||(F=new Set,C.set(B,F)),F.add(N)}const k={keys:pt(C),include_docs:!0},E=await h.allDocs(k),I={};for(const b of E.rows){const A=b.key.substring(8);for(const B of C.get(b.key)){let N=A+"/"+B;w.views[N]||(N=B);const F=Object.keys(w.views[N]),Y=b.doc&&b.doc.views&&b.doc.views[B];for(const ee of F)I[ee]=I[ee]||Y}}const R=Object.keys(I).filter(function(b){return!I[b]}).map(function(b){return yt(T(b),function(){return new h.constructor(b,h.__opts).destroy()})()});return Promise.all(R).then(function(){return{ok:!0}})}catch(w){if(w.status===404)return{ok:!0};throw w}}async function z(h,w,C){if(typeof h._query=="function")return d(h,w,C);if(ke(h))return _(h,w,C);const k={changes_batch_size:h.__opts.view_update_changes_batch_size||Ma};if(typeof w!="string")return S(C,w),Sn.add(async function(){const E=await wn(h,"temp_view/temp_view",w.map,w.reduce,!0,e);return La(P(E,k).then(function(){return j(E,C)}),function(){return E.db.destroy()})}),Sn.finish();{const E=w,I=wt(E),G=I[0],R=I[1],b=await h.get("_design/"+G);if(w=b.views&&b.views[R],!w)throw new at(`ddoc ${b._id} has no view named ${R}`);r(b,R),S(C,w);const A=await wn(h,E,w.map,w.reduce,!1,e);return C.stale==="ok"||C.stale==="update_after"?(C.stale==="update_after"&&qe(function(){P(A,k)}),j(A,C)):(await P(A,k),j(A,C))}}function Q(h,w,C){const k=this;typeof w=="function"&&(C=w,w={}),w=w?v(w):{},typeof h=="function"&&(h={map:h});const E=Promise.resolve().then(function(){return z(k,h,w)});return cr(E,C),E}const W=$a(function(){const h=this;return typeof h._viewCleanup=="function"?m(h):ke(h)?$(h):L(h)});return{query:Q,viewCleanup:W}}var bt={_sum:function(e,t){return It(t)},_count:function(e,t){return t.length},_stats:function(e,t){function n(r){for(var i=0,a=0,s=r.length;a<s;a++){var u=r[a];i+=u*u}return i}return{sum:It(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:n(t)}}};function za(e){if(/^_sum/.test(e))return bt._sum;if(/^_count/.test(e))return bt._count;if(/^_stats/.test(e))return bt._stats;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}function Qa(e,t){if(typeof e=="function"&&e.length===2){var n=e;return function(r){return n(r,t)}}else return fr(e.toString(),t)}function Wa(e){var t=e.toString(),n=za(t);return n||fr(t)}function Ha(e,t){var n=e.views&&e.views[t];if(typeof n.map!="string")throw new at("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof n.map)}var Xa="mrviews",lr=Ja(Xa,Qa,Wa,Ha);function Ya(e,t,n){return lr.query.call(this,e,t,n)}function Za(e){return lr.viewCleanup.call(this,e)}var Va={query:Ya,viewCleanup:Za};function es(e,t,n){return!e._attachments||!e._attachments[n]||e._attachments[n].digest!==t._attachments[n].digest}function qn(e,t){var n=Object.keys(t._attachments);return Promise.all(n.map(function(r){return e.getAttachment(t._id,r,{rev:t._rev})}))}function ts(e,t,n){var r=ke(t)&&!ke(e),i=Object.keys(n._attachments);return r?e.get(n._id).then(function(a){return Promise.all(i.map(function(s){return es(a,n,s)?t.getAttachment(n._id,s):e.getAttachment(a._id,s)}))}).catch(function(a){if(a.status!==404)throw a;return qn(t,n)}):qn(t,n)}function ns(e){var t=[];return Object.keys(e).forEach(function(n){var r=e[n].missing;r.forEach(function(i){t.push({id:n,rev:i})})}),{docs:t,revs:!0,latest:!0}}function rs(e,t,n,r){n=se(n);var i=[],a=!0;function s(){var c=ns(n);if(c.docs.length)return e.bulkGet(c).then(function(l){if(r.cancelled)throw new Error("cancelled");return Promise.all(l.results.map(function(g){return Promise.all(g.docs.map(function(o){var f=o.ok;return o.error&&(a=!1),!f||!f._attachments?f:ts(t,e,f).then(v=>{var p=Object.keys(f._attachments);return v.forEach(function(S,_){var d=f._attachments[p[_]];delete d.stub,delete d.length,d.data=S}),f})}))})).then(function(g){i=i.concat(g.flat().filter(Boolean))})})}function u(){return{ok:a,docs:i}}return Promise.resolve().then(s).then(u)}var An=1,On="pouchdb",is=5,me=0;function $t(e,t,n,r,i){return e.get(t).catch(function(a){if(a.status===404)return(e.adapter==="http"||e.adapter==="https")&&qt(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:t,history:[],replicator:On,version:An};throw a}).then(function(a){if(!i.cancelled&&a.last_seq!==n)return a.history=(a.history||[]).filter(function(s){return s.session_id!==r}),a.history.unshift({last_seq:n,session_id:r}),a.history=a.history.slice(0,is),a.version=An,a.replicator=On,a.session_id=r,a.last_seq=n,e.put(a).catch(function(s){if(s.status===409)return $t(e,t,n,r,i);throw s})})}class Cn{constructor(t,n,r,i,a={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0}){this.src=t,this.target=n,this.id=r,this.returnValue=i,this.opts=a,typeof a.writeSourceCheckpoint>"u"&&(a.writeSourceCheckpoint=!0),typeof a.writeTargetCheckpoint>"u"&&(a.writeTargetCheckpoint=!0)}writeCheckpoint(t,n){var r=this;return this.updateTarget(t,n).then(function(){return r.updateSource(t,n)})}updateTarget(t,n){return this.opts.writeTargetCheckpoint?$t(this.target,this.id,t,n,this.returnValue):Promise.resolve(!0)}updateSource(t,n){if(this.opts.writeSourceCheckpoint){var r=this;return $t(this.src,this.id,t,n,this.returnValue).catch(function(i){if(En(i))return r.opts.writeSourceCheckpoint=!1,!0;throw i})}else return Promise.resolve(!0)}getCheckpoint(){var t=this;return!t.opts.writeSourceCheckpoint&&!t.opts.writeTargetCheckpoint?Promise.resolve(me):t.opts&&t.opts.writeSourceCheckpoint&&!t.opts.writeTargetCheckpoint?t.src.get(t.id).then(function(n){return n.last_seq||me}).catch(function(n){if(n.status!==404)throw n;return me}):t.target.get(t.id).then(function(n){return t.opts&&t.opts.writeTargetCheckpoint&&!t.opts.writeSourceCheckpoint?n.last_seq||me:t.src.get(t.id).then(function(r){if(n.version!==r.version)return me;var i;return n.version?i=n.version.toString():i="undefined",i in Dn?Dn[i](n,r):me},function(r){if(r.status===404&&n.last_seq)return t.src.put({_id:t.id,last_seq:me}).then(function(){return me},function(i){return En(i)?(t.opts.writeSourceCheckpoint=!1,n.last_seq):me});throw r})}).catch(function(n){if(n.status!==404)throw n;return me})}}var Dn={undefined:function(e,t){return ne(e.last_seq,t.last_seq)===0?t.last_seq:0},1:function(e,t){return as(t,e).last_seq}};function as(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:dr(e.history,t.history)}function dr(e,t){var n=e[0],r=e.slice(1),i=t[0],a=t.slice(1);if(!n||t.length===0)return{last_seq:me,history:[]};var s=n.session_id;if(Lt(s,t))return{last_seq:n.last_seq,history:e};var u=i.session_id;return Lt(u,r)?{last_seq:i.last_seq,history:a}:dr(r,a)}function Lt(e,t){var n=t[0],r=t.slice(1);return!e||t.length===0?!1:e===n.session_id?!0:Lt(e,r)}function En(e){return typeof e.status=="number"&&Math.floor(e.status/100)===4}function hr(e,t,n,r,i){return this instanceof Cn?hr:new Cn(e,t,n,r,i)}var xn=0;function ss(e,t,n,r){if(e.retry===!1){t.emit("error",n),t.removeAllListeners();return}if(typeof e.back_off_function!="function"&&(e.back_off_function=Er),t.emit("requestError",n),t.state==="active"||t.state==="pending"){t.emit("paused",n),t.state="stopped";var i=function(){e.current_back_off=xn},a=function(){t.removeListener("active",i)};t.once("paused",a),t.once("active",i)}e.current_back_off=e.current_back_off||xn,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(r,e.current_back_off)}function os(e){return Object.keys(e).sort(ne).reduce(function(t,n){return t[n]=e[n],t},{})}function us(e,t,n){var r=n.doc_ids?n.doc_ids.sort(ne):"",i=n.filter?n.filter.toString():"",a="",s="",u="";return n.selector&&(u=JSON.stringify(n.selector)),n.filter&&n.query_params&&(a=JSON.stringify(os(n.query_params))),n.filter&&n.filter==="_view"&&(s=n.view.toString()),Promise.all([e.id(),t.id()]).then(function(c){var l=c[0]+c[1]+i+s+a+r+u;return new Promise(function(g){Xt(l,g)})}).then(function(c){return c=c.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+c})}function vr(e,t,n,r,i){var a=[],s,u={seq:0,changes:[],docs:[]},c=!1,l=!1,g=!1,o=0,f=0,v=n.continuous||n.live||!1,p=n.batch_size||100,S=n.batches_limit||10,_=n.style||"all_docs",d=!1,m=n.doc_ids,y=n.selector,O,q,x=[],T=it(),P;i=i||{ok:!0,start_time:new Date().toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var D={};r.ready(e,t);function K(){return q?Promise.resolve():us(e,t,n).then(function(b){O=b;var A={};n.checkpoint===!1?A={writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:n.checkpoint==="source"?A={writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:n.checkpoint==="target"?A={writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:A={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},q=new hr(e,t,O,r,A)})}function j(){if(x=[],s.docs.length!==0){var b=s.docs,A={timeout:n.timeout};return t.bulkDocs({docs:b,new_edits:!1},A).then(function(B){if(r.cancelled)throw h(),new Error("cancelled");var N=Object.create(null);B.forEach(function(Y){Y.error&&(N[Y.id]=Y)});var F=Object.keys(N).length;i.doc_write_failures+=F,i.docs_written+=b.length-F,b.forEach(function(Y){var ee=N[Y._id];if(ee){i.errors.push(ee);var re=(ee.name||"").toLowerCase();if(re==="unauthorized"||re==="forbidden")r.emit("denied",se(ee));else throw ee}else x.push(Y)})},function(B){throw i.doc_write_failures+=b.length,B})}}function U(){if(s.error)throw new Error("There was a problem getting docs.");i.last_seq=f=s.seq;var b=se(i);return x.length&&(b.docs=x,typeof s.pending=="number"&&(b.pending=s.pending,delete s.pending),r.emit("change",b)),c=!0,e.info().then(function(A){var B=e.activeTasks.get(P);if(!(!s||!B)){var N=B.completed_items||0,F=parseInt(A.update_seq,10)-parseInt(o,10);e.activeTasks.update(P,{completed_items:N+s.changes.length,total_items:F})}}),q.writeCheckpoint(s.seq,T).then(function(){if(r.emit("checkpoint",{checkpoint:s.seq}),c=!1,r.cancelled)throw h(),new Error("cancelled");s=void 0,E()}).catch(function(A){throw R(A),A})}function $(){var b={};return s.changes.forEach(function(A){r.emit("checkpoint",{revs_diff:A}),A.id!=="_user/"&&(b[A.id]=A.changes.map(function(B){return B.rev}))}),t.revsDiff(b).then(function(A){if(r.cancelled)throw h(),new Error("cancelled");s.diffs=A})}function L(){return rs(e,t,s.diffs,r).then(function(b){s.error=!b.ok,b.docs.forEach(function(A){delete s.diffs[A._id],i.docs_read++,s.docs.push(A)})})}function z(){if(!(r.cancelled||s)){if(a.length===0){Q(!0);return}s=a.shift(),r.emit("checkpoint",{start_next_batch:s.seq}),$().then(L).then(j).then(U).then(z).catch(function(b){W("batch processing terminated with error",b)})}}function Q(b){if(u.changes.length===0){a.length===0&&!s&&((v&&D.live||l)&&(r.state="pending",r.emit("paused")),l&&h());return}(b||l||u.changes.length>=p)&&(a.push(u),u={seq:0,changes:[],docs:[]},(r.state==="pending"||r.state==="stopped")&&(r.state="active",r.emit("active")),z())}function W(b,A){g||(A.message||(A.message=b),i.ok=!1,i.status="aborting",a=[],u={seq:0,changes:[],docs:[]},h(A))}function h(b){if(!g&&!(r.cancelled&&(i.status="cancelled",c)))if(i.status=i.status||"complete",i.end_time=new Date().toISOString(),i.last_seq=f,g=!0,e.activeTasks.remove(P,b),b){b=M(b),b.result=i;var A=(b.name||"").toLowerCase();A==="unauthorized"||A==="forbidden"?(r.emit("error",b),r.removeAllListeners()):ss(n,r,b,function(){vr(e,t,n,r)})}else r.emit("complete",i),r.removeAllListeners()}function w(b,A,B){if(r.cancelled)return h();typeof A=="number"&&(u.pending=A);var N=Mt(n)(b);if(!N){var F=e.activeTasks.get(P);if(F){var Y=F.completed_items||0;e.activeTasks.update(P,{completed_items:++Y})}return}u.seq=b.seq||B,u.changes.push(b),r.emit("checkpoint",{pending_batch:u.seq}),qe(function(){Q(a.length===0&&D.live)})}function C(b){if(d=!1,r.cancelled)return h();if(b.results.length>0)D.since=b.results[b.results.length-1].seq,E(),Q(!0);else{var A=function(){v?(D.live=!0,E()):l=!0,Q(!0)};!s&&b.results.length===0?(c=!0,q.writeCheckpoint(b.last_seq,T).then(function(){if(c=!1,i.last_seq=f=b.last_seq,r.cancelled)throw h(),new Error("cancelled");A()}).catch(R)):A()}}function k(b){if(d=!1,r.cancelled)return h();W("changes rejected",b)}function E(){if(!(!d&&!l&&a.length<S))return;d=!0;function b(){B.cancel()}function A(){r.removeListener("cancel",b)}r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",b);var B=e.changes(D).on("change",w);B.then(A,A),B.then(C).catch(k),n.retry&&(r._changes=B,r._abortChanges=b)}function I(b){return e.info().then(function(A){var B=typeof n.since>"u"?parseInt(A.update_seq,10)-parseInt(b,10):parseInt(A.update_seq,10);return P=e.activeTasks.add({name:`${v?"continuous ":""}replication from ${A.db_name}`,total_items:B}),b})}function G(){K().then(function(){if(r.cancelled){h();return}return q.getCheckpoint().then(I).then(function(b){f=b,o=b,D={since:f,limit:p,batch_size:p,style:_,doc_ids:m,selector:y,return_docs:!0},n.filter&&(typeof n.filter!="string"?D.include_docs=!0:D.filter=n.filter),"heartbeat"in n&&(D.heartbeat=n.heartbeat),"timeout"in n&&(D.timeout=n.timeout),n.query_params&&(D.query_params=n.query_params),n.view&&(D.view=n.view),E()})}).catch(function(b){W("getCheckpoint rejected with ",b)})}function R(b){c=!1,W("writeCheckpoint completed with error",b)}if(r.cancelled){h();return}r._addedListeners||(r.once("cancel",h),typeof n.complete=="function"&&(r.once("error",n.complete),r.once("complete",function(b){n.complete(null,b)})),r._addedListeners=!0),typeof n.since>"u"?G():K().then(function(){return c=!0,q.writeCheckpoint(n.since,T)}).then(function(){if(c=!1,r.cancelled){h();return}f=n.since,G()}).catch(R)}class cs extends Oe{constructor(){super(),this.cancelled=!1,this.state="pending";const t=new Promise((n,r)=>{this.once("complete",n),this.once("error",r)});this.then=function(n,r){return t.then(n,r)},this.catch=function(n){return t.catch(n)},this.catch(function(){})}cancel(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")}ready(t,n){if(this._readyCalled)return;this._readyCalled=!0;const r=()=>{this.cancel()};t.once("destroyed",r),n.once("destroyed",r);function i(){t.removeListener("destroyed",r),n.removeListener("destroyed",r)}this.once("complete",i),this.once("error",i)}}function nt(e,t){var n=t.PouchConstructor;return typeof e=="string"?new n(e,t):e}function Nt(e,t,n,r){if(typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw M(rt,"`doc_ids` filter parameter is not a list.");n.complete=r,n=se(n),n.continuous=n.continuous||n.live,n.retry="retry"in n?n.retry:!1,n.PouchConstructor=n.PouchConstructor||this;var i=new cs(n),a=nt(e,n),s=nt(t,n);return vr(a,s,n,i),i}function fs(e,t,n,r){return typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n=se(n),n.PouchConstructor=n.PouchConstructor||this,e=nt(e,n),t=nt(t,n),new ls(e,t,n,r)}class ls extends Oe{constructor(t,n,r,i){super(),this.canceled=!1;const a=r.push?Object.assign({},r,r.push):r,s=r.pull?Object.assign({},r,r.pull):r;this.push=Nt(t,n,a),this.pull=Nt(n,t,s),this.pushPaused=!0,this.pullPaused=!0;const u=y=>{this.emit("change",{direction:"pull",change:y})},c=y=>{this.emit("change",{direction:"push",change:y})},l=y=>{this.emit("denied",{direction:"push",doc:y})},g=y=>{this.emit("denied",{direction:"pull",doc:y})},o=()=>{this.pushPaused=!0,this.pullPaused&&this.emit("paused")},f=()=>{this.pullPaused=!0,this.pushPaused&&this.emit("paused")},v=()=>{this.pushPaused=!1,this.pullPaused&&this.emit("active",{direction:"push"})},p=()=>{this.pullPaused=!1,this.pushPaused&&this.emit("active",{direction:"pull"})};let S={};const _=y=>(O,q)=>{(O==="change"&&(q===u||q===c)||O==="denied"&&(q===g||q===l)||O==="paused"&&(q===f||q===o)||O==="active"&&(q===p||q===v))&&(O in S||(S[O]={}),S[O][y]=!0,Object.keys(S[O]).length===2&&this.removeAllListeners(O))};r.live&&(this.push.on("complete",this.pull.cancel.bind(this.pull)),this.pull.on("complete",this.push.cancel.bind(this.push)));function d(y,O,q){y.listeners(O).indexOf(q)==-1&&y.on(O,q)}this.on("newListener",function(y){y==="change"?(d(this.pull,"change",u),d(this.push,"change",c)):y==="denied"?(d(this.pull,"denied",g),d(this.push,"denied",l)):y==="active"?(d(this.pull,"active",p),d(this.push,"active",v)):y==="paused"&&(d(this.pull,"paused",f),d(this.push,"paused",o))}),this.on("removeListener",function(y){y==="change"?(this.pull.removeListener("change",u),this.push.removeListener("change",c)):y==="denied"?(this.pull.removeListener("denied",g),this.push.removeListener("denied",l)):y==="active"?(this.pull.removeListener("active",p),this.push.removeListener("active",v)):y==="paused"&&(this.pull.removeListener("paused",f),this.push.removeListener("paused",o))}),this.pull.on("removeListener",_("pull")),this.push.on("removeListener",_("push"));const m=Promise.all([this.push,this.pull]).then(y=>{const O={push:y[0],pull:y[1]};return this.emit("complete",O),i&&i(null,O),this.removeAllListeners(),O},y=>{if(this.cancel(),i?i(y):this.emit("error",y),this.removeAllListeners(),i)throw y});this.then=function(y,O){return m.then(y,O)},this.catch=function(y){return m.catch(y)}}cancel(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())}}function ds(e){e.replicate=Nt,e.sync=fs,Object.defineProperty(e.prototype,"replicate",{get:function(){var t=this;return typeof this.replicateMethods>"u"&&(this.replicateMethods={from:function(n,r,i){return t.constructor.replicate(n,t,r,i)},to:function(n,r,i){return t.constructor.replicate(t,n,r,i)}}),this.replicateMethods}}),e.prototype.sync=function(t,n,r){return this.constructor.sync(this,t,n,r)}}J.plugin(Da).plugin(ja).plugin(Va).plugin(ds);export{J as P};
