var W=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},E=[],m=[],gr=typeof Uint8Array<"u"?Uint8Array:Array,L=!1;function G(){L=!0;for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0,e=n.length;r<e;++r)E[r]=n[r],m[n.charCodeAt(r)]=r;m[45]=62,m[95]=63}function yr(n){L||G();var r,e,i,t,o,u,c=n.length;if(c%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o=n[c-2]==="="?2:n[c-1]==="="?1:0,u=new gr(c*3/4-o),i=o>0?c-4:c;var a=0;for(r=0,e=0;r<i;r+=4,e+=3)t=m[n.charCodeAt(r)]<<18|m[n.charCodeAt(r+1)]<<12|m[n.charCodeAt(r+2)]<<6|m[n.charCodeAt(r+3)],u[a++]=t>>16&255,u[a++]=t>>8&255,u[a++]=t&255;return o===2?(t=m[n.charCodeAt(r)]<<2|m[n.charCodeAt(r+1)]>>4,u[a++]=t&255):o===1&&(t=m[n.charCodeAt(r)]<<10|m[n.charCodeAt(r+1)]<<4|m[n.charCodeAt(r+2)]>>2,u[a++]=t>>8&255,u[a++]=t&255),u}function mr(n){return E[n>>18&63]+E[n>>12&63]+E[n>>6&63]+E[n&63]}function Er(n,r,e){for(var i,t=[],o=r;o<e;o+=3)i=(n[o]<<16)+(n[o+1]<<8)+n[o+2],t.push(mr(i));return t.join("")}function Q(n){L||G();for(var r,e=n.length,i=e%3,t="",o=[],u=16383,c=0,a=e-i;c<a;c+=u)o.push(Er(n,c,c+u>a?a:c+u));return i===1?(r=n[e-1],t+=E[r>>2],t+=E[r<<4&63],t+="=="):i===2&&(r=(n[e-2]<<8)+n[e-1],t+=E[r>>10],t+=E[r>>4&63],t+=E[r<<2&63],t+="="),o.push(t),o.join("")}function N(n,r,e,i,t){var o,u,c=t*8-i-1,a=(1<<c)-1,l=a>>1,h=-7,s=e?t-1:0,x=e?-1:1,d=n[r+s];for(s+=x,o=d&(1<<-h)-1,d>>=-h,h+=c;h>0;o=o*256+n[r+s],s+=x,h-=8);for(u=o&(1<<-h)-1,o>>=-h,h+=i;h>0;u=u*256+n[r+s],s+=x,h-=8);if(o===0)o=1-l;else{if(o===a)return u?NaN:(d?-1:1)*(1/0);u=u+Math.pow(2,i),o=o-l}return(d?-1:1)*u*Math.pow(2,o-i)}function H(n,r,e,i,t,o){var u,c,a,l=o*8-t-1,h=(1<<l)-1,s=h>>1,x=t===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:o-1,w=i?1:-1,y=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(c=isNaN(r)?1:0,u=h):(u=Math.floor(Math.log(r)/Math.LN2),r*(a=Math.pow(2,-u))<1&&(u--,a*=2),u+s>=1?r+=x/a:r+=x*Math.pow(2,1-s),r*a>=2&&(u++,a/=2),u+s>=h?(c=0,u=h):u+s>=1?(c=(r*a-1)*Math.pow(2,t),u=u+s):(c=r*Math.pow(2,s-1)*Math.pow(2,t),u=0));t>=8;n[e+d]=c&255,d+=w,c/=256,t-=8);for(u=u<<t|c,l+=t;l>0;n[e+d]=u&255,d+=w,u/=256,l-=8);n[e+d-w]|=y*128}var _r={}.toString,K=Array.isArray||function(n){return _r.call(n)=="[object Array]"},Ar=50;f.TYPED_ARRAY_SUPPORT=W.TYPED_ARRAY_SUPPORT!==void 0?W.TYPED_ARRAY_SUPPORT:!0;P();function P(){return f.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function A(n,r){if(P()<r)throw new RangeError("Invalid typed array length");return f.TYPED_ARRAY_SUPPORT?(n=new Uint8Array(r),n.__proto__=f.prototype):(n===null&&(n=new f(r)),n.length=r),n}function f(n,r,e){if(!f.TYPED_ARRAY_SUPPORT&&!(this instanceof f))return new f(n,r,e);if(typeof n=="number"){if(typeof r=="string")throw new Error("If encoding is specified then the first argument must be a string");return $(this,n)}return X(this,n,r,e)}f.poolSize=8192;f._augment=function(n){return n.__proto__=f.prototype,n};function X(n,r,e,i){if(typeof r=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&r instanceof ArrayBuffer?Rr(n,r,e,i):typeof r=="string"?Ir(n,r,e):Tr(n,r)}f.from=function(n,r,e){return X(null,n,r,e)};f.TYPED_ARRAY_SUPPORT&&(f.prototype.__proto__=Uint8Array.prototype,f.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&f[Symbol.species]);function Z(n){if(typeof n!="number")throw new TypeError('"size" argument must be a number');if(n<0)throw new RangeError('"size" argument must not be negative')}function Fr(n,r,e,i){return Z(r),r<=0?A(n,r):e!==void 0?typeof i=="string"?A(n,r).fill(e,i):A(n,r).fill(e):A(n,r)}f.alloc=function(n,r,e){return Fr(null,n,r,e)};function $(n,r){if(Z(r),n=A(n,r<0?0:J(r)|0),!f.TYPED_ARRAY_SUPPORT)for(var e=0;e<r;++e)n[e]=0;return n}f.allocUnsafe=function(n){return $(null,n)};f.allocUnsafeSlow=function(n){return $(null,n)};function Ir(n,r,e){if((typeof e!="string"||e==="")&&(e="utf8"),!f.isEncoding(e))throw new TypeError('"encoding" must be a valid string encoding');var i=rr(r,e)|0;n=A(n,i);var t=n.write(r,e);return t!==i&&(n=n.slice(0,t)),n}function v(n,r){var e=r.length<0?0:J(r.length)|0;n=A(n,e);for(var i=0;i<e;i+=1)n[i]=r[i]&255;return n}function Rr(n,r,e,i){if(r.byteLength,e<0||r.byteLength<e)throw new RangeError("'offset' is out of bounds");if(r.byteLength<e+(i||0))throw new RangeError("'length' is out of bounds");return e===void 0&&i===void 0?r=new Uint8Array(r):i===void 0?r=new Uint8Array(r,e):r=new Uint8Array(r,e,i),f.TYPED_ARRAY_SUPPORT?(n=r,n.__proto__=f.prototype):n=v(n,r),n}function Tr(n,r){if(_(r)){var e=J(r.length)|0;return n=A(n,e),n.length===0||r.copy(n,0,0,e),n}if(r){if(typeof ArrayBuffer<"u"&&r.buffer instanceof ArrayBuffer||"length"in r)return typeof r.length!="number"||Wr(r.length)?A(n,0):v(n,r);if(r.type==="Buffer"&&K(r.data))return v(n,r.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function J(n){if(n>=P())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+P().toString(16)+" bytes");return n|0}f.isBuffer=T;function _(n){return!!(n!=null&&n._isBuffer)}f.compare=function(r,e){if(!_(r)||!_(e))throw new TypeError("Arguments must be Buffers");if(r===e)return 0;for(var i=r.length,t=e.length,o=0,u=Math.min(i,t);o<u;++o)if(r[o]!==e[o]){i=r[o],t=e[o];break}return i<t?-1:t<i?1:0};f.isEncoding=function(r){switch(String(r).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};f.concat=function(r,e){if(!K(r))throw new TypeError('"list" argument must be an Array of Buffers');if(r.length===0)return f.alloc(0);var i;if(e===void 0)for(e=0,i=0;i<r.length;++i)e+=r[i].length;var t=f.allocUnsafe(e),o=0;for(i=0;i<r.length;++i){var u=r[i];if(!_(u))throw new TypeError('"list" argument must be an Array of Buffers');u.copy(t,o),o+=u.length}return t};function rr(n,r){if(_(n))return n.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(n)||n instanceof ArrayBuffer))return n.byteLength;typeof n!="string"&&(n=""+n);var e=n.length;if(e===0)return 0;for(var i=!1;;)switch(r){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":case void 0:return Y(n).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return e*2;case"hex":return e>>>1;case"base64":return fr(n).length;default:if(i)return Y(n).length;r=(""+r).toLowerCase(),i=!0}}f.byteLength=rr;function Sr(n,r,e){var i=!1;if((r===void 0||r<0)&&(r=0),r>this.length||((e===void 0||e>this.length)&&(e=this.length),e<=0)||(e>>>=0,r>>>=0,e<=r))return"";for(n||(n="utf8");;)switch(n){case"hex":return br(this,r,e);case"utf8":case"utf-8":return ir(this,r,e);case"ascii":return Or(this,r,e);case"latin1":case"binary":return qr(this,r,e);case"base64":return Yr(this,r,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Mr(this,r,e);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(n+"").toLowerCase(),i=!0}}f.prototype._isBuffer=!0;function I(n,r,e){var i=n[r];n[r]=n[e],n[e]=i}f.prototype.swap16=function(){var r=this.length;if(r%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<r;e+=2)I(this,e,e+1);return this};f.prototype.swap32=function(){var r=this.length;if(r%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<r;e+=4)I(this,e,e+3),I(this,e+1,e+2);return this};f.prototype.swap64=function(){var r=this.length;if(r%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<r;e+=8)I(this,e,e+7),I(this,e+1,e+6),I(this,e+2,e+5),I(this,e+3,e+4);return this};f.prototype.toString=function(){var r=this.length|0;return r===0?"":arguments.length===0?ir(this,0,r):Sr.apply(this,arguments)};f.prototype.equals=function(r){if(!_(r))throw new TypeError("Argument must be a Buffer");return this===r?!0:f.compare(this,r)===0};f.prototype.inspect=function(){var r="",e=Ar;return this.length>0&&(r=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(r+=" ... ")),"<Buffer "+r+">"};f.prototype.compare=function(r,e,i,t,o){if(!_(r))throw new TypeError("Argument must be a Buffer");if(e===void 0&&(e=0),i===void 0&&(i=r?r.length:0),t===void 0&&(t=0),o===void 0&&(o=this.length),e<0||i>r.length||t<0||o>this.length)throw new RangeError("out of range index");if(t>=o&&e>=i)return 0;if(t>=o)return-1;if(e>=i)return 1;if(e>>>=0,i>>>=0,t>>>=0,o>>>=0,this===r)return 0;for(var u=o-t,c=i-e,a=Math.min(u,c),l=this.slice(t,o),h=r.slice(e,i),s=0;s<a;++s)if(l[s]!==h[s]){u=l[s],c=h[s];break}return u<c?-1:c<u?1:0};function er(n,r,e,i,t){if(n.length===0)return-1;if(typeof e=="string"?(i=e,e=0):e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,isNaN(e)&&(e=t?0:n.length-1),e<0&&(e=n.length+e),e>=n.length){if(t)return-1;e=n.length-1}else if(e<0)if(t)e=0;else return-1;if(typeof r=="string"&&(r=f.from(r,i)),_(r))return r.length===0?-1:j(n,r,e,i,t);if(typeof r=="number")return r=r&255,f.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?t?Uint8Array.prototype.indexOf.call(n,r,e):Uint8Array.prototype.lastIndexOf.call(n,r,e):j(n,[r],e,i,t);throw new TypeError("val must be string, number or Buffer")}function j(n,r,e,i,t){var o=1,u=n.length,c=r.length;if(i!==void 0&&(i=String(i).toLowerCase(),i==="ucs2"||i==="ucs-2"||i==="utf16le"||i==="utf-16le")){if(n.length<2||r.length<2)return-1;o=2,u/=2,c/=2,e/=2}function a(d,w){return o===1?d[w]:d.readUInt16BE(w*o)}var l;if(t){var h=-1;for(l=e;l<u;l++)if(a(n,l)===a(r,h===-1?0:l-h)){if(h===-1&&(h=l),l-h+1===c)return h*o}else h!==-1&&(l-=l-h),h=-1}else for(e+c>u&&(e=u-c),l=e;l>=0;l--){for(var s=!0,x=0;x<c;x++)if(a(n,l+x)!==a(r,x)){s=!1;break}if(s)return l}return-1}f.prototype.includes=function(r,e,i){return this.indexOf(r,e,i)!==-1};f.prototype.indexOf=function(r,e,i){return er(this,r,e,i,!0)};f.prototype.lastIndexOf=function(r,e,i){return er(this,r,e,i,!1)};function Ur(n,r,e,i){e=Number(e)||0;var t=n.length-e;i?(i=Number(i),i>t&&(i=t)):i=t;var o=r.length;if(o%2!==0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var u=0;u<i;++u){var c=parseInt(r.substr(u*2,2),16);if(isNaN(c))return u;n[e+u]=c}return u}function Br(n,r,e,i){return b(Y(r,n.length-e),n,e,i)}function nr(n,r,e,i){return b(Jr(r),n,e,i)}function Dr(n,r,e,i){return nr(n,r,e,i)}function Cr(n,r,e,i){return b(fr(r),n,e,i)}function Pr(n,r,e,i){return b(Vr(r,n.length-e),n,e,i)}f.prototype.write=function(r,e,i,t){if(e===void 0)t="utf8",i=this.length,e=0;else if(i===void 0&&typeof e=="string")t=e,i=this.length,e=0;else if(isFinite(e))e=e|0,isFinite(i)?(i=i|0,t===void 0&&(t="utf8")):(t=i,i=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var o=this.length-e;if((i===void 0||i>o)&&(i=o),r.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");t||(t="utf8");for(var u=!1;;)switch(t){case"hex":return Ur(this,r,e,i);case"utf8":case"utf-8":return Br(this,r,e,i);case"ascii":return nr(this,r,e,i);case"latin1":case"binary":return Dr(this,r,e,i);case"base64":return Cr(this,r,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Pr(this,r,e,i);default:if(u)throw new TypeError("Unknown encoding: "+t);t=(""+t).toLowerCase(),u=!0}};f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Yr(n,r,e){return r===0&&e===n.length?Q(n):Q(n.slice(r,e))}function ir(n,r,e){e=Math.min(n.length,e);for(var i=[],t=r;t<e;){var o=n[t],u=null,c=o>239?4:o>223?3:o>191?2:1;if(t+c<=e){var a,l,h,s;switch(c){case 1:o<128&&(u=o);break;case 2:a=n[t+1],(a&192)===128&&(s=(o&31)<<6|a&63,s>127&&(u=s));break;case 3:a=n[t+1],l=n[t+2],(a&192)===128&&(l&192)===128&&(s=(o&15)<<12|(a&63)<<6|l&63,s>2047&&(s<55296||s>57343)&&(u=s));break;case 4:a=n[t+1],l=n[t+2],h=n[t+3],(a&192)===128&&(l&192)===128&&(h&192)===128&&(s=(o&15)<<18|(a&63)<<12|(l&63)<<6|h&63,s>65535&&s<1114112&&(u=s))}}u===null?(u=65533,c=1):u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|u&1023),i.push(u),t+=c}return Nr(i)}var z=4096;function Nr(n){var r=n.length;if(r<=z)return String.fromCharCode.apply(String,n);for(var e="",i=0;i<r;)e+=String.fromCharCode.apply(String,n.slice(i,i+=z));return e}function Or(n,r,e){var i="";e=Math.min(n.length,e);for(var t=r;t<e;++t)i+=String.fromCharCode(n[t]&127);return i}function qr(n,r,e){var i="";e=Math.min(n.length,e);for(var t=r;t<e;++t)i+=String.fromCharCode(n[t]);return i}function br(n,r,e){var i=n.length;(!r||r<0)&&(r=0),(!e||e<0||e>i)&&(e=i);for(var t="",o=r;o<e;++o)t+=$r(n[o]);return t}function Mr(n,r,e){for(var i=n.slice(r,e),t="",o=0;o<i.length;o+=2)t+=String.fromCharCode(i[o]+i[o+1]*256);return t}f.prototype.slice=function(r,e){var i=this.length;r=~~r,e=e===void 0?i:~~e,r<0?(r+=i,r<0&&(r=0)):r>i&&(r=i),e<0?(e+=i,e<0&&(e=0)):e>i&&(e=i),e<r&&(e=r);var t;if(f.TYPED_ARRAY_SUPPORT)t=this.subarray(r,e),t.__proto__=f.prototype;else{var o=e-r;t=new f(o,void 0);for(var u=0;u<o;++u)t[u]=this[u+r]}return t};function p(n,r,e){if(n%1!==0||n<0)throw new RangeError("offset is not uint");if(n+r>e)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUIntLE=function(r,e,i){r=r|0,e=e|0,i||p(r,e,this.length);for(var t=this[r],o=1,u=0;++u<e&&(o*=256);)t+=this[r+u]*o;return t};f.prototype.readUIntBE=function(r,e,i){r=r|0,e=e|0,i||p(r,e,this.length);for(var t=this[r+--e],o=1;e>0&&(o*=256);)t+=this[r+--e]*o;return t};f.prototype.readUInt8=function(r,e){return e||p(r,1,this.length),this[r]};f.prototype.readUInt16LE=function(r,e){return e||p(r,2,this.length),this[r]|this[r+1]<<8};f.prototype.readUInt16BE=function(r,e){return e||p(r,2,this.length),this[r]<<8|this[r+1]};f.prototype.readUInt32LE=function(r,e){return e||p(r,4,this.length),(this[r]|this[r+1]<<8|this[r+2]<<16)+this[r+3]*16777216};f.prototype.readUInt32BE=function(r,e){return e||p(r,4,this.length),this[r]*16777216+(this[r+1]<<16|this[r+2]<<8|this[r+3])};f.prototype.readIntLE=function(r,e,i){r=r|0,e=e|0,i||p(r,e,this.length);for(var t=this[r],o=1,u=0;++u<e&&(o*=256);)t+=this[r+u]*o;return o*=128,t>=o&&(t-=Math.pow(2,8*e)),t};f.prototype.readIntBE=function(r,e,i){r=r|0,e=e|0,i||p(r,e,this.length);for(var t=e,o=1,u=this[r+--t];t>0&&(o*=256);)u+=this[r+--t]*o;return o*=128,u>=o&&(u-=Math.pow(2,8*e)),u};f.prototype.readInt8=function(r,e){return e||p(r,1,this.length),this[r]&128?(255-this[r]+1)*-1:this[r]};f.prototype.readInt16LE=function(r,e){e||p(r,2,this.length);var i=this[r]|this[r+1]<<8;return i&32768?i|4294901760:i};f.prototype.readInt16BE=function(r,e){e||p(r,2,this.length);var i=this[r+1]|this[r]<<8;return i&32768?i|4294901760:i};f.prototype.readInt32LE=function(r,e){return e||p(r,4,this.length),this[r]|this[r+1]<<8|this[r+2]<<16|this[r+3]<<24};f.prototype.readInt32BE=function(r,e){return e||p(r,4,this.length),this[r]<<24|this[r+1]<<16|this[r+2]<<8|this[r+3]};f.prototype.readFloatLE=function(r,e){return e||p(r,4,this.length),N(this,r,!0,23,4)};f.prototype.readFloatBE=function(r,e){return e||p(r,4,this.length),N(this,r,!1,23,4)};f.prototype.readDoubleLE=function(r,e){return e||p(r,8,this.length),N(this,r,!0,52,8)};f.prototype.readDoubleBE=function(r,e){return e||p(r,8,this.length),N(this,r,!1,52,8)};function g(n,r,e,i,t,o){if(!_(n))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>t||r<o)throw new RangeError('"value" argument is out of bounds');if(e+i>n.length)throw new RangeError("Index out of range")}f.prototype.writeUIntLE=function(r,e,i,t){if(r=+r,e=e|0,i=i|0,!t){var o=Math.pow(2,8*i)-1;g(this,r,e,i,o,0)}var u=1,c=0;for(this[e]=r&255;++c<i&&(u*=256);)this[e+c]=r/u&255;return e+i};f.prototype.writeUIntBE=function(r,e,i,t){if(r=+r,e=e|0,i=i|0,!t){var o=Math.pow(2,8*i)-1;g(this,r,e,i,o,0)}var u=i-1,c=1;for(this[e+u]=r&255;--u>=0&&(c*=256);)this[e+u]=r/c&255;return e+i};f.prototype.writeUInt8=function(r,e,i){return r=+r,e=e|0,i||g(this,r,e,1,255,0),f.TYPED_ARRAY_SUPPORT||(r=Math.floor(r)),this[e]=r&255,e+1};function O(n,r,e,i){r<0&&(r=65535+r+1);for(var t=0,o=Math.min(n.length-e,2);t<o;++t)n[e+t]=(r&255<<8*(i?t:1-t))>>>(i?t:1-t)*8}f.prototype.writeUInt16LE=function(r,e,i){return r=+r,e=e|0,i||g(this,r,e,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[e]=r&255,this[e+1]=r>>>8):O(this,r,e,!0),e+2};f.prototype.writeUInt16BE=function(r,e,i){return r=+r,e=e|0,i||g(this,r,e,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[e]=r>>>8,this[e+1]=r&255):O(this,r,e,!1),e+2};function q(n,r,e,i){r<0&&(r=4294967295+r+1);for(var t=0,o=Math.min(n.length-e,4);t<o;++t)n[e+t]=r>>>(i?t:3-t)*8&255}f.prototype.writeUInt32LE=function(r,e,i){return r=+r,e=e|0,i||g(this,r,e,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[e+3]=r>>>24,this[e+2]=r>>>16,this[e+1]=r>>>8,this[e]=r&255):q(this,r,e,!0),e+4};f.prototype.writeUInt32BE=function(r,e,i){return r=+r,e=e|0,i||g(this,r,e,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[e]=r>>>24,this[e+1]=r>>>16,this[e+2]=r>>>8,this[e+3]=r&255):q(this,r,e,!1),e+4};f.prototype.writeIntLE=function(r,e,i,t){if(r=+r,e=e|0,!t){var o=Math.pow(2,8*i-1);g(this,r,e,i,o-1,-o)}var u=0,c=1,a=0;for(this[e]=r&255;++u<i&&(c*=256);)r<0&&a===0&&this[e+u-1]!==0&&(a=1),this[e+u]=(r/c>>0)-a&255;return e+i};f.prototype.writeIntBE=function(r,e,i,t){if(r=+r,e=e|0,!t){var o=Math.pow(2,8*i-1);g(this,r,e,i,o-1,-o)}var u=i-1,c=1,a=0;for(this[e+u]=r&255;--u>=0&&(c*=256);)r<0&&a===0&&this[e+u+1]!==0&&(a=1),this[e+u]=(r/c>>0)-a&255;return e+i};f.prototype.writeInt8=function(r,e,i){return r=+r,e=e|0,i||g(this,r,e,1,127,-128),f.TYPED_ARRAY_SUPPORT||(r=Math.floor(r)),r<0&&(r=255+r+1),this[e]=r&255,e+1};f.prototype.writeInt16LE=function(r,e,i){return r=+r,e=e|0,i||g(this,r,e,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[e]=r&255,this[e+1]=r>>>8):O(this,r,e,!0),e+2};f.prototype.writeInt16BE=function(r,e,i){return r=+r,e=e|0,i||g(this,r,e,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[e]=r>>>8,this[e+1]=r&255):O(this,r,e,!1),e+2};f.prototype.writeInt32LE=function(r,e,i){return r=+r,e=e|0,i||g(this,r,e,4,2147483647,-2147483648),f.TYPED_ARRAY_SUPPORT?(this[e]=r&255,this[e+1]=r>>>8,this[e+2]=r>>>16,this[e+3]=r>>>24):q(this,r,e,!0),e+4};f.prototype.writeInt32BE=function(r,e,i){return r=+r,e=e|0,i||g(this,r,e,4,2147483647,-2147483648),r<0&&(r=4294967295+r+1),f.TYPED_ARRAY_SUPPORT?(this[e]=r>>>24,this[e+1]=r>>>16,this[e+2]=r>>>8,this[e+3]=r&255):q(this,r,e,!1),e+4};function tr(n,r,e,i,t,o){if(e+i>n.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range")}function or(n,r,e,i,t){return t||tr(n,r,e,4),H(n,r,e,i,23,4),e+4}f.prototype.writeFloatLE=function(r,e,i){return or(this,r,e,!0,i)};f.prototype.writeFloatBE=function(r,e,i){return or(this,r,e,!1,i)};function ur(n,r,e,i,t){return t||tr(n,r,e,8),H(n,r,e,i,52,8),e+8}f.prototype.writeDoubleLE=function(r,e,i){return ur(this,r,e,!0,i)};f.prototype.writeDoubleBE=function(r,e,i){return ur(this,r,e,!1,i)};f.prototype.copy=function(r,e,i,t){if(i||(i=0),!t&&t!==0&&(t=this.length),e>=r.length&&(e=r.length),e||(e=0),t>0&&t<i&&(t=i),t===i||r.length===0||this.length===0)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(t<0)throw new RangeError("sourceEnd out of bounds");t>this.length&&(t=this.length),r.length-e<t-i&&(t=r.length-e+i);var o=t-i,u;if(this===r&&i<e&&e<t)for(u=o-1;u>=0;--u)r[u+e]=this[u+i];else if(o<1e3||!f.TYPED_ARRAY_SUPPORT)for(u=0;u<o;++u)r[u+e]=this[u+i];else Uint8Array.prototype.set.call(r,this.subarray(i,i+o),e);return o};f.prototype.fill=function(r,e,i,t){if(typeof r=="string"){if(typeof e=="string"?(t=e,e=0,i=this.length):typeof i=="string"&&(t=i,i=this.length),r.length===1){var o=r.charCodeAt(0);o<256&&(r=o)}if(t!==void 0&&typeof t!="string")throw new TypeError("encoding must be a string");if(typeof t=="string"&&!f.isEncoding(t))throw new TypeError("Unknown encoding: "+t)}else typeof r=="number"&&(r=r&255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;e=e>>>0,i=i===void 0?this.length:i>>>0,r||(r=0);var u;if(typeof r=="number")for(u=e;u<i;++u)this[u]=r;else{var c=_(r)?r:Y(new f(r,t).toString()),a=c.length;for(u=0;u<i-e;++u)this[u+e]=c[u%a]}return this};var kr=/[^+\/0-9A-Za-z-_]/g;function vr(n){if(n=Lr(n).replace(kr,""),n.length<2)return"";for(;n.length%4!==0;)n=n+"=";return n}function Lr(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")}function $r(n){return n<16?"0"+n.toString(16):n.toString(16)}function Y(n,r){r=r||1/0;for(var e,i=n.length,t=null,o=[],u=0;u<i;++u){if(e=n.charCodeAt(u),e>55295&&e<57344){if(!t){if(e>56319){(r-=3)>-1&&o.push(239,191,189);continue}else if(u+1===i){(r-=3)>-1&&o.push(239,191,189);continue}t=e;continue}if(e<56320){(r-=3)>-1&&o.push(239,191,189),t=e;continue}e=(t-55296<<10|e-56320)+65536}else t&&(r-=3)>-1&&o.push(239,191,189);if(t=null,e<128){if((r-=1)<0)break;o.push(e)}else if(e<2048){if((r-=2)<0)break;o.push(e>>6|192,e&63|128)}else if(e<65536){if((r-=3)<0)break;o.push(e>>12|224,e>>6&63|128,e&63|128)}else if(e<1114112){if((r-=4)<0)break;o.push(e>>18|240,e>>12&63|128,e>>6&63|128,e&63|128)}else throw new Error("Invalid code point")}return o}function Jr(n){for(var r=[],e=0;e<n.length;++e)r.push(n.charCodeAt(e)&255);return r}function Vr(n,r){for(var e,i,t,o=[],u=0;u<n.length&&!((r-=2)<0);++u)e=n.charCodeAt(u),i=e>>8,t=e%256,o.push(t),o.push(i);return o}function fr(n){return yr(vr(n))}function b(n,r,e,i){for(var t=0;t<i&&!(t+e>=r.length||t>=n.length);++t)r[t+e]=n[t];return t}function Wr(n){return n!==n}function T(n){return n!=null&&(!!n._isBuffer||sr(n)||Qr(n))}function sr(n){return!!n.constructor&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function Qr(n){return typeof n.readFloatLE=="function"&&typeof n.slice=="function"&&sr(n.slice(0,0))}const jr=46,zr=/\\(\\)?/g,Gr=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g"),Hr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Kr=/^\w*$/,Xr=function(n){return Object.prototype.toString.call(n)},cr=function(n){const r=typeof n;return r==="symbol"||r==="object"&&n&&Xr(n)==="[object Symbol]"},Zr=function(n,r){if(Array.isArray(n))return!1;const e=typeof n;return e==="number"||e==="symbol"||e==="boolean"||!n||cr(n)?!0:Kr.test(n)||!Hr.test(n)||r!=null&&n in Object(r)},re=function(n){const r=[];return n.charCodeAt(0)===jr&&r.push(""),n.replace(Gr,function(e,i,t,o){let u=e;t?u=o.replace(zr,"$1"):i&&(u=i.trim()),r.push(u)}),r},ee=function(n,r){return Array.isArray(n)?n:Zr(n,r)?[n]:re(n)},ne=function(n){if(typeof n=="string"||cr(n))return n;const r=`${n}`;return r=="0"&&1/n==-INFINITY?"-0":r},ie=function(n,r){r=ee(r,n);let e=0;const i=r.length;for(;n!=null&&e<i;)n=n[ne(r[e++])];return e&&e===i?n:void 0},te=function(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)},ar=function(n){if(n==null)return[void 0,void 0];if(typeof n!="object")return[Error('Invalid option "columns": expect an array or an object')];if(Array.isArray(n)){const r=[];for(const e of n)if(typeof e=="string")r.push({key:e,header:e});else if(typeof e=="object"&&e!==null&&!Array.isArray(e)){if(!e.key)return[Error('Invalid column definition: property "key" is required')];e.header===void 0&&(e.header=e.key),r.push(e)}else return[Error("Invalid column definition: expect a string or an object")];n=r}else{const r=[];for(const e in n)r.push({key:e,header:n[e]});n=r}return[void 0,n]};class S extends Error{constructor(r,e,...i){Array.isArray(e)&&(e=e.join(" ")),super(e),Error.captureStackTrace!==void 0&&Error.captureStackTrace(this,S),this.code=r;for(const t of i)for(const o in t){const u=t[o];this[o]=T(u)?u.toString():u==null?u:JSON.parse(JSON.stringify(u))}}}const oe=function(n){return n.replace(/([A-Z])/g,function(r,e){return"_"+e.toLowerCase()})},lr=function(n){const r={};for(const t in n)r[oe(t)]=n[t];if(r.bom===void 0||r.bom===null||r.bom===!1)r.bom=!1;else if(r.bom!==!0)return[new S("CSV_OPTION_BOOLEAN_INVALID_TYPE",["option `bom` is optional and must be a boolean value,",`got ${JSON.stringify(r.bom)}`])];if(r.delimiter===void 0||r.delimiter===null)r.delimiter=",";else if(T(r.delimiter))r.delimiter=r.delimiter.toString();else if(typeof r.delimiter!="string")return[new S("CSV_OPTION_DELIMITER_INVALID_TYPE",["option `delimiter` must be a buffer or a string,",`got ${JSON.stringify(r.delimiter)}`])];if(r.quote===void 0||r.quote===null)r.quote='"';else if(r.quote===!0)r.quote='"';else if(r.quote===!1)r.quote="";else if(T(r.quote))r.quote=r.quote.toString();else if(typeof r.quote!="string")return[new S("CSV_OPTION_QUOTE_INVALID_TYPE",["option `quote` must be a boolean, a buffer or a string,",`got ${JSON.stringify(r.quote)}`])];if((r.quoted===void 0||r.quoted===null)&&(r.quoted=!1),r.escape_formulas===void 0||r.escape_formulas===null)r.escape_formulas=!1;else if(typeof r.escape_formulas!="boolean")return[new S("CSV_OPTION_ESCAPE_FORMULAS_INVALID_TYPE",["option `escape_formulas` must be a boolean,",`got ${JSON.stringify(r.escape_formulas)}`])];if((r.quoted_empty===void 0||r.quoted_empty===null)&&(r.quoted_empty=void 0),r.quoted_match===void 0||r.quoted_match===null||r.quoted_match===!1?r.quoted_match=null:Array.isArray(r.quoted_match)||(r.quoted_match=[r.quoted_match]),r.quoted_match)for(const t of r.quoted_match){const o=typeof t=="string",u=t instanceof RegExp;if(!o&&!u)return[Error(`Invalid Option: quoted_match must be a string or a regex, got ${JSON.stringify(t)}`)]}if((r.quoted_string===void 0||r.quoted_string===null)&&(r.quoted_string=!1),(r.eof===void 0||r.eof===null)&&(r.eof=!0),r.escape===void 0||r.escape===null)r.escape='"';else if(T(r.escape))r.escape=r.escape.toString();else if(typeof r.escape!="string")return[Error(`Invalid Option: escape must be a buffer or a string, got ${JSON.stringify(r.escape)}`)];if(r.escape.length>1)return[Error(`Invalid Option: escape must be one character, got ${r.escape.length} characters`)];(r.header===void 0||r.header===null)&&(r.header=!1);const[e,i]=ar(r.columns);if(e!==void 0)return[e];if(r.columns=i,(r.quoted===void 0||r.quoted===null)&&(r.quoted=!1),(r.cast===void 0||r.cast===null)&&(r.cast={}),(r.cast.bigint===void 0||r.cast.bigint===null)&&(r.cast.bigint=t=>""+t),(r.cast.boolean===void 0||r.cast.boolean===null)&&(r.cast.boolean=t=>t?"1":""),(r.cast.date===void 0||r.cast.date===null)&&(r.cast.date=t=>""+t.getTime()),(r.cast.number===void 0||r.cast.number===null)&&(r.cast.number=t=>""+t),(r.cast.object===void 0||r.cast.object===null)&&(r.cast.object=t=>JSON.stringify(t)),(r.cast.string===void 0||r.cast.string===null)&&(r.cast.string=function(t){return t}),r.on_record!==void 0&&typeof r.on_record!="function")return[Error('Invalid Option: "on_record" must be a function.')];if(r.record_delimiter===void 0||r.record_delimiter===null)r.record_delimiter=`
`;else if(T(r.record_delimiter))r.record_delimiter=r.record_delimiter.toString();else if(typeof r.record_delimiter!="string")return[Error(`Invalid Option: record_delimiter must be a buffer or a string, got ${JSON.stringify(r.record_delimiter)}`)];switch(r.record_delimiter){case"unix":r.record_delimiter=`
`;break;case"mac":r.record_delimiter="\r";break;case"windows":r.record_delimiter=`\r
`;break;case"ascii":r.record_delimiter="";break;case"unicode":r.record_delimiter="\u2028";break}return[void 0,r]},ue=f.from([239,187,191]),fe=function(n,r,e){return{options:n,state:r,info:e,__transform:function(i,t){if(!Array.isArray(i)&&typeof i!="object")return Error(`Invalid Record: expect an array or an object, got ${JSON.stringify(i)}`);if(this.info.records===0){if(Array.isArray(i)){if(this.options.header===!0&&this.options.columns===void 0)return Error("Undiscoverable Columns: header option requires column option or object records")}else if(this.options.columns===void 0){const[c,a]=ar(Object.keys(i));if(c)return;this.options.columns=a}}if(this.info.records===0){this.bom(t);const c=this.headers(t);if(c)return c}try{this.options.on_record&&this.options.on_record(i,this.info.records)}catch(c){return c}let o,u;if(this.options.eof){if([o,u]=this.stringify(i),o)return o;if(u===void 0)return;u=u+this.options.record_delimiter}else{if([o,u]=this.stringify(i),o)return o;if(u===void 0)return;(this.options.header||this.info.records)&&(u=this.options.record_delimiter+u)}this.info.records++,t(u)},stringify:function(i,t=!1){if(typeof i!="object")return[void 0,i];const{columns:o}=this.options,u=[];if(Array.isArray(i)){o&&i.splice(o.length);for(let a=0;a<i.length;a++){const l=i[a],[h,s]=this.__cast(l,{index:a,column:a,records:this.info.records,header:t});if(h)return[h];u[a]=[s,l]}}else for(let a=0;a<o.length;a++){const l=ie(i,o[a].key),[h,s]=this.__cast(l,{index:a,column:o[a].key,records:this.info.records,header:t});if(h)return[h];u[a]=[s,l]}let c="";for(let a=0;a<u.length;a++){let l,h,[s,x]=u[a];if(typeof s=="string")l=this.options;else if(te(s)){if(l=s,s=l.value,delete l.value,typeof s!="string"&&s!==void 0&&s!==null&&h)return[Error(`Invalid Casting Value: returned value must return a string, null or undefined, got ${JSON.stringify(s)}`)];if(l={...this.options,...l},[h,l]=lr(l),h!==void 0)return[h]}else if(s==null)l=this.options;else return[Error(`Invalid Casting Value: returned value must return a string, an object, null or undefined, got ${JSON.stringify(s)}`)];const{delimiter:d,escape:w,quote:y,quoted:hr,quoted_empty:B,quoted_string:M,quoted_match:D,record_delimiter:pr,escape_formulas:dr}=l;if(s===""&&x===""){let R=D&&D.filter(U=>typeof U=="string"?s.indexOf(U)!==-1:U.test(s));R=R&&R.length>0,(R||B===!0||M===!0&&B!==!1)===!0&&(s=y+s+y),c+=s}else if(s){if(typeof s!="string")return[Error(`Formatter must return a string, null or undefined, got ${JSON.stringify(s)}`)];const R=d.length&&s.indexOf(d)>=0,k=y!==""&&s.indexOf(y)>=0,U=s.indexOf(w)>=0&&w!==y,wr=s.indexOf(pr)>=0,xr=M&&typeof x=="string";let C=D&&D.filter(F=>typeof F=="string"?s.indexOf(F)!==-1:F.test(s));if(C=C&&C.length>0,dr)switch(s[0]){case"=":case"+":case"-":case"@":case"	":case"\r":case"＝":case"＋":case"－":case"＠":s=`'${s}`;break}const V=k===!0||R||wr||hr||xr||C;if(V===!0&&U===!0){const F=w==="\\"?new RegExp(w+w,"g"):new RegExp(w,"g");s=s.replace(F,w+w)}if(k===!0){const F=new RegExp(y,"g");s=s.replace(F,w+y)}V===!0&&(s=y+s+y),c+=s}else(B===!0||x===""&&M===!0&&B!==!1)&&(c+=y+y);a!==u.length-1&&(c+=d)}return[void 0,c]},bom:function(i){this.options.bom===!0&&i(ue)},headers:function(i){if(this.options.header===!1||this.options.columns===void 0)return;let t,o=this.options.columns.map(u=>u.header);if(this.options.eof?([t,o]=this.stringify(o,!0),o+=this.options.record_delimiter):[t,o]=this.stringify(o),t)return t;i(o)},__cast:function(i,t){const o=typeof i;try{return o==="string"?[void 0,this.options.cast.string(i,t)]:o==="bigint"?[void 0,this.options.cast.bigint(i,t)]:o==="number"?[void 0,this.options.cast.number(i,t)]:o==="boolean"?[void 0,this.options.cast.boolean(i,t)]:i instanceof Date?[void 0,this.options.cast.date(i,t)]:o==="object"&&i!==null?[void 0,this.options.cast.object(i,t)]:[void 0,i,i]}catch(u){return[u]}}}},se=function(n,r={}){const e=[],[i,t]=lr(r);if(i!==void 0)throw i;const c=fe(t,{stop:!1},{records:0});for(const a of n){const l=c.__transform(a,function(h){e.push(h)});if(l!==void 0)throw l}if(e.length===0){c.bom(l=>{e.push(l)});const a=c.headers(l=>{e.push(l)});if(a!==void 0)throw a}return e.join("")};export{se as stringify};
