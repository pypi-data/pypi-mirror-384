
{% load static %}
{% load wagtailcore_tags wagtailimages_tags %}


{% block metadata %}
    {% comment %} <meta name="viewport" content="width=device-width, initial-scale=1.0"> {% endcomment %}
{% endblock %}


{% block title %}
	<title>{{ page.title }}</title>
{% endblock %}

{%block govnavbar %}
    <div style="background-color: #071E41;">
        <div class="menu">
            <div class="logo">
                <img style="width: 51px; height: 18px;" src="{% static 'enap_designsystem/icons/logo-white.png' %}" alt="Passar pro lado esquerdo" alt="Logo GovBR" height="40">
            </div>
            <a href="https://www.gov.br/secom/pt-br/acesso-a-informacao/comunicabr">Comunica BR</a>
            <div class="separator"></div>
            <a href="https://www.gov.br/acessoainformacao/pt-br">Acesso à informação</a>
            <div class="separator"></div>
            <a href="https://www.gov.br/pt-br/participacao-social/">Participe</a>
            <div class="separator"></div>
            <a href="https://www4.planalto.gov.br/legislacao/">Legislação</a>
            <div class="separator"></div>
            <a href="https://www.gov.br/pt-br/orgaos-do-governo">Órgãos do Governo</a>
        </div>
    </div>
{% endblock %}


{% block navbar %}
    {% if page.navbar %}
        {% include "enap_designsystem/blocks/navbar/navbar_block.html" with navbar=page.navbar %}
    {% else %}
        <p style="color: red;">DEBUG: Nenhuma Navbar foi definida.</p>
    {% endif %}
{% endblock %}

{% block extra_css %}
<style>
    /* ============================================ */
    /* VARIÁVEIS E CORES */
    /* ============================================ */
    
    :root {
        --primary: #0c5a5a;
        --primary-dark: #094444;
        --primary-light: #0f7070;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
        --blue-50: #eff6ff;
        --blue-100: #dbeafe;
        --blue-200: #bfdbfe;
        --blue-600: #2563eb;
        --red-50: #fef2f2;
        --red-100: #fecaca;
        --red-600: #dc2626;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        --radius-sm: 6px;
        --radius-md: 8px;
        --radius-lg: 12px;
        --radius-xl: 16px;
    }
    
    /* ============================================ */
    /* LAYOUT PRINCIPAL */
    /* ============================================ */
    
    .capsulas-busca-page {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        min-height: 100vh;
    }
    
    .capsulas-busca-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2.5rem 1.5rem;
        display: grid;
        grid-template-columns: 360px 1fr;
        gap: 2.5rem;
    }
    
    @media (max-width: 968px) {
        .capsulas-busca-container {
            grid-template-columns: 1fr;
            padding: 1.5rem 1rem;
            gap: 1.5rem;
        }
    }
    
    /* ============================================ */
    /* SIDEBAR DE BUSCA E FILTROS */
    /* ============================================ */
    
    .busca-sidebar {
        position: sticky;
        top: 2rem;
        height: fit-content;
    }
    
    @media (max-width: 968px) {
        .busca-sidebar {
            position: static;
        }
    }
    
    /* Campo de busca modernizado */
    .busca-input-wrapper {
        position: relative;
        margin-bottom: 1.5rem;
    }
    
    .busca-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray-400);
        width: 20px;
        height: 20px;
        transition: color 0.2s;
    }
    
    .busca-input {
        width: 100%;
        padding: 1rem 1rem 1rem 3rem;
        border: 2px solid var(--gray-200);
        border-radius: var(--radius-lg);
        font-size: 0.9375rem;
        background: white;
        transition: all 0.2s ease;
        box-shadow: var(--shadow-sm);
    }
    
    .busca-input:hover {
        border-color: var(--gray-300);
    }
    
    .busca-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(12, 90, 90, 0.1);
    }
    
    .busca-input:focus + .busca-icon {
        color: var(--primary);
    }
    
    /* Container de filtros */
    .filtros-avancados {
        overflow: hidden;
    }
    
    .filtros-avancados-header {
        padding: 1.25rem 1.5rem;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        border: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        user-select: none;
        transition: all 0.2s;
        width: 100%;
    }
    
    .filtros-avancados-header:hover {
        background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
    }
    
    .filtros-avancados-titulo {
        display: flex;
        align-items: center;
        gap: 0.625rem;
        font-weight: 600;
        color: white;
        font-size: 1.0625rem;
    }
    
    .filtros-icon {
        width: 22px;
        height: 22px;
        color: white;
    }
    
    .toggle-icon {
        width: 20px;
        height: 20px;
        color: white;
        transition: transform 0.3s ease;
    }
    
    .filtros-avancados-header[aria-expanded="false"] .toggle-icon {
        transform: rotate(-90deg);
    }
    
    .filtros-content {
        max-height: 600px;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: var(--gray-300) var(--gray-100);
    }
    
    .filtros-content::-webkit-scrollbar {
        width: 6px;
    }
    
    .filtros-content::-webkit-scrollbar-track {
        background: var(--gray-100);
        border-radius: 3px;
    }
    
    .filtros-content::-webkit-scrollbar-thumb {
        background: var(--gray-300);
        border-radius: 3px;
    }
    
    .filtros-content::-webkit-scrollbar-thumb:hover {
        background: var(--gray-400);
    }
    
    .filtros-content[hidden] {
        display: none;
    }
    
    /* ============================================ */
    /* DROPDOWN MODERNIZADO */
    /* ============================================ */
    
    .filtro-grupo {
        border: none;
        padding: 0;
        margin: 0 0 1.5rem;
    }
    
    .filtro-grupo:last-child {
        margin-bottom: 0;
    }
    
    .filtro-dropdown {
        border: 1px solid #C8D1E0;
        border-radius: 1px solid #C8D1E0;
        overflow: hidden;
        transition: all 0.2s;
        background: var(--gray-50);
        
    }
    
    .filtro-dropdown:hover {
        border-color: var(--gray-300);
    }
    
    .filtro-dropdown.active {
        
    }
    
    .filtro-grupo-header {
        padding: 0.875rem 1rem;
        background: white;
        border: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        user-select: none;
        width: 100%;
        transition: all 0.2s;
    }
    
    .filtro-grupo-header:hover {
        background: var(--gray-50);
    }
    
    .filtro-grupo-titulo {
        font-size: 0.9375rem;
        font-weight: 600;
        color: var(--gray-800);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .dropdown-chevron {
        width: 16px;
        height: 16px;
        color: var(--gray-500);
        transition: transform 0.3s ease;
    }
    
    .filtro-grupo-header[aria-expanded="true"] .dropdown-chevron {
        transform: rotate(180deg);
        color: var(--primary);
    }
    
    .filtro-opcoes {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        background: white;
    }
    
    .filtro-opcoes.open {
        max-height: 400px;
        border-top: 1px solid var(--gray-100);
        padding: 0.75rem 0.5rem;
    }
    
    /* Checkbox customizado moderno */
    .filtro-checkbox {
        display: flex;
        align-items: center;
        cursor: pointer;
        padding: 0.5rem 0.75rem;
        border-radius: var(--radius-sm);
        transition: all 0.2s;
        margin: 0.125rem 0;
    }
    
    .filtro-checkbox:hover {
        background: var(--gray-50);
    }
    
    .filtro-checkbox input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
        margin-right: 0.75rem;
        flex-shrink: 0;
        accent-color: var(--primary);
        border-radius: 4px;
    }
    
    .checkbox-label {
        font-size: 0.9375rem;
        color: var(--gray-700);
        transition: color 0.2s;
    }
    
    .filtro-checkbox:hover .checkbox-label {
        color: var(--primary);
    }
    
    .filtro-checkbox input[type="checkbox"]:checked + .checkbox-label {
        font-weight: 500;
        color: var(--primary);
    }
    
    /* Badge de contagem */
    .count-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 20px;
        height: 20px;
        padding: 0 0.375rem;
        background: var(--primary);
        color: white;
        border-radius: 10px;
        font-size: 0.6875rem;
        font-weight: 600;
        margin-left: auto;
    }
    
    /* ============================================ */
    /* ÁREA DE RESULTADOS */
    /* ============================================ */
    
    .resultados-area {
        min-width: 0;
    }
    
    .resultados-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding: 1.25rem 1.5rem;
        background: white;
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
        border: 2px solid var(--gray-200);
    }
    
    @media (max-width: 640px) {
        .resultados-header {
            flex-direction: column;
            gap: 1rem;
            align-items: flex-start;
        }
    }
    
    .resultados-count {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--gray-800);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .resultados-count::before {
        content: '';
        width: 4px;
        height: 24px;
        background: linear-gradient(180deg, var(--primary) 0%, var(--primary-light) 100%);
        border-radius: 2px;
    }
    
    .resultados-sort {
        display: flex;
        align-items: center;
        gap: 0.625rem;
    }
    
    .sort-label {
        font-size: 0.875rem;
        color: var(--gray-600);
        font-weight: 500;
    }
    
    .sort-select {
        padding: 0.625rem 2.25rem 0.625rem 0.875rem;
        border: 2px solid var(--gray-200);
        border-radius: var(--radius-md);
        font-size: 0.9375rem;
        background: white;
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%230c5a5a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0.75rem center;
        transition: all 0.2s;
        font-weight: 500;
    }
    
    .sort-select:hover {
        border-color: var(--gray-300);
    }
    
    .sort-select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(12, 90, 90, 0.1);
    }
    
    /* ============================================ */
    /* GRID DE CÁPSULAS MODERNIZADO */
    /* ============================================ */
    
    .capsulas-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        gap: 1.75rem;
    }
    
    @media (max-width: 768px) {
        .capsulas-grid {
            grid-template-columns: 1fr;
        }
    }
    
    .capsula-card {
        background: white;
        border: 1px solid #C8D1E0;
        border-radius: 20px;
        padding: 2rem;
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
    }
    
    
    .capsula-card:hover {
        color: #006969;
        background-color: #EBEFF5;
    }
    
    .capsula-card:hover::before {
        transform: scaleX(1);
    }
    
    .capsula-card-icon {
        width: 56px;
        height: 56px;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1.25rem;
        flex-shrink: 0;
        box-shadow: 0 4px 12px rgba(12, 90, 90, 0.2);
    }
    
    .capsula-card-icon svg {
        width: 28px;
        height: 28px;
        color: white;
    }
    
    .capsula-card-titulo {
        font-size: 18px;
        font-weight: 700;
        color: #434A54;
        margin-bottom: 0.875rem;
        line-height: 1.4;
        margin: 0;
    }
    
    .capsula-card-titulo a {
        color: inherit;
        text-decoration: none;
        transition: color 0.2s;
    }
    
    .capsula-card-titulo a:hover {
        color: var(--primary);
    }
    
    .capsula-card-descricao {
        font-size: 16px;
        color: #434A54;
        line-height: 1.7;
        margin-bottom: 1.5rem;
        flex-grow: 1;
    }
    
    /* Tags de deficiência */
    .capsula-tags-deficiencia {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }
    
    .tag-deficiencia {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.375rem 0.75rem;
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        border: 1px solid #bae6fd;
        border-radius: var(--radius-xl);
        font-size: 0.8125rem;
        color: var(--primary);
        font-weight: 500;
    }
    
    .tag-deficiencia-icon {
        width: 14px;
        height: 14px;
        flex-shrink: 0;
    }
    
    /* Badge de prioridade */
    .capsula-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.375rem 0.875rem;
        border-radius: var(--radius-xl);
        font-size: 0.8125rem;
        font-weight: 700;
        margin-bottom: 1rem;
        width: fit-content;
        letter-spacing: 0.5px;
    }
    
    .capsula-badge-obrigatorio {
        background: #FCF0F1;
        color: #DF3E63;
        border: 1px solid #DF3E63;
    }
    
    .capsula-badge-recomendado {
        background: #E6EFFA;
        color: #155BCB;
        border: 1px solid #155BCB;
    }
    
    .badge-icon {
        width: 14px;
        height: 14px;
    }
    
    /* Tags de recurso */
    .capsula-tags-recurso {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
        padding-top: 1.25rem;
        border-top: 2px solid var(--gray-100);
    }
    
    .tag-recurso {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.375rem 0.75rem;
        background: var(--gray-100);
        border-radius: var(--radius-sm);
        font-size: 0.8125rem;
        color: var(--gray-700);
        font-weight: 500;
        transition: all 0.2s;
    }
    
    .tag-recurso:hover {
        background: var(--gray-200);
    }
    
    .tag-recurso-icon {
        width: 14px;
        height: 14px;
    }
    
    /* Botão de ação modernizado */
    .capsula-card-btn {
        padding: 0.875rem 1.5rem;
        background: #007D7A;
        color: white;
        border: none;
        border-radius: 32px;
        font-weight: 700;
        font-size: 0.9375rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        text-decoration: none;
        display: block;
        box-shadow: 0 4px 12px rgba(12, 90, 90, 0.2);
        position: relative;
        overflow: hidden;
    }
    
    .capsula-card-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
    }
    
    .capsula-card-btn:hover {
        background: #006969;
        color: white;
        box-shadow: 0 6px 16px rgba(12, 90, 90, 0.3);
    }
    
    .capsula-card-btn:hover::before {
        left: 100%;
    }

    
    .capsula-card-btn:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(12, 90, 90, 0.2), 0 6px 16px rgba(12, 90, 90, 0.3);
    }
    
    /* Estado vazio */
    .resultados-vazio {
        text-align: center;
        padding: 5rem 2rem;
        background: white;
        border-radius: var(--radius-xl);
        border: 2px dashed var(--gray-300);
    }
    
    .resultados-vazio-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 1.5rem;
        color: var(--gray-300);
    }
    
    .resultados-vazio h2 {
        font-size: 1.75rem;
        color: var(--gray-800);
        margin-bottom: 0.75rem;
        font-weight: 700;
    }
    
    .resultados-vazio p {
        color: var(--gray-600);
        font-size: 1.0625rem;
    }
    
    .resultados-vazio a {
        color: var(--primary);
        font-weight: 700;
        text-decoration: none;
        transition: color 0.2s;
    }
    
    .resultados-vazio a:hover {
        color: var(--primary-dark);
        text-decoration: underline;
    }
</style>
{% endblock %}

{% block content %}
<div class="capsulas-busca-page">
    <div class="capsulas-busca-container">
        
        {# ============================================ #}
        {# SIDEBAR DE BUSCA E FILTROS #}
        {# ============================================ #}
        <aside class="busca-sidebar" role="complementary" aria-label="Busca e filtros">
            
            {# Campo de busca #}
            <div class="busca-input-wrapper">
                <svg class="busca-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <input 
                    type="text" 
                    class="busca-input" 
                    placeholder="Digite palavras-chave (ex: contraste, legendas)"
                    aria-label="Buscar cápsulas">
            </div>
            
            {# Filtros avançados #}
            <div class="filtros-avancados">
             
                <div id="filtros-content" class="filtros-content">
                    <form method="get" id="filtros-form">
                        
                        {# TIPO DE DEFICIÊNCIA - DROPDOWN #}
                        <fieldset class="filtro-grupo">
                            <div class="filtro-dropdown" id="dropdown-deficiencia">
                                <button type="button" 
                                        class="filtro-grupo-header" 
                                        aria-expanded="false"
                                        onclick="toggleDropdown('deficiencia')">
                                    <span class="filtro-grupo-titulo">
                                        Tipo de Deficiência
                                        <span class="count-badge" id="count-deficiencia">0</span>
                                    </span>
                                    <svg class="dropdown-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="filtro-opcoes" id="opcoes-deficiencia">
                                    {% for value, label in opcoes_filtros.tipos_deficiencia %}
                                        <label class="filtro-checkbox">
                                            <input type="checkbox" 
                                                   name="tipo_deficiencia" 
                                                   value="{{ value }}"
                                                   {% if value in filtros_ativos.tipo_deficiencia %}checked{% endif %}
                                                   onchange="updateCount('deficiencia'); this.form.submit()">
                                            <span class="checkbox-label">{{ label }}</span>
                                        </label>
                                    {% endfor %}
                                </div>
                            </div>
                        </fieldset>
                        
                        {# FORMATO DE AÇÃO - DROPDOWN #}
                        <fieldset class="filtro-grupo">
                            <div class="filtro-dropdown" id="dropdown-formato">
                                <button type="button" 
                                        class="filtro-grupo-header" 
                                        aria-expanded="false"
                                        onclick="toggleDropdown('formato')">
                                    <span class="filtro-grupo-titulo">
                                        Formato de Ação
                                        <span class="count-badge" id="count-formato">0</span>
                                    </span>
                                    <svg class="dropdown-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="filtro-opcoes" id="opcoes-formato">
                                    {% for value, label in opcoes_filtros.formatos_acao %}
                                        <label class="filtro-checkbox">
                                            <input type="checkbox" 
                                                   name="formato_acao" 
                                                   value="{{ value }}"
                                                   {% if value in filtros_ativos.formato_acao %}checked{% endif %}
                                                   onchange="updateCount('formato'); this.form.submit()">
                                            <span class="checkbox-label">{{ label }}</span>
                                        </label>
                                    {% endfor %}
                                </div>
                            </div>
                        </fieldset>
                        
                        {# TIPO DE RECURSO - DROPDOWN #}
                        <fieldset class="filtro-grupo">
                            <div class="filtro-dropdown" id="dropdown-recurso">
                                <button type="button" 
                                        class="filtro-grupo-header" 
                                        aria-expanded="false"
                                        onclick="toggleDropdown('recurso')">
                                    <span class="filtro-grupo-titulo">
                                        Tipo de Recurso
                                        <span class="count-badge" id="count-recurso">0</span>
                                    </span>
                                    <svg class="dropdown-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="filtro-opcoes" id="opcoes-recurso">
                                    {% for value, label in opcoes_filtros.tipos_recurso %}
                                        <label class="filtro-checkbox">
                                            <input type="checkbox" 
                                                   name="tipo_recurso" 
                                                   value="{{ value }}"
                                                   {% if value in filtros_ativos.tipo_recurso %}checked{% endif %}
                                                   onchange="updateCount('recurso'); this.form.submit()">
                                            <span class="checkbox-label">{{ label }}</span>
                                        </label>
                                    {% endfor %}
                                </div>
                            </div>
                        </fieldset>
                        
                    </form>
                </div>
            </div>
            
        </aside>
        
        {# ============================================ #}
        {# ÁREA DE RESULTADOS #}
        {# ============================================ #}
        <main class="resultados-area" role="main">
            
            <div class="resultados-header">
                <div class="resultados-count">
                    {{ total_resultados }} cápsula{{ total_resultados|pluralize:",s" }} encontrada{{ total_resultados|pluralize:",s" }}
                </div>
                
                <div class="resultados-sort">
                    <label for="sort-select" class="sort-label">Ordenar por:</label>
                    <select id="sort-select" class="sort-select">
                        <option value="relevancia">Relevância</option>
                        <option value="recente">Mais recentes</option>
                        <option value="titulo">A-Z</option>
                    </select>
                </div>
            </div>
            
            {% if capsulas %}
                <div class="capsulas-grid">
                    {% for capsula in capsulas %}
                        <article class="capsula-card">
                            <div class="capsula-card-icon">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                </svg>
                            </div>
                            
                            <h2 class="capsula-card-titulo">
                                <a href="{% pageurl capsula %}">{{ capsula.title }}</a>
                            </h2>
                            
                            <p class="capsula-card-descricao">
                                {{ capsula.resumo_card|default:"Aprenda sobre este importante aspecto da acessibilidade digital." }}
                            </p>
                            
                            {# Tags de deficiência #}
                            {% if capsula.tipos_deficiencia %}
                                <div class="capsula-tags-deficiencia">
                                    {% for tipo in capsula.get_tipos_deficiencia_display|slice:":2" %}
                                        <span class="tag-deficiencia">
                                            <svg class="tag-deficiencia-icon" fill="currentColor" viewBox="0 0 20 20">
                                                <circle cx="10" cy="10" r="4"></circle>
                                            </svg>
                                            {{ tipo }}
                                        </span>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            
                            {# Badge de prioridade #}
                            {% if capsula.prioridade %}
                                <div class="capsula-badge capsula-badge-{{ capsula.prioridade }}">
                                    <svg class="badge-icon" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                    {{ capsula.get_prioridade_display }}
                                </div>
                            {% endif %}
                            
                            {# Tags de recurso #}
                            {% if capsula.tipos_recurso %}
                                <div class="capsula-tags-recurso">
                                    {% for recurso in capsula.get_tipos_recurso_display|slice:":3" %}
                                        <span class="tag-recurso">
                                            <svg class="tag-recurso-icon" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path>
                                            </svg>
                                            {{ recurso }}
                                        </span>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            
                            <a href="{% pageurl capsula %}" class="capsula-card-btn">
                                Acessar Cápsula
                            </a>
                        </article>
                    {% endfor %}
                </div>
                
            {% else %}
                <div class="resultados-vazio">
                    <svg class="resultados-vazio-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <h2>Nenhuma cápsula encontrada</h2>
                    <p>Tente ajustar os filtros ou <a href="{{ page.url }}">limpe os filtros</a> para ver todas as cápsulas.</p>
                </div>
            {% endif %}
            
        </main>
        
    </div>
</div>
{% endblock %}

{% block footer %}
    {% include "enap_designsystem/includes/footer.html" %}
{% endblock %}

{% block scriptinline %}
<script>
    // Toggle do painel principal de filtros
    function toggleFiltros() {
        const header = document.querySelector('.filtros-avancados-header');
        const content = document.getElementById('filtros-content');
        const expanded = header.getAttribute('aria-expanded') === 'true';
        
        header.setAttribute('aria-expanded', !expanded);
        content.hidden = expanded;
    }

    // Toggle dos dropdowns individuais
    function toggleDropdown(tipo) {
        const header = document.querySelector(`#dropdown-${tipo} .filtro-grupo-header`);
        const opcoes = document.getElementById(`opcoes-${tipo}`);
        const dropdown = document.getElementById(`dropdown-${tipo}`);
        const expanded = header.getAttribute('aria-expanded') === 'true';
        
        // Fecha outros dropdowns
        document.querySelectorAll('.filtro-dropdown').forEach(dd => {
            if (dd.id !== `dropdown-${tipo}`) {
                dd.classList.remove('active');
                const h = dd.querySelector('.filtro-grupo-header');
                const o = dd.querySelector('.filtro-opcoes');
                h.setAttribute('aria-expanded', 'false');
                o.classList.remove('open');
            }
        });
        
        // Toggle do dropdown atual
        header.setAttribute('aria-expanded', !expanded);
        opcoes.classList.toggle('open');
        dropdown.classList.toggle('active');
    }

    // Atualiza o contador de filtros selecionados
    function updateCount(tipo) {
        const checkboxes = document.querySelectorAll(`#opcoes-${tipo} input[type="checkbox"]:checked`);
        const badge = document.getElementById(`count-${tipo}`);
        const count = checkboxes.length;
        
        badge.textContent = count;
        badge.style.display = count > 0 ? 'inline-flex' : 'none';
    }

    // Inicializa os contadores ao carregar a página
    document.addEventListener('DOMContentLoaded', function() {
        updateCount('deficiencia');
        updateCount('formato');
        updateCount('recurso');
        
        // Esconde badges com contador 0
        document.querySelectorAll('.count-badge').forEach(badge => {
            if (badge.textContent === '0') {
                badge.style.display = 'none';
            }
        });
    });

    // Fecha dropdowns ao clicar fora
    document.addEventListener('click', function(event) {
        if (!event.target.closest('.filtro-dropdown')) {
            document.querySelectorAll('.filtro-dropdown').forEach(dropdown => {
                dropdown.classList.remove('active');
                const header = dropdown.querySelector('.filtro-grupo-header');
                const opcoes = dropdown.querySelector('.filtro-opcoes');
                header.setAttribute('aria-expanded', 'false');
                opcoes.classList.remove('open');
            });
        }
    });
</script>
{% endblock %}