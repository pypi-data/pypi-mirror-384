import{_ as ne,H as E,A as ie,B as H,n as T,h as u,z as X,r as se,l as M,o as m,F as O,s as re,y as Q,e as L,c as z,m as D,a,f as g,t as U,p as K,b as W,i as F,w as f,g as P,q as ue}from"./index-D9OmnhdE.js";import{u as me}from"./logos-BOVDV-my.js";import{_ as de}from"./ConfirmDialog-CnWM982L.js";import{_ as ce,V as pe}from"./ConnectedLayout-CiKHST8t.js";import{a as _}from"./webmail-Dqo8FjAw.js";import{c as G,V as N,a as ve,j as fe}from"./VAvatar-Wz1UmZ2b.js";import{V as Y}from"./VSpacer-Pa16wvUF.js";import{V as be,r as xe}from"./VForm-RVvaatfV.js";import{V as ge,b as ye,a as Me}from"./VCard-BrQzTMsm.js";import{V as Ve}from"./VTextField-BBIziqiv.js";import{V as _e}from"./VDialog-BF9xR7BQ.js";import{V as he}from"./VMenu-BPG7b7dT.js";import{V as Ce,a as R}from"./forwardRefs-GE5Osi9V.js";import"./VToolbar-CILwTR5O.js";import"./tag-jImTUiWx.js";import"./VProgressCircular-Bdwj7JuI.js";import"./theme-tqh89n3L.js";import"./VContainer-f9kXL-37.js";/* empty css              */import"./VApp-1CFpPM0s.js";import"./layout-CuwY6Rle.js";import"./ssrBoot-DaeAGyhc.js";import"./layout.store-uEYOXtgD.js";import"./global.store-CxPrtY0_.js";import"./VBadge-C08Ii4Nb.js";import"./VRow-DGPh2Qmm.js";import"./VSheet-C07oo1bg.js";import"./VInput-ssnfbpwr.js";const we=["onClick","onMouseover","onMouseleave"],ke={key:0,class:"font-weight-bold"},Ue={key:1},$e={key:0,class:"font-weight-bold"},Be={key:1},Le={__name:"MailboxList",props:E({mailboxes:{type:Array,default:null},lightMode:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},unseenCounters:{type:Boolean,default:!0},allowUnselect:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:E(["update:modelValue"],["update:modelValue"]),setup(S,{emit:y}){const l=S,n=ie(S,"modelValue"),s=y,V=H(),r=T(),$={inbox:"mdi-inbox",draft:"mdi-file",junk:"mdi-fire",sent:"mdi-email-fast-outline",trash:"mdi-trash-can-outline",normal:"mdi-folder-outline"},d=u(null),h=u({}),c=u({});function b(e){return e.label.split("/").pop()}function B(e){return d.value===null&&(d.value=e.unseen),d.value}function i(e,C){h.value[e.name]=C}function o(e){return n.value===e.name?"bg-primary-lighten-1":l.lightMode?h.value[e.name]?"bg-primary":"bg-white":h.value[e.name]?"bg-primary-lighten-1":"bg-primary"}function p(e){return c.value[e.name]}function q(e){c.value[e.name]||(c.value[e.name]=!1),c.value[e.name]=!c.value[e.name],c.value[e.name]&&!e.sub.length&&_.getUserMailboxes(e.name).then(C=>{e.sub=C.data.mailboxes})}function I(e){l.allowUnselect&&e===n.value?s("update:modelValue",null):s("update:modelValue",e)}return X(()=>r.mbCounterKey,()=>{_.getUserMailboxUnseen(V.query.mailbox).then(e=>{d.value=e.data.counter})}),(e,C)=>{const A=se("MailboxList",!0);return m(),M("div",null,[(m(!0),M(O,null,re(l.mailboxes,t=>(m(),M("div",{key:t.name,class:Q(["pl-3 text-body-2",{"py-1":!l.compact}])},[L("div",{class:Q([o(t),"d-flex mailbox pa-1 align-center"]),onClick:w=>I(t.name),onMouseover:w=>i(t,!0),onMouseleave:w=>i(t,!1)},[a(G,{icon:$[t.type],class:"mr-4"},null,8,["icon"]),t.name===g(V).query.mailbox?(m(),M(O,{key:0},[d.value>0?(m(),M("span",ke,U(b(t))+" ("+U(B(t))+") ",1)):(m(),M("span",Ue,U(b(t)),1))],64)):(m(),M(O,{key:1},[t.unseen>0?(m(),M("span",$e,U(b(t))+" ("+U(t.unseen)+") ",1)):(m(),M("span",Be,U(b(t)),1))],64)),a(Y),t.sub?(m(),z(N,{key:2,icon:p(t)?"mdi-minus":"mdi-plus",size:"xsmall",variant:"flat",color:"transparent",onClick:K(w=>q(t),["stop"])},null,8,["icon","onClick"])):D("",!0)],42,we),p(t)&&t.sub&&t.sub.length?(m(),z(A,{key:0,modelValue:n.value,"onUpdate:modelValue":C[0]||(C[0]=w=>n.value=w),mailboxes:t.sub,class:"mt-1","light-mode":l.lightMode,compact:l.compact},null,8,["modelValue","mailboxes","light-mode","compact"])):D("",!0)],2))),128))])}}},J=ne(Le,[["__scopeId","data-v-62d5beb0"]]),Ne={class:"mb-2 rounded-lg"},Se={__name:"MailboxForm",props:{userMailboxes:Array,mailbox:{type:String,default:null},hdelimiter:{type:String,default:null}},emits:["close","mailboxRenamed"],setup(S,{emit:y}){const l=S,n=y,{$gettext:s}=W(),{displayNotification:V}=T(),r=u({}),$=u(),d=u(!1),h=F(()=>l.mailbox?s("Edit mailbox"):s("Create new mailbox")),c=F(()=>l.mailbox?s("Update"):s("Create")),b=()=>{r.value={},n("close")},B=async()=>{const{valid:i}=await $.value.validate();if(i){d.value=!0;try{const o={...r.value};l.mailbox?(o.oldname=l.mailbox,await _.renameUserMailbox(o),V({msg:s("Mailbox renamed")}),n("mailboxRenamed",`${o.parent_mailbox}${l.hdelimiter}${o.name}`)):(await _.createUserMailbox(o),V({msg:s("Mailbox created")})),b()}finally{d.value=!1}}};return X(()=>l.mailbox,i=>{if(i){const o=l.mailbox.split(l.hdelimiter);r.value.name=o.slice(-1)[0],r.value.parent_mailbox=o.slice(0,-1).join(l.hdelimiter)}else r.value={}},{immediate:!0}),(i,o)=>(m(),z(Me,{title:h.value},{default:f(()=>[a(ge,null,{default:f(()=>[a(be,{ref_key:"formRef",ref:$},{default:f(()=>[a(Ve,{modelValue:r.value.name,"onUpdate:modelValue":o[0]||(o[0]=p=>r.value.name=p),label:g(s)("Name"),variant:"outlined",density:"compact",rules:[g(xe).required]},null,8,["modelValue","label","rules"]),L("div",Ne,[L("h4",null,U(g(s)("Parent mailbox")),1),a(J,{modelValue:r.value.parent_mailbox,"onUpdate:modelValue":o[1]||(o[1]=p=>r.value.parent_mailbox=p),"active-mailbox":l.parent,mailboxes:l.userMailboxes,"light-mode":"",compact:"","unseen-counters":!1,"allow-unselect":""},null,8,["modelValue","active-mailbox","mailboxes"])])]),_:1},512)]),_:1}),a(ye,null,{default:f(()=>[a(Y),a(N,{text:g(s)("Close"),variant:"flat",loading:d.value,onClick:b},null,8,["text","loading"]),a(N,{text:c.value,variant:"tonal",color:"primary",loading:d.value,onClick:B},null,8,["text","loading"])]),_:1})]),_:1},8,["title"]))}},qe={class:"d-flex align-center"},Fe={class:"d-flex justify-center mb-4"},Ie={class:"border-t-sm d-flex align-center bg-grey"},ma={__name:"WebmailLayout",async setup(S){let y,l;const{$gettext:n}=W(),s=H(),V=ue(),r=T(),{menuLogoPath:$}=me(),d=u(),h=u(!0),c=u(!1),b=u(null),B=u(null),i=u(null),o=u(s.query.mailbox||"INBOX"),p=u(!1),q=u([]),I=F(()=>["INBOX"].includes(s.query.mailbox||"INBOX")),e=F(()=>i.value.usage<50?"info":i.value.usage<80?"warning":"error"),C=F(()=>`${i.value.current} / ${i.value.limit} (${i.value.usage}%)`);function A(x){V.push({name:"MailboxView",query:{mailbox:x}}),_.getUserMailboxQuota(x).then(v=>{i.value=v.data})}const t=async()=>{const x=await _.getUserMailboxes();q.value=x.data.mailboxes,B.value=x.data.hdelimiter},w=()=>{V.push({name:"ComposeEmailView"})},Z=()=>{p.value=!1,b.value=null,t()},ee=()=>{p.value=!0},ae=()=>{b.value=o.value,p.value=!0},j=x=>{o.value=x,V.push({name:"MailboxView",query:{mailbox:x}})},te=async()=>{await _.compressUserMailbox({name:o.value}),r.displayNotification({msg:n("Mailbox compressed")})},le=async()=>{await d.value.open(n("Warning"),n("Delete this mailbox?"),{color:"warning",agreeLabel:n("Yes"),cancelLabel:n("No")})&&(await _.deleteUserMailbox({name:o.value}),r.displayNotification({msg:n("Mailbox deleted")}),j("INBOX"))};X(()=>r.dataKey,()=>{t()}),[y,l]=P(()=>t()),await y,l();const oe=([y,l]=P(()=>_.getUserMailboxQuota(s.query.mailbox||"INBOX")),y=await y,l(),y);return i.value=oe.data,(x,v)=>(m(),M(O,null,[a(ce,null,{navbar:f(()=>[a(pe,{modelValue:h.value,"onUpdate:modelValue":v[2]||(v[2]=k=>h.value=k),rail:c.value,permanent:"",color:"primary",app:""},{prepend:f(()=>[L("div",qe,[a(fe,{src:g($),"max-width":"190",class:"logo"},null,8,["src"]),a(N,{icon:c.value?"mdi-chevron-right":"mdi-chevron-left",variant:"text",onClick:v[0]||(v[0]=K(k=>c.value=!c.value,["stop"]))},null,8,["icon"])]),L("div",Fe,[a(N,{text:g(n)("Compose"),color:"secondary",variant:"flat","prepend-icon":"mdi-pencil",onClick:w},null,8,["text"])])]),append:f(()=>[L("div",Ie,[a(N,{class:"ml-2",variant:"text",icon:"",size:"small"},{default:f(()=>[a(G,{icon:"mdi-cog"}),a(he,{activator:"parent"},{default:f(()=>[a(Ce,{density:"compact"},{default:f(()=>[a(R,{title:g(n)("Create a new mailbox"),"prepend-icon":"mdi-plus",onClick:ee},null,8,["title"]),a(R,{title:g(n)("Edit this mailbox"),"prepend-icon":"mdi-pencil",disabled:I.value,onClick:ae},null,8,["title","disabled"]),a(R,{title:g(n)("Delete this mailbox"),"prepend-icon":"mdi-trash-can",disabled:I.value,onClick:le},null,8,["title","disabled"]),a(R,{title:g(n)("Compress this mailbox"),"prepend-icon":"mdi-folder-zip-outline",onClick:te},null,8,["title"])]),_:1})]),_:1})]),_:1}),i.value?(m(),z(ve,{key:0,color:e.value,"model-value":i.value.usage,title:C.value},null,8,["color","model-value","title"])):D("",!0)])]),default:f(()=>[a(J,{modelValue:o.value,"onUpdate:modelValue":[v[1]||(v[1]=k=>o.value=k),A],mailboxes:q.value,class:"mr-2"},null,8,["modelValue","mailboxes"])]),_:1},8,["modelValue","rail"])]),_:1}),a(_e,{modelValue:p.value,"onUpdate:modelValue":v[4]||(v[4]=k=>p.value=k),"max-width":"800"},{default:f(()=>[a(Se,{"user-mailboxes":q.value,mailbox:b.value,hdelimiter:B.value,onMailboxRenamed:j,onClose:v[3]||(v[3]=k=>Z())},null,8,["user-mailboxes","mailbox","hdelimiter"])]),_:1},8,["modelValue"]),a(de,{ref_key:"confirm",ref:d},null,512)],64))}};export{ma as default};
