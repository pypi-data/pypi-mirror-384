import{a as N,m as oe,c as ue}from"./VTextField-BBIziqiv.js";import{u as se,V as M,b as ce}from"./VInput-ssnfbpwr.js";import{f as fe}from"./forwardRefs-GE5Osi9V.js";import{I as de,J as ve,K as me,O as pe,a5 as x,i as v,bI as O,h as V,a7 as ye,a6 as ge,z as he,ag as be,a as h,v as D,e as m,F as w,y as Ie,a0 as ke,bG as Ce}from"./index-D9OmnhdE.js";import{V as Fe}from"./VChip-B1E7xQW1.js";import{u as Ve}from"./tag-jImTUiWx.js";function De(){function e(s){var l,o;return[...((l=s.dataTransfer)==null?void 0:l.items)??[]].filter(n=>n.kind==="file").map(n=>n.webkitGetAsEntry()).filter(Boolean).length>0||[...((o=s.dataTransfer)==null?void 0:o.files)??[]].length>0}async function r(s){var o,n;const c=[],l=[...((o=s.dataTransfer)==null?void 0:o.items)??[]].filter(i=>i.kind==="file").map(i=>i.webkitGetAsEntry()).filter(Boolean);if(l.length)for(const i of l){const b=await j(i,G(".",i));c.push(...b.map(I=>I.file))}else c.push(...((n=s.dataTransfer)==null?void 0:n.files)??[]);return c}return{handleDrop:r,hasFilesOrFolders:e}}function j(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new Promise((s,c)=>{e.isFile?e.file(o=>s([{file:o,path:r}]),c):e.isDirectory&&e.createReader().readEntries(async o=>{const n=[];for(const i of o)n.push(...await j(i,G(r,i)));s(n)})})}function G(e,r){return r.isDirectory?`${e}/${r.name}`:e}const we=ve({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},...ce({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>x(e).every(r=>r!=null&&typeof r=="object")},...oe({clearable:!0})},"VFileInput"),Te=de()({name:"VFileInput",inheritAttrs:!1,props:we(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,r){let{attrs:s,emit:c,slots:l}=r;const{t:o}=me(),n=pe(e,"modelValue",e.modelValue,t=>x(t),t=>!e.multiple&&Array.isArray(t)?t[0]:t),{isFocused:i,focus:b,blur:I}=se(e),P=v(()=>typeof e.showSize!="boolean"?e.showSize:void 0),R=v(()=>(n.value??[]).reduce((t,a)=>{let{size:d=0}=a;return t+d},0)),S=v(()=>O(R.value,P.value)),k=v(()=>(n.value??[]).map(t=>{const{name:a="",size:d=0}=t;return e.showSize?`${a} (${O(d,P.value)})`:a})),J=v(()=>{var a;const t=((a=n.value)==null?void 0:a.length)??0;return e.showSize?o(e.counterSizeString,t,S.value):o(e.counterString,t)}),z=V(),A=V(),u=V(),K=ye(()=>i.value||e.active),B=v(()=>["plain","underlined"].includes(e.variant)),y=ge(!1),{handleDrop:L,hasFilesOrFolders:U}=De();function C(){var t;u.value!==document.activeElement&&((t=u.value)==null||t.focus()),i.value||b()}function _(t){var a;(a=u.value)==null||a.click()}function q(t){c("mousedown:control",t)}function H(t){var a;(a=u.value)==null||a.click(),c("click:control",t)}function Q(t){t.stopPropagation(),C(),ke(()=>{n.value=[],Ce(e["onClick:clear"],t)})}function W(t){t.preventDefault(),t.stopImmediatePropagation(),y.value=!0}function X(t){t.preventDefault(),y.value=!1}async function Y(t){if(t.preventDefault(),t.stopImmediatePropagation(),y.value=!1,!u.value||!U(t))return;const a=new DataTransfer;for(const d of await L(t))a.items.add(d);u.value.files=a.files,u.value.dispatchEvent(new Event("change",{bubbles:!0}))}return he(n,t=>{(!Array.isArray(t)||!t.length)&&u.value&&(u.value.value="")}),Ve(()=>{const t=!!(l.counter||e.counter),a=!!(t||l.details),[d,Z]=be(s),{modelValue:Pe,...ee}=M.filterProps(e),te=N.filterProps(e);return h(M,D({ref:z,modelValue:e.multiple?n.value:n.value[0],class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--dragging":y.value,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":B.value},e.class],style:e.style,"onClick:prepend":_},d,ee,{centerAffix:!B.value,focused:i.value}),{...l,default:F=>{let{id:g,isDisabled:p,isDirty:E,isReadonly:T,isValid:ne}=F;return h(N,D({ref:A,"prepend-icon":e.prependIcon,onMousedown:q,onClick:H,"onClick:clear":Q,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},te,{id:g.value,active:K.value||E.value,dirty:E.value||e.dirty,disabled:p.value,focused:i.value,error:ne.value===!1,onDragover:W,onDrop:Y}),{...l,default:ae=>{var $;let{props:{class:le,...ie}}=ae;return m(w,null,[m("input",D({ref:u,type:"file",readonly:T.value,disabled:p.value,multiple:e.multiple,name:e.name,onClick:f=>{f.stopPropagation(),T.value&&f.preventDefault(),C()},onChange:f=>{if(!f.target)return;const re=f.target;n.value=[...re.files??[]]},onDragleave:X,onFocus:C,onBlur:I},ie,Z),null),m("div",{class:Ie(le)},[!!(($=n.value)!=null&&$.length)&&!e.hideInput&&(l.selection?l.selection({fileNames:k.value,totalBytes:R.value,totalBytesReadable:S.value}):e.chips?k.value.map(f=>h(Fe,{key:f,size:"small",text:f},null)):k.value.join(", "))])])}})},details:a?F=>{var g,p;return m(w,null,[(g=l.details)==null?void 0:g.call(l,F),t&&m(w,null,[m("span",null,null),h(ue,{active:!!((p=n.value)!=null&&p.length),value:J.value,disabled:e.disabled},l.counter)])])}:void 0})}),fe({},z,A,u)}});export{Te as V};
