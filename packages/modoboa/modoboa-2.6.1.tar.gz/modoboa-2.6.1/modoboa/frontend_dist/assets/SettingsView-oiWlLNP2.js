import{C as Le,b as J,n as te,u as se,i as Y,h as y,d as ce,z as me,c as x,o as M,w as d,a as i,k as P,t as g,f,p as de,e as E,ae as ge,af as B,$ as Re,F as O,I as ze,J as Be,O as Qe,K as He,T as Ke,a7 as ae,a0 as Ge,ag as Ye,a1 as qe,v as ke,U as We,y as Je,ah as Ae,l as D,m as G,s as Me,ad as H,N as Xe,ai as Ze,_ as je,j as Ee}from"./index-D9OmnhdE.js";import{_ as et}from"./AccountPasswordSubForm-KRg2Sc3j.js";import{V as Z,r as j}from"./VForm-RVvaatfV.js";import{V as Ve,c as Pe,a as Se,b as tt}from"./VExpansionPanels-Rq8tzNGV.js";import{V as Q,a as at,m as ot}from"./VTextField-BBIziqiv.js";import{V as nt}from"./VAutocomplete-vTx-9foZ.js";import{V as L,c as he}from"./VAvatar-Wz1UmZ2b.js";import{c as fe,V as q,a as W,b as ye}from"./VCard-BrQzTMsm.js";import{V as ue,a as re}from"./VRow-DGPh2Qmm.js";import{V as X}from"./VAlert-BWUQvs3i.js";import{a as lt}from"./VMenu-BPG7b7dT.js";import{V as rt}from"./VProgressCircular-Bdwj7JuI.js";import{a as st,u as it,m as ut}from"./tag-jImTUiWx.js";import{u as dt,m as ct}from"./VInput-ssnfbpwr.js";import{V as Ne}from"./VTable-C08Q6ok2.js";import{V as ft}from"./VSpacer-Pa16wvUF.js";import{V as Fe}from"./VDialog-BF9xR7BQ.js";import{V as Te}from"./VTextarea-PURjBZRs.js";import{V as Ie}from"./VCheckbox-IdHLHDAe.js";import{_ as pe}from"./ConfirmDialog-CnWM982L.js";import{V as vt}from"./VDataTableVirtual-Ceu9uaGm.js";import{V as mt,a as ht}from"./VToolbar-CILwTR5O.js";import{V as pt,a as gt,b as ne,c as le}from"./VTabs-CaqxP8RF.js";import"./accounts-DkNidbb0.js";import"./VSwitch-C8Eq78Y3.js";import"./VSelectionControl-BIXXUgD4.js";import"./forwardRefs-GE5Osi9V.js";import"./ssrBoot-DaeAGyhc.js";import"./VSelect-CzmrBwOO.js";import"./VCheckboxBtn-BMf4a9DP.js";import"./VChip-B1E7xQW1.js";import"./filter-CfvL3jIf.js";/* empty css              */import"./VDataTable-CVJjOdhF.js";import"./VWindowItem-l3wU5Kto.js";const yt="languages",_t={getAll(){return Le.get(`/${yt}/`)}},bt={class:"m-label"},wt={class:"m-label"},Ct={class:"m-label"},kt={class:"text-disabled"},At={href:"https://explore.transifex.com/tonio/modoboa/",target:"_blank"},Et={href:"https://github.com/modoboa/modoboa/issues/new/choose",target:"_blank"},Vt={class:"m-label"},Pt={class:"m-label"},St={__name:"ProfileForm",setup(r){const{$gettext:s,available:v}=J(),l=te(),m=se(),p=Y(()=>m.authUser),o=y({}),e=y(),t=y(),a=y({}),n=y([]),u=y(0),c=y(!1),h=y(!1),w=y("");function C(R){o.value={first_name:R.first_name,last_name:R.last_name,language:R.language,phone_number:R.phone_number,secondary_email:R.secondary_email}}async function F(){const{valid:R}=await e.value.validate();R&&(c.value=!0,m.updateAccount(o.value).then(()=>{l.displayNotification({msg:s("Profile updated")}),m.accountLanguage in v||(w.value=s("Language does no exist"))}).finally(()=>c.value=!1))}async function T(){const{valid:R}=await t.value.validate();if(R){h.value=!0;try{await m.updatePassword({password:o.value.password,new_password:o.value.new_password}),l.displayNotification({msg:s("Password updated")}),t.value.reset()}catch(_){_.status===400&&(a.value=_.response.data)}finally{h.value=!1}}}return ce(()=>{C(p.value),_t.getAll().then(R=>{n.value=R.data})}),me(()=>p,R=>{R?C(R):o.value={}}),(R,_)=>(M(),x(tt,{modelValue:u.value,"onUpdate:modelValue":_[6]||(_[6]=k=>u.value=k),flat:""},{default:d(()=>[i(Ve,null,{default:d(()=>[i(Pe,null,{default:d(()=>[P(g(f(s)("General settings")),1)]),_:1}),i(Se,null,{default:d(()=>[i(Z,{ref_key:"profileForm",ref:e,onSubmit:de(F,["prevent"])},{default:d(()=>[E("label",bt,g(f(s)("First name")),1),i(Q,{modelValue:o.value.first_name,"onUpdate:modelValue":_[0]||(_[0]=k=>o.value.first_name=k),variant:"outlined",density:"compact"},null,8,["modelValue"]),E("label",wt,g(f(s)("Last name")),1),i(Q,{modelValue:o.value.last_name,"onUpdate:modelValue":_[1]||(_[1]=k=>o.value.last_name=k),variant:"outlined",density:"compact"},null,8,["modelValue"]),E("label",Ct,[P(g(f(s)("Language"))+" ",1),E("p",kt,[P(g(f(s)("Feel free to improve the translations"))+" ",1),E("a",At,g(f(s)("here")),1),P(" "+g(f(s)("or suggest a new language"))+" ",1),E("a",Et,g(f(s)("there")),1)])]),i(nt,{modelValue:o.value.language,"onUpdate:modelValue":_[2]||(_[2]=k=>o.value.language=k),items:n.value,"item-title":"label","item-value":"code",variant:"outlined",density:"compact","error-messages":w.value},null,8,["modelValue","items","error-messages"]),E("label",Vt,g(f(s)("Phone number")),1),i(Q,{modelValue:o.value.phone_number,"onUpdate:modelValue":_[3]||(_[3]=k=>o.value.phone_number=k),label:f(s)("Phone number"),variant:"outlined",density:"compact"},null,8,["modelValue","label"]),E("label",Pt,g(f(s)("Secondary email")),1),i(Q,{modelValue:o.value.secondary_email,"onUpdate:modelValue":_[4]||(_[4]=k=>o.value.secondary_email=k),variant:"outlined",density:"compact",rules:[f(j).emailOrNull]},null,8,["modelValue","rules"]),i(L,{color:"success",type:"submit",loading:c.value},{default:d(()=>[P(g(f(s)("Update settings")),1)]),_:1},8,["loading"])]),_:1},512)]),_:1})]),_:1}),i(Ve,null,{default:d(()=>[i(Pe,null,{default:d(()=>[P(g(f(s)("Password")),1)]),_:1}),i(Se,null,{default:d(()=>[i(Z,{ref_key:"passwordForm",ref:t,onSubmit:de(T,["prevent"])},{default:d(()=>[i(et,{modelValue:o.value,"onUpdate:modelValue":_[5]||(_[5]=k=>o.value=k),"form-errors":a.value,"with-password-check":""},null,8,["modelValue","form-errors"]),i(L,{color:"success",type:"submit",loading:h.value},{default:d(()=>[P(g(f(s)("Update Password")),1)]),_:1},8,["loading"])]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};/*!
 * qrcode.vue v3.6.0
 * A Vue.js component to generate QRCode. Both support Vue 2 and Vue 3
 * Â© 2017-PRESENT @scopewu(https://github.com/scopewu)
 * MIT License.
 */var K=function(){return K=Object.assign||function(s){for(var v,l=1,m=arguments.length;l<m;l++){v=arguments[l];for(var p in v)Object.prototype.hasOwnProperty.call(v,p)&&(s[p]=v[p])}return s},K.apply(this,arguments)};var ee;(function(r){var s=function(){function o(e,t,a,n){if(this.version=e,this.errorCorrectionLevel=t,this.modules=[],this.isFunction=[],e<o.MIN_VERSION||e>o.MAX_VERSION)throw new RangeError("Version value out of range");if(n<-1||n>7)throw new RangeError("Mask value out of range");this.size=e*4+17;for(var u=[],c=0;c<this.size;c++)u.push(!1);for(var c=0;c<this.size;c++)this.modules.push(u.slice()),this.isFunction.push(u.slice());this.drawFunctionPatterns();var h=this.addEccAndInterleave(a);if(this.drawCodewords(h),n==-1)for(var w=1e9,c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);var C=this.getPenaltyScore();C<w&&(n=c,w=C),this.applyMask(c)}m(0<=n&&n<=7),this.mask=n,this.applyMask(n),this.drawFormatBits(n),this.isFunction=[]}return o.encodeText=function(e,t){var a=r.QrSegment.makeSegments(e);return o.encodeSegments(a,t)},o.encodeBinary=function(e,t){var a=r.QrSegment.makeBytes(e);return o.encodeSegments([a],t)},o.encodeSegments=function(e,t,a,n,u,c){if(a===void 0&&(a=1),n===void 0&&(n=40),u===void 0&&(u=-1),c===void 0&&(c=!0),!(o.MIN_VERSION<=a&&a<=n&&n<=o.MAX_VERSION)||u<-1||u>7)throw new RangeError("Invalid value");var h,w;for(h=a;;h++){var C=o.getNumDataCodewords(h,t)*8,F=p.getTotalBits(e,h);if(F<=C){w=F;break}if(h>=n)throw new RangeError("Data too long")}for(var T=0,R=[o.Ecc.MEDIUM,o.Ecc.QUARTILE,o.Ecc.HIGH];T<R.length;T++){var _=R[T];c&&w<=o.getNumDataCodewords(h,_)*8&&(t=_)}for(var k=[],V=0,S=e;V<S.length;V++){var A=S[V];v(A.mode.modeBits,4,k),v(A.numChars,A.mode.numCharCountBits(h),k);for(var b=0,N=A.getData();b<N.length;b++){var U=N[b];k.push(U)}}m(k.length==w);var $=o.getNumDataCodewords(h,t)*8;m(k.length<=$),v(0,Math.min(4,$-k.length),k),v(0,(8-k.length%8)%8,k),m(k.length%8==0);for(var I=236;k.length<$;I^=253)v(I,8,k);for(var z=[];z.length*8<k.length;)z.push(0);return k.forEach(function(ve,ie){return z[ie>>>3]|=ve<<7-(ie&7)}),new o(h,t,z,u)},o.prototype.getModule=function(e,t){return 0<=e&&e<this.size&&0<=t&&t<this.size&&this.modules[t][e]},o.prototype.getModules=function(){return this.modules},o.prototype.drawFunctionPatterns=function(){for(var e=0;e<this.size;e++)this.setFunctionModule(6,e,e%2==0),this.setFunctionModule(e,6,e%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);for(var t=this.getAlignmentPatternPositions(),a=t.length,e=0;e<a;e++)for(var n=0;n<a;n++)e==0&&n==0||e==0&&n==a-1||e==a-1&&n==0||this.drawAlignmentPattern(t[e],t[n]);this.drawFormatBits(0),this.drawVersion()},o.prototype.drawFormatBits=function(e){for(var t=this.errorCorrectionLevel.formatBits<<3|e,a=t,n=0;n<10;n++)a=a<<1^(a>>>9)*1335;var u=(t<<10|a)^21522;m(u>>>15==0);for(var n=0;n<=5;n++)this.setFunctionModule(8,n,l(u,n));this.setFunctionModule(8,7,l(u,6)),this.setFunctionModule(8,8,l(u,7)),this.setFunctionModule(7,8,l(u,8));for(var n=9;n<15;n++)this.setFunctionModule(14-n,8,l(u,n));for(var n=0;n<8;n++)this.setFunctionModule(this.size-1-n,8,l(u,n));for(var n=8;n<15;n++)this.setFunctionModule(8,this.size-15+n,l(u,n));this.setFunctionModule(8,this.size-8,!0)},o.prototype.drawVersion=function(){if(!(this.version<7)){for(var e=this.version,t=0;t<12;t++)e=e<<1^(e>>>11)*7973;var a=this.version<<12|e;m(a>>>18==0);for(var t=0;t<18;t++){var n=l(a,t),u=this.size-11+t%3,c=Math.floor(t/3);this.setFunctionModule(u,c,n),this.setFunctionModule(c,u,n)}}},o.prototype.drawFinderPattern=function(e,t){for(var a=-4;a<=4;a++)for(var n=-4;n<=4;n++){var u=Math.max(Math.abs(n),Math.abs(a)),c=e+n,h=t+a;0<=c&&c<this.size&&0<=h&&h<this.size&&this.setFunctionModule(c,h,u!=2&&u!=4)}},o.prototype.drawAlignmentPattern=function(e,t){for(var a=-2;a<=2;a++)for(var n=-2;n<=2;n++)this.setFunctionModule(e+n,t+a,Math.max(Math.abs(n),Math.abs(a))!=1)},o.prototype.setFunctionModule=function(e,t,a){this.modules[t][e]=a,this.isFunction[t][e]=!0},o.prototype.addEccAndInterleave=function(e){var t=this.version,a=this.errorCorrectionLevel;if(e.length!=o.getNumDataCodewords(t,a))throw new RangeError("Invalid argument");for(var n=o.NUM_ERROR_CORRECTION_BLOCKS[a.ordinal][t],u=o.ECC_CODEWORDS_PER_BLOCK[a.ordinal][t],c=Math.floor(o.getNumRawDataModules(t)/8),h=n-c%n,w=Math.floor(c/n),C=[],F=o.reedSolomonComputeDivisor(u),T=0,R=0;T<n;T++){var _=e.slice(R,R+w-u+(T<h?0:1));R+=_.length;var k=o.reedSolomonComputeRemainder(_,F);T<h&&_.push(0),C.push(_.concat(k))}for(var V=[],S=function(A){C.forEach(function(b,N){(A!=w-u||N>=h)&&V.push(b[A])})},T=0;T<C[0].length;T++)S(T);return m(V.length==c),V},o.prototype.drawCodewords=function(e){if(e.length!=Math.floor(o.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");for(var t=0,a=this.size-1;a>=1;a-=2){a==6&&(a=5);for(var n=0;n<this.size;n++)for(var u=0;u<2;u++){var c=a-u,h=(a+1&2)==0,w=h?this.size-1-n:n;!this.isFunction[w][c]&&t<e.length*8&&(this.modules[w][c]=l(e[t>>>3],7-(t&7)),t++)}}m(t==e.length*8)},o.prototype.applyMask=function(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(var t=0;t<this.size;t++)for(var a=0;a<this.size;a++){var n=void 0;switch(e){case 0:n=(a+t)%2==0;break;case 1:n=t%2==0;break;case 2:n=a%3==0;break;case 3:n=(a+t)%3==0;break;case 4:n=(Math.floor(a/3)+Math.floor(t/2))%2==0;break;case 5:n=a*t%2+a*t%3==0;break;case 6:n=(a*t%2+a*t%3)%2==0;break;case 7:n=((a+t)%2+a*t%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[t][a]&&n&&(this.modules[t][a]=!this.modules[t][a])}},o.prototype.getPenaltyScore=function(){for(var e=0,t=0;t<this.size;t++){for(var a=!1,n=0,u=[0,0,0,0,0,0,0],c=0;c<this.size;c++)this.modules[t][c]==a?(n++,n==5?e+=o.PENALTY_N1:n>5&&e++):(this.finderPenaltyAddHistory(n,u),a||(e+=this.finderPenaltyCountPatterns(u)*o.PENALTY_N3),a=this.modules[t][c],n=1);e+=this.finderPenaltyTerminateAndCount(a,n,u)*o.PENALTY_N3}for(var c=0;c<this.size;c++){for(var a=!1,h=0,u=[0,0,0,0,0,0,0],t=0;t<this.size;t++)this.modules[t][c]==a?(h++,h==5?e+=o.PENALTY_N1:h>5&&e++):(this.finderPenaltyAddHistory(h,u),a||(e+=this.finderPenaltyCountPatterns(u)*o.PENALTY_N3),a=this.modules[t][c],h=1);e+=this.finderPenaltyTerminateAndCount(a,h,u)*o.PENALTY_N3}for(var t=0;t<this.size-1;t++)for(var c=0;c<this.size-1;c++){var w=this.modules[t][c];w==this.modules[t][c+1]&&w==this.modules[t+1][c]&&w==this.modules[t+1][c+1]&&(e+=o.PENALTY_N2)}for(var C=0,F=0,T=this.modules;F<T.length;F++){var R=T[F];C=R.reduce(function(V,S){return V+(S?1:0)},C)}var _=this.size*this.size,k=Math.ceil(Math.abs(C*20-_*10)/_)-1;return m(0<=k&&k<=9),e+=k*o.PENALTY_N4,m(0<=e&&e<=2568888),e},o.prototype.getAlignmentPatternPositions=function(){if(this.version==1)return[];for(var e=Math.floor(this.version/7)+2,t=Math.floor((this.version*8+e*3+5)/(e*4-4))*2,a=[6],n=this.size-7;a.length<e;n-=t)a.splice(1,0,n);return a},o.getNumRawDataModules=function(e){if(e<o.MIN_VERSION||e>o.MAX_VERSION)throw new RangeError("Version number out of range");var t=(16*e+128)*e+64;if(e>=2){var a=Math.floor(e/7)+2;t-=(25*a-10)*a-55,e>=7&&(t-=36)}return m(208<=t&&t<=29648),t},o.getNumDataCodewords=function(e,t){return Math.floor(o.getNumRawDataModules(e)/8)-o.ECC_CODEWORDS_PER_BLOCK[t.ordinal][e]*o.NUM_ERROR_CORRECTION_BLOCKS[t.ordinal][e]},o.reedSolomonComputeDivisor=function(e){if(e<1||e>255)throw new RangeError("Degree out of range");for(var t=[],a=0;a<e-1;a++)t.push(0);t.push(1);for(var n=1,a=0;a<e;a++){for(var u=0;u<t.length;u++)t[u]=o.reedSolomonMultiply(t[u],n),u+1<t.length&&(t[u]^=t[u+1]);n=o.reedSolomonMultiply(n,2)}return t},o.reedSolomonComputeRemainder=function(e,t){for(var a=t.map(function(w){return 0}),n=function(w){var C=w^a.shift();a.push(0),t.forEach(function(F,T){return a[T]^=o.reedSolomonMultiply(F,C)})},u=0,c=e;u<c.length;u++){var h=c[u];n(h)}return a},o.reedSolomonMultiply=function(e,t){if(e>>>8||t>>>8)throw new RangeError("Byte out of range");for(var a=0,n=7;n>=0;n--)a=a<<1^(a>>>7)*285,a^=(t>>>n&1)*e;return m(a>>>8==0),a},o.prototype.finderPenaltyCountPatterns=function(e){var t=e[1];m(t<=this.size*3);var a=t>0&&e[2]==t&&e[3]==t*3&&e[4]==t&&e[5]==t;return(a&&e[0]>=t*4&&e[6]>=t?1:0)+(a&&e[6]>=t*4&&e[0]>=t?1:0)},o.prototype.finderPenaltyTerminateAndCount=function(e,t,a){return e&&(this.finderPenaltyAddHistory(t,a),t=0),t+=this.size,this.finderPenaltyAddHistory(t,a),this.finderPenaltyCountPatterns(a)},o.prototype.finderPenaltyAddHistory=function(e,t){t[0]==0&&(e+=this.size),t.pop(),t.unshift(e)},o.MIN_VERSION=1,o.MAX_VERSION=40,o.PENALTY_N1=3,o.PENALTY_N2=3,o.PENALTY_N3=40,o.PENALTY_N4=10,o.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],o.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],o}();r.QrCode=s;function v(o,e,t){if(e<0||e>31||o>>>e)throw new RangeError("Value out of range");for(var a=e-1;a>=0;a--)t.push(o>>>a&1)}function l(o,e){return(o>>>e&1)!=0}function m(o){if(!o)throw new Error("Assertion error")}var p=function(){function o(e,t,a){if(this.mode=e,this.numChars=t,this.bitData=a,t<0)throw new RangeError("Invalid argument");this.bitData=a.slice()}return o.makeBytes=function(e){for(var t=[],a=0,n=e;a<n.length;a++){var u=n[a];v(u,8,t)}return new o(o.Mode.BYTE,e.length,t)},o.makeNumeric=function(e){if(!o.isNumeric(e))throw new RangeError("String contains non-numeric characters");for(var t=[],a=0;a<e.length;){var n=Math.min(e.length-a,3);v(parseInt(e.substring(a,a+n),10),n*3+1,t),a+=n}return new o(o.Mode.NUMERIC,e.length,t)},o.makeAlphanumeric=function(e){if(!o.isAlphanumeric(e))throw new RangeError("String contains unencodable characters in alphanumeric mode");var t=[],a;for(a=0;a+2<=e.length;a+=2){var n=o.ALPHANUMERIC_CHARSET.indexOf(e.charAt(a))*45;n+=o.ALPHANUMERIC_CHARSET.indexOf(e.charAt(a+1)),v(n,11,t)}return a<e.length&&v(o.ALPHANUMERIC_CHARSET.indexOf(e.charAt(a)),6,t),new o(o.Mode.ALPHANUMERIC,e.length,t)},o.makeSegments=function(e){return e==""?[]:o.isNumeric(e)?[o.makeNumeric(e)]:o.isAlphanumeric(e)?[o.makeAlphanumeric(e)]:[o.makeBytes(o.toUtf8ByteArray(e))]},o.makeEci=function(e){var t=[];if(e<0)throw new RangeError("ECI assignment value out of range");if(e<128)v(e,8,t);else if(e<16384)v(2,2,t),v(e,14,t);else if(e<1e6)v(6,3,t),v(e,21,t);else throw new RangeError("ECI assignment value out of range");return new o(o.Mode.ECI,0,t)},o.isNumeric=function(e){return o.NUMERIC_REGEX.test(e)},o.isAlphanumeric=function(e){return o.ALPHANUMERIC_REGEX.test(e)},o.prototype.getData=function(){return this.bitData.slice()},o.getTotalBits=function(e,t){for(var a=0,n=0,u=e;n<u.length;n++){var c=u[n],h=c.mode.numCharCountBits(t);if(c.numChars>=1<<h)return 1/0;a+=4+h+c.bitData.length}return a},o.toUtf8ByteArray=function(e){e=encodeURI(e);for(var t=[],a=0;a<e.length;a++)e.charAt(a)!="%"?t.push(e.charCodeAt(a)):(t.push(parseInt(e.substring(a+1,a+3),16)),a+=2);return t},o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",o}();r.QrSegment=p})(ee||(ee={}));(function(r){(function(s){var v=function(){function l(m,p){this.ordinal=m,this.formatBits=p}return l.LOW=new l(0,1),l.MEDIUM=new l(1,0),l.QUARTILE=new l(2,3),l.HIGH=new l(3,2),l}();s.Ecc=v})(r.QrCode||(r.QrCode={}))})(ee||(ee={}));(function(r){(function(s){var v=function(){function l(m,p){this.modeBits=m,this.numBitsCharCount=p}return l.prototype.numCharCountBits=function(m){return this.numBitsCharCount[Math.floor((m+7)/17)]},l.NUMERIC=new l(1,[10,12,14]),l.ALPHANUMERIC=new l(2,[9,11,13]),l.BYTE=new l(4,[8,16,16]),l.KANJI=new l(8,[8,10,12]),l.ECI=new l(7,[0,0,0]),l}();s.Mode=v})(r.QrSegment||(r.QrSegment={}))})(ee||(ee={}));var oe=ee,_e="L",be={L:oe.QrCode.Ecc.LOW,M:oe.QrCode.Ecc.MEDIUM,Q:oe.QrCode.Ecc.QUARTILE,H:oe.QrCode.Ecc.HIGH},Rt=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}();function we(r){return r in be}function Ue(r,s){s===void 0&&(s=0);var v=[];return r.forEach(function(l,m){var p=null;l.forEach(function(o,e){if(!o&&p!==null){v.push("M".concat(p+s," ").concat(m+s,"h").concat(e-p,"v1H").concat(p+s,"z")),p=null;return}if(e===l.length-1){if(!o)return;p===null?v.push("M".concat(e+s,",").concat(m+s," h1v1H").concat(e+s,"z")):v.push("M".concat(p+s,",").concat(m+s," h").concat(e+1-p,"v1H").concat(p+s,"z"));return}o&&p===null&&(p=e)})}),v.join("")}function $e(r,s,v,l){var m=l.width,p=l.height,o=l.x,e=l.y,t=r.length+v*2,a=Math.floor(s*.1),n=t/s,u=(m||a)*n,c=(p||a)*n,h=o==null?r.length/2-u/2:o*n,w=e==null?r.length/2-c/2:e*n,C=null;if(l.excavate){var F=Math.floor(h),T=Math.floor(w),R=Math.ceil(u+h-F),_=Math.ceil(c+w-T);C={x:F,y:T,w:R,h:_}}return{x:h,y:w,h:c,w:u,excavation:C}}function De(r,s){return r.slice().map(function(v,l){return l<s.y||l>=s.y+s.h?v:v.map(function(m,p){return p<s.x||p>=s.x+s.w?m:!1})})}var Ce={value:{type:String,required:!0,default:""},size:{type:Number,default:100},level:{type:String,default:_e,validator:function(r){return we(r)}},background:{type:String,default:"#fff"},foreground:{type:String,default:"#000"},margin:{type:Number,required:!1,default:0},imageSettings:{type:Object,required:!1,default:function(){return{}}},gradient:{type:Boolean,required:!1,default:!1},gradientType:{type:String,required:!1,default:"linear",validator:function(r){return["linear","radial"].indexOf(r)>-1}},gradientStartColor:{type:String,required:!1,default:"#000"},gradientEndColor:{type:String,required:!1,default:"#fff"}},Mt=K(K({},Ce),{renderAs:{type:String,required:!1,default:"canvas",validator:function(r){return["canvas","svg"].indexOf(r)>-1}}}),Nt=ge({name:"QRCodeSvg",props:Ce,setup:function(r){var s=y(0),v=y(""),l,m=function(){var o=r.value,e=r.level,t=r.margin,a=t>>>0,n=we(e)?e:_e,u=oe.QrCode.encodeText(o,be[n]).getModules();if(s.value=u.length+a*2,r.imageSettings.src){var c=$e(u,r.size,a,r.imageSettings);l={x:c.x+a,y:c.y+a,width:c.w,height:c.h},c.excavation&&(u=De(u,c.excavation))}v.value=Ue(u,a)},p=function(){if(!r.gradient)return null;var o=r.gradientType==="linear"?{x1:"0%",y1:"0%",x2:"100%",y2:"100%"}:{cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"};return B(r.gradientType==="linear"?"linearGradient":"radialGradient",K({id:"qr-gradient"},o),[B("stop",{offset:"0%",style:{stopColor:r.gradientStartColor}}),B("stop",{offset:"100%",style:{stopColor:r.gradientEndColor}})])};return m(),Re(m),function(){return B("svg",{width:r.size,height:r.size,"shape-rendering":"crispEdges",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(s.value," ").concat(s.value)},[B("defs",{},[p()]),B("rect",{width:"100%",height:"100%",fill:r.background}),B("path",{fill:r.gradient?"url(#qr-gradient)":r.foreground,d:v.value}),r.imageSettings.src&&B("image",K({href:r.imageSettings.src},l))])}}}),Ft=ge({name:"QRCodeCanvas",props:Ce,setup:function(r,s){var v=y(null),l=y(null),m=function(){var o=r.value,e=r.level,t=r.size,a=r.margin,n=r.background,u=r.foreground,c=r.gradient,h=r.gradientType,w=r.gradientStartColor,C=r.gradientEndColor,F=a>>>0,T=we(e)?e:_e,R=v.value;if(R){var _=R.getContext("2d");if(_){var k=oe.QrCode.encodeText(o,be[T]).getModules(),V=k.length+F*2,S=l.value,A={x:0,y:0,width:0,height:0},b=r.imageSettings.src&&S!=null&&S.naturalWidth!==0&&S.naturalHeight!==0;if(b){var N=$e(k,r.size,F,r.imageSettings);A={x:N.x+F,y:N.y+F,width:N.w,height:N.h},N.excavation&&(k=De(k,N.excavation))}var U=window.devicePixelRatio||1,$=t/V*U;if(R.height=R.width=t*U,_.scale($,$),_.fillStyle=n,_.fillRect(0,0,V,V),c){var I=void 0;h==="linear"?I=_.createLinearGradient(0,0,V,V):I=_.createRadialGradient(V/2,V/2,0,V/2,V/2,V/2),I.addColorStop(0,w),I.addColorStop(1,C),_.fillStyle=I}else _.fillStyle=u;Rt?_.fill(new Path2D(Ue(k,F))):k.forEach(function(z,ve){z.forEach(function(ie,Oe){ie&&_.fillRect(Oe+F,ve+F,1,1)})}),b&&_.drawImage(S,A.x,A.y,A.width,A.height)}}};ce(m),Re(m);var p=s.attrs.style;return function(){return B(O,[B("canvas",K(K({},s.attrs),{ref:v,style:K(K({},p),{width:"".concat(r.size,"px"),height:"".concat(r.size,"px")})})),r.imageSettings.src&&B("img",{ref:l,src:r.imageSettings.src,style:{display:"none"},onLoad:m})])}}}),Tt=ge({name:"Qrcode",render:function(){var r=this.$props,s=r.renderAs,v=r.value,l=r.size,m=r.margin,p=r.level,o=r.background,e=r.foreground,t=r.imageSettings,a=r.gradient,n=r.gradientType,u=r.gradientStartColor,c=r.gradientEndColor;return B(s==="svg"?Nt:Ft,{value:v,size:l,margin:m,level:p,background:o,foreground:e,imageSettings:t,gradient:a,gradientType:n,gradientStartColor:u,gradientEndColor:c})},props:Mt});const It=Be({autofocus:Boolean,divider:String,focusAll:Boolean,label:{type:String,default:"$vuetify.input.otp"},length:{type:[Number,String],default:6},modelValue:{type:[Number,String],default:void 0},placeholder:String,type:{type:String,default:"number"},...ut(),...ct(),...We(ot({variant:"outlined"}),["baseColor","bgColor","class","color","disabled","error","loading","rounded","style","theme","variant"])},"VOtpInput"),Ut=ze()({name:"VOtpInput",props:It(),emits:{finish:r=>!0,"update:focused":r=>!0,"update:modelValue":r=>!0},setup(r,s){let{attrs:v,emit:l,slots:m}=s;const{dimensionStyles:p}=st(r),{isFocused:o,focus:e,blur:t}=dt(r),a=Qe(r,"modelValue","",b=>b==null?[]:String(b).split(""),b=>b.join("")),{t:n}=He(),u=Y(()=>Number(r.length)),c=Y(()=>Array(u.value).fill(0)),h=y(-1),w=y(),C=y([]),F=Y(()=>C.value[h.value]);function T(){if(A(F.value.value)){F.value.value="";return}const b=a.value.slice(),N=F.value.value;b[h.value]=N;let U=null;h.value>a.value.length?U=a.value.length+1:h.value+1!==u.value&&(U="next"),a.value=b,U&&Ae(w.value,U)}function R(b){const N=a.value.slice(),U=h.value;let $=null;["ArrowLeft","ArrowRight","Backspace","Delete"].includes(b.key)&&(b.preventDefault(),b.key==="ArrowLeft"?$="prev":b.key==="ArrowRight"?$="next":["Backspace","Delete"].includes(b.key)&&(N[h.value]="",a.value=N,h.value>0&&b.key==="Backspace"?$="prev":requestAnimationFrame(()=>{var I;(I=C.value[U])==null||I.select()})),requestAnimationFrame(()=>{$!=null&&Ae(w.value,$)}))}function _(b,N){var $,I;N.preventDefault(),N.stopPropagation();const U=(($=N==null?void 0:N.clipboardData)==null?void 0:$.getData("Text").trim().slice(0,u.value))??"";A(U)||(a.value=U.split(""),(I=C.value)==null||I[b].blur())}function k(){a.value=[]}function V(b,N){e(),h.value=N}function S(){t(),h.value=-1}function A(b){return r.type==="number"&&/[^0-9]/g.test(b)}return Ke({VField:{color:ae(()=>r.color),bgColor:ae(()=>r.color),baseColor:ae(()=>r.baseColor),disabled:ae(()=>r.disabled),error:ae(()=>r.error),variant:ae(()=>r.variant)}},{scoped:!0}),me(a,b=>{b.length===u.value&&(h.value=u.value-1,l("finish",b.join("")))},{deep:!0}),me(h,b=>{b<0||Ge(()=>{var N;(N=C.value[b])==null||N.select()})}),it(()=>{var U;const[b,N]=Ye(v);return E("div",ke({class:["v-otp-input",{"v-otp-input--divided":!!r.divider},r.class],style:[r.style]},b),[E("div",{ref:w,class:"v-otp-input__content",style:qe([p.value])},[c.value.map(($,I)=>E(O,null,[r.divider&&I!==0&&E("span",{class:"v-otp-input__divider"},[r.divider]),i(at,{focused:o.value&&r.focusAll||h.value===I,key:I},{...m,loader:void 0,default:()=>E("input",{ref:z=>C.value[I]=z,"aria-label":n(r.label,I+1),autofocus:I===0&&r.autofocus,autocomplete:"one-time-code",class:Je(["v-otp-input__field"]),disabled:r.disabled,inputmode:r.type==="number"?"numeric":"text",min:r.type==="number"?0:void 0,maxlength:I===0?u.value:"1",placeholder:r.placeholder,type:r.type==="number"?"text":r.type,value:a.value[I],onInput:T,onFocus:z=>V(z,I),onBlur:S,onKeydown:R,onPaste:z=>_(I,z)},null)})])),E("input",ke({class:"v-otp-input-input",type:"hidden"},N,{value:a.value.join("")}),null),i(lt,{contained:!0,"content-class":"v-otp-input__loader","model-value":!!r.loading,persistent:!0},{default:()=>{var $;return[(($=m.loader)==null?void 0:$.call(m))??i(rt,{color:typeof r.loading=="boolean"?void 0:r.loading,indeterminate:!0,size:"24",width:"2"},null)]}}),(U=m.default)==null?void 0:U.call(m)])])}),{blur:()=>{var b;(b=C.value)==null||b.some(N=>N.blur())},focus:()=>{var b;(b=C.value)==null||b[0].focus()},reset:k,isFocused:o}}}),$t={class:"text-h6"},Dt={class:"m-label"},xt={class:"mt-4"},Ot={class:"m-label"},Lt={class:"mt-5"},zt={tag:"p",class:"my-4"},Bt={__name:"TotpAuthForm",setup(r){const{$gettext:s}=J(),v=te(),l=se(),m=y(),p=y(""),o=y([]),e=y(null),t=y(null),a=y(!1),n=y(!1),u=y(""),c=y([]),h=y([]),w=y(!1),C=Y(()=>l.authUser.totp_enabled);function F(){H.getKeyForTFASetup().then(V=>{e.value=V.data.key,t.value=V.data.url})}function T(){navigator.clipboard.writeText(e.value),a.value=!0}function R(){H.startTFASetup().then(()=>{F()})}function _(){l.finalizeTFASetup(p.value).then(V=>{e.value=null,t.value=null,V.status===200&&(h.value=V.data.tokens),w.value=!0}).catch(V=>{V.response.status===400&&(o.value=V.response.data.pin_code)})}async function k(){if(!await m.value.validate())return;const S={password:u.value};n.value=!0,H.disableTFA(S).then(()=>{l.fetchUser()}).catch(A=>{A.response.status===400?c.value=A.response.data.password:v.displayNotification({msg:s(A.response.data),type:"error"})}).finally(()=>{n.value=!1,m.value.reset()})}return(V,S)=>(M(),D("div",null,[i(W,{flat:""},{default:d(()=>[i(fe,null,{default:d(()=>[E("span",$t,g(f(s)("One-time passwords")),1)]),_:1}),i(q,null,{default:d(()=>[t.value?(M(),x(ue,{key:0},{default:d(()=>[i(re,{cols:"4"},{default:d(()=>[i(ue,{rows:"2"},{default:d(()=>[i(Tt,{value:t.value,size:250,"render-as":"svg",level:"H",class:"qrcode"},null,8,["value"])]),_:1}),i(ue,null,{default:d(()=>[i(L,{color:"primary",class:"key",onClick:T},{default:d(()=>[P(g(f(s)("Click here to copy the key"))+" ",1),a.value?(M(),x(he,{key:0,color:"success"},{default:d(()=>S[2]||(S[2]=[P(" mdi-check-all ")])),_:1,__:[2]})):G("",!0)]),_:1})]),_:1})]),_:1}),i(re,{cols:"6"},{default:d(()=>[i(X,{type:"info",class:"ma-4"},{default:d(()=>[P(g(f(s)("Install a soft token authenticator like FreeOTP or Google Authenticator from your application repository and use that app to scan this QR code.")),1)]),_:1}),E("label",Dt,g(f(s)("Pin code")),1),i(Ut,{modelValue:p.value,"onUpdate:modelValue":S[0]||(S[0]=A=>p.value=A),error:o.value.length!==0},null,8,["modelValue","error"]),i(L,{color:"primary",onClick:_},{default:d(()=>[P(g(f(s)("Register")),1)]),_:1})]),_:1})]),_:1})):w.value?(M(),D(O,{key:1},[i(X,{type:"success"},{default:d(()=>[P(g(f(s)("Congratulations! Two-factor authentication using one-time passwords is now enabled for your account.")),1)]),_:1}),h.value.length?(M(),D(O,{key:0},[E("p",xt,g(f(s)("The following recovery codes can be used one time each to let you regain access to your account, in case you lose your phone for example. Make sure to save them in a safe place, otherwise you won't be able to access your account anymore.")),1),i(Ne,{density:"compact"},{default:d(()=>[E("tbody",null,[(M(!0),D(O,null,Me(h.value,A=>(M(),D("tr",{key:A},[E("td",null,g(A),1)]))),128))])]),_:1})],64)):G("",!0)],64)):C.value?(M(),D(O,{key:2},[i(X,{type:"info",class:"mb-2"},{default:d(()=>[P(g(f(s)("Two-factor authentication using one-time passwords is enabled for your account.")),1)]),_:1}),i(Z,{ref_key:"editTFAForm",ref:m},{default:d(()=>[E("label",Ot,g(f(s)("Password")),1),i(Q,{modelValue:u.value,"onUpdate:modelValue":S[1]||(S[1]=A=>u.value=A),autocomplete:"new-password",type:"password",variant:"outlined",density:"compact",rules:[f(j).required],"error-messages":c.value},null,8,["modelValue","rules","error-messages"]),E("div",Lt,[i(L,{color:"error",class:"mr-2",loading:n.value,onClick:k},{default:d(()=>[P(g(f(s)("Disable 2FA")),1)]),_:1},8,["loading"])])]),_:1},512)],64)):(M(),D(O,{key:3},[E("div",zt,g(f(s)("Two-factor authentication (2FA) using one-time passwords is not yet activated for your account.")),1),i(L,{color:"success",onClick:R},{default:d(()=>[P(g(f(s)("Register authenticator")),1)]),_:1})],64))]),_:1})]),_:1})]))}},Qt={class:"headline"},xe={__name:"RecoveryCodesResetDialog",props:{tokens:{type:Array,default:null}},emits:["close"],setup(r,{emit:s}){const{$gettext:v}=J(),l=s;function m(){l("close")}return(p,o)=>(M(),x(W,null,{default:d(()=>[i(fe,null,{default:d(()=>[E("span",Qt,g(f(v)("New recovery codes")),1)]),_:1}),i(q,null,{default:d(()=>[i(X,{type:"info"},{default:d(()=>[P(g(f(v)("The following recovery codes can be used one time each to let you regain access to your account, in case you lose your phone for example. Make sure to save them in a safe place, otherwise you won't be able to access your account anymore.")),1)]),_:1}),i(Ne,{class:"mt-4",density:"compact"},{default:d(()=>[E("tbody",null,[(M(!0),D(O,null,Me(r.tokens,e=>(M(),D("tr",{key:e},[E("td",null,g(e),1)]))),128))])]),_:1})]),_:1}),i(ye,null,{default:d(()=>[i(ft),i(L,{color:"grey darken-1",text:"",onClick:m},{default:d(()=>[P(g(f(v)("Close")),1)]),_:1})]),_:1})]),_:1}))}},Ht={class:"text-h6"},Kt={class:"m-label"},Gt={class:"mt-5"},Yt={key:1,tag:"p",class:"my-4"},qt={__name:"BackupCodeAuthForm",setup(r){const{$gettext:s}=J(),v=te(),l=se(),m=Y(()=>l.authUser.tfa_enabled),p=y(!1),o=y(),e=y(""),t=y([]),a=y(),n=y(!1);async function u(){if(!await o.value.validate())return;const w={password:e.value};p.value=!0,H.resetRecoveryCodes(w).then(C=>{t.value=C.data.tokens,n.value=!0}).catch(C=>{C.response.status===400?a.value=C.response.data.password:v.displayNotification({msg:s(C.response.data),type:"error"})}).finally(()=>{p.value=!1,o.value.reset()})}function c(){t.value=[],n.value=!1}return(h,w)=>(M(),D("div",null,[i(W,{flat:""},{default:d(()=>[i(fe,null,{default:d(()=>[E("span",Ht,g(f(s)("Backup codes")),1)]),_:1}),i(q,null,{default:d(()=>[m.value?(M(),D(O,{key:0},[i(X,{type:"info",class:"mb-2"},{default:d(()=>[P(g(f(s)("You already have generated backup codes for this account. If you don't remember them or have used them all, you can generate new ones.")),1)]),_:1}),i(Z,{ref_key:"editTFAForm",ref:o},{default:d(()=>[E("label",Kt,g(f(s)("Password")),1),i(Q,{modelValue:e.value,"onUpdate:modelValue":w[0]||(w[0]=C=>e.value=C),autocomplete:"new-password",type:"password",variant:"outlined",density:"compact",rules:[f(j).required],"error-messages":a.value},null,8,["modelValue","rules","error-messages"]),E("div",Gt,[i(L,{loading:p.value,color:"success",onClick:u},{default:d(()=>[P(g(f(s)("Reset recovery codes")),1)]),_:1},8,["loading"])])]),_:1},512)],64)):(M(),D("div",Yt,g(f(s)("No two-factor authentificator is yet set for your account.")),1)),i(Fe,{modelValue:n.value,"onUpdate:modelValue":w[1]||(w[1]=C=>n.value=C),"max-width":"800px",persistent:""},{default:d(()=>[i(f(xe),{tokens:t.value,onClose:c},null,8,["tokens"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]))}},Wt={class:"m-label"},Jt={__name:"ForwardForm",setup(r){const{$gettext:s}=J(),v=te(),l=y({}),m=y(!1);async function p(){m.value=!0;try{await H.setForward(l.value),v.displayNotification({type:"success",msg:s("Forward updated")})}finally{m.value=!1}}return H.getForward().then(o=>{l.value=o.data}),(o,e)=>(M(),x(W,{flat:""},{default:d(()=>[i(q,null,{default:d(()=>[E("label",Wt,g(f(s)("Recipient(s)")),1),i(Te,{modelValue:l.value.recipients,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.recipients=t),hint:f(s)("Indicate one or more recipients separated by a comma (,)"),"persistent-hint":"",rows:"3",variant:"outlined"},null,8,["modelValue","hint"]),i(Ie,{modelValue:l.value.keepcopies,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.keepcopies=t),label:f(s)("Keep local copies"),hint:f(s)("Forward messages and store copies into your local mailbox"),"persistent-hint":""},null,8,["modelValue","label","hint"])]),_:1}),i(ye,{class:"pa-4"},{default:d(()=>[i(L,{color:"success",variant:"flat",loading:m.value,onClick:p},{default:d(()=>[P(g(f(s)("Update")),1)]),_:1},8,["loading"])]),_:1})]),_:1}))}},Xt={class:"m-label"},Zt={class:"mb-4"},jt={class:"m-label"},ea={class:"mb-4"},ta={class:"m-label"},aa={class:"mb-4"},oa={class:"m-label"},na={__name:"AutoReplyForm",setup(r){const s=te(),{$gettext:v}=J(),l=y({}),m=y(),p=y(!1);async function o(){const{valid:e}=await m.value.validate();e&&(p.value=!0,l.value.fromdate===""&&(l.value.fromdate=null),l.value.untildate===""&&(l.value.untildate=null),H.setARMessage(l.value).then(()=>{s.displayNotification({msg:v("Auto-reply message updated")}),p.value=!1}).catch(()=>{p.value=!1}))}return H.getARMessage().then(e=>{l.value=e.data,l.value.fromdate&&(l.value.fromdate=l.value.fromdate.slice(0,-4)),l.value.untildate&&(l.value.untildate=l.value.untildate.slice(0,-4))}),(e,t)=>(M(),x(W,{flat:""},{default:d(()=>[i(q,null,{default:d(()=>[i(Z,{ref_key:"formRef",ref:m,onSubmit:de(o,["prevent"])},{default:d(()=>[i(Ie,{modelValue:l.value.enabled,"onUpdate:modelValue":t[0]||(t[0]=a=>l.value.enabled=a),label:f(v)("Enabled"),color:"primary","hide-details":"",class:"mb-4"},null,8,["modelValue","label"]),E("label",Xt,g(f(v)("Subject")),1),i(Q,{modelValue:l.value.subject,"onUpdate:modelValue":t[1]||(t[1]=a=>l.value.subject=a),variant:"outlined",density:"compact",rules:[f(j).required]},null,8,["modelValue","rules"]),E("div",Zt,[E("label",jt,g(f(v)("Content")),1),i(Te,{modelValue:l.value.content,"onUpdate:modelValue":t[2]||(t[2]=a=>l.value.content=a),hint:f(v)("The content of your answer. You can use the following variables, which will be automatically replaced by the appropriate value: %(name)s, %(fromdate)s, %(untildate)s"),"persistent-hint":"",variant:"outlined",rows:"3",density:"compact",rules:[f(j).required]},null,8,["modelValue","hint","rules"])]),E("div",ea,[E("label",ta,g(f(v)("From")),1),i(Q,{modelValue:l.value.fromdate,"onUpdate:modelValue":t[3]||(t[3]=a=>l.value.fromdate=a),hint:f(v)("Activate your auto reply from this date"),variant:"outlined","persistent-hint":"",type:"datetime-local",density:"compact"},null,8,["modelValue","hint"])]),E("div",aa,[E("label",oa,g(f(v)("Until")),1),i(Q,{modelValue:l.value.untildate,"onUpdate:modelValue":t[4]||(t[4]=a=>l.value.untildate=a),hint:f(v)("Activate your auto reply until this date"),variant:"outlined","persistent-hint":"",type:"datetime-local",density:"compact"},null,8,["modelValue","hint"])]),i(L,{color:"success",type:"submit",loading:p.value},{default:d(()=>[P(g(f(v)("Update auto-reply")),1)]),_:1},8,["loading"])]),_:1},512)]),_:1})]),_:1}))}},la={class:"m-label"},ra={class:"ml-5 mr-5"},sa=["href"],ia={__name:"APISetupForm",setup(r){const{$gettext:s}=J(),v=te(),l=Xe("$config"),m=Y(()=>l.API_DOC_URL),p=y(!1),o=y(null),e=y();function t(){navigator.clipboard.writeText(o.value),v.displayNotification({msg:s("API token copied to your clipboard"),type:"success"})}function a(){p.value=!0,H.createAPIToken().then(c=>{o.value=c.data.token,v.displayNotification({msg:s("API token created"),type:"success"})}).finally(()=>p.value=!1)}function n(){e.value.open(s("Warning"),s("You are about to delete your API access token"),{color:"error",cancelLabel:s("Cancel"),agreeLabel:s("Proceed")})}async function u(){await H.deleteAPIToken(),v.displayNotification({msg:s("API token deleted"),type:"success"}),o.value=null}return ce(()=>{H.getAPIToken().then(c=>{o.value=c.data.token})}),(c,h)=>(M(),D(O,null,[o.value?(M(),x(W,{key:1,flat:""},{default:d(()=>[i(q,null,{default:d(()=>[E("label",la,g(f(s)("Your API token is:")),1),E("code",ra,g(o.value),1),i(L,{icon:"mdi-clipboard-plus",density:"compact",title:f(s)("Copy token to clipboard"),variant:"text",onClick:h[0]||(h[0]=w=>t())},null,8,["title"]),i(L,{icon:"mdi-delete",density:"compact",color:"error",variant:"text",title:f(s)("Delete token"),onClick:n},null,8,["title"])]),_:1})]),_:1})):(M(),x(W,{key:0,flat:""},{default:d(()=>[i(q,null,{default:d(()=>[P(g(f(s)("Your API token has not been generated yet.")),1)]),_:1}),i(ye,null,{default:d(()=>[i(L,{color:"success",variant:"flat",loading:p.value,onClick:a},{default:d(()=>[P(g(f(s)("Generate")),1)]),_:1},8,["loading"])]),_:1})]),_:1})),i(X,{type:"info",variant:"tonal",border:"start",class:"mt-4"},{default:d(()=>[P(g(f(s)("A documentation of the API is available"))+" ",1),E("a",{href:m.value,target:"_blank"},g(f(s)("here")),9,sa),h[1]||(h[1]=P(". "))]),_:1,__:[1]}),i(pe,{ref_key:"confirm",ref:e,onAgree:u},null,512)],64))}},ua={class:"text-h6"},da={tag:"p",class:"my-4"},ca={__name:"FidoAuthForm",setup(r){const s=se(),v=te(),{$gettext:l}=J(),m=y(),p=y(!1),o=!!(navigator.credentials&&navigator.credentials.create&&navigator.credentials.get&&PublicKeyCredential.parseCreationOptionsFromJSON),e=y(),t=Y(()=>s.fidoCreds),a=[{title:l("Name"),key:"name"},{title:l("Added On"),key:"added_on"},{title:l("Last Used"),key:"last_used"},{title:l("Use count"),key:"use_count"},{title:l("Actions"),key:"actions"}],n=y(),u=y(),c=y(),h=y(""),w=y(),C=y(!1);async function F(){const{valid:V}=await e.value.validate();if(!V)return;p.value=!0;const S=await Ze.beginFidoRegistration();if(S){const A=PublicKeyCredential.parseCreationOptionsFromJSON(S.data.publicKey);navigator.credentials.create({publicKey:A}).then(b=>{const N=b.toJSON();N.name=m.value,s.addFidoCred(N).then(U=>{U.status===200&&(w.value=U.data.tokens,C.value=!0)}),e.value.reset(),p.value=!1}).catch(b=>{console.log(b),e.value.reset(),p.value=!1,v.displayNotification({msg:l("Failed to register the webAuthN device"),type:"error"})})}p.value=!1}function T(){w.value=[],C.value=!1}async function R(V){await n.value.open(l("Warning"),l("Do you really want to delete this WebAuthn device?"),{color:"warning",cancelLabel:l("No"),agreeLabel:l("Yes")})&&s.deleteFidoCreds(V.id)}async function _(){return(await c.value.validate()).valid}async function k(V){if(h.value=V.name,!await u.value.open(l("Edition"),l("Edit your device"),{color:"warning",cancelLabel:l("Cancel"),agreeLabel:l("Save")}))return;const A={name:h.value};await s.editFidoCred(V.id,A)}return ce(()=>{s.getFidoCreds()}),(V,S)=>(M(),D(O,null,[E("div",null,[i(W,{flat:""},{default:d(()=>[i(fe,null,{default:d(()=>[E("span",ua,g(f(l)("WebAuthn")),1)]),_:1}),i(q,null,{default:d(()=>[i(ue,null,{default:d(()=>[t.value.length===0?(M(),x(re,{key:0,cols:"4"},{default:d(()=>[E("div",da,g(f(l)("You don't have any WebAuthN device registered as a second authentication method.")),1)]),_:1})):(M(),x(re,{key:1,cols:"8"},{default:d(()=>[E("h3",null,g(f(l)("Registered Webauthn devices")),1),i(vt,{headers:a,items:t.value,"item-value":"id"},{"item.added_on":d(({item:A})=>[P(g(V.$date(A.added_on)),1)]),"item.last_used":d(({item:A})=>[A.last_used===null?(M(),D(O,{key:0},[P(g(f(l)("Never")),1)],64)):(M(),D(O,{key:1},[P(g(V.$date(A.last_used)),1)],64))]),"item.enabled":d(({item:A})=>[P(g(V.$yesno(A.enabled)),1)]),"item.actions":d(({item:A})=>[i(he,{class:"me-2",size:"small",onClick:b=>k(A)},{default:d(()=>S[3]||(S[3]=[P(" mdi-pencil ")])),_:2,__:[3]},1032,["onClick"]),i(he,{size:"small",onClick:b=>R(A)},{default:d(()=>S[4]||(S[4]=[P(" mdi-delete ")])),_:2,__:[4]},1032,["onClick"])]),_:2},1032,["items"])]),_:1})),i(re,{cols:"4"},{default:d(()=>[o?(M(),D(O,{key:0},[E("h3",null,g(f(l)("Enter a name to register a new webauthn device.")),1),i(Z,{ref_key:"fidoForm",ref:e,onSubmit:de(F,["prevent"])},{default:d(()=>[i(Q,{modelValue:m.value,"onUpdate:modelValue":S[0]||(S[0]=A=>m.value=A),label:f(l)("New device name"),rules:[f(j).required]},null,8,["modelValue","label","rules"]),i(L,{color:"success",type:"submit",loading:p.value},{default:d(()=>[P(g(f(l)("Setup device")),1)]),_:1},8,["loading"])]),_:1},512)],64)):(M(),x(X,{key:1,type:"error"},{default:d(()=>[P(g(f(l)("Your browser does not seem compatible with WebAuthN")),1)]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1})]),i(pe,{ref_key:"confirmDeletion",ref:n},null,512),i(pe,{ref_key:"confirmEdition",ref:u,callback_agree:_},{default:d(()=>[i(Z,{ref_key:"editForm",ref:c},{default:d(()=>[i(Q,{modelValue:h.value,"onUpdate:modelValue":S[1]||(S[1]=A=>h.value=A),label:f(l)("name"),rules:[f(j).required]},null,8,["modelValue","label","rules"])]),_:1},512)]),_:1},512),i(Fe,{modelValue:C.value,"onUpdate:modelValue":S[2]||(S[2]=A=>C.value=A),"max-width":"800px",persistent:""},{default:d(()=>[i(xe,{tokens:w.value,onClose:T},null,8,["tokens"])]),_:1},8,["modelValue"])],64))}},fa={class:"pa-4"},va={__name:"SettingsView",setup(r){const s=se(),v=y();return(l,m)=>(M(),D(O,null,[i(mt,{flat:""},{default:d(()=>[i(ht,null,{default:d(()=>[P(g(l.$gettext("Account settings")),1)]),_:1})]),_:1}),E("div",fa,[i(pt,{modelValue:v.value,"onUpdate:modelValue":m[0]||(m[0]=p=>v.value=p),color:"primary",class:"mb-4"},{default:d(()=>[i(ne,{value:"profile"},{default:d(()=>[P(g(l.$gettext("Profile")),1)]),_:1}),i(ne,{value:"security"},{default:d(()=>[P(g(l.$gettext("Two-factor auth")),1)]),_:1}),f(s).userHasMailbox?(M(),x(ne,{key:0,value:"forward"},{default:d(()=>[P(g(l.$gettext("Forward")),1)]),_:1})):G("",!0),f(s).userHasMailbox?(M(),x(ne,{key:1,value:"autoreply"},{default:d(()=>[P(g(l.$gettext("Auto-reply message")),1)]),_:1})):G("",!0),f(s).authUser.role===f(Ee).SUPER_ADMIN?(M(),x(ne,{key:2,value:"api"},{default:d(()=>[P(g(l.$gettext("API access")),1)]),_:1})):G("",!0)]),_:1},8,["modelValue"]),i(gt,{modelValue:v.value,"onUpdate:modelValue":m[1]||(m[1]=p=>v.value=p)},{default:d(()=>[i(le,{value:"profile"},{default:d(()=>[i(St)]),_:1}),i(le,{value:"security"},{default:d(()=>[i(Bt),i(ca),i(qt)]),_:1}),f(s).userHasMailbox?(M(),x(le,{key:0,value:"forward"},{default:d(()=>[i(Jt)]),_:1})):G("",!0),f(s).userHasMailbox?(M(),x(le,{key:1,value:"autoreply"},{default:d(()=>[i(na)]),_:1})):G("",!0),f(s).authUser.role===f(Ee).SUPER_ADMIN?(M(),x(le,{key:2,value:"api"},{default:d(()=>[i(ia)]),_:1})):G("",!0)]),_:1},8,["modelValue"])])],64))}},Wa=je(va,[["__scopeId","data-v-fc9b36ca"]]);export{Wa as default};
