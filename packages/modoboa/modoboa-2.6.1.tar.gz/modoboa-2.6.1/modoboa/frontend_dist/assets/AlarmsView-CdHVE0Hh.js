import{d as G}from"./index-DuzUMVLM.js";import{C as b,_ as E,b as H,n as J,h as d,B as K,c as A,w as a,a as s,e as Q,f as p,v as D,k as n,t as c,l as w,F as N,j as x,o as f}from"./index-D9OmnhdE.js";import{_ as M}from"./MenuItems-Dg2GGDq6.js";import{V as L}from"./VMenu-BPG7b7dT.js";import{V as T,c as W}from"./VAvatar-Wz1UmZ2b.js";import{V as B}from"./VChip-B1E7xQW1.js";import{V as O,a as X}from"./VToolbar-CILwTR5O.js";import{V as Y}from"./VTextField-BBIziqiv.js";import{V as Z}from"./forwardRefs-GE5Osi9V.js";import{V as ee}from"./VDataTableServer-BSZUbic1.js";import{a as te}from"./VCard-BrQzTMsm.js";import"./VProgressCircular-Bdwj7JuI.js";import"./tag-jImTUiWx.js";import"./VInput-ssnfbpwr.js";import"./ssrBoot-DaeAGyhc.js";import"./VDataTable-CVJjOdhF.js";import"./VSelect-CzmrBwOO.js";import"./VCheckboxBtn-BMf4a9DP.js";import"./VSelectionControl-BIXXUgD4.js";import"./VTable-C08Q6ok2.js";import"./filter-CfvL3jIf.js";const y="alarms",h={getAll(i){return b.get(`${y}/`,{params:i})},switchStatus(i,e){return b.patch(`${y}/${i}/switch/`,e)},delete(i){return b.delete(`${y}/${i}/`)},bulkDelete(i){return b.post(`${y}/bulk_delete/`,{ids:i})}},ae={class:"text-right"},le={__name:"AlarmList",setup(i){const{$gettext:e}=H(),V=K(),v=J(),C=d([]),$=d([{key:"status",order:"desc"}]),k=d(!1),u=d(""),g=d([]),S=d(0),R=[{title:e("Triggered"),key:"created"},{title:e("Status"),key:"status"},{title:e("Domain"),key:"domain.name",sortable:!1},{title:e("Mailbox"),key:"mailbox",sortable:!1},{title:e("Message"),key:"title"},{title:e("Actions"),key:"actions",sortable:!1,align:"right"}],z=[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"}];function I(){const o=[];return g.value.length>0&&o.push({label:e("Delete"),icon:"mdi-delete-outline",onClick:U,color:"red"}),o.push({label:e("Reload"),icon:"mdi-reload",onClick:r}),o}function P(o){const l=[];return l.push({label:e("Delete"),icon:"mdi-delete-outline",onClick:j,color:"red"}),o.status===x.ALARM_OPENED?l.push({label:e("Close alarm"),icon:"mdi-check",onClick:F,color:"green"}):l.push({label:e("Reopen alarm"),icon:"mdi-alert-circle-outline",onClick:q,color:"orange"}),l}function r({page:o,itemsPerPage:l,sortBy:t}){const _={page:o||1,page_size:l||10};t&&t.length&&(_.ordering=t.map(m=>m.order!=="asc"?`-${m.key}`:m.key).join(",")),u.value!==""&&(_.search=u.value),k.value=!0,h.getAll(_).then(m=>{C.value=m.data.results,S.value=m.data.count,k.value=!1})}async function j(o,l=!0){h.delete(o.id).then(()=>{l&&(v.displayNotification({msg:e("Alarm deleted")}),r({}))})}async function U(){await h.bulkDelete(g.value),v.displayNotification({msg:e("Alarms deleted")}),g.value=[],r({})}async function F(o){h.switchStatus(o.id,{status:x.ALARM_CLOSED}).then(()=>{v.displayNotification({msg:e("Alarm closed")}),r({})})}async function q(o){h.switchStatus(o.id,{status:x.ALARM_OPENED}).then(()=>{v.displayNotification({msg:e("Alarm re-opened")}),r({})})}return V.query.search&&(u.value=V.query.search),r=G(r,500),(o,l)=>(f(),A(te,{class:"mt-6"},{default:a(()=>[s(ee,{modelValue:g.value,"onUpdate:modelValue":l[1]||(l[1]=t=>g.value=t),"sort-by":$.value,"onUpdate:sortBy":l[2]||(l[2]=t=>$.value=t),headers:R,items:C.value,search:u.value,"item-value":"id","items-length":S.value,"items-per-page-options":z,loading:k.value,elevation:"0","show-select":"","onUpdate:options":r},{top:a(()=>[s(O,{color:"white",flat:""},{default:a(()=>[s(Y,{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=t=>u.value=t),"prepend-inner-icon":"mdi-magnify",placeholder:p(e)("Search"),density:"compact",variant:"outlined","hide-details":"",flat:"","single-line":"",class:"flex-grow-0 w-33 mr-4"},null,8,["modelValue","placeholder"]),s(L,{location:"bottom"},{activator:a(({props:t})=>[s(T,D(t,{size:"small"}),{default:a(()=>[n(c(p(e)("Actions"))+" ",1),s(W,{right:""},{default:a(()=>l[3]||(l[3]=[n("mdi-chevron-down")])),_:1,__:[3]})]),_:2},1040)]),default:a(()=>[s(Z,{density:"compact"},{default:a(()=>[s(p(M),{items:I()},null,8,["items"])]),_:1})]),_:1})]),_:1})]),"item.status":a(({item:t})=>[t.status===1?(f(),A(B,{key:0,color:"warning",size:"small"},{default:a(()=>[n(c(p(e)("Opened")),1)]),_:1})):(f(),A(B,{key:1,color:"info",size:"small"},{default:a(()=>[n(c(p(e)("Closed")),1)]),_:1}))]),"item.mailbox":a(({item:t})=>[t.mailbox?(f(),w(N,{key:0},[n(c(t.mailbox.address)+"@"+c(t.domain.name),1)],64)):(f(),w(N,{key:1},[n(" / ")],64))]),"item.created":a(({item:t})=>[n(c(o.$date(t.created)),1)]),"item.actions":a(({item:t})=>[Q("div",ae,[s(L,{location:"bottom"},{activator:a(({props:_})=>[s(T,D({icon:"mdi-dots-horizontal"},_,{variant:"text"}),null,16)]),default:a(()=>[s(p(M),{items:P(t),obj:t},null,8,["items","obj"])]),_:2},1024)])]),_:2},1032,["modelValue","sort-by","items","search","items-length","loading"])]),_:1}))}},oe=E(le,[["__scopeId","data-v-4fccec74"]]),se={__name:"AlarmsView",setup(i){return(e,V)=>(f(),w("div",null,[s(O,{flat:""},{default:a(()=>[s(X,null,{default:a(()=>[n(c(e.$gettext("Opened alarms")),1)]),_:1})]),_:1}),s(oe)]))}},$e=E(se,[["__scopeId","data-v-eeff1c15"]]);export{$e as default};
