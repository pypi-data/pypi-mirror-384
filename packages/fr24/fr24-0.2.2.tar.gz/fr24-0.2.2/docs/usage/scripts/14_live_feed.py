# ruff: noqa
# fmt: off
# mypy: disable-error-code="top-level-await, no-redef"
# %%
# --8<-- [start:script]
from fr24 import FR24, FR24Cache, BoundingBox

bbox = BoundingBox(south=42, north=52, west=-8, east=10)

async def my_feed() -> None:
    async with FR24() as fr24:
        result = await fr24.live_feed.fetch(bbox)
        print(result)
        print(result.to_dict())
        print(result.to_polars())
        result.write_table(FR24Cache.default())

await my_feed()
# --8<-- [end:script]
# %%
"""
# --8<-- [start:result]
LiveFeedResult(
    request=LiveFeedParams(
        bounding_box=BoundingBox(south=42, north=52, west=-8, east=10),
        stats=False,
        limit=1500,
        maxage=14400,
        fields={"reg", "route", "flight", "type"},
    ),
    response=<Response [200 OK]>,
    timestamp=1753150332,
)
# --8<-- [end:result]
# --8<-- [start:dict]
{
    "flights_list": [
        {
            "flightid": 995827034,
            "lat": 43.11081,
            "lon": -4.72674,
            "track": 23,
            "alt": 43000,
            "speed": 513,
            "icon": "A330",
            "timestamp": 1753150329,
            "callsign": "AFR407",
            "extra_info": {
                "flight": "AF407",
                "reg": "F-HTYA",
                "route": {"from": "SCL", "to": "CDG"},
                "type": "A359",
            },
            "position_buffer": {
                "recent_positions_list": [
                    {"delta_lat": 247, "delta_lon": 146, "delta_ms": 1088},
                    {"delta_lat": 434, "delta_lon": 255, "delta_ms": 2013},
                    {"delta_lat": 664, "delta_lon": 392, "delta_ms": 3038},
                    {"delta_lat": 958, "delta_lon": 568, "delta_ms": 4375},
                    {"delta_lat": 1172, "delta_lon": 699, "delta_ms": 5375},
                    {"delta_lat": 1382, "delta_lon": 817, "delta_ms": 6313},
                    {"delta_lat": 1707, "delta_lon": 1013, "delta_ms": 7875},
                    {"delta_lat": 2000, "delta_lon": 1189, "delta_ms": 9163},
                    {"delta_lat": 2252, "delta_lon": 1334, "delta_ms": 10288},
                ]
            },
            "timestamp_ms": "1753150329391",
        },
        ...
    ],
    "server_time_ms": "1753150332065",
}

# --8<-- [end:dict]
"""
#%%
"""
# --8<-- [start:polars]
shape: (171, 18)
┌──────────────┬───────────┬───────────┬───────────┬───┬─────┬────────┬──────────────┬─────────────┐
│ timestamp    ┆ flightid  ┆ latitude  ┆ longitude ┆ … ┆ eta ┆ squawk ┆ vertical_spe ┆ position_bu │
│ ---          ┆ ---       ┆ ---       ┆ ---       ┆   ┆ --- ┆ ---    ┆ ed           ┆ ffer        │
│ datetime[ms, ┆ u32       ┆ f32       ┆ f32       ┆   ┆ u32 ┆ u16    ┆ ---          ┆ ---         │
│ UTC]         ┆           ┆           ┆           ┆   ┆     ┆        ┆ i16          ┆ list[struct │
│              ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ [3]]        │
╞══════════════╪═══════════╪═══════════╪═══════════╪═══╪═════╪════════╪══════════════╪═════════════╡
│ 2025-07-22   ┆ 995827034 ┆ 43.110809 ┆ -4.72674  ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ [{247,146,1 │
│ 02:12:09.391 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 088}, {434, │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 255,2013…   │
│ 2025-07-22   ┆ 995947452 ┆ 43.176819 ┆ -3.079877 ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ [{210,95,10 │
│ 02:12:09.762 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 90}, {421,1 │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 91,2110}…   │
│ 2025-07-22   ┆ 995945816 ┆ 42.667923 ┆ -2.855509 ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ [{45,-137,1 │
│ 02:12:10.242 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 140}, {149, │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ -455,377…   │
│ 2025-07-22   ┆ 995924443 ┆ 45.168983 ┆ -3.100891 ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ [{299,307,1 │
│ 02:12:10.116 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 540}, {514, │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 529,2610…   │
│ 2025-07-22   ┆ 995916683 ┆ 45.573853 ┆ -2.016594 ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ [{192,174,9 │
│ 02:12:09.579 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 90}, {370,3 │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 28,1880}…   │
│ …            ┆ …         ┆ …         ┆ …         ┆ … ┆ …   ┆ …      ┆ …            ┆ …           │
│ 2025-07-22   ┆ 995956094 ┆ 51.458233 ┆ 5.390149  ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ [{0,0,4902} │
│ 02:12:06.528 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ , {0,0,1000 │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 4}]         │
│ 2025-07-22   ┆ 995956104 ┆ 51.45718  ┆ 5.388998  ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ [{0,0,5030} │
│ 02:12:06.722 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ , {0,0,1010 │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 0}]         │
│ 2025-07-22   ┆ 995957785 ┆ 51.915054 ┆ 6.172904  ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ [{21,-324,9 │
│ 02:12:09.788 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 85}, {53,-6 │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 82,1980}…   │
│ 2025-07-22   ┆ 995959079 ┆ 51.789047 ┆ 8.022098  ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ [{123,475,2 │
│ 02:12:09.029 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 309}, {186, │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 711,3455…   │
│ 2025-07-22   ┆ 995949304 ┆ 51.774536 ┆ 8.631542  ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ [{27,-527,1 │
│ 02:12:09.460 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 535}, {45,- │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ 920,2677…   │
└──────────────┴───────────┴───────────┴───────────┴───┴─────┴────────┴──────────────┴─────────────┘
"""
# %%
# --8<-- [start:script2]
from fr24 import FR24, BoundingBox
import time

yesterday = int(time.time() - 86400)
bbox = BoundingBox(south=42, north=52, west=-8, east=10)

async def my_feed() -> None:
    async with FR24() as fr24:
        result = await fr24.live_feed_playback.fetch(bbox, timestamp=yesterday)
        print(result.to_polars())

await my_feed()
# --8<-- [end:script2]

# %%
"""
# --8<-- [start:polars2]
shape: (139, 18)
┌──────────────┬───────────┬───────────┬───────────┬───┬─────┬────────┬──────────────┬─────────────┐
│ timestamp    ┆ flightid  ┆ latitude  ┆ longitude ┆ … ┆ eta ┆ squawk ┆ vertical_spe ┆ position_bu │
│ ---          ┆ ---       ┆ ---       ┆ ---       ┆   ┆ --- ┆ ---    ┆ ed           ┆ ffer        │
│ datetime[ms, ┆ u32       ┆ f32       ┆ f32       ┆   ┆ u32 ┆ u16    ┆ ---          ┆ ---         │
│ UTC]         ┆           ┆           ┆           ┆   ┆     ┆        ┆ i16          ┆ list[struct │
│              ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆ [3]]        │
╞══════════════╪═══════════╪═══════════╪═══════════╪═══╪═════╪════════╪══════════════╪═════════════╡
│ 2025-07-21   ┆ 995593418 ┆ 43.238297 ┆ -4.690012 ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ []          │
│ 02:15:58.408 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ 2025-07-21   ┆ 995708427 ┆ 42.489532 ┆ 1.29364   ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ []          │
│ 02:15:58.430 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ 2025-07-21   ┆ 995704634 ┆ 42.442608 ┆ -2.886849 ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ []          │
│ 02:15:58.895 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ 2025-07-21   ┆ 995658391 ┆ 43.957397 ┆ -7.309677 ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ []          │
│ 02:15:58.852 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ 2025-07-21   ┆ 995709110 ┆ 42.351471 ┆ 4.712822  ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ []          │
│ 02:15:59.310 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ …            ┆ …         ┆ …         ┆ …         ┆ … ┆ …   ┆ …      ┆ …            ┆ …           │
│ 2025-07-21   ┆ 995713747 ┆ 50.823303 ┆ 7.588361  ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ []          │
│ 02:15:59.020 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ 2025-07-21   ┆ 995713721 ┆ 50.925819 ┆ 7.402649  ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ []          │
│ 02:15:58.966 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ 2025-07-21   ┆ 995714247 ┆ 50.87875  ┆ 7.124541  ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ []          │
│ 02:15:54.967 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ 2025-07-21   ┆ 995715577 ┆ 50.983913 ┆ 7.240559  ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ []          │
│ 02:15:58.219 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ 2025-07-21   ┆ 995714961 ┆ 50.878696 ┆ 7.126026  ┆ … ┆ 0   ┆ 0      ┆ 0            ┆ []          │
│ 02:15:59.524 ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
│ UTC          ┆           ┆           ┆           ┆   ┆     ┆        ┆              ┆             │
└──────────────┴───────────┴───────────┴───────────┴───┴─────┴────────┴──────────────┴─────────────┘
# --8<-- [end:polars2]
"""
