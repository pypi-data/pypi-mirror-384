<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RA PM Dashboard</title>

    <!-- External CSS files -->
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/header.css">
    <link rel="stylesheet" href="/static/css/kanban.css">
    <link rel="stylesheet" href="/static/css/modals.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/tabs-tables.css">
    <link rel="stylesheet" href="/static/css/forms-special.css">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" width="28" height="28" role="img" aria-label="Commands.com">
                <g transform="matrix(1,0,0,1,0.5,0.5)">
                    <path d="M31,5C31,2.792 29.208,1 27,1L5,1C2.792,1 1,2.792 1,5L1,27C1,29.208 2.792,31 5,31L27,31C29.208,31 31,29.208 31,27L31,5Z" style="fill:rgb(18,25,41);"/>
                    <path d="M31,5C31,2.792 29.208,1 27,1L5,1C2.792,1 1,2.792 1,5L1,27C1,29.208 2.792,31 5,31L27,31C29.208,31 31,29.208 31,27L31,5Z" style="fill:none;stroke:rgb(81,162,255);stroke-width:1.8px;"/>
                    <path d="M9,10L16,16L9,22" style="fill:none;fill-rule:nonzero;stroke:rgb(81,162,255);stroke-width:2.6px;"/>
                    <rect x="21" y="8" width="2" height="16" style="fill:rgb(81,162,255);"/>
                </g>
            </svg>
            <h1>RA PM Dashboard</h1>
            <button id="knowledgeBtn" class="knowledge-btn" title="Knowledge Management">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                </svg>
            </button>
            <button id="assumptionInsightsBtn" class="knowledge-btn" title="Assumption Insights Dashboard">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="20" x2="18" y2="10"></line>
                    <line x1="12" y1="20" x2="12" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="14"></line>
                </svg>
            </button>
            <button id="planningBtn" class="knowledge-btn" title="Planning Mode - View PRDs and Epics">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14,2 14,8 20,8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10,9 9,9 8,9"></polyline>
                </svg>
            </button>
        </div>
        <div class="header-filters">
            <div class="filter-group">
                <label for="projectSelect" class="filter-label">Project:</label>
                <select id="projectSelect" class="filter-select">
                    <option value="">All Projects</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="epicSelect" class="filter-label">Epic:</label>
                <select id="epicSelect" class="filter-select">
                    <option value="">All Epics</option>
                </select>
                <button id="deleteFilterBtn" class="delete-filter-btn" title="Delete selected project or epic" style="display: none;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 6h18"></path>
                        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                        <path d="M8 6V4c0-1 1-2 2-2h4c0 1 1 2 2 2v2"></path>
                    </svg>
                </button>
            </div>
        </div>
        <span id="connectionStatus" class="connection-status connecting">Connecting...</span>
    </header>

    <main class="board">
        <div class="column" data-status="TODO">
            <div class="column-header">
                <div class="column-title-container">
                    <div class="column-title" id="todo-column-title">TODO</div>
                    <button id="todo-backlog-toggle" class="toggle-btn" title="Toggle between TODO and Backlog view">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 12h18m0 0l-6-6m6 6l-6 6"/>
                        </svg>
                    </button>
                </div>
                <div class="task-count" id="todo-count">0 tasks</div>
            </div>
            <div class="tasks" id="todo-tasks">
                <div class="loading">
                    <span class="spinner"></span>
                    Loading tasks...
                </div>
            </div>
        </div>

        <div class="column" data-status="IN_PROGRESS">
            <div class="column-header">
                <div class="column-title">IN PROGRESS</div>
                <div class="task-count" id="in_progress-count">0 tasks</div>
            </div>
            <div class="tasks" id="in_progress-tasks">
                <div class="loading">
                    <span class="spinner"></span>
                    Loading tasks...
                </div>
            </div>
        </div>

        <div class="column" data-status="REVIEW">
            <div class="column-header">
                <div class="column-title">REVIEW</div>
                <div class="task-count" id="review-count">0 tasks</div>
            </div>
            <div class="tasks" id="review-tasks">
                <div class="loading">
                    <span class="spinner"></span>
                    Loading tasks...
                </div>
            </div>
        </div>

        <div class="column" data-status="DONE">
            <div class="column-header">
                <div class="column-title">DONE</div>
                <div class="task-count" id="done-count">0 tasks</div>
            </div>
            <div class="tasks" id="done-tasks">
                <div class="loading">
                    <span class="spinner"></span>
                    Loading tasks...
                </div>
            </div>
        </div>
    </main>

    <!-- Task Detail Modal -->
    <div id="taskDetailModal" class="task-modal" style="display: none;">
        <div class="task-modal-content">
            <div class="modal-header">
                <h2 id="modalTaskTitle" class="modal-title">Task Details</h2>
                <button id="modalCloseBtn" class="modal-close-btn">&times;</button>
            </div>

            <div class="modal-tabs">
                <button class="modal-tab active" data-tab="overview">Overview</button>
                <button class="modal-tab" data-tab="ra-tags">RA Tags</button>
                <button class="modal-tab" data-tab="execution-log">Execution Log</button>
                <button class="modal-tab" data-tab="system-prompt">System Prompt</button>
                <button class="modal-tab" data-tab="dependencies">Dependencies</button>
            </div>

            <div class="modal-content-area">
                <div id="overview-tab" class="tab-content active">
                    <div class="overview-sections">
                        <div class="overview-main">
                            <div id="taskDescription" class="task-description">
                                Loading task description...
                            </div>
                            <div id="taskMetrics" class="task-metrics">
                                <!-- Metrics will be populated here -->
                            </div>
                        </div>
                        <div class="overview-sidebar">
                            <div id="taskBreadcrumb" class="task-breadcrumb-full">
                                <!-- Breadcrumb will be populated here -->
                            </div>
                            <div id="taskTimestamps" class="task-timestamps">
                                <!-- Timestamps will be populated here -->
                            </div>
                            <div id="taskStatusInfo" class="task-status-info">
                                <!-- Status info will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div id="ra-tags-tab" class="tab-content">
                    <div class="ra-tags-header">
                        <input type="text" id="tagsSearchInput" class="tags-search-input" placeholder="Search RA tags...">
                        <div class="tags-category-filter">
                            <button class="category-filter-btn active" data-category="all">All</button>
                            <button class="category-filter-btn" data-category="impl">Implementation</button>
                            <button class="category-filter-btn" data-category="suggest">Suggestions</button>
                            <button class="category-filter-btn" data-category="pattern">Patterns</button>
                        </div>
                    </div>
                    <div id="raTagsContainer" class="ra-tags-container">
                        Loading RA tags...
                    </div>
                </div>

                <div id="execution-log-tab" class="tab-content">
                    <div class="log-header">
                        <div class="log-filters">
                            <select id="logTypeFilter" class="log-filter-select">
                                <option value="">All Types</option>
                                <option value="prompt">Prompts</option>
                                <option value="ra_tag">RA Tags</option>
                                <option value="status">Status</option>
                                <option value="update">Updates</option>
                            </select>
                        </div>
                        <button id="logRefreshBtn" class="log-refresh-btn">Refresh</button>
                    </div>
                    <div id="executionLogContainer" class="execution-log-container">
                        Loading execution logs...
                    </div>
                </div>

                <div id="system-prompt-tab" class="tab-content">
                    <div class="prompt-header">
                        <div class="prompt-version">System Prompt Snapshot</div>
                        <button id="promptCopyBtn" class="prompt-copy-btn">Copy</button>
                    </div>
                    <div class="system-prompt-container">
                        <pre id="systemPromptContent" class="system-prompt-content">Loading system prompt...</pre>
                    </div>
                </div>

                <div id="dependencies-tab" class="tab-content">
                    <div class="dependency-stats">
                        <div class="dependency-stat">
                            <div class="metric-label">Total Dependencies</div>
                            <div id="totalDepsCount" class="metric-value">0</div>
                        </div>
                        <div class="dependency-stat">
                            <div class="metric-label">Completed</div>
                            <div id="completedDepsCount" class="metric-value">0</div>
                        </div>
                        <div class="dependency-stat">
                            <div class="metric-label">Pending</div>
                            <div id="pendingDepsCount" class="metric-value">0</div>
                        </div>
                    </div>
                    <div id="dependenciesContainer" class="dependencies-container">
                        Loading dependencies...
                    </div>
                </div>
            </div>

            <div id="modalLoading" class="modal-loading" style="display: none;">
                <div class="spinner"></div>
                <div>Loading task details...</div>
            </div>
        </div>
    </div>

    <!-- Knowledge Management Modal -->
    <div id="knowledgeModal" class="knowledge-modal">
        <div class="knowledge-modal-content">
            <div class="modal-header">
                <div class="modal-header-left">
                    <h2 class="modal-title">Knowledge Management</h2>
                    <span class="context-indicator">Project Context</span>
                </div>
                <div class="modal-header-actions">
                    <button id="addKnowledgeBtn" class="action-btn add-btn">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
                        </svg>
                        Add Knowledge
                    </button>
                    <button id="saveKnowledgeBtn" class="action-btn save-btn" style="display: none;">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                        </svg>
                        Save
                    </button>
                    <button id="cancelKnowledgeBtn" class="action-btn cancel-btn" style="display: none;">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm3.5 6L12 10.5 8.5 8 7 9.5 10.5 13 7 16.5 8.5 18 12 14.5 15.5 18 17 16.5 13.5 13 17 9.5 15.5 8z"/>
                        </svg>
                        Cancel
                    </button>
                    <button id="knowledgeModalCloseBtn" class="modal-close-btn">&times;</button>
                </div>
            </div>
            <div class="knowledge-modal-body">
                <div class="knowledge-search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M21.71 20.29l-5.4-5.4a9 9 0 10-1.42 1.42l5.4 5.4a1 1 0 001.42-1.42zM11 18a7 7 0 117-7 7 7 0 01-7 7z"/>
                        </svg>
                        <input type="text" id="knowledgeSearchInput" class="search-input" placeholder="Search knowledge items...">
                        <button id="clearSearchBtn" class="clear-search-btn" style="display: none;">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M18.3 5.71a1 1 0 00-1.42 0L12 10.59 7.12 5.71a1 1 0 00-1.42 1.42L10.59 12l-4.89 4.87a1 1 0 001.42 1.42L12 13.41l4.88 4.88a1 1 0 001.42-1.42L13.41 12l4.89-4.87a1 1 0 000-1.42z"/>
                            </svg>
                        </button>
                    </div>
                    <select id="knowledgeCategoryFilter" class="category-filter">
                        <option value="">All Categories</option>
                        <option value="gotchas">Gotchas</option>
                        <option value="workarounds">Workarounds</option>
                        <option value="solutions">Solutions</option>
                        <option value="architecture">Architecture</option>
                        <option value="decisions">Decisions</option>
                    </select>
                </div>

                <div id="knowledgeEditForm" class="knowledge-edit-form" style="display: none;">
                    <div class="form-header">
                        <h3 id="formTitle">Add New Knowledge Item</h3>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="itemTitle">Title *</label>
                            <input type="text" id="itemTitle" class="form-input" required maxlength="200">
                            <span class="field-error" id="titleError"></span>
                        </div>
                        <div class="form-group">
                            <label for="itemCategory">Category *</label>
                            <select id="itemCategory" class="form-select" required>
                                <option value="">Select Category</option>
                                <option value="gotchas">Gotchas</option>
                                <option value="workarounds">Workarounds</option>
                                <option value="solutions">Solutions</option>
                                <option value="architecture">Architecture</option>
                                <option value="decisions">Decisions</option>
                                <option value="api">API Documentation</option>
                                <option value="troubleshooting">Troubleshooting</option>
                            </select>
                            <span class="field-error" id="categoryError"></span>
                        </div>
                        <div class="form-group full-width">
                            <label for="itemContent">Description/Content *</label>
                            <textarea id="itemContent" class="form-textarea" required rows="4" maxlength="2000" placeholder="Provide detailed description or content..."></textarea>
                            <div class="textarea-footer">
                                <span class="field-error" id="contentError"></span>
                                <span class="char-counter" id="contentCharCounter">0/2000</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="itemPriority">Priority</label>
                            <select id="itemPriority" class="form-select">
                                <option value="1">Low</option>
                                <option value="2" selected>Medium</option>
                                <option value="3">High</option>
                                <option value="4">Critical</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="tagInput">Tags</label>
                            <div class="tag-input-container">
                                <input type="text" id="tagInput" class="form-input" placeholder="Add tags...">
                                <button type="button" id="addTagBtn" class="add-tag-btn">Add</button>
                            </div>
                            <div id="tagsContainer" class="tags-container"></div>
                        </div>
                    </div>
                </div>

                <div id="knowledgeContent" class="knowledge-sections">
                    <!-- Knowledge items will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Assumption Insights Modal -->
    <div id="assumptionInsightsModal" class="assumption-insights-modal">
        <div class="assumption-insights-modal-content">
            <div class="assumption-modal-header">
                <div>
                    <h2 class="assumption-modal-title">Assumption Insights Dashboard</h2>
                    <div class="assumption-modal-subtitle">RA Tag Validation Analytics & Success Patterns</div>
                </div>
                <button id="assumptionModalCloseBtn" class="modal-close-btn">&times;</button>
            </div>
            <div class="assumption-modal-body">
                <div class="assumption-filters-section">
                    <div class="assumption-filter-group">
                        <label for="assumption-project-select" class="assumption-filter-label">Project</label>
                        <select id="assumption-project-select" class="assumption-filter-select">
                            <option value="">All Projects</option>
                        </select>
                    </div>
                    <div class="assumption-filter-group">
                        <label for="assumption-epic-select" class="assumption-filter-label">Epic</label>
                        <select id="assumption-epic-select" class="assumption-filter-select">
                            <option value="">All Epics</option>
                        </select>
                    </div>
                    <div class="assumption-filter-group">
                        <label for="assumption-tag-type-select" class="assumption-filter-label">Tag Type</label>
                        <select id="assumption-tag-type-select" class="assumption-filter-select">
                            <option value="">All Types</option>
                            <option value="COMPLETION_DRIVE_IMPL">Implementation</option>
                            <option value="SUGGEST_ERROR_HANDLING">Error Handling</option>
                            <option value="PATTERN_MOMENTUM">Patterns</option>
                            <option value="CONTEXT_DEGRADED">Context Issues</option>
                        </select>
                    </div>
                    <div class="assumption-filter-group">
                        <label for="assumption-outcome-select" class="assumption-filter-label">Outcome</label>
                        <select id="assumption-outcome-select" class="assumption-filter-select">
                            <option value="">All Outcomes</option>
                            <option value="validated">Validated</option>
                            <option value="rejected">Rejected</option>
                            <option value="partial">Partial</option>
                        </select>
                    </div>
                    <div class="assumption-filter-group">
                        <label class="assumption-filter-label">Date Range</label>
                        <div class="date-range-inputs">
                            <input type="date" id="assumption-start-date" class="date-input">
                            <input type="date" id="assumption-end-date" class="date-input">
                        </div>
                    </div>
                </div>
                <div class="assumption-kpi-cards">
                    <!-- KPI cards will be populated by JavaScript -->
                </div>
                <div class="assumption-data-section">
                    <!-- Data tables will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="modal-overlay" style="display: none;">
        <div class="delete-modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Confirm Delete</h3>
                <button class="modal-close-btn">
                    <svg width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="delete-modal-text">
                    <p id="deleteModalMessage" class="delete-message"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel">Cancel</button>
                <button id="confirmDeleteBtn" class="modal-btn modal-btn-danger">Delete</button>
            </div>
        </div>
    </div>

    <!-- Assumption Detail Drawer -->
    <div id="assumption-detail-drawer" class="assumption-detail-drawer">
        <div class="drawer-header">
            <h3 class="drawer-title" id="drawer-tag-title">Tag Details</h3>
            <p class="drawer-subtitle" id="drawer-tag-subtitle">Historical validation data</p>
            <button id="drawerCloseBtn" class="drawer-close-btn" aria-label="Close Detail Drawer">&times;</button>
        </div>
        <div class="drawer-body">
            <div class="drawer-section">
                <h4 class="drawer-section-title">Success Metrics</h4>
                <div id="drawer-metrics-content">
                    <!-- Dynamic metrics content -->
                </div>
            </div>

            <div class="drawer-section">
                <h4 class="drawer-section-title">Validation History</h4>
                <div id="drawer-history-content">
                    <!-- Dynamic validation history -->
                </div>
            </div>

            <div class="drawer-section">
                <h4 class="drawer-section-title">Common Reasons</h4>
                <div id="drawer-reasons-content">
                    <!-- Dynamic common validation reasons -->
                </div>
            </div>
        </div>
    </div>

    <!-- External JavaScript modules -->
    <script type="module" src="/static/js/app.js"></script>
</body>
</html>