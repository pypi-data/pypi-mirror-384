{% extends 'generic/object.html' %}
{% load helpers %}
{% load static %}

{% block style %}
<link href="{% static 'netbox_toolkit_plugin/css/toolkit.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
  <div class="row mb-3">
    <div class="col col-md-6">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Command Log</h3>
        </div>
        <div class="card-body">
          <table class="table table-hover attr-table">
            <tr>
              <th scope="row">Command</th>
              <td>{{ object.command|linkify }}</td>
            </tr>
            <tr>
              <th scope="row">Device</th>
              <td>{{ object.device|linkify }}</td>
            </tr>
            <tr>
              <th scope="row">Username</th>
              <td>{{ object.username }}</td>
            </tr>
            <tr>
              <th scope="row">Execution Time</th>
              <td>{{ object.execution_time }}</td>
            </tr>
            <tr>
              <th scope="row">Status</th>
              <td>
                {% if object.success %}
                  <span class="badge bg-success-lt text-success-lt-fg">Success</span>
                {% else %}
                  <span class="badge bg-danger">Failed</span>
                {% endif %}
              </td>
            </tr>
            {% if object.execution_duration %}
            <tr>
              <th scope="row">Duration</th>
              <td>{{ object.execution_duration|floatformat:3 }}s</td>
            </tr>
            {% endif %}
            {% comment %}
            <!-- Parsing status removed - focus on execution history -->
            {% if object.get_fresh_parsed_data %}
            <tr>
              <th scope="row">Parsing Status</th>
              <td>
                <span class="badge bg-success">
                  <i class="mdi mdi-check-circle me-1"></i>
                  Successfully Parsed
                </span>
                <br><small class="text-muted">Parsed from raw output</small>
              </td>
            </tr>
            {% endif %}
            {% endcomment %}
            {% if not object.success and object.error_message %}
            <tr>
              <th scope="row">Error</th>
              <td><code>{{ object.error_message }}</code></td>
            </tr>
            {% endif %}
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col col-md-12">
      <div class="card">
        <div class="card-header">
          <div class="d-flex justify-content-between align-items-start">
            <h3 class="card-title mb-0 mt-1 me-3">Command Output</h3>
            <div class="btn-list">
              <button type="button" class="btn btn-sm btn-outline-primary copy-output-btn"
                      title="Copy output to clipboard">
                <i class="mdi mdi-content-copy me-1"></i>Copy
              </button>
            </div>
          </div>
        </div>
        <div class="card-body">
          <pre class="command-output bg-surface p-3 rounded font-monospace">{{ object.output }}</pre>
        </div>
      </div>
    </div>
  </div>

{% endblock %}

{% block javascript %}
<!-- Load NetBox Toolkit consolidated JavaScript -->
<script src="{% static 'netbox_toolkit_plugin/js/toolkit.js' %}"></script>
{% endblock %}
