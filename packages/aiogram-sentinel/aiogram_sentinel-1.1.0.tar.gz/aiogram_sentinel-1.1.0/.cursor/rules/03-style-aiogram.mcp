---
description: aiogram v3 middleware/router style & constraints
globs: "src/aiogram_sentinel/middlewares/**/*.py, src/aiogram_sentinel/routers/**/*.py, src/aiogram_sentinel/sentinel.py"
alwaysApply: true
---

# aiogram Style

## Middlewares
- DebounceMiddleware: fingerprint(message.text|caption|callback.data or hashed fallback of Update); if seen() then set data["sentinel_debounced"]=True; return.
- ThrottlingMiddleware: resolve (max, per, scope) from decorator or cfg; if not allowed set data["sentinel_rate_limited"]=True; call on_rate_limited(event, data, retry_afterâ‰ˆ1.0); return.

## Setup
- Sentinel.setup wires middlewares in strict order on .message & .callback_query; returns (router, infra).

## Performance
- No sleeps; no network or DB in middlewares/router. Push to hooks.
