## Internationalization (I18n)

This library integrates with aiogram's `I18n` and follows its best practices:

- Resolve locale from middleware/context (`SimpleI18nMiddleware`)
- Use `gettext` for singular and `ngettext` for plurals
- Optional explicit `locale` override when building static resources (e.g., per-language command lists)

### Setup

```python
from aiogram import Dispatcher
from aiogram.utils.i18n import I18n, SimpleI18nMiddleware

i18n = I18n(path="locales", domain="messages", default_locale="en")
dp = Dispatcher()
dp.message.middleware(SimpleI18nMiddleware(i18n))
```

### Translator adapter

Use `build_translator_from_i18n(i18n)` to create a translator compatible with `aiogram_cmds`:

```python
from aiogram_cmds import build_translator_from_i18n

translator = build_translator_from_i18n(i18n)

# Singular
translator("cmd.start.desc", locale="en")

# Plural
translator("{n} file", plural="{n} files", count=3, locale="en")
```

The adapter uses `I18n.with_locale(locale)` when a locale is provided; otherwise it relies on the ambient middleware context.

### Using with command setup

```python
from aiogram_cmds import CommandScopeManager

manager = CommandScopeManager(bot, translator=translator)
await manager.setup_all()
```

### Babel workflow

Install Babel (via Poetry):

```bash
poetry add --group dev babel
```

Run scripts to extract/update/compile translations (see `tools/i18n/`):

```bash
pwsh tools/i18n/extract.ps1
pwsh tools/i18n/init.ps1 -Locale ru
pwsh tools/i18n/update.ps1
pwsh tools/i18n/compile.ps1
```

Place your sources under `locales/<lang>/LC_MESSAGES/messages.po` and compiled files in `messages.mo`.


