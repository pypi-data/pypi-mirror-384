{
  "name": "CLI output",
  "description": "Morphic Staging",
  "rules": [
    {
      "name": "lora flux style",
      "description": "LoRA training for flux style models",
      "priority": 90,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "lora",
          "description": null
        },
        {
          "field": "base_model_architecture",
          "operator": "equals",
          "value": "flux",
          "description": null
        },
        {
          "field": "model_type",
          "operator": "equals",
          "value": "style",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "lora-flux-style",
          "endpoint": "https://modal.com/apps/lora-flux-style",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "LoraRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "lora flux character",
      "description": "LoRA training for flux character models",
      "priority": 89,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "lora",
          "description": null
        },
        {
          "field": "base_model_architecture",
          "operator": "equals",
          "value": "flux",
          "description": null
        },
        {
          "field": "model_type",
          "operator": "equals",
          "value": "character",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "lora-flux-char",
          "endpoint": "https://modal.com/apps/lora-flux-char",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "LoraRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "img2vid_wan 480p",
      "description": "Image to video 480p resolution",
      "priority": 80,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "img2vid_wan",
          "description": null
        },
        {
          "field": "resolution",
          "operator": "equals",
          "value": "480p",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "img2vid-wan-480-dist",
          "endpoint": "https://modal.com/apps/img2vid-wan-480-dist",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "Img2VidRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "img2vid_wan 720p",
      "description": "Image to video 720p resolution",
      "priority": 79,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "img2vid_wan",
          "description": null
        },
        {
          "field": "resolution",
          "operator": "equals",
          "value": "720p",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "img2vid-wan-720-dist",
          "endpoint": "https://modal.com/apps/img2vid-wan-720-dist",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "Img2VidRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "image_superresolution clarity",
      "description": "Super resolution using clarity model",
      "priority": 70,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "image_superresolution",
          "description": null
        },
        {
          "field": "model",
          "operator": "equals",
          "value": "clarity",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "clarity",
          "endpoint": "https://modal.com/apps/clarity",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main_image",
          "request_class": "ImageSuperresolutionRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "image_superresolution custom",
      "description": "Super resolution using custom model",
      "priority": 69,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "image_superresolution",
          "description": null
        },
        {
          "field": "model",
          "operator": "equals",
          "value": "custom",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "super-resolution",
          "endpoint": "https://modal.com/apps/super-resolution",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main_image",
          "request_class": "ImageSuperresolutionRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "posenref2image",
      "description": "Pose and reference to image",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "posenref2image",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "posenref2image",
          "endpoint": "https://modal.com/apps/posenref2image",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "DiscordImgRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "subject2img",
      "description": "Subject to image conversion",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "subject2img",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "subject2image",
          "endpoint": "https://modal.com/apps/subject2image",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "DiscordImgRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "img2img_xl",
      "description": "Image to image XL processing",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "img2img_xl",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "sketch2image",
          "endpoint": "https://modal.com/apps/sketch2image",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "DiscordImgRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "img2img_sdxl",
      "description": "Image to image SDXL processing",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "img2img_sdxl",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "sdxl-control-plus",
          "endpoint": "https://modal.com/apps/sdxl-control-plus",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "DiscordImgRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "frame_interpolation",
      "description": "Frame interpolation processing",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "frame_interpolation",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "interpolation-wan-flf2v",
          "endpoint": "https://modal.com/apps/interpolation-wan-flf2v",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main_video",
          "request_class": "FrameInterpolationRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "inpainting_wan_dist_480p",
      "description": "Inpainting WAN 480p",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "inpainting_wan_dist_480p",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "inpainting-wan-480-dist",
          "endpoint": "https://modal.com/apps/inpainting-wan-480-dist",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "InpaintVideoRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "inpainting_wan_dist_720p",
      "description": "Inpainting WAN 720p",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "inpainting_wan_dist_720p",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "inpainting-wan-720-dist",
          "endpoint": "https://modal.com/apps/inpainting-wan-720-dist",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "InpaintVideoRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "layers_flux",
      "description": "Layers flux processing",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "layers_flux",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "layers-flux",
          "endpoint": "https://modal.com/apps/layers-flux",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main_image",
          "request_class": "LayersImageRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "autoseg",
      "description": "Automatic segmentation",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "autoseg",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "automatic-segmentation",
          "endpoint": "https://modal.com/apps/automatic-segmentation",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main_image",
          "request_class": "AutomaticSegmentationRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "img2vid_wan_480_dist",
      "description": "Image to video WAN 480p",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "img2vid_wan_480_dist",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "img2vid-wan-480-dist",
          "endpoint": "https://modal.com/apps/img2vid-wan-480-dist",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "Img2VidRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "img2vid_wan_720_dist",
      "description": "Image to video WAN 720p",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "img2vid_wan_720_dist",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "img2vid-wan-720-dist",
          "endpoint": "https://modal.com/apps/img2vid-wan-720-dist",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "Img2VidRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "video_superresolution",
      "description": "Video super resolution",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "video_superresolution",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "super-resolution",
          "endpoint": "https://modal.com/apps/super-resolution",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main_video",
          "request_class": "VideoSuperresolutionRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "real_esrgan_video",
      "description": "Real ESRGAN video processing",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "real_esrgan_video",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "super-resolution",
          "endpoint": "https://modal.com/apps/super-resolution",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main_video",
          "request_class": "VideoSuperresolutionRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "replace_object_flux",
      "description": "Replace object using flux",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "replace_object_flux",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "replace-object-flux",
          "endpoint": "https://modal.com/apps/replace-object-flux",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main_image",
          "request_class": "ReplaceObjectImageRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "rife_video",
      "description": "RIFE video processing",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "rife_video",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "rife-interpolation",
          "endpoint": "https://modal.com/apps/rife-interpolation",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main_video",
          "request_class": "RifeVideoRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "outpainting_flux",
      "description": "Outpainting using flux",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "outpainting_flux",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "outpainting-flux",
          "endpoint": "https://modal.com/apps/outpainting-flux",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main_image",
          "request_class": "OutpaintingImageRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "outpainting_wan_dist_720p",
      "description": "Outpainting WAN 720p",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "outpainting_wan_dist_720p",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "outpainting-wan-720-dist",
          "endpoint": "https://modal.com/apps/outpainting-wan-720-dist",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "OutpaintingVideoRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "img2pose",
      "description": "Image to pose conversion",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "img2pose",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "img2pose",
          "endpoint": "https://modal.com/apps/img2pose",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "Img2PoseRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "face_swap",
      "description": "Face swap processing",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "face_swap",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "face-swap",
          "endpoint": "https://modal.com/apps/face-swap",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "FaceSwapRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "uni3c",
      "description": "Uni3C video generation",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "uni3c",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "uni3c",
          "endpoint": "https://modal.com/apps/uni3c",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "generate_video",
          "request_class": "Uni3CRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "kontext",
      "description": "Kontext processing",
      "priority": 50,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "kontext",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "kontext",
          "endpoint": "https://modal.com/apps/kontext",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "KontextRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "img2img_flux fallback",
      "description": "Unconditional fallback for img2img_flux",
      "priority": 10,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "img2img_flux",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "flux",
          "endpoint": "https://modal.com/apps/flux",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "DiscordImgRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "lora fallback",
      "description": "Unconditional fallback for lora",
      "priority": 9,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "lora",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "lora",
          "endpoint": "https://modal.com/apps/lora",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "LoraRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "img2vid_wan fallback",
      "description": "Unconditional fallback for img2vid_wan",
      "priority": 8,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "img2vid_wan",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "img2vid-wan-480-dist",
          "endpoint": "https://modal.com/apps/img2vid-wan-480-dist",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "Img2VidRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "image_superresolution fallback",
      "description": "Unconditional fallback for image_superresolution",
      "priority": 7,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "image_superresolution",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "clarity",
          "endpoint": "https://modal.com/apps/clarity",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main_image",
          "request_class": "ImageSuperresolutionRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    },
    {
      "name": "img2img_flux with @ref prompt",
      "description": "Complex conditional routes first - highest priority",
      "priority": 1,
      "is_enabled": true,
      "conditions": [
        {
          "field": "request_type",
          "operator": "equals",
          "value": "img2img_flux",
          "description": null
        },
        {
          "field": "positive_prompt",
          "operator": "contains",
          "value": "@ref",
          "description": null
        }
      ],
      "strategy": "single",
      "targets": [
        {
          "provider": "modal",
          "model_name": "subject2image",
          "endpoint": "https://modal.com/apps/subject2image",
          "weight": 1.0,
          "label": null,
          "timeout_ms": null,
          "retry_count": null,
          "function_name": "main",
          "request_class": "DiscordImgRequest",
          "headers": null,
          "is_shadow": false
        }
      ]
    }
  ],
  "metadata": {}
}
