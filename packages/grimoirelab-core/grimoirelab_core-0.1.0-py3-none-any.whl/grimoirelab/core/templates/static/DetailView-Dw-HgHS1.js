import{_ as T,r as l,c as h,o as b,w as r,a,g as x,b as o,t as i,d as p,f as N,j as O,k as A,l as R,A as D,n as m,m as z}from"./index-B5gNOk1p.js";import{f as V}from"./dates-sb6Utn2R.js";import{S as B}from"./StatusCard-wjjLcoj-.js";import{S as I,u as M}from"./StatusIcon-CHehJsJv.js";import{u as P,C as j}from"./ConfirmModal-DmJufS9P.js";const U={name:"TaskCard",components:{StatusCard:B,StatusIcon:I},emits:["cancel","reschedule"],props:{age:{type:[Number,String],required:!1,default:0},backend:{type:String,required:!0},backendArgs:{type:Object,required:!1,default:()=>{}},category:{type:String,required:!0},status:{type:String,required:!0},executions:{type:[Number,String],required:!1,default:0},id:{type:[Number,String],required:!0},interval:{type:[Number,String],required:!0},scheduledDate:{type:String,required:!1,default:null},lastExecution:{type:String,required:!1,default:null},failures:{type:Number,required:!1,default:null}},computed:{formattedInterval(){switch(this.interval){case 86400:return"day";case 604800:return"week";default:return`${this.interval} seconds`}},lastRunDate(){return this.lastExecution?V(this.lastExecution):"-"},scheduledForDate(){return this.scheduledDate?V(this.scheduledDate):"-"}}},F={class:"font-weight-medium"},L={key:0},G={class:"pb-2 text-body-2"},H={class:"font-weight-medium"},J={class:"pb-2 text-body-2"},K={class:"font-weight-medium"},Q={key:0,class:"pb-2 text-body-2"},W={class:"font-weight-medium"};function X(S,n,s,g,w,f){const k=l("v-card-title"),d=l("v-icon"),t=l("v-card-subtitle"),_=l("status-icon"),y=l("v-col"),C=l("v-divider"),u=l("v-btn"),e=l("v-row"),q=l("status-card");return b(),h(q,{class:"pa-2 pb-4",status:s.status},{default:r(()=>[a(e,null,{default:r(()=>[a(y,{cols:"6"},{default:r(()=>[a(k,null,{default:r(()=>[o(" Task "+i(s.id),1)]),_:1}),a(t,{class:"pb-2"},{default:r(()=>{var v;return[a(d,{size:"small",start:""},{default:r(()=>[o(i("mdi-"+s.backend),1)]),_:1}),p("span",F,i(s.category),1),(v=s.backendArgs)!=null&&v.uri?(b(),N("span",L," from "+i(s.backendArgs.uri),1)):x("",!0)]}),_:1}),s.lastExecution?(b(),h(t,{key:0},{default:r(()=>[a(d,{"aria-label":s.status,color:s.status,role:"img","aria-hidden":"false",size:"small",start:""},{default:r(()=>[a(_,{status:s.status,size:"x-small"},null,8,["status"])]),_:1},8,["aria-label","color"]),o(" Last run "+i(f.lastRunDate),1)]),_:1})):x("",!0)]),_:1}),a(C,{class:"mt-2",vertical:""}),a(y,{cols:"5",class:"px-4 py-6 mt-2"},{default:r(()=>[p("p",G,[a(d,{color:"medium-emphasis",size:"small",start:""},{default:r(()=>n[2]||(n[2]=[o(" mdi-calendar ",-1)])),_:1,__:[2]}),n[3]||(n[3]=o(" Scheduled for ",-1)),p("span",H,i(f.scheduledForDate),1)]),p("p",J,[a(d,{color:"medium-emphasis",size:"small",start:""},{default:r(()=>n[4]||(n[4]=[o(" mdi-timelapse ",-1)])),_:1,__:[4]}),n[5]||(n[5]=o(" Every ",-1)),p("span",K,i(f.formattedInterval),1)]),s.failures?(b(),N("p",Q,[a(d,{color:"failed",size:"small",start:""},{default:r(()=>n[6]||(n[6]=[o(" mdi-alert-circle-outline ",-1)])),_:1,__:[6]}),p("span",W,i(s.failures),1),o(" failure"+i(s.failures>1?"s":""),1)])):x("",!0)]),_:1}),a(y,{class:"px-4 py-6 mt-1 d-flex flex-column align-end"},{default:r(()=>[a(u,{icon:"mdi-cancel",class:"mb-",color:"danger",variant:"text",size:"small",density:"comfortable",onClick:n[0]||(n[0]=v=>S.$emit("cancel",s.id))}),a(u,{icon:"mdi-refresh",variant:"text",size:"small",density:"comfortable",onClick:n[1]||(n[1]=v=>S.$emit("reschedule",s.id))})]),_:1})]),_:1})]),_:1},8,["status"])}const Y=T(U,[["render",X]]),se={__name:"DetailView",setup(S){const{closeModal:n,confirmCancel:s,modalProps:g}=P(),{openErrorSnackbar:w,openSnackbar:f,snackbarProps:k}=M(),d=R(),t=O({});async function _(u){const e=await D.scheduler.get(u);e.data&&(t.value=e.data)}async function y(u){n();try{await D.scheduler.cancel(u),f({color:"success",text:"Canceled task"}),_(u)}catch(e){w(e)}}async function C(u){try{await D.scheduler.reschedule(u),f({color:"success",text:"Rescheduled task"}),_(u)}catch(e){w(e)}}return A(()=>{_(d.params.id)}),(u,e)=>{const q=l("router-view"),v=l("v-snackbar"),E=l("v-container");return b(),h(E,null,{default:r(()=>[t.value.uuid?(b(),h(Y,{key:0,id:t.value.uuid,age:t.value.age,backend:t.value.datasource_type,"backend-args":t.value.backend_args,category:t.value.datasource_category,status:t.value.status,executions:t.value.runs,failures:t.value.failures,interval:t.value.job_interval,"last-execution":t.value.last_run,"max-retries":t.value.max_retries,"scheduled-date":t.value.scheduled_at,onCancel:e[0]||(e[0]=c=>m(s)(y,c)),onReschedule:e[1]||(e[1]=c=>C(c)),class:"mt-4"},null,8,["id","age","backend","backend-args","category","status","executions","failures","interval","last-execution","max-retries","scheduled-date"])):x("",!0),a(q,{task:t.value,"onUpdate:task":e[2]||(e[2]=c=>_(m(d).params.id))},null,8,["task"]),a(j,z({"is-open":m(g).isOpen,"onUpdate:isOpen":e[3]||(e[3]=c=>m(g).isOpen=c)},m(g)),null,16,["is-open"]),a(v,z({modelValue:m(k).isOpen,"onUpdate:modelValue":e[4]||(e[4]=c=>m(k).isOpen=c)},m(k)),null,16,["modelValue"])]),_:1})}}};export{se as default};
