import{_ as y,c as b,w as l,r as d,o,a as m,g as _,f as c,b as n,t as i,d as u,F as x,h as k,A as j}from"./index-B5gNOk1p.js";import{f as D,g as C}from"./dates-sb6Utn2R.js";import{S}from"./StatusCard-wjjLcoj-.js";const q={name:"JobCard",components:{StatusCard:S},props:{id:{type:String,required:!0},status:{type:String,required:!0},result:{type:Object,required:!1,default:()=>{}},startedAt:{type:String,required:!1,default:null},endedAt:{type:String,required:!1,default:null}},computed:{duration(){return C(this.startedAt,this.endedAt)}},methods:{formatDate(s){return D(s)}}},L={key:0,class:"px-4 pb-2 text-body-2"},B={key:1,class:"px-4 pb-2 text-body-2"},V={key:2,class:"px-4 pb-2 text-body-2"},z={class:"text-body-2 mb-2"},I={class:"font-weight-medium"},N={class:"text-body-2 mb-2"},T={class:"font-weight-medium"};function F(s,e,t,v,a,f){const r=d("v-chip"),g=d("v-card-title"),p=d("v-icon"),h=d("v-col"),J=d("v-divider"),w=d("v-row"),A=d("status-card");return o(),b(A,{status:t.status,class:"pa-2"},{default:l(()=>[m(w,null,{default:l(()=>[m(h,{cols:"6"},{default:l(()=>[m(g,{class:"text-subtitle-2 pb-1"},{default:l(()=>[n(" Job "+i(t.id)+" ",1),m(r,{color:t.status,class:"ml-2",density:"comfortable",size:"small"},{default:l(()=>[n(i(t.status),1)]),_:1},8,["color"])]),_:1}),t.endedAt?(o(),c("p",L,[m(p,{color:"medium-emphasis",size:"small",start:""},{default:l(()=>e[0]||(e[0]=[n(" mdi-calendar ",-1)])),_:1,__:[0]}),n(" "+i(f.formatDate(t.endedAt)),1)])):_("",!0),f.duration?(o(),c("p",B,[m(p,{color:"medium-emphasis",size:"small",start:""},{default:l(()=>e[1]||(e[1]=[n(" mdi-alarm ",-1)])),_:1,__:[1]}),n(" "+i(f.duration),1)])):t.status==="started"?(o(),c("p",V,[m(p,{color:"medium-emphasis",size:"small",start:""},{default:l(()=>e[2]||(e[2]=[n(" mdi-alarm ",-1)])),_:1,__:[2]}),e[3]||(e[3]=n(" In progress ",-1))])):_("",!0)]),_:1}),t.result?(o(),b(J,{key:0,class:"mt-2",vertical:""})):_("",!0),t.result?(o(),b(h,{key:1,cols:"6",class:"px-4 py-6"},{default:l(()=>[u("p",z,[e[4]||(e[4]=n(" Fetched ",-1)),u("span",I,i(t.result.fetched),1)]),u("p",N,[e[5]||(e[5]=n(" Skipped ",-1)),u("span",T,i(t.result.skipped),1)])]),_:1})):_("",!0)]),_:1})]),_:1},8,["status"])}const E=y(q,[["render",F]]),O={name:"LogContainer",props:{logs:{type:Array,required:!0},loading:{type:Boolean,required:!1,default:!1}},methods:{formattedDate(s){return D(s.created*1e3)}}},P={class:"log-container"},G={class:"log-line-number mr-2"},H={class:"log-line-text"},K={key:0,class:"loading-container"};function M(s,e,t,v,a,f){return o(),c("div",P,[u("code",null,[(o(!0),c(x,null,k(t.logs,(r,g)=>(o(),c("div",{key:r.created,class:"d-flex"},[u("div",G,i(g+1),1),u("div",H,"["+i(r.module)+"] "+i(r.msg),1)]))),128))]),t.loading?(o(),c("div",K,[(o(),c(x,null,k(3,r=>u("div",{class:"loading-dot",key:r})),64))])):_("",!0)])}const Q=y(O,[["render",M],["__scopeId","data-v-7b12ccd1"]]),R={components:{JobCard:E,LogContainer:Q},emits:["update:task"],data(){return{job:{},logs:[],pollID:null}},methods:{async fetchJob(s,e){const t=await j.scheduler.getJob(s,e);t.data&&(this.job=t.data)},async fetchJobLogs(s,e){const t=await j.scheduler.getJobLogs(s,e);t.data&&(this.logs=t.data.logs)},async pollJob(s,e){clearTimeout(this.pollID);try{await this.fetchJob(s,e),await this.fetchJobLogs(s,e)}catch(t){console.log(t)}finally{this.job.status==="running"?this.pollID=setTimeout(()=>this.pollJob(s,e),1e4):this.$emit("update:task")}}},mounted(){this.pollID=this.pollJob(this.$route.params.id,this.$route.params.jobid)},unmounted(){clearTimeout(this.pollID)}};function U(s,e,t,v,a,f){var p,h;const r=d("job-card"),g=d("log-container");return o(),c("div",null,[a.job.status?(o(),b(r,{key:0,id:this.$route.params.jobid,status:a.job.status,result:(p=a.job.progress)==null?void 0:p.summary,"started-at":a.job.scheduled_at,"ended-at":a.job.finished_at,class:"mt-4"},null,8,["id","status","result","started-at","ended-at"])):_("",!0),((h=a.logs)==null?void 0:h.length)>0?(o(),b(g,{key:1,logs:a.logs,loading:a.job.status==="running",class:"mt-4"},null,8,["logs","loading"])):_("",!0)])}const Z=y(R,[["render",U]]);export{Z as default};
