const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["static/GitHub-DxsIUOdi.js","static/index-B5gNOk1p.js","static/index-XP7xsndU.css","static/LoadSbom-CwyveTxV.js","static/datasources-B0x4KOZU.js"])))=>i.map(i=>d[i]);
import{_ as j,r as d,c as _,g as y,o as m,J as S,h as x,w as a,f as k,a as i,d as h,t as C,b as v,s as q,v as O,A as B,x as U}from"./index-B5gNOk1p.js";import{I as R}from"./IntervalSelector-DRcs0Vny.js";import{a as A}from"./datasources-B0x4KOZU.js";const f={issue:"has_issues",pull_request:"has_pull_requests"},E={name:"RepositoryTable",emits:["update:selected"],props:{repositories:{type:Array,required:!0},showFilters:{type:Boolean,required:!1,default:!1}},data(){return{isLoading:!1,items:[],headers:[{title:"Repository URL",value:"url"},{title:"Commits",value:"commit"},{title:"Issues",value:"issue"},{title:"Pull Requests",value:"pull_request"}],selectedColumns:{commit:!1,issue:!1,pull_request:!1},selected:[],filters:{archived:!0,fork:!0}}},computed:{selectedByCategory(){return this.selected.reduce((t,e)=>(Object.entries(e.form).forEach(l=>{const[u,s]=l;s&&t.push({category:u,datasource:e.datasource,url:u==="commit"?`${e.url}.git`:e.url})}),t),[])},indeterminate(){return{commit:this.areSomeSelected("commit"),issue:this.areSomeSelected("issue"),pull_request:this.areSomeSelected("pull_request")}}},methods:{applyFilters(t,e){this.selected=[];const l=Object.keys(e);return t.reduce((u,s)=>(l.every(c=>e[c]?!0:e[c]===s[c])&&u.push({...s,form:{commit:!1,pull_request:!1,issue:!1}}),u),[])},selectAll(t){this.items.forEach(e=>e.form[t]=this.selectedColumns[t]),this.$emit("update:selected",this.selectedByCategory)},areSomeSelected(t){return this.items.some(e=>e.form[t]===!0)&&!this.items.every(e=>e.form[t]===!0||f[t]&&!e[f[t]])},selectRow(t,e,l){const u=!e(t);Object.keys(t.value.form).forEach(s=>{(!f[s]||t.value[f[s]])&&(t.value.form[s]=u)}),l(t)},isRowIndeterminate(t,e){return e(t)&&Object.values(t.value.form).some(l=>l===!0)&&!Object.keys(t.value.form).every(l=>t.value.form[l]===!0||f[l]&&!t.value[f[l]])}},watch:{filters:{handler(t){this.items=this.applyFilters(this.repositories,t)},deep:!0},repositories(t){this.items=this.applyFilters(t,this.filters)}},mounted(){this.items=this.applyFilters(this.repositories,this.filters)}},I={class:"d-flex align-center justify-space-between pa-1"},T={key:0,class:"d-flex"},L={key:0,class:"d-flex align-center"},F={class:"ml-2"},P={key:1};function z(t,e,l,u,s,n){const c=d("v-switch"),p=d("v-checkbox-btn"),b=d("v-icon"),V=d("v-chip"),w=d("v-data-table-virtual");return s.items.length>0?(m(),_(w,{key:0,modelValue:s.selected,"onUpdate:modelValue":[e[5]||(e[5]=r=>s.selected=r),e[6]||(e[6]=r=>t.$emit("update:selected",n.selectedByCategory))],"fixed-header":!0,headers:s.headers,items:s.items,loading:s.isLoading,color:"primary","item-value":"url","return-object":"","show-select":""},S({top:a(()=>[h("div",I,[e[7]||(e[7]=h("p",{class:"text-subtitle-2 mb-4"},"Select the data you want to analyse",-1)),l.showFilters?(m(),k("div",T,[i(c,{modelValue:s.filters.archived,"onUpdate:modelValue":e[0]||(e[0]=r=>s.filters.archived=r),class:"mr-4",color:"primary",label:"Show archived repositories","hide-details":""},null,8,["modelValue"]),i(c,{modelValue:s.filters.fork,"onUpdate:modelValue":e[1]||(e[1]=r=>s.filters.fork=r),color:"primary",label:"Show forked repositories","hide-details":""},null,8,["modelValue"])])):y("",!0)])]),"item.data-table-select":a(({internalItem:r,isSelected:o,toggleSelect:g})=>[i(p,{"model-value":o(r),indeterminate:n.isRowIndeterminate(r,o),color:"primary","onUpdate:modelValue":J=>n.selectRow(r,o,g)},null,8,["model-value","indeterminate","onUpdate:modelValue"])]),"item.url":a(({item:r})=>[v(C(r.url)+" ",1),r.fork?(m(),_(V,{key:0,class:"ml-2",color:"primary",density:"comfortable",size:"small"},{default:a(()=>[i(b,{size:"small",start:""},{default:a(()=>e[8]||(e[8]=[v("mdi-source-fork",-1)])),_:1,__:[8]}),e[9]||(e[9]=v(" fork ",-1))]),_:1,__:[9]})):y("",!0),r.archived?(m(),_(V,{key:1,class:"ml-2",color:"warning",density:"comfortable",size:"small"},{default:a(()=>[i(b,{size:"small",start:""},{default:a(()=>e[10]||(e[10]=[v("mdi-archive-outline",-1)])),_:1,__:[10]}),e[11]||(e[11]=v(" archived ",-1))]),_:1,__:[11]})):y("",!0)]),"item.commit":a(({item:r})=>[i(p,{modelValue:r.form.commit,"onUpdate:modelValue":[o=>r.form.commit=o,e[2]||(e[2]=o=>t.$emit("update:selected",n.selectedByCategory))],color:"primary",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),"item.issue":a(({item:r})=>[i(p,{modelValue:r.form.issue,"onUpdate:modelValue":[o=>r.form.issue=o,e[3]||(e[3]=o=>t.$emit("update:selected",n.selectedByCategory))],disabled:!r.has_issues,color:"primary",density:"compact"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.pull_request":a(({item:r})=>[i(p,{modelValue:r.form.pull_request,"onUpdate:modelValue":[o=>r.form.pull_request=o,e[4]||(e[4]=o=>t.$emit("update:selected",n.selectedByCategory))],disabled:!r.has_pull_requests,color:"primary",density:"compact"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},[x(s.headers,r=>({name:`header.${r.value}`,fn:a(({column:o})=>[r.value!=="url"?(m(),k("div",L,[i(p,{modelValue:s.selectedColumns[o.value],"onUpdate:modelValue":g=>s.selectedColumns[o.value]=g,"true-value":!0,"false-value":!1,indeterminate:n.indeterminate[o.value],color:"primary",density:"compact",onChange:g=>n.selectAll(o.value)},null,8,["modelValue","onUpdate:modelValue","indeterminate","onChange"]),h("span",F,C(o.title),1)])):(m(),k("span",P,C(o.title),1))])}))]),1032,["modelValue","headers","items","loading"])):y("",!0)}const D=j(E,[["render",z],["__scopeId","data-v-0b900244"]]),N={components:{GitHubView:q(()=>U(()=>import("./GitHub-DxsIUOdi.js"),__vite__mapDeps([0,1,2]))),SBoMView:q(()=>U(()=>import("./LoadSbom-CwyveTxV.js"),__vite__mapDeps([3,4,1,2]))),IntervalSelector:R,RepositoryTable:D},data(){return{errorMessage:null,loading:!1,repos:[],form:{interval:"604800",selected:[]},alert:{isOpen:!1,text:"",color:"error",icon:"mdi-warning"}}},computed:{project(){var t;return(t=this.$route.query)==null?void 0:t.project},ecosystem(){var t;return(t=this.$route.query)==null?void 0:t.ecosystem},currentComponent(){var t,e;return((t=this.$route.query)==null?void 0:t.create)==="github"?"GitHubView":((e=this.$route.query)==null?void 0:e.create)==="sbom"?"SBoMView":null}},methods:{async createTasks(){if(this.form.selected.length===0){Object.assign(this.alert,{isOpen:!0,color:"error",text:"Select at least one URL and one category (commits, issues and/or pull requests) to retrieve.",icon:"mdi-alert-outline"});return}this.loading=!0,Promise.allSettled(this.form.selected.map(t=>{const{datasource_type:e,category:l,uri:u,backend_args:s}=A(t.datasource,t.category,t.url);return B.repository.create(this.ecosystem,this.project,{datasource_type:e,category:l,uri:u,backend_args:s,scheduler:{job_interval:this.form.interval,job_max_retries:3}})})).then(t=>{const e=t.filter(l=>l.status==="rejected").map(l=>l.reason.response.data&&typeof l.reason.response.data=="object"?Object.values(l.reason.response.data).toString():l.reason.message);e.length>0?Object.assign(this.alert,{isOpen:!0,color:"error",text:e,icon:"mdi-alert-outline"}):this.$router.push({name:"ecosystems",query:{ecosystem:this.ecosystem,project:this.project}})}).finally(()=>{this.loading=!1})}}},M={key:0},G={class:"mb-6"};function H(t,e,l,u,s,n){const c=d("router-view"),p=d("repository-table"),b=d("interval-selector"),V=d("v-alert"),w=d("v-btn"),r=d("v-container");return m(),_(r,null,{default:a(()=>[(m(),_(O(n.currentComponent),{"onUpdate:repos":e[0]||(e[0]=o=>s.repos=o)},null,32)),i(c,{"onUpdate:repos":e[1]||(e[1]=o=>s.repos=o)}),s.repos.length>0?(m(),k("div",M,[i(p,{repositories:s.repos,"onUpdate:selected":e[2]||(e[2]=o=>s.form.selected=o)},null,8,["repositories"]),e[6]||(e[6]=h("p",{class:"text-subtitle-2 mt-6 mb-4"},"Schedule",-1)),h("div",G,[i(b,{modelValue:s.form.interval,"onUpdate:modelValue":e[3]||(e[3]=o=>s.form.interval=o)},null,8,["modelValue"])]),i(V,{modelValue:s.alert.isOpen,"onUpdate:modelValue":e[4]||(e[4]=o=>s.alert.isOpen=o),text:s.alert.text,icon:s.alert.icon,color:s.alert.color,density:"compact",class:"mb-6"},null,8,["modelValue","text","icon","color"]),i(w,{loading:s.loading,color:"primary",onClick:n.createTasks},{default:a(()=>e[5]||(e[5]=[v(" Schedule selected ",-1)])),_:1,__:[5]},8,["loading","onClick"])])):y("",!0)]),_:1})}const X=j(N,[["render",H],["__scopeId","data-v-bdd1c1ab"]]);export{X as default};
