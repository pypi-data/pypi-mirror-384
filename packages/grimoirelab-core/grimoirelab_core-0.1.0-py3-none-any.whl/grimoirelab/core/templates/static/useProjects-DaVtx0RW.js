const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["static/TreeFolder-C_lIv3-h.js","static/index-B5gNOk1p.js","static/index-XP7xsndU.css","static/TreeFolder-CLM2Ge82.css"])))=>i.map(i=>d[i]);
import{_ as q,s as U,r as l,f as O,o as V,a as o,c as x,g as S,e as N,p as E,x as T,w as c,m as B,b as L,t as I,l as A,j as y,G as k,A as v}from"./index-B5gNOk1p.js";import{g as F}from"./datasources-B0x4KOZU.js";import{u as M}from"./loading-yltfngwl.js";const D={components:{"tree-folder":U(()=>T(()=>import("./TreeFolder-C_lIv3-h.js"),__vite__mapDeps([0,1,2,3])))},emits:["filters:update","page:update"],props:{projects:{type:Array,required:!0},fetchChildren:{type:Function,required:!0},isLoading:{type:Boolean,required:!1},page:{type:Number,required:!1,default:1},pages:{type:Number,required:!1,default:1}},data(){return{filters:{term:""}}},provide(){return{fetchChildren:this.fetchChildren}}},K={class:"tree-list"};function R(t,e,s,h,r,d){const f=l("v-text-field"),p=l("v-progress-linear"),i=l("tree-folder"),m=l("v-pagination");return V(),O("div",K,[o(f,{modelValue:r.filters.term,"onUpdate:modelValue":e[0]||(e[0]=u=>r.filters.term=u),"append-inner-icon":"mdi-magnify",color:"primary",density:"compact",placeholder:"Search",clearable:"","onClick:appendInner":e[1]||(e[1]=u=>t.$emit("filters:update",r.filters)),"onClick:clear":e[2]||(e[2]=u=>t.$emit("filters:update",{})),onKeyup:e[3]||(e[3]=N(u=>t.$emit("filters:update",r.filters),["enter"]))},null,8,["modelValue"]),s.isLoading?(V(),x(p,{key:0,color:"primary",indeterminate:""})):S("",!0),s.projects.length>0?(V(),O("div",{key:1,class:E({"pt-1":!s.isLoading})},[o(i,{projects:s.projects,class:"border"},null,8,["projects"]),o(m,{value:"page",length:s.pages,color:"primary",density:"comfortable","onUpdate:modelValue":e[4]||(e[4]=u=>t.$emit("page:update",u))},null,8,["length"])],2)):S("",!0)])}const Z=q(D,[["render",R],["__scopeId","data-v-5a916037"]]),z={name:"ProjectSelector",emits:["update:modelValue"],inject:["getProjects","ecosystem"],data(){return{inputValue:"",items:[],isLoading:!1,searchValue:null}},props:{label:{type:String,required:!1,default:"Project"},exclude:{type:Number,required:!1,default:null}},methods:{debounceSearch(t){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.getSelectorItems(t)},500)},async getSelectorItems(t){const e=t?{term:t}:{},s=await this.getProjects(this.ecosystem,e);s&&(this.items=s.data.results.filter(h=>h.id!==this.exclude),this.isLoading=!1)},filterItems(t){return t},search(t){this.searchValue=t,(!t||t.length>2&&t!==this.inputValue)&&(this.isLoading=!0,this.debounceSearch(t))}},watch:{inputValue(t){this.$emit("update:modelValue",t)}},mounted(){this.getSelectorItems(this.value)}};function G(t,e,s,h,r,d){const f=l("v-list-item"),p=l("v-autocomplete");return V(),x(p,{modelValue:r.inputValue,"onUpdate:modelValue":e[0]||(e[0]=i=>r.inputValue=i),items:r.items,label:s.label,loading:r.isLoading,filter:d.filterItems,"no-data-text":`No matches for "${r.searchValue}"`,"hide-no-data":r.isLoading,"item-title":"title",variant:"outlined",density:"comfortable",clearable:"","return-object":"","onUpdate:search":d.search},{selection:c(({item:i})=>[L(I(i.raw.title||i.raw.name),1)]),item:c(({props:i,item:m})=>[o(f,B(i,{title:m.raw.title||m.raw.name}),null,16,["title"])]),_:1},8,["modelValue","items","label","loading","filter","no-data-text","hide-no-data","onUpdate:search"])}const H=q(z,[["render",G]]),J={components:{ProjectSelector:H},emits:["update:isOpen","project:update","projects:update"],props:{isOpen:{type:Boolean,default:!1},createProject:{type:Function,required:!1,default:()=>{}},editProject:{type:Function,required:!1,default:()=>{}},edit:{type:Boolean,required:!1,default:!1},parent:{type:Object,required:!1,default:null},name:{type:String,required:!1,default:""},title:{type:String,required:!1,default:""},id:{type:Number,required:!1,default:null}},data(){return{form:{name:this.name,title:this.title},parent_project:this.parent,errors:{}}},methods:{generateSlug:F,onClick(){this.edit?this.onEdit():this.onCreate()},async onCreate(){var t;try{(await this.createProject(this.form.name,this.form.title,(t=this.parent_project)==null?void 0:t.id)).status===201&&(this.$emit("update:isOpen",!1),this.$emit("projects:update"))}catch(e){this.errors=e.response.data}},async onEdit(){var t;try{(await this.editProject(this.name,this.form.title,(t=this.parent_project)==null?void 0:t.id)).status===200&&(this.$emit("update:isOpen",!1),this.$emit("project:update"))}catch(e){this.errors=e.response.data||e}}},watch:{name(t){this.form.name=t},title(t){this.form.title=t},parent(t){this.parent_project=t}}};function Q(t,e,s,h,r,d){const f=l("v-card-title"),p=l("v-text-field"),i=l("v-col"),m=l("v-row"),u=l("project-selector"),P=l("v-card-text"),C=l("v-spacer"),b=l("v-btn"),w=l("v-card"),a=l("v-dialog");return V(),x(a,{"model-value":s.isOpen,"max-width":"500","onUpdate:modelValue":e[5]||(e[5]=n=>t.$emit("update:isOpen",n))},{default:c(()=>[o(w,{class:"pa-3"},{actions:c(()=>[o(C),o(b,{text:"Cancel",variant:"text",onClick:e[4]||(e[4]=n=>t.$emit("update:isOpen",!1))}),o(b,{color:"primary",text:"Save",variant:"flat",onClick:d.onClick},null,8,["onClick"])]),default:c(()=>[o(f,{class:"headline"},{default:c(()=>[L(I(s.edit?"Edit project":"Create project"),1)]),_:1}),o(P,null,{default:c(()=>[o(m,{dense:""},{default:c(()=>[o(i,null,{default:c(()=>[o(p,{modelValue:r.form.title,"onUpdate:modelValue":e[0]||(e[0]=n=>r.form.title=n),"error-messages":r.errors.title,color:"primary",label:"Project title",placeholder:"Project Title","hide-details":"","persistent-placeholder":"",required:"",onChange:e[1]||(e[1]=n=>d.generateSlug(r.form.title,t.$refs.slug))},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),o(m,null,{default:c(()=>[o(i,null,{default:c(()=>[o(p,{modelValue:r.form.name,"onUpdate:modelValue":e[2]||(e[2]=n=>r.form.name=n),"error-messages":r.errors.name,disabled:s.edit,color:"primary",label:"Project slug",placeholder:"project-name",hint:"Can contain alphanumeric characters or hyphens. It must start with a letter and cannot end with a hyphen.","persistent-hint":"","persistent-placeholder":"",required:"",ref:"slug"},null,8,["modelValue","error-messages","disabled"])]),_:1})]),_:1}),o(m,null,{default:c(()=>[o(i,null,{default:c(()=>[o(u,{modelValue:r.parent_project,"onUpdate:modelValue":e[3]||(e[3]=n=>r.parent_project=n),label:"Parent project (optional)","error-messages":r.errors.parent_project,exclude:s.edit?s.id:null},null,8,["modelValue","error-messages","exclude"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}const $=q(J,[["render",Q]]);function ee(){const{isLoading:t}=M(),e=A(),s=y([]),h=y(0),r=y(1),d=y({}),f=y({isOpen:!1,edit:!1,name:null,title:null,parentProject:null}),p=y({isOpen:!1,text:"",color:"error",icon:"mdi-warning"});function i(a){Object.assign(f.value,{isOpen:!0,edit:!0,name:a.name,title:a.title,parentProject:a.parent_project})}function m(a){Object.assign(f.value,{isOpen:!0,edit:!1,name:"",title:null,parentProject:a})}async function u(a,n,_=d){try{const g=Object.assign({page:n},_.value),j=await v.project.getChildren(e.query.ecosystem,a,g);j.data.results&&(s.value=j.data.results,h.value=j.data.total_pages,r.value=j.data.page,p.value.isOpen=!1)}catch(g){Object.assign(p.value,{isOpen:!0,text:g.toString()})}}function P(a,n){d.value=n,u(a,1,d)}async function C(a,n){return await v.project.getChildren(e.query.ecosystem,a,n)}async function b(a,n,_){return await v.project.create(e.query.ecosystem,{name:a,title:n,parent_project:_})}async function w(a,n,_){const g={title:n,parent_project:_};return await v.project.edit(e.query.ecosystem,a,g)}return k("getProjects",v.project.list),k("ecosystem",e.query.ecosystem),{isLoading:t,children:s,page:r,pages:h,filters:d,modal:f,alert:p,openCreateModal:m,openEditModal:i,fetchChildren:u,setFilters:P,fetchProjectChildren:C,createProject:b,editProject:w}}export{$ as P,Z as T,ee as u};
