import{_ as h,f as d,d as N,a,c as g,b as r,w as l,r as o,F as T,h as C,o as u,t as c,g as y,A as q}from"./index-B5gNOk1p.js";import{u as z}from"./loading-yltfngwl.js";import{g as B,f as A}from"./dates-sb6Utn2R.js";import{S as F}from"./StatusCard-wjjLcoj-.js";const P={name:"JobList",components:{StatusCard:F},emits:["update:filters"],props:{jobs:{type:Array,required:!0},count:{type:Number,required:!0},pages:{type:Number,required:!0},loading:{type:Boolean,required:!1,default:!1}},data(){return{page:1,tab:"all",tabs:[{text:"All",value:"all"},{text:"Failed",value:5},{text:"Completed",value:4},{text:"Canceled",value:7}]}},methods:{formatDate:A,getDuration:B},watch:{tab(){this.page=1}}},S={class:"text-h6 mb-4"},U={key:0,class:"d-flex justify-center pa-4"},j={key:0,class:"px-4 pt-2 text-body-2"},E={key:1,class:"px-4 py-2 text-body-2"},O={key:2,class:"px-4 py-2 text-body-2"};function G(n,t,s,b,i,m){const p=o("v-chip"),_=o("v-tab"),x=o("v-tabs"),k=o("v-progress-circular"),V=o("v-empty-state"),I=o("v-card-title"),J=o("v-card-subtitle"),v=o("v-col"),f=o("v-icon"),w=o("v-row"),D=o("status-card"),L=o("v-pagination");return u(),d("div",null,[N("h2",S,[t[4]||(t[4]=r(" Jobs ",-1)),a(p,{class:"ml-2",density:"comfortable"},{default:l(()=>[r(c(s.count),1)]),_:1})]),a(x,{modelValue:i.tab,"onUpdate:modelValue":[t[0]||(t[0]=e=>i.tab=e),t[1]||(t[1]=e=>n.$emit("update:filters",{status:e,page:1}))],items:i.tabs,"align-tabs":"left",class:"mb-4",color:"primary",height:"36","slider-color":"primary"},{tab:l(({item:e})=>[a(_,{text:e.text,value:e.value,class:"text-none text-subtitle-2"},null,8,["text","value"])]),_:1},8,["modelValue","items"]),s.loading?(u(),d("div",U,[a(k,{class:"mx-auto",color:"primary",indeterminate:""})])):!s.loading&&s.count===0?(u(),g(V,{key:1,icon:"mdi-magnify",title:"No results found",size:"52"})):(u(!0),d(T,{key:2},C(s.jobs,e=>(u(),g(D,{key:e.uuid,status:e.status,to:{name:"job",params:{jobid:e.uuid}},class:"mb-2"},{default:l(()=>[a(w,null,{default:l(()=>[a(v,null,{default:l(()=>[a(I,{class:"text-subtitle-2 pb-0"},{default:l(()=>[r(c(e.uuid)+" ",1),a(p,{color:e.status,class:"ml-3",density:"comfortable",size:"small"},{default:l(()=>[r(c(e.status),1)]),_:2},1032,["color"])]),_:2},1024),a(J,{class:"pb-2"},{default:l(()=>[r(" #"+c(e.job_num),1)]),_:2},1024)]),_:2},1024),a(v,{cols:"4"},{default:l(()=>[e.finished_at?(u(),d("p",j,[a(f,{color:"medium-emphasis",size:"small",start:""},{default:l(()=>t[5]||(t[5]=[r(" mdi-calendar ",-1)])),_:1,__:[5]}),r(" "+c(m.formatDate(e.finished_at)),1)])):y("",!0),e.finished_at?(u(),d("p",E,[a(f,{color:"medium-emphasis",size:"small",start:""},{default:l(()=>t[6]||(t[6]=[r(" mdi-alarm ",-1)])),_:1,__:[6]}),r(" "+c(m.getDuration(e.scheduled_at,e.finished_at)),1)])):e.status==="started"?(u(),d("p",O,[a(f,{color:"medium-emphasis",size:"small",start:""},{default:l(()=>t[7]||(t[7]=[r(" mdi-alarm ",-1)])),_:1,__:[7]}),t[8]||(t[8]=r(" In progress ",-1))])):y("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["status","to"]))),128)),a(L,{modelValue:i.page,"onUpdate:modelValue":[t[2]||(t[2]=e=>i.page=e),t[3]||(t[3]=e=>n.$emit("update:filters",{page:e,status:i.tab}))],length:s.pages,color:"primary",density:"comfortable"},null,8,["modelValue","length"])])}const H=h(P,[["render",G],["__scopeId","data-v-feac971e"]]),K={components:{JobList:H},props:{task:{type:Object,required:!1,default:()=>{}}},data(){return{jobs:[],pages:1,currentPage:1,count:0,pollID:null,interval:3e4,filters:{}}},computed:{taskId(){return this.$route.params.id}},methods:{async fetchTaskJobs(n=this.taskId,t={page:1}){t.status==="all"&&delete t.status;try{const s=await q.scheduler.getTaskJobs(n,t);s.data&&(this.jobs=s.data.results,this.count=s.data.count,this.pages=s.data.total_pages,this.currentPage=s.data.page,this.filters=t)}catch(s){console.log(s)}},async pollJobs(n){clearTimeout(this.pollID);try{await this.fetchTaskJobs(this.taskId,n)}catch(t){console.log(t)}finally{this.pollID=setTimeout(()=>this.pollJobs(n),this.interval)}}},mounted(){this.pollJobs()},unmounted(){clearTimeout(this.pollID)},setup(){const{isLoading:n}=z();return{isLoading:n}},watch:{task(n,t){t.status&&this.pollJobs(this.filters)}}};function M(n,t,s,b,i,m){const p=o("job-list");return u(),g(p,{jobs:i.jobs,count:i.count,loading:b.isLoading,pages:i.pages,class:"mt-4","onUpdate:filters":t[0]||(t[0]=_=>m.pollJobs(_))},null,8,["jobs","count","loading","pages"])}const Y=h(K,[["render",M]]);export{Y as default};
