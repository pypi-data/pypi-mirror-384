import{_ as U,r as l,c as b,g as y,o as m,w as o,d as i,a,b as _,t as u,f as B,F as I,h as N,m as F,A as d}from"./index-B5gNOk1p.js";import{f as L}from"./dates-sb6Utn2R.js";import{C as S,u as A}from"./ConfirmModal-DmJufS9P.js";const E={components:{ConfirmModal:S},computed:{project(){var t;return(t=this.$route.query)==null?void 0:t.project},uuid(){var t;return(t=this.$route.query)==null?void 0:t.repo},ecosystem(){var t;return(t=this.$route.query)==null?void 0:t.ecosystem}},data(){return{repo:null,categories:{git:{commit:{active:!1,name:"Commits"}},github:{pull_request:{active:!1,name:"Pull requests"},issue:{active:!1,name:"Issues"}}},snackbar:{open:!1,color:"success",text:""}}},methods:{async fetchRepo(){var t;try{const e=await d.repository.get(this.ecosystem,this.project,this.uuid);this.repo=e.data,e.data.categories.forEach(s=>{Object.assign(this.categories[this.repo.datasource_type][s.category],{active:s.task&&s.task.status!=="canceled",...s})})}catch(e){((t=e.response)==null?void 0:t.status)===404&&this.$router.push({name:"notFound"})}},toggleCategory(t,e){var s;e.active=t,t&&((s=e.task)==null?void 0:s.status)==="canceled"?this.rescheduleTask(e.task.uuid):t?this.createCategory(e):this.cancelTask(e.task.uuid)},async cancelTask(t){var e,s;try{await d.scheduler.cancel(t),this.fetchRepo()}catch(r){Object.assign(this.snackbar,{open:!0,color:"error",text:((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||r})}},async rescheduleTask(t){var e,s;try{await d.scheduler.reschedule(t),this.fetchRepo()}catch(r){Object.assign(this.snackbar,{open:!0,color:"error",text:((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||r})}},async createCategory(t){var e,s;try{const r={category:t,uri:this.repo.uri,datasource_type:this.repo.datasource_type};await d.repository.create(this.ecosystem,this.project,r)}catch(r){Object.assign(this.snackbar,{open:!0,color:"error",text:((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||r})}},async deleteRepo(){var t;try{await d.repository.delete(this.ecosystem,this.project,this.uuid),this.$router.replace({name:"ecosystems",query:{ecosystem:this.ecosystem,project:this.project}})}catch(e){const s=(t=e.response)!=null&&t.data.detail?e.response.data.detail:e.toString();Object.assign(alert.value,{isOpen:!0,text:s})}},formatDate:L},mounted(){this.fetchRepo()},setup(){const{modalProps:t,confirmDelete:e}=A();return{modalProps:t,confirmDelete:e}}},M={class:"d-flex align-center"},z={class:"text-subtitle-2"},J={class:"font-weight-regular"},G={class:"text-subtitle-2"},H={class:"font-weight-regular"},K={class:"text-subtitle-2"};function Q(t,e,s,r,c,f){const x=l("v-spacer"),w=l("v-btn"),h=l("v-list-item-title"),v=l("v-list-item"),j=l("v-divider"),k=l("v-list"),C=l("router-link"),V=l("v-chip"),D=l("v-list-item-subtitle"),O=l("v-switch"),R=l("v-list-item-action"),P=l("v-snackbar"),q=l("confirm-modal"),T=l("v-container");return c.repo?(m(),b(T,{key:0},{default:o(()=>[i("div",M,[e[4]||(e[4]=i("h1",{class:"text-h5 mt-4 mb-4"},"Repository",-1)),a(x),a(w,{variant:"outlined",class:"text-subtitle-2 border","prepend-icon":"mdi-delete",onClick:e[0]||(e[0]=n=>r.confirmDelete(f.deleteRepo,"repository"))},{default:o(()=>e[3]||(e[3]=[_(" Delete ",-1)])),_:1,__:[3]})]),e[7]||(e[7]=i("h2",{class:"text-h6 mb-4"},"Details",-1)),a(k,{class:"border rounded"},{default:o(()=>[a(v,null,{default:o(()=>[a(h,{class:"d-flex align-center"},{default:o(()=>[i("p",z,[e[5]||(e[5]=i("span",{class:"mr-2"},"URI:",-1)),i("span",J,u(c.repo.uri),1)])]),_:1})]),_:1}),a(j),a(v,null,{default:o(()=>[a(h,{class:"d-flex align-center"},{default:o(()=>[i("p",G,[e[6]||(e[6]=i("span",{class:"text-subtitle-2 mr-2"},"Source:",-1)),i("span",H,u(c.repo.datasource_type),1)])]),_:1})]),_:1})]),_:1}),e[8]||(e[8]=i("h2",{class:"text-h6 mb-4 mt-4"},"Data sources",-1)),a(k,{class:"border rounded"},{default:o(()=>[(m(!0),B(I,null,N(c.categories[c.repo.datasource_type],(n,g)=>(m(),b(v,{key:g},{append:o(()=>[a(R,{class:"flex-column align-end"},{default:o(()=>[a(O,{"model-value":n.active,color:"primary","hide-details":"",class:"mr-4","onUpdate:modelValue":p=>f.toggleCategory(p,n)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),default:o(()=>[a(h,{class:"d-flex align-center mb-1"},{default:o(()=>[i("span",K,u(n.name||g),1)]),_:2},1024),n.active&&n.task.last_run?(m(),b(D,{key:0,class:"d-flex align-center"},{default:o(()=>{var p;return[a(C,{to:{name:"taskJobs",params:{id:(p=n.task)==null?void 0:p.uuid}},class:"link--underlined d-flex font-weight-regular"},{default:o(()=>[_(" Last collection "+u(f.formatDate(n.task.last_run)),1)]),_:2},1032,["to"]),a(V,{color:n.task.status.toLowerCase(),class:"ml-4",density:"compact",size:"small"},{default:o(()=>[_(u(n.task.status),1)]),_:2},1032,["color"])]}),_:2},1024)):y("",!0)]),_:2},1024))),128))]),_:1}),a(P,{modelValue:c.snackbar.open,"onUpdate:modelValue":e[1]||(e[1]=n=>c.snackbar.open=n),color:c.snackbar.color},{default:o(()=>[_(u(c.snackbar.text),1)]),_:1},8,["modelValue","color"]),a(q,F({"is-open":r.modalProps.isOpen,"onUpdate:isOpen":e[2]||(e[2]=n=>r.modalProps.isOpen=n)},r.modalProps),null,16,["is-open"])]),_:1,__:[7,8]})):y("",!0)}const Z=U(E,[["render",Q],["__scopeId","data-v-7946862e"]]);export{Z as default};
