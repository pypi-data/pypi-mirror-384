import"../chunks/DsnmJJEf.js";import{i as $e}from"../chunks/BeOat8u8.js";import{Z as Be,n as pe,at as pt,a0 as Xe,U as _t,T as bt,a as t,b as Ze,W as yt,X as wt,Y as Ve,_ as Pe,a7 as Se,au as xt,av as Tt,a1 as ze,a4 as St,a2 as xe,aw as et,ax as kt,w as j,ay as Re,az as Ct,a5 as tt,a6 as Et,aA as qt,aB as Le,aC as at,aD as Dt,aE as $t,aF as It,aG as Ot,aH as Nt,aI as Mt,e as Bt,aJ as Pt,ap as Lt,u as R,a9 as Wt,aK as Ht,B as jt,y as st,E as Ie,F as Oe,as as nt,aL as ke,s as y,aM as rt,G as N,K as l,M as d,O as o,Q as ae,aN as A,I as E,J as Ne,aO as ot,R as G,ai as Ce,ah as be,aP as lt,aQ as Ke,ar as We}from"../chunks/DREhghgd.js";import{s as Ee,r as Ge}from"../chunks/CsceclWA.js";import{s as Te,a as Me}from"../chunks/BmRkfDt5.js";import{c as it,a as At,b as zt,d as Ut,s as Ft}from"../chunks/Cml8fQPH.js";import{i as z,b as ct}from"../chunks/Bs20YoNl.js";import{p as Jt}from"../chunks/N1MTTA_3.js";import{T as Vt}from"../chunks/BkoWMZpV.js";function Rt(a,n,e){for(var s=a.items,u=[],i=n.length,v=0;v<i;v++)Ot(n[v].e,u,!0);var g=i>0&&u.length===0&&e!==null;if(g){var h=e.parentNode;Nt(h),h.append(e),s.clear(),he(a,n[0].prev,n[i-1].next)}Mt(u,()=>{for(var c=0;c<i;c++){var D=n[c];g||(s.delete(D.k),he(a,D.prev,D.next)),at(D.e,!g)}})}function vt(a,n,e,s,u,i=null){var v=a,g={flags:n,items:new Map,first:null};{var h=a;v=pe?Be(pt(h)):h.appendChild(Xe())}pe&&_t();var c=null,D=!1,T=new Map,p=Ze(()=>{var b=e();return kt(b)?b:b==null?[]:et(b)}),w,_;function $(){Kt(_,w,g,T,v,u,n,s,e),i!==null&&(w.length===0?c?tt(c):c=ze(()=>i(v)):c!==null&&Et(c,()=>{c=null}))}bt(()=>{_??=Bt,w=t(p);var b=w.length;if(D&&b===0)return;D=b===0;let H=!1;if(pe){var U=yt(v)===wt;U!==(b===0)&&(v=Ve(),Be(v),Pe(!1),H=!0)}if(pe){for(var q=null,B,M=0;M<b;M++){if(Se.nodeType===xt&&Se.data===Tt){v=Se,H=!0,Pe(!1);break}var V=w[M],W=s(V,M);B=Ue(Se,g,q,null,V,W,M,u,n,e),g.items.set(W,B),q=B}b>0&&Be(Ve())}if(pe)b===0&&i&&(c=ze(()=>i(v)));else if(St()){var Q=new Set,J=xe;for(M=0;M<b;M+=1){V=w[M],W=s(V,M);var F=g.items.get(W)??T.get(W);F?dt(F,V,M):(B=Ue(null,g,null,null,V,W,M,u,n,e,!0),T.set(W,B)),Q.add(W)}for(const[X,Z]of g.items)Q.has(X)||J.skipped_effects.add(Z.e);J.add_callback($)}else $();H&&Pe(!0),t(p)}),pe&&(v=Se)}function Kt(a,n,e,s,u,i,v,g,h){var c=n.length,D=e.items,T=e.first,p=T,w,_=null,$=[],b=[],H,U,q,B;for(B=0;B<c;B+=1){if(H=n[B],U=g(H,B),q=D.get(U),q===void 0){var M=s.get(U);if(M!==void 0){s.delete(U),D.set(U,M);var V=_?_.next:p;he(e,_,M),he(e,M,V),He(M,V,u),_=M}else{var W=p?p.e.nodes_start:u;_=Ue(W,e,_,_===null?e.first:_.next,H,U,B,i,v,h)}D.set(U,_),$=[],b=[],p=_.next;continue}if(dt(q,H,B),(q.e.f&Le)!==0&&tt(q.e),q!==p){if(w!==void 0&&w.has(q)){if($.length<b.length){var Q=b[0],J;_=Q.prev;var F=$[0],X=$[$.length-1];for(J=0;J<$.length;J+=1)He($[J],Q,u);for(J=0;J<b.length;J+=1)w.delete(b[J]);he(e,F.prev,X.next),he(e,_,F),he(e,X,Q),p=Q,_=X,B-=1,$=[],b=[]}else w.delete(q),He(q,p,u),he(e,q.prev,q.next),he(e,q,_===null?e.first:_.next),he(e,_,q),_=q;continue}for($=[],b=[];p!==null&&p.k!==U;)(p.e.f&Le)===0&&(w??=new Set).add(p),b.push(p),p=p.next;if(p===null)continue;q=p}$.push(q),_=q,p=q.next}if(p!==null||w!==void 0){for(var Z=w===void 0?[]:et(w);p!==null;)(p.e.f&Le)===0&&Z.push(p),p=p.next;var oe=Z.length;if(oe>0){var ce=c===0?u:null;Rt(e,Z,ce)}}a.first=e.first&&e.first.e,a.last=_&&_.e;for(var se of s.values())at(se.e);s.clear()}function dt(a,n,e,s){Ct(a.v,n),a.i=e}function Ue(a,n,e,s,u,i,v,g,h,c,D){var T=(h&Dt)!==0,p=(h&$t)===0,w=T?p?j(u,!1,!1):Re(u):u,_=(h&qt)===0?v:Re(v),$={i:_,v:w,k:i,a:null,e:null,prev:e,next:s};try{if(a===null){var b=document.createDocumentFragment();b.append(a=Xe())}return $.e=ze(()=>g(a,w,_,c),pe),$.e.prev=e&&e.e,$.e.next=s&&s.e,e===null?D||(n.first=$):(e.next=$,e.e.next=$.e),s!==null&&(s.prev=$,s.e.prev=$.e),$}finally{}}function He(a,n,e){for(var s=a.next?a.next.e.nodes_start:e,u=n?n.e.nodes_start:e,i=a.e.nodes_start;i!==null&&i!==s;){var v=It(i);u.before(i),i=v}}function he(a,n,e){n===null?a.first=e:(n.next=e,n.e.next=e&&e.e),e!==null&&(e.prev=n,e.e.prev=n&&n.e)}const Ye=[...` 	
\r\fÂ \v\uFEFF`];function Gt(a,n,e){var s=a==null?"":""+a;if(n&&(s=s?s+" "+n:n),e){for(var u in e)if(e[u])s=s?s+" "+u:u;else if(s.length)for(var i=u.length,v=0;(v=s.indexOf(u,v))>=0;){var g=v+i;(v===0||Ye.includes(s[v-1]))&&(g===s.length||Ye.includes(s[g]))?s=(v===0?"":s.substring(0,v))+s.substring(g+1):v=g}}return s===""?null:s}function K(a,n,e,s,u,i){var v=a.__className;if(pe||v!==e||v===void 0){var g=Gt(e,s,i);(!pe||g!==a.getAttribute("class"))&&(g==null?a.removeAttribute("class"):a.className=g),a.__className=e}else if(i&&u!==i)for(var h in i){var c=!!i[h];(u==null||c!==!!u[h])&&a.classList.toggle(h,c)}return i}function qe(a,n,e=n){var s=new WeakSet;Pt(a,"input",async u=>{var i=u?a.defaultValue:a.value;if(i=je(a)?Ae(i):i,e(i),xe!==null&&s.add(xe),await Lt(),i!==(i=n())){var v=a.selectionStart,g=a.selectionEnd,h=a.value.length;if(a.value=i??"",g!==null){var c=a.value.length;v===g&&g===h&&c>h?(a.selectionStart=c,a.selectionEnd=c):(a.selectionStart=v,a.selectionEnd=Math.min(g,c))}}}),(pe&&a.defaultValue!==a.value||R(n)==null&&a.value)&&(e(je(a)?Ae(a.value):a.value),xe!==null&&s.add(xe)),Wt(()=>{var u=n();if(a===document.activeElement){var i=Ht??xe;if(s.has(i))return}je(a)&&u===Ae(a.value)||a.type==="date"&&!u&&!a.value||u!==a.value&&(a.value=u??"")})}function je(a){var n=a.type;return n==="number"||n==="range"}function Ae(a){return a===""?null:+a}const ut={connected:!1,bot_token:null,bot_username:null,chat_id:null,messages:[],unread_count:0},ie=jt(ut);let de=null;async function Yt(a,n){try{return(await(await fetch("/api/telegram/credentials",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bot_token:a,chat_id:n||null})})).json()).status==="ok"?(await De(),!0):!1}catch(e){return console.error("Error connecting to Telegram:",e),!1}}async function Qt(a){try{const e=await(await fetch("/api/telegram/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bot_token:a})})).json();return e.status==="ok"&&e.bot_info?e.bot_info:e.error?{error:e.error}:null}catch(n){return console.error("Error testing Telegram connection:",n),{error:"Network error - please check your connection"}}}function Xt(){de&&(de.close(),de=null),ie.set(ut)}async function Zt(a,n){const s=st(ie).chat_id;if(!s)return console.error("No chat ID available for sending message"),!1;try{if(de&&de.readyState===WebSocket.OPEN){de.send(JSON.stringify({type:"telegram_send",chat_id:s,message:a}));const v={chat_id:s,user_id:0,username:"bot",message:a,timestamp:Date.now()/1e3,direction:"outgoing"};return ie.update(g=>({...g,messages:[...g.messages,v]})),!0}return(await(await fetch("/api/telegram/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:s,message:a})})).json()).status==="ok"}catch(u){return console.error("Error sending Telegram message:",u),!1}}function Fe(){const a=st(ie);a.bot_username?window.open(`https://t.me/${a.bot_username}`,"_blank"):console.warn("Bot username not available")}async function ea(){const n=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/telegram`;de=new WebSocket(n),de.addEventListener("open",()=>{console.log("Telegram WebSocket connected")}),de.addEventListener("message",e=>{try{const s=JSON.parse(e.data);ta(s)}catch(s){console.error("Error parsing WebSocket message:",s)}}),de.addEventListener("close",()=>{console.log("Telegram WebSocket closed"),ie.update(e=>({...e,connected:!1}))}),de.addEventListener("error",e=>{console.error("Telegram WebSocket error:",e)})}function ta(a){switch(a.type){case"telegram_message":{const n={chat_id:a.chat_id,user_id:a.user_id,username:a.username,message:a.message,timestamp:a.timestamp,direction:"incoming"};ie.update(e=>({...e,messages:[...e.messages,n],unread_count:e.unread_count+1}));break}case"telegram_status":{const e=a.status==="connected";ie.update(s=>({...s,connected:e}));break}default:console.log("Unknown Telegram WebSocket message type:",a.type)}}function Qe(){ie.update(a=>({...a,unread_count:0}))}async function De(){try{const n=await(await fetch("/api/telegram/status")).json();console.log("[Telegram] Status check:",n),n.credentials_saved?n.connected&&n.bot_info?(console.log("[Telegram] Connected! Bot:",n.bot_info.username,n.from_keyring?"(from keyring)":""),ie.update(e=>({...e,connected:!0,bot_username:n.bot_info.username,chat_id:n.chat_id||e.chat_id,bot_token:"***"})),(!de||de.readyState!==WebSocket.OPEN)&&await ea()):(console.warn("[Telegram] Credentials saved but bot connection test failed"),ie.update(e=>({...e,connected:!0,bot_username:null,chat_id:n.chat_id||null,bot_token:"***"}))):(console.log("[Telegram] Not connected. Error:",n.error),ie.update(e=>({...e,connected:!1,bot_username:null,chat_id:n.chat_id||null})))}catch(a){console.error("Error fetching Telegram status:",a)}}var aa=N('<span class="unread-badge svelte-1qwqu3f"> </span>'),sa=N('<button class="btn-icon svelte-1qwqu3f" title="Open in Telegram" aria-label="Open in Telegram"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></button>'),na=N('<div class="empty-state svelte-1qwqu3f"><p class="empty-text svelte-1qwqu3f">Not connected to Telegram</p> <p class="empty-hint svelte-1qwqu3f">Configure your bot in Settings to get started</p></div>'),ra=N('<div class="empty-state svelte-1qwqu3f"><p class="empty-text svelte-1qwqu3f">No messages yet</p> <p class="empty-hint svelte-1qwqu3f">Send a message to start the conversation</p></div>'),oa=N('<div><div class="message-header svelte-1qwqu3f"><span class="message-username svelte-1qwqu3f"> </span> <span class="message-timestamp svelte-1qwqu3f"> </span></div> <div class="message-content svelte-1qwqu3f"> </div></div>'),la=N('<div class="messages-list svelte-1qwqu3f"></div>'),ia=N('<div class="input-container svelte-1qwqu3f"><textarea placeholder="Type a message..." rows="1" class="message-input svelte-1qwqu3f"></textarea> <button class="send-button svelte-1qwqu3f" title="Send message" aria-label="Send message"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button></div>'),ca=N('<div><div class="chat-header svelte-1qwqu3f"><div class="header-title svelte-1qwqu3f"><svg class="telegram-icon svelte-1qwqu3f" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.654-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"></path></svg> <span>Telegram</span> <!></div> <div class="header-actions svelte-1qwqu3f"><!></div></div> <div class="messages-container svelte-1qwqu3f"><!></div> <!></div>');function va(a,n){Ie(n,!1);const e=()=>Te(ie,"$telegramStore",s),[s,u]=Me(),i=j(),v=j();let g=Jt(n,"collapsed",8,!1),h=j(""),c=j(),D=j(!0);Oe(()=>{g()||Qe()}),nt(()=>{});function T(){t(c)&&requestAnimationFrame(()=>{ot(c,t(c).scrollTop=t(c).scrollHeight)})}function p(){if(!t(c))return;const{scrollTop:x,scrollHeight:I,clientHeight:L}=t(c);y(D,I-x-L<50),t(D)&&!g()&&Qe()}async function w(){const x=t(h).trim();if(!x)return;await Zt(x)?(y(h,""),T()):console.error("Failed to send Telegram message")}function _(x){x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),w())}function $(x){const I=new Date(x*1e3),L=new Date;return I.toDateString()===L.toDateString()?I.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):I.toLocaleDateString([],{month:"short",day:"numeric"})+" "+I.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function b(){!e().connected||!e().bot_username||Fe()}ke(()=>e(),()=>{y(i,e().messages.length>0)}),ke(()=>e(),()=>{y(v,e().unread_count>0)}),ke(()=>(e(),t(c),t(D)),()=>{e().messages&&t(c)&&t(D)&&T()}),rt(),$e();var H=ca();let U;var q=l(H),B=l(q),M=d(l(B),4);{var V=x=>{var I=aa(),L=l(I,!0);o(I),ae(()=>G(L,(e(),R(()=>e().unread_count)))),E(x,I)};z(M,x=>{t(v)&&x(V)})}o(B);var W=d(B,2),Q=l(W);{var J=x=>{var I=sa();A("click",I,b),E(x,I)};z(Q,x=>{e(),R(()=>e().connected&&e().bot_username)&&x(J)})}o(W),o(q);var F=d(q,2),X=l(F);{var Z=x=>{var I=na();E(x,I)},oe=x=>{var I=Ce(),L=be(I);{var le=ee=>{var ue=ra();E(ee,ue)},ge=ee=>{var ue=la();vt(ue,5,()=>(e(),R(()=>e().messages)),me=>me.timestamp+me.direction,(me,Y)=>{var ne=oa();let _e;var f=l(ne),k=l(f),P=l(k,!0);o(k);var O=d(k,2),r=l(O,!0);o(O),o(f);var m=d(f,2),C=l(m,!0);o(m),o(ne),ae((S,te)=>{_e=K(ne,1,"message svelte-1qwqu3f",null,_e,S),G(P,(t(Y),R(()=>t(Y).username))),G(r,te),G(C,(t(Y),R(()=>t(Y).message)))},[()=>({incoming:t(Y).direction==="incoming",outgoing:t(Y).direction==="outgoing"}),()=>(t(Y),R(()=>$(t(Y).timestamp)))]),E(me,ne)}),o(ue),E(ee,ue)};z(L,ee=>{t(i)?ee(ge,!1):ee(le)},!0)}E(x,I)};z(X,x=>{e(),R(()=>!e().connected)?x(Z):x(oe,!1)})}o(F),ct(F,x=>y(c,x),()=>t(c));var ce=d(F,2);{var se=x=>{var I=ia(),L=l(I);lt(L);var le=d(L,2);o(I),ae(ge=>{L.disabled=(e(),R(()=>!e().connected)),le.disabled=ge},[()=>(t(h),e(),R(()=>!t(h).trim()||!e().connected))]),qe(L,()=>t(h),ge=>y(h,ge)),A("keypress",L,_),A("click",le,w),E(x,I)};z(ce,x=>{e(),R(()=>e().connected)&&x(se)})}o(H),ae(x=>U=K(H,1,"telegram-chat svelte-1qwqu3f",null,U,x),[()=>({collapsed:g()})]),A("scroll",F,p),E(a,H),Ne(),u()}var da=N('<span class="badge svelte-191yngm"> </span>'),ua=N('<button aria-label="Toggle Telegram panel"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="svelte-191yngm"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.654-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z" class="svelte-191yngm"></path></svg> <!></button> <button class="btn-secondary svelte-191yngm" data-testid="telegram-launch-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-191yngm"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" class="svelte-191yngm"></path><polyline points="15 3 21 3 21 9" class="svelte-191yngm"></polyline><line x1="10" y1="14" x2="21" y2="3" class="svelte-191yngm"></line></svg> Launch in Telegram</button>',1),ga=N('<div class="empty-state svelte-191yngm"><svg class="empty-icon svelte-191yngm" xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" class="svelte-191yngm"></path></svg> <p class="empty-text svelte-191yngm">Start a conversation with Claude Code</p> <p class="empty-hint svelte-191yngm">Type a message below to begin</p></div>'),fa=N('<div><div class="message-header svelte-191yngm"><span class="message-role svelte-191yngm"> </span> <span class="message-timestamp svelte-191yngm"> </span></div> <div class="message-content svelte-191yngm"> </div></div>'),ma=N('<div class="messages-list svelte-191yngm"></div>'),ha=N('<div class="loading-indicator svelte-191yngm"><div class="loading-dot svelte-191yngm"></div> <div class="loading-dot svelte-191yngm"></div> <div class="loading-dot svelte-191yngm"></div></div>'),pa=N('<div class="telegram-panel svelte-191yngm"><!></div>'),_a=N('<div class="config-popup svelte-191yngm" data-testid="telegram-config-popup">Enter a bot token in Settings to enable Telegram</div>'),ba=N('<div class="chat-layout svelte-191yngm"><div><div class="chat-header svelte-191yngm"><div class="header-left svelte-191yngm"><h2 class="svelte-191yngm">Chat with Claude Code</h2></div> <div class="header-right svelte-191yngm"><!> <button class="btn-secondary svelte-191yngm" title="Clear chat history">Clear</button></div></div> <div class="messages-container svelte-191yngm"><!> <!></div> <div class="input-container svelte-191yngm"><textarea placeholder="Type your message to Claude Code..." rows="1" class="message-input svelte-191yngm"></textarea> <button class="send-button svelte-191yngm" title="Send message" aria-label="Send message"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-191yngm"><line x1="22" y1="2" x2="11" y2="13" class="svelte-191yngm"></line><polygon points="22 2 15 22 11 13 2 9 22 2" class="svelte-191yngm"></polygon></svg></button></div></div> <!> <!></div>');function ya(a,n){Ie(n,!1);const e=()=>Te(it,"$currentProject",u),s=()=>Te(ie,"$telegramStore",u),[u,i]=Me(),v=j(),g=j();let h=j([]),c=j(""),D=j(!1),T=j(!1),p=j(!1),w=j(),_=null;Oe(async()=>{await De(),$(),V()}),nt(()=>{_&&_.close()});function $(){const m=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;_=new WebSocket(m),_.addEventListener("open",()=>{console.log("Chat WebSocket connected")}),_.addEventListener("message",C=>{try{const S=JSON.parse(C.data);b(S)}catch(S){console.error("Error parsing WebSocket message:",S)}}),_.addEventListener("close",()=>{console.log("Chat WebSocket closed"),setTimeout(()=>{(!_||_.readyState===WebSocket.CLOSED)&&$()},3e3)}),_.addEventListener("error",C=>{console.error("Chat WebSocket error:",C)})}function b(r){if(r.type==="message"||r.content){const m={id:crypto.randomUUID(),role:r.role||"assistant",content:r.content||"",timestamp:Date.now()};y(h,[...t(h),m]),W(),q()}}async function H(){if(!t(g))return;const r=t(c).trim();y(c,"");const m={id:crypto.randomUUID(),role:"user",content:r,timestamp:Date.now()};y(h,[...t(h),m]),W(),q(),y(D,!0);try{if(_&&_.readyState===WebSocket.OPEN)_.send(JSON.stringify({type:"chat",message:r,project_path:e()||process.cwd()}));else{const C=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:r,project_path:e()||process.cwd()})});if(!C.ok)throw new Error("Failed to send message");const S=await C.json();if(S.response){const te={id:crypto.randomUUID(),role:"assistant",content:S.response,timestamp:Date.now()};y(h,[...t(h),te]),W(),q()}}}catch(C){console.error("Error sending message:",C);const S={id:crypto.randomUUID(),role:"system",content:"Error: Failed to send message. Please try again.",timestamp:Date.now()};y(h,[...t(h),S]),W()}finally{y(D,!1)}}function U(r){r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),H())}function q(){t(w)&&requestAnimationFrame(()=>{ot(w,t(w).scrollTop=t(w).scrollHeight)})}function B(){y(T,!t(T))}function M(){if(!s().connected||!s().bot_username){y(p,!0),setTimeout(()=>{y(p,!1)},3e3);return}Fe()}function V(){try{const r=localStorage.getItem("chat_history");r&&y(h,JSON.parse(r))}catch(r){console.error("Error loading chat history:",r)}}function W(){try{localStorage.setItem("chat_history",JSON.stringify(t(h)))}catch(r){console.error("Error saving chat history:",r)}}function Q(){y(h,[]),W()}function J(r){return new Date(r).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}ke(()=>t(h),()=>{y(v,t(h).length>0)}),ke(()=>(t(c),t(D)),()=>{y(g,t(c).trim().length>0&&!t(D))}),rt(),$e();var F=ba(),X=l(F);let Z;var oe=l(X),ce=d(l(oe),2),se=l(ce);{var x=r=>{var m=ua(),C=be(m);let S;var te=d(l(C),2);{var fe=ve=>{var ye=da(),we=l(ye,!0);o(ye),ae(()=>G(we,(s(),R(()=>s().unread_count)))),E(ve,ye)};z(te,ve=>{s(),R(()=>s().unread_count>0)&&ve(fe)})}o(C);var re=d(C,2);ae(ve=>{S=K(C,1,"btn-icon svelte-191yngm",null,S,ve),Ee(C,"title",t(T)?"Hide Telegram":"Show Telegram"),re.disabled=(s(),R(()=>!s().connected||!s().bot_username)),Ee(re,"title",(s(),R(()=>s().bot_username?`Launch @${s().bot_username} in Telegram`:"Configure Telegram in Settings")))},[()=>({active:t(T)})]),A("click",C,B),A("click",re,M),E(r,m)};z(se,r=>{s(),R(()=>s().connected)&&r(x)})}var I=d(se,2);o(ce),o(oe);var L=d(oe,2),le=l(L);{var ge=r=>{var m=ga();E(r,m)},ee=r=>{var m=ma();vt(m,5,()=>t(h),C=>C.id,(C,S)=>{var te=fa();let fe;var re=l(te),ve=l(re),ye=l(ve,!0);o(ve);var we=d(ve,2),gt=l(we,!0);o(we),o(re);var Je=d(re,2),ft=l(Je,!0);o(Je),o(te),ae((mt,ht)=>{fe=K(te,1,"message svelte-191yngm",null,fe,mt),G(ye,(t(S),R(()=>t(S).role==="user"?"You":t(S).role==="assistant"?"Claude":"System"))),G(gt,ht),G(ft,(t(S),R(()=>t(S).content)))},[()=>({user:t(S).role==="user",assistant:t(S).role==="assistant",system:t(S).role==="system"}),()=>(t(S),R(()=>J(t(S).timestamp)))]),E(C,te)}),o(m),E(r,m)};z(le,r=>{t(v)?r(ee,!1):r(ge)})}var ue=d(le,2);{var me=r=>{var m=ha();E(r,m)};z(ue,r=>{t(D)&&r(me)})}o(L),ct(L,r=>y(w,r),()=>t(w));var Y=d(L,2),ne=l(Y);lt(ne);var _e=d(ne,2);o(Y),o(X);var f=d(X,2);{var k=r=>{var m=pa(),C=l(m);{let S=Ze(()=>!t(T));va(C,{get collapsed(){return t(S)}})}o(m),E(r,m)};z(f,r=>{t(T)&&r(k)})}var P=d(f,2);{var O=r=>{var m=_a();E(r,m)};z(P,r=>{t(p)&&r(O)})}o(F),ae(r=>{Z=K(X,1,"main-chat-panel svelte-191yngm",null,Z,r),I.disabled=!t(v),ne.disabled=t(D),_e.disabled=!t(g)},[()=>({"with-telegram":t(T)})]),A("click",I,Q),qe(ne,()=>t(c),r=>y(c,r)),A("keypress",ne,U),A("click",_e,H),E(a,F),Ne(),i()}var wa=N('<div class="diff-container svelte-n31mvn"><div class="diff-header svelte-n31mvn"><h2 class="svelte-n31mvn">Diff Viewer</h2></div> <div class="diff-content svelte-n31mvn"><p class="placeholder-text svelte-n31mvn">Diff viewer coming soon...</p></div></div>');function xa(a){var n=wa();E(a,n)}var Ta=N('<div class="history-container svelte-1t4jzn8"><div class="history-header svelte-1t4jzn8"><h2 class="svelte-1t4jzn8">Conversation History</h2></div> <div class="history-content svelte-1t4jzn8"><p class="placeholder-text svelte-1t4jzn8">History viewer coming soon...</p></div></div>');function Sa(a){var n=Ta();E(a,n)}var ka=N(`<div class="bot-info svelte-x4gxra"><span class="bot-username svelte-x4gxra"> </span> <button class="open-telegram-btn svelte-x4gxra" title="Open in Telegram"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="svelte-x4gxra"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97
							9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002
							0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.654-.64.135-.954l11.566-4.458c.538-.196
							1.006.128.832.941z"></path></svg> Open in Telegram</button></div>`),Ca=N('<div class="bot-info svelte-x4gxra"><span class="status-note svelte-x4gxra">Bot not verified - click Test Connection to verify</span></div>'),Ea=N('<div data-testid="telegram-status"> </div>'),qa=N('<div class="test-result svelte-x4gxra"><h4 class="svelte-x4gxra">Bot Information:</h4> <ul class="svelte-x4gxra"><li class="svelte-x4gxra"><strong>Username:</strong> </li> <li class="svelte-x4gxra"><strong>Name:</strong> </li> <li class="svelte-x4gxra"><strong>ID:</strong> </li> <li class="svelte-x4gxra"><strong>Link:</strong> <a target="_blank" class="svelte-x4gxra"> </a></li></ul></div>'),Da=N('<button class="btn btn-primary svelte-x4gxra" data-testid="telegram-test-button"> </button> <button class="btn btn-success svelte-x4gxra" data-testid="telegram-save-button"> </button>',1),$a=N('<button class="btn btn-primary svelte-x4gxra" data-testid="telegram-test-button"> </button> <button class="btn btn-danger svelte-x4gxra" data-testid="telegram-disconnect-button">Disconnect</button>',1),Ia=N('<button class="btn btn-danger svelte-x4gxra" data-testid="telegram-disconnect-button">Disconnect</button>'),Oa=N('<div class="config-popup svelte-x4gxra" data-testid="telegram-config-popup">Enter a bot token in the configuration</div>'),Na=N(`<div class="telegram-settings svelte-x4gxra"><div class="settings-header svelte-x4gxra"><h2 class="svelte-x4gxra">Telegram Integration</h2> <p class="description svelte-x4gxra">Connect your Telegram bot to receive real-time notifications and interact with Claude Code
			from Telegram.</p></div> <div class="status-section svelte-x4gxra"><div><span class="status-dot svelte-x4gxra"></span> <span class="status-text svelte-x4gxra"><!></span></div> <!></div> <div class="config-section svelte-x4gxra"><h3 class="svelte-x4gxra">Configuration</h3> <div class="instructions svelte-x4gxra"><p class="svelte-x4gxra"><strong>Setup Instructions:</strong></p> <ol class="svelte-x4gxra"><li class="svelte-x4gxra">Open Telegram and search for <a href="https://t.me/BotFather" target="_blank" class="svelte-x4gxra">@BotFather</a></li> <li class="svelte-x4gxra">Send <code class="svelte-x4gxra">/newbot</code> command and follow the prompts</li> <li class="svelte-x4gxra">Copy your bot token (looks like: <code class="svelte-x4gxra">123456:ABC-DEF1234...</code>)</li> <li class="svelte-x4gxra">Paste the token below and click "Save Credentials"</li> <li class="svelte-x4gxra">Open your bot in Telegram and send a message to activate it</li></ol></div> <div class="form-group svelte-x4gxra"><label for="bot-token" class="svelte-x4gxra">Bot Token</label> <input id="bot-token" type="password" placeholder="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11" class="token-input svelte-x4gxra"/> <span class="help-text svelte-x4gxra">Your Telegram bot token from @BotFather</span></div> <div class="form-group svelte-x4gxra"><label for="chat-id" class="svelte-x4gxra">Chat ID (Optional)</label> <input id="chat-id" type="text" placeholder="Auto-detected when you message the bot" class="chat-id-input svelte-x4gxra"/> <span class="help-text svelte-x4gxra">Leave empty for auto-detection</span></div> <!> <!> <div class="button-group svelte-x4gxra"><!></div></div> <!></div>`);function Ma(a,n){Ie(n,!1);const e=()=>Te(ie,"$telegramStore",s),[s,u]=Me();let i=j(""),v=j(""),g=j(""),h=j("info"),c=j(!1),D=j(!1),T=j(null);Oe(async()=>{await De()});async function p(){if(!t(i).trim()){b("Please enter a bot token","error");return}y(c,!0),b("Saving credentials...","info"),await Yt(t(i),t(v).trim()||void 0)?(b("Credentials saved successfully","success"),y(i,"")):b("Failed to save credentials","error"),y(c,!1)}async function w(){if(!t(i).trim()){b("Please enter a bot token","error");return}y(c,!0),b("Testing connection...","info"),y(T,await Qt(t(i))),t(T)?"error"in t(T)?(b(t(T).error,"error"),y(T,null)):(b(`Connection successful! Bot: @${t(T).username} (${t(T).first_name})`,"success"),await De()):(b("Connection failed. Please check your bot token.","error"),y(T,null)),y(c,!1)}function _(){Xt(),y(i,""),y(v,""),y(T,null),b("Disconnected from Telegram","info")}function $(){if(!e().connected||!e().bot_username){y(D,!0),window.setTimeout(()=>{y(D,!1)},3e3);return}Fe()}function b(f,k){y(g,f),y(h,k)}$e();var H=Na(),U=d(l(H),2),q=l(U);let B;var M=d(l(q),2),V=l(M);{var W=f=>{var k=We("Connected");E(f,k)},Q=f=>{var k=Ce(),P=be(k);{var O=m=>{var C=We("Credentials Configured");E(m,C)},r=m=>{var C=We("Disconnected");E(m,C)};z(P,m=>{e().connected?m(O):m(r,!1)},!0)}E(f,k)};z(V,f=>{e().connected&&e().bot_username?f(W):f(Q,!1)})}o(M),o(q);var J=d(q,2);{var F=f=>{var k=ka(),P=l(k),O=l(P);o(P);var r=d(P,2);o(k),ae(()=>G(O,`@${e().bot_username??""}`)),A("click",r,$),E(f,k)},X=f=>{var k=Ce(),P=be(k);{var O=r=>{var m=Ca();E(r,m)};z(P,r=>{e().connected&&r(O)},!0)}E(f,k)};z(J,f=>{e().connected&&e().bot_username?f(F):f(X,!1)})}o(U);var Z=d(U,2),oe=d(l(Z),4),ce=d(l(oe),2);Ge(ce),Ke(2),o(oe);var se=d(oe,2),x=d(l(se),2);Ge(x),Ke(2),o(se);var I=d(se,2);{var L=f=>{var k=Ea(),P=l(k,!0);o(k),ae(()=>{K(k,1,`status-message ${t(h)??""}`,"svelte-x4gxra"),G(P,t(g))}),E(f,k)};z(I,f=>{t(g)&&f(L)})}var le=d(I,2);{var ge=f=>{var k=qa(),P=d(l(k),2),O=l(P),r=d(l(O));o(O);var m=d(O,2),C=d(l(m));o(m);var S=d(m,2),te=d(l(S));o(S);var fe=d(S,2),re=d(l(fe),2),ve=l(re,!0);o(re),o(fe),o(P),o(k),ae(()=>{G(r,` @${t(T).username??""}`),G(C,` ${t(T).first_name??""}`),G(te,` ${t(T).id??""}`),Ee(re,"href",t(T).deep_link),G(ve,t(T).deep_link)}),E(f,k)};z(le,f=>{t(T)&&f(ge)})}var ee=d(le,2),ue=l(ee);{var me=f=>{var k=Da(),P=be(k),O=l(P,!0);o(P);var r=d(P,2),m=l(r,!0);o(r),ae((C,S)=>{P.disabled=C,G(O,t(c)?"Testing...":"Test Connection"),r.disabled=S,G(m,t(c)?"Saving...":"Save Credentials")},[()=>t(c)||!t(i).trim(),()=>t(c)||!t(i).trim()]),A("click",P,w),A("click",r,p),E(f,k)},Y=f=>{var k=Ce(),P=be(k);{var O=m=>{var C=$a(),S=be(C),te=l(S,!0);o(S);var fe=d(S,2);ae(re=>{S.disabled=re,G(te,t(c)?"Testing...":"Test Connection")},[()=>t(c)||!t(i).trim()]),A("click",S,w),A("click",fe,_),E(m,C)},r=m=>{var C=Ia();A("click",C,_),E(m,C)};z(P,m=>{e().bot_username?m(r,!1):m(O)},!0)}E(f,k)};z(ue,f=>{e().connected?f(Y,!1):f(me)})}o(ee),o(Z);var ne=d(Z,2);{var _e=f=>{var k=Oa();E(f,k)};z(ne,f=>{t(D)&&f(_e)})}o(H),ae(f=>{B=K(q,1,"status-indicator svelte-x4gxra",null,B,f),ce.disabled=t(c)||e().connected,x.disabled=t(c)||e().connected},[()=>({connected:e().connected})]),qe(ce,()=>t(i),f=>y(i,f)),qe(x,()=>t(v),f=>y(v,f)),E(a,H),Ne(),u()}var Ba=N('<div class="general-settings svelte-anx9w7"><h2 class="svelte-anx9w7">General Settings</h2> <p class="placeholder-text svelte-anx9w7">General settings coming soon...</p></div>'),Pa=N('<div class="settings-container svelte-anx9w7"><div class="settings-sidebar svelte-anx9w7"><button>General</button> <button>Telegram</button></div> <div class="settings-content svelte-anx9w7"><!></div></div>');function La(a){let n=j("telegram");var e=Pa(),s=l(e),u=l(s);let i;var v=d(u,2);let g;o(s);var h=d(s,2),c=l(h);{var D=p=>{var w=Ba();E(p,w)},T=p=>{var w=Ce(),_=be(w);{var $=b=>{Ma(b,{})};z(_,b=>{t(n)==="telegram"&&b($)},!0)}E(p,w)};z(c,p=>{t(n)==="general"?p(D):p(T,!1)})}o(h),o(e),ae((p,w)=>{i=K(u,1,"settings-tab svelte-anx9w7",null,i,p),g=K(v,1,"settings-tab svelte-anx9w7",null,g,w)},[()=>({active:t(n)==="general"}),()=>({active:t(n)==="telegram"})]),A("click",u,()=>y(n,"general")),A("click",v,()=>y(n,"telegram")),E(a,e)}var Wa=N('<div class="app-container svelte-1uha8ag"><header class="app-header svelte-1uha8ag"><div class="header-left svelte-1uha8ag"><h1 class="app-title svelte-1uha8ag">Claude Code</h1> <div class="project-selector svelte-1uha8ag"><span class="project-label svelte-1uha8ag">Project:</span> <span class="project-name svelte-1uha8ag"> </span></div></div> <div class="header-right svelte-1uha8ag"><button class="theme-toggle svelte-1uha8ag" title="Toggle Theme"><span class="theme-icon svelte-1uha8ag"> </span></button></div></header> <nav class="tab-nav svelte-1uha8ag"><button>Chat</button> <button>Terminal</button> <button>Diff</button> <button>History</button> <button>Settings</button></nav> <main class="tab-content svelte-1uha8ag"><div><!></div> <div><!></div> <div><!></div> <div><!></div> <div><!></div></main></div>');function Ka(a,n){Ie(n,!1);const e=()=>Te(zt,"$themeIcon",u),s=()=>Te(At,"$activeTab",u),[u,i]=Me();let v=j("");Oe(async()=>{try{const r=await(await fetch("/api/cwd")).json();y(v,r.cwd),it.set(t(v))}catch(O){console.error("Error fetching current directory:",O),y(v,"Current Directory")}});function g(O){Ft(O)}function h(O){if(!O)return"Loading...";const r=O.split(/[\\/]/).filter(Boolean);return r[r.length-1]||O}$e();var c=Wa(),D=l(c),T=l(D),p=d(l(T),2),w=d(l(p),2),_=l(w,!0);o(w),o(p),o(T);var $=d(T,2),b=l($),H=l(b),U=l(H,!0);o(H),o(b),o($),o(D);var q=d(D,2),B=l(q);let M;var V=d(B,2);let W;var Q=d(V,2);let J;var F=d(Q,2);let X;var Z=d(F,2);let oe;o(q);var ce=d(q,2),se=l(ce);let x;var I=l(se);ya(I,{}),o(se);var L=d(se,2);let le;var ge=l(L);Vt(ge,{}),o(L);var ee=d(L,2);let ue;var me=l(ee);xa(me),o(ee);var Y=d(ee,2);let ne;var _e=l(Y);Sa(_e),o(Y);var f=d(Y,2);let k;var P=l(f);La(P),o(f),o(ce),o(c),ae((O,r,m,C,S,te,fe,re,ve,ye,we)=>{Ee(w,"title",t(v)),G(_,O),G(U,e()),M=K(B,1,"tab-button svelte-1uha8ag",null,M,r),W=K(V,1,"tab-button svelte-1uha8ag",null,W,m),J=K(Q,1,"tab-button svelte-1uha8ag",null,J,C),X=K(F,1,"tab-button svelte-1uha8ag",null,X,S),oe=K(Z,1,"tab-button svelte-1uha8ag",null,oe,te),x=K(se,1,"tab-panel svelte-1uha8ag",null,x,fe),le=K(L,1,"tab-panel svelte-1uha8ag",null,le,re),ue=K(ee,1,"tab-panel svelte-1uha8ag",null,ue,ve),ne=K(Y,1,"tab-panel svelte-1uha8ag",null,ne,ye),k=K(f,1,"tab-panel svelte-1uha8ag",null,k,we)},[()=>h(t(v)),()=>({active:s()==="chat"}),()=>({active:s()==="terminal"}),()=>({active:s()==="diff"}),()=>({active:s()==="history"}),()=>({active:s()==="settings"}),()=>({active:s()==="chat"}),()=>({active:s()==="terminal"}),()=>({active:s()==="diff"}),()=>({active:s()==="history"}),()=>({active:s()==="settings"})]),A("click",b,function(...O){Ut?.apply(this,O)}),A("click",B,()=>g("chat")),A("click",V,()=>g("terminal")),A("click",Q,()=>g("diff")),A("click",F,()=>g("history")),A("click",Z,()=>g("settings")),E(a,c),Ne(),i()}export{Ka as component};
