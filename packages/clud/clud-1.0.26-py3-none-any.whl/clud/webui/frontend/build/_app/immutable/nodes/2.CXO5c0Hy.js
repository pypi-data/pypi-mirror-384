import"../chunks/DsnmJJEf.js";import{i as Ee}from"../chunks/BeOat8u8.js";import{Z as Me,n as pe,at as ht,a0 as Ge,U as _t,T as bt,a,b as Ye,W as yt,X as wt,Y as Ue,_ as Ne,a7 as Te,au as xt,av as Tt,a1 as He,a4 as St,a2 as we,aw as Qe,ax as kt,w as H,ay as Fe,az as Ct,a5 as Xe,a6 as Et,aA as $t,aB as Be,aC as Ze,aD as qt,aE as Dt,aF as Ot,aG as It,aH as Mt,aI as Nt,e as Bt,aJ as Pt,ap as Lt,u as V,a9 as Wt,aK as Ht,B as jt,y as et,E as $e,F as qe,as as tt,aL as Se,s as b,aM as at,G as I,K as i,M as d,O as l,Q as ae,aN as F,I as $,J as De,aO as st,R as G,ai as nt,ah as Oe,aP as rt,aQ as Je}from"../chunks/DREhghgd.js";import{s as ke,r as Re}from"../chunks/CsceclWA.js";import{s as xe,a as Ie}from"../chunks/BmRkfDt5.js";import{c as lt,a as At,b as zt,d as Ut,s as Ft}from"../chunks/Cml8fQPH.js";import{i as Q,b as ot}from"../chunks/Bs20YoNl.js";import{p as Jt}from"../chunks/N1MTTA_3.js";import{T as Rt}from"../chunks/BkoWMZpV.js";function Vt(t,n,e){for(var s=t.items,u=[],o=n.length,c=0;c<o;c++)It(n[c].e,u,!0);var g=o>0&&u.length===0&&e!==null;if(g){var f=e.parentNode;Mt(f),f.append(e),s.clear(),me(t,n[0].prev,n[o-1].next)}Nt(u,()=>{for(var v=0;v<o;v++){var k=n[v];g||(s.delete(k.k),me(t,k.prev,k.next)),Ze(k.e,!g)}})}function it(t,n,e,s,u,o=null){var c=t,g={flags:n,items:new Map,first:null};{var f=t;c=pe?Me(ht(f)):f.appendChild(Ge())}pe&&_t();var v=null,k=!1,T=new Map,m=Ye(()=>{var _=e();return kt(_)?_:_==null?[]:Qe(_)}),y,h;function C(){Kt(h,y,g,T,c,u,n,s,e),o!==null&&(y.length===0?v?Xe(v):v=He(()=>o(c)):v!==null&&Et(v,()=>{v=null}))}bt(()=>{h??=Bt,y=a(m);var _=y.length;if(k&&_===0)return;k=_===0;let L=!1;if(pe){var z=yt(c)===wt;z!==(_===0)&&(c=Ue(),Me(c),Ne(!1),L=!0)}if(pe){for(var x=null,N,O=0;O<_;O++){if(Te.nodeType===xt&&Te.data===Tt){c=Te,L=!0,Ne(!1);break}var J=y[O],P=s(J,O);N=je(Te,g,x,null,J,P,O,u,n,e),g.items.set(P,N),x=N}_>0&&Me(Ue())}if(pe)_===0&&o&&(v=He(()=>o(c)));else if(St()){var X=new Set,j=we;for(O=0;O<_;O+=1){J=y[O],P=s(J,O);var W=g.items.get(P)??T.get(P);W?ct(W,J,O):(N=je(null,g,null,null,J,P,O,u,n,e,!0),T.set(P,N)),X.add(P)}for(const[R,Z]of g.items)X.has(R)||j.skipped_effects.add(Z.e);j.add_callback(C)}else C();L&&Ne(!0),a(m)}),pe&&(c=Te)}function Kt(t,n,e,s,u,o,c,g,f){var v=n.length,k=e.items,T=e.first,m=T,y,h=null,C=[],_=[],L,z,x,N;for(N=0;N<v;N+=1){if(L=n[N],z=g(L,N),x=k.get(z),x===void 0){var O=s.get(z);if(O!==void 0){s.delete(z),k.set(z,O);var J=h?h.next:m;me(e,h,O),me(e,O,J),Pe(O,J,u),h=O}else{var P=m?m.e.nodes_start:u;h=je(P,e,h,h===null?e.first:h.next,L,z,N,o,c,f)}k.set(z,h),C=[],_=[],m=h.next;continue}if(ct(x,L,N),(x.e.f&Be)!==0&&Xe(x.e),x!==m){if(y!==void 0&&y.has(x)){if(C.length<_.length){var X=_[0],j;h=X.prev;var W=C[0],R=C[C.length-1];for(j=0;j<C.length;j+=1)Pe(C[j],X,u);for(j=0;j<_.length;j+=1)y.delete(_[j]);me(e,W.prev,R.next),me(e,h,W),me(e,R,X),m=X,h=R,N-=1,C=[],_=[]}else y.delete(x),Pe(x,m,u),me(e,x.prev,x.next),me(e,x,h===null?e.first:h.next),me(e,h,x),h=x;continue}for(C=[],_=[];m!==null&&m.k!==z;)(m.e.f&Be)===0&&(y??=new Set).add(m),_.push(m),m=m.next;if(m===null)continue;x=m}C.push(x),h=x,m=x.next}if(m!==null||y!==void 0){for(var Z=y===void 0?[]:Qe(y);m!==null;)(m.e.f&Be)===0&&Z.push(m),m=m.next;var se=Z.length;if(se>0){var ce=v===0?u:null;Vt(e,Z,ce)}}t.first=e.first&&e.first.e,t.last=h&&h.e;for(var re of s.values())Ze(re.e);s.clear()}function ct(t,n,e,s){Ct(t.v,n),t.i=e}function je(t,n,e,s,u,o,c,g,f,v,k){var T=(f&qt)!==0,m=(f&Dt)===0,y=T?m?H(u,!1,!1):Fe(u):u,h=(f&$t)===0?c:Fe(c),C={i:h,v:y,k:o,a:null,e:null,prev:e,next:s};try{if(t===null){var _=document.createDocumentFragment();_.append(t=Ge())}return C.e=He(()=>g(t,y,h,v),pe),C.e.prev=e&&e.e,C.e.next=s&&s.e,e===null?k||(n.first=C):(e.next=C,e.e.next=C.e),s!==null&&(s.prev=C,s.e.prev=C.e),C}finally{}}function Pe(t,n,e){for(var s=t.next?t.next.e.nodes_start:e,u=n?n.e.nodes_start:e,o=t.e.nodes_start;o!==null&&o!==s;){var c=Ot(o);u.before(o),o=c}}function me(t,n,e){n===null?t.first=e:(n.next=e,n.e.next=e&&e.e),e!==null&&(e.prev=n,e.e.prev=n&&n.e)}const Ve=[...` 	
\r\fÂ \v\uFEFF`];function Gt(t,n,e){var s=t==null?"":""+t;if(n&&(s=s?s+" "+n:n),e){for(var u in e)if(e[u])s=s?s+" "+u:u;else if(s.length)for(var o=u.length,c=0;(c=s.indexOf(u,c))>=0;){var g=c+o;(c===0||Ve.includes(s[c-1]))&&(g===s.length||Ve.includes(s[g]))?s=(c===0?"":s.substring(0,c))+s.substring(g+1):c=g}}return s===""?null:s}function K(t,n,e,s,u,o){var c=t.__className;if(pe||c!==e||c===void 0){var g=Gt(e,s,o);(!pe||g!==t.getAttribute("class"))&&(g==null?t.removeAttribute("class"):t.className=g),t.__className=e}else if(o&&u!==o)for(var f in o){var v=!!o[f];(u==null||v!==!!u[f])&&t.classList.toggle(f,v)}return o}function Ce(t,n,e=n){var s=new WeakSet;Pt(t,"input",async u=>{var o=u?t.defaultValue:t.value;if(o=Le(t)?We(o):o,e(o),we!==null&&s.add(we),await Lt(),o!==(o=n())){var c=t.selectionStart,g=t.selectionEnd,f=t.value.length;if(t.value=o??"",g!==null){var v=t.value.length;c===g&&g===f&&v>f?(t.selectionStart=v,t.selectionEnd=v):(t.selectionStart=c,t.selectionEnd=Math.min(g,v))}}}),(pe&&t.defaultValue!==t.value||V(n)==null&&t.value)&&(e(Le(t)?We(t.value):t.value),we!==null&&s.add(we)),Wt(()=>{var u=n();if(t===document.activeElement){var o=Ht??we;if(s.has(o))return}Le(t)&&u===We(t.value)||t.type==="date"&&!u&&!t.value||u!==t.value&&(t.value=u??"")})}function Le(t){var n=t.type;return n==="number"||n==="range"}function We(t){return t===""?null:+t}const vt={connected:!1,bot_token:null,bot_username:null,chat_id:null,messages:[],unread_count:0},ie=jt(vt);let oe=null;async function Yt(t,n){try{if((await(await fetch("/api/telegram/credentials",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bot_token:t,chat_id:n||null})})).json()).status==="ok"){const o=await(await fetch("/api/telegram/bot_info")).json();if(o.status==="ok"&&o.bot_info)return ie.update(c=>({...c,connected:!0,bot_token:t,bot_username:o.bot_info.username,chat_id:n||null})),await dt(),!0}return!1}catch(e){return console.error("Error connecting to Telegram:",e),!1}}async function Qt(t){try{const e=await(await fetch("/api/telegram/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bot_token:t})})).json();return e.status==="ok"&&e.bot_info?e.bot_info:null}catch(n){return console.error("Error testing Telegram connection:",n),null}}function Xt(){oe&&(oe.close(),oe=null),ie.set(vt)}async function Zt(t,n){const s=et(ie).chat_id;if(!s)return console.error("No chat ID available for sending message"),!1;try{if(oe&&oe.readyState===WebSocket.OPEN){oe.send(JSON.stringify({type:"telegram_send",chat_id:s,message:t}));const c={chat_id:s,user_id:0,username:"bot",message:t,timestamp:Date.now()/1e3,direction:"outgoing"};return ie.update(g=>({...g,messages:[...g.messages,c]})),!0}return(await(await fetch("/api/telegram/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:s,message:t})})).json()).status==="ok"}catch(u){return console.error("Error sending Telegram message:",u),!1}}function Ae(){const t=et(ie);t.bot_username?window.open(`https://t.me/${t.bot_username}`,"_blank"):console.warn("Bot username not available")}async function dt(){const n=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/telegram`;oe=new WebSocket(n),oe.addEventListener("open",()=>{console.log("Telegram WebSocket connected")}),oe.addEventListener("message",e=>{try{const s=JSON.parse(e.data);ea(s)}catch(s){console.error("Error parsing WebSocket message:",s)}}),oe.addEventListener("close",()=>{console.log("Telegram WebSocket closed"),ie.update(e=>({...e,connected:!1}))}),oe.addEventListener("error",e=>{console.error("Telegram WebSocket error:",e)})}function ea(t){switch(t.type){case"telegram_message":{const n={chat_id:t.chat_id,user_id:t.user_id,username:t.username,message:t.message,timestamp:t.timestamp,direction:"incoming"};ie.update(e=>({...e,messages:[...e.messages,n],unread_count:e.unread_count+1}));break}case"telegram_status":{const e=t.status==="connected";ie.update(s=>({...s,connected:e}));break}default:console.log("Unknown Telegram WebSocket message type:",t.type)}}function Ke(){ie.update(t=>({...t,unread_count:0}))}async function ut(){try{const n=await(await fetch("/api/telegram/status")).json();n.connected&&n.bot_info&&(ie.update(e=>({...e,connected:!0,bot_username:n.bot_info.username})),(!oe||oe.readyState!==WebSocket.OPEN)&&await dt())}catch(t){console.error("Error fetching Telegram status:",t)}}var ta=I('<span class="unread-badge svelte-1qwqu3f"> </span>'),aa=I('<button class="btn-icon svelte-1qwqu3f" title="Open in Telegram" aria-label="Open in Telegram"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></button>'),sa=I('<div class="empty-state svelte-1qwqu3f"><p class="empty-text svelte-1qwqu3f">Not connected to Telegram</p> <p class="empty-hint svelte-1qwqu3f">Configure your bot in Settings to get started</p></div>'),na=I('<div class="empty-state svelte-1qwqu3f"><p class="empty-text svelte-1qwqu3f">No messages yet</p> <p class="empty-hint svelte-1qwqu3f">Send a message to start the conversation</p></div>'),ra=I('<div><div class="message-header svelte-1qwqu3f"><span class="message-username svelte-1qwqu3f"> </span> <span class="message-timestamp svelte-1qwqu3f"> </span></div> <div class="message-content svelte-1qwqu3f"> </div></div>'),la=I('<div class="messages-list svelte-1qwqu3f"></div>'),oa=I('<div class="input-container svelte-1qwqu3f"><textarea placeholder="Type a message..." rows="1" class="message-input svelte-1qwqu3f"></textarea> <button class="send-button svelte-1qwqu3f" title="Send message" aria-label="Send message"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button></div>'),ia=I('<div><div class="chat-header svelte-1qwqu3f"><div class="header-title svelte-1qwqu3f"><svg class="telegram-icon svelte-1qwqu3f" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.654-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"></path></svg> <span>Telegram</span> <!></div> <div class="header-actions svelte-1qwqu3f"><!></div></div> <div class="messages-container svelte-1qwqu3f"><!></div> <!></div>');function ca(t,n){$e(n,!1);const e=()=>xe(ie,"$telegramStore",s),[s,u]=Ie(),o=H(),c=H();let g=Jt(n,"collapsed",8,!1),f=H(""),v=H(),k=H(!0);qe(()=>{g()||Ke()}),tt(()=>{});function T(){a(v)&&requestAnimationFrame(()=>{st(v,a(v).scrollTop=a(v).scrollHeight)})}function m(){if(!a(v))return;const{scrollTop:w,scrollHeight:q,clientHeight:B}=a(v);b(k,q-w-B<50),a(k)&&!g()&&Ke()}async function y(){const w=a(f).trim();if(!w)return;await Zt(w)?(b(f,""),T()):console.error("Failed to send Telegram message")}function h(w){w.key==="Enter"&&!w.shiftKey&&(w.preventDefault(),y())}function C(w){const q=new Date(w*1e3),B=new Date;return q.toDateString()===B.toDateString()?q.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):q.toLocaleDateString([],{month:"short",day:"numeric"})+" "+q.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function _(){!e().connected||!e().bot_username||Ae()}Se(()=>e(),()=>{b(o,e().messages.length>0)}),Se(()=>e(),()=>{b(c,e().unread_count>0)}),Se(()=>(e(),a(v),a(k)),()=>{e().messages&&a(v)&&a(k)&&T()}),at(),Ee();var L=ia();let z;var x=i(L),N=i(x),O=d(i(N),4);{var J=w=>{var q=ta(),B=i(q,!0);l(q),ae(()=>G(B,(e(),V(()=>e().unread_count)))),$(w,q)};Q(O,w=>{a(c)&&w(J)})}l(N);var P=d(N,2),X=i(P);{var j=w=>{var q=aa();F("click",q,_),$(w,q)};Q(X,w=>{e(),V(()=>e().connected&&e().bot_username)&&w(j)})}l(P),l(x);var W=d(x,2),R=i(W);{var Z=w=>{var q=sa();$(w,q)},se=w=>{var q=nt(),B=Oe(q);{var le=te=>{var ve=na();$(te,ve)},de=te=>{var ve=la();it(ve,5,()=>(e(),V(()=>e().messages)),fe=>fe.timestamp+fe.direction,(fe,p)=>{var S=ra();let A;var Y=i(S),ee=i(Y),ue=i(ee,!0);l(ee);var U=d(ee,2),r=i(U,!0);l(U),l(Y);var D=d(Y,2),M=i(D,!0);l(D),l(S),ae((E,ne)=>{A=K(S,1,"message svelte-1qwqu3f",null,A,E),G(ue,(a(p),V(()=>a(p).username))),G(r,ne),G(M,(a(p),V(()=>a(p).message)))},[()=>({incoming:a(p).direction==="incoming",outgoing:a(p).direction==="outgoing"}),()=>(a(p),V(()=>C(a(p).timestamp)))]),$(fe,S)}),l(ve),$(te,ve)};Q(B,te=>{a(o)?te(de,!1):te(le)},!0)}$(w,q)};Q(R,w=>{e(),V(()=>!e().connected)?w(Z):w(se,!1)})}l(W),ot(W,w=>b(v,w),()=>a(v));var ce=d(W,2);{var re=w=>{var q=oa(),B=i(q);rt(B);var le=d(B,2);l(q),ae(de=>{B.disabled=(e(),V(()=>!e().connected)),le.disabled=de},[()=>(a(f),e(),V(()=>!a(f).trim()||!e().connected))]),Ce(B,()=>a(f),de=>b(f,de)),F("keypress",B,h),F("click",le,y),$(w,q)};Q(ce,w=>{e(),V(()=>e().connected)&&w(re)})}l(L),ae(w=>z=K(L,1,"telegram-chat svelte-1qwqu3f",null,z,w),[()=>({collapsed:g()})]),F("scroll",W,m),$(t,L),De(),u()}var va=I('<span class="badge svelte-191yngm"> </span>'),da=I('<button aria-label="Toggle Telegram panel"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="svelte-191yngm"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.654-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z" class="svelte-191yngm"></path></svg> <!></button> <button class="btn-secondary svelte-191yngm" data-testid="telegram-open-button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-191yngm"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" class="svelte-191yngm"></path><polyline points="15 3 21 3 21 9" class="svelte-191yngm"></polyline><line x1="10" y1="14" x2="21" y2="3" class="svelte-191yngm"></line></svg> Open in Telegram</button>',1),ua=I('<div class="empty-state svelte-191yngm"><svg class="empty-icon svelte-191yngm" xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" class="svelte-191yngm"></path></svg> <p class="empty-text svelte-191yngm">Start a conversation with Claude Code</p> <p class="empty-hint svelte-191yngm">Type a message below to begin</p></div>'),ga=I('<div><div class="message-header svelte-191yngm"><span class="message-role svelte-191yngm"> </span> <span class="message-timestamp svelte-191yngm"> </span></div> <div class="message-content svelte-191yngm"> </div></div>'),fa=I('<div class="messages-list svelte-191yngm"></div>'),ma=I('<div class="loading-indicator svelte-191yngm"><div class="loading-dot svelte-191yngm"></div> <div class="loading-dot svelte-191yngm"></div> <div class="loading-dot svelte-191yngm"></div></div>'),pa=I('<div class="telegram-panel svelte-191yngm"><!></div>'),ha=I('<div class="config-popup svelte-191yngm" data-testid="telegram-config-popup">Enter a bot token in Settings to enable Telegram</div>'),_a=I('<div class="chat-layout svelte-191yngm"><div><div class="chat-header svelte-191yngm"><div class="header-left svelte-191yngm"><h2 class="svelte-191yngm">Chat with Claude Code</h2></div> <div class="header-right svelte-191yngm"><!> <button class="btn-secondary svelte-191yngm" title="Clear chat history">Clear</button></div></div> <div class="messages-container svelte-191yngm"><!> <!></div> <div class="input-container svelte-191yngm"><textarea placeholder="Type your message to Claude Code..." rows="1" class="message-input svelte-191yngm"></textarea> <button class="send-button svelte-191yngm" title="Send message" aria-label="Send message"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-191yngm"><line x1="22" y1="2" x2="11" y2="13" class="svelte-191yngm"></line><polygon points="22 2 15 22 11 13 2 9 22 2" class="svelte-191yngm"></polygon></svg></button></div></div> <!> <!></div>');function ba(t,n){$e(n,!1);const e=()=>xe(lt,"$currentProject",u),s=()=>xe(ie,"$telegramStore",u),[u,o]=Ie(),c=H(),g=H();let f=H([]),v=H(""),k=H(!1),T=H(!1),m=H(!1),y=H(),h=null;qe(async()=>{await ut(),C(),J()}),tt(()=>{h&&h.close()});function C(){const D=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;h=new WebSocket(D),h.addEventListener("open",()=>{console.log("Chat WebSocket connected")}),h.addEventListener("message",M=>{try{const E=JSON.parse(M.data);_(E)}catch(E){console.error("Error parsing WebSocket message:",E)}}),h.addEventListener("close",()=>{console.log("Chat WebSocket closed"),setTimeout(()=>{(!h||h.readyState===WebSocket.CLOSED)&&C()},3e3)}),h.addEventListener("error",M=>{console.error("Chat WebSocket error:",M)})}function _(r){if(r.type==="message"||r.content){const D={id:crypto.randomUUID(),role:r.role||"assistant",content:r.content||"",timestamp:Date.now()};b(f,[...a(f),D]),P(),x()}}async function L(){if(!a(g))return;const r=a(v).trim();b(v,"");const D={id:crypto.randomUUID(),role:"user",content:r,timestamp:Date.now()};b(f,[...a(f),D]),P(),x(),b(k,!0);try{if(h&&h.readyState===WebSocket.OPEN)h.send(JSON.stringify({type:"chat",message:r,project_path:e()||process.cwd()}));else{const M=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:r,project_path:e()||process.cwd()})});if(!M.ok)throw new Error("Failed to send message");const E=await M.json();if(E.response){const ne={id:crypto.randomUUID(),role:"assistant",content:E.response,timestamp:Date.now()};b(f,[...a(f),ne]),P(),x()}}}catch(M){console.error("Error sending message:",M);const E={id:crypto.randomUUID(),role:"system",content:"Error: Failed to send message. Please try again.",timestamp:Date.now()};b(f,[...a(f),E]),P()}finally{b(k,!1)}}function z(r){r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),L())}function x(){a(y)&&requestAnimationFrame(()=>{st(y,a(y).scrollTop=a(y).scrollHeight)})}function N(){b(T,!a(T))}function O(){if(!s().connected||!s().bot_username){b(m,!0),setTimeout(()=>{b(m,!1)},3e3);return}Ae()}function J(){try{const r=localStorage.getItem("chat_history");r&&b(f,JSON.parse(r))}catch(r){console.error("Error loading chat history:",r)}}function P(){try{localStorage.setItem("chat_history",JSON.stringify(a(f)))}catch(r){console.error("Error saving chat history:",r)}}function X(){b(f,[]),P()}function j(r){return new Date(r).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}Se(()=>a(f),()=>{b(c,a(f).length>0)}),Se(()=>(a(v),a(k)),()=>{b(g,a(v).trim().length>0&&!a(k))}),at(),Ee();var W=_a(),R=i(W);let Z;var se=i(R),ce=d(i(se),2),re=i(ce);{var w=r=>{var D=da(),M=Oe(D);let E;var ne=d(i(M),2);{var be=ge=>{var _e=va(),ye=i(_e,!0);l(_e),ae(()=>G(ye,(s(),V(()=>s().unread_count)))),$(ge,_e)};Q(ne,ge=>{s(),V(()=>s().unread_count>0)&&ge(be)})}l(M);var he=d(M,2);ae(ge=>{E=K(M,1,"btn-icon svelte-191yngm",null,E,ge),ke(M,"title",a(T)?"Hide Telegram":"Show Telegram"),he.disabled=(s(),V(()=>!s().connected||!s().bot_username)),ke(he,"title",(s(),V(()=>s().bot_username?`Open @${s().bot_username} in Telegram`:"Configure Telegram in Settings")))},[()=>({active:a(T)})]),F("click",M,N),F("click",he,O),$(r,D)};Q(re,r=>{s(),V(()=>s().connected)&&r(w)})}var q=d(re,2);l(ce),l(se);var B=d(se,2),le=i(B);{var de=r=>{var D=ua();$(r,D)},te=r=>{var D=fa();it(D,5,()=>a(f),M=>M.id,(M,E)=>{var ne=ga();let be;var he=i(ne),ge=i(he),_e=i(ge,!0);l(ge);var ye=d(ge,2),gt=i(ye,!0);l(ye),l(he);var ze=d(he,2),ft=i(ze,!0);l(ze),l(ne),ae((mt,pt)=>{be=K(ne,1,"message svelte-191yngm",null,be,mt),G(_e,(a(E),V(()=>a(E).role==="user"?"You":a(E).role==="assistant"?"Claude":"System"))),G(gt,pt),G(ft,(a(E),V(()=>a(E).content)))},[()=>({user:a(E).role==="user",assistant:a(E).role==="assistant",system:a(E).role==="system"}),()=>(a(E),V(()=>j(a(E).timestamp)))]),$(M,ne)}),l(D),$(r,D)};Q(le,r=>{a(c)?r(te,!1):r(de)})}var ve=d(le,2);{var fe=r=>{var D=ma();$(r,D)};Q(ve,r=>{a(k)&&r(fe)})}l(B),ot(B,r=>b(y,r),()=>a(y));var p=d(B,2),S=i(p);rt(S);var A=d(S,2);l(p),l(R);var Y=d(R,2);{var ee=r=>{var D=pa(),M=i(D);{let E=Ye(()=>!a(T));ca(M,{get collapsed(){return a(E)}})}l(D),$(r,D)};Q(Y,r=>{a(T)&&r(ee)})}var ue=d(Y,2);{var U=r=>{var D=ha();$(r,D)};Q(ue,r=>{a(m)&&r(U)})}l(W),ae(r=>{Z=K(R,1,"main-chat-panel svelte-191yngm",null,Z,r),q.disabled=!a(c),S.disabled=a(k),A.disabled=!a(g)},[()=>({"with-telegram":a(T)})]),F("click",q,X),Ce(S,()=>a(v),r=>b(v,r)),F("keypress",S,z),F("click",A,L),$(t,W),De(),o()}var ya=I('<div class="diff-container svelte-n31mvn"><div class="diff-header svelte-n31mvn"><h2 class="svelte-n31mvn">Diff Viewer</h2></div> <div class="diff-content svelte-n31mvn"><p class="placeholder-text svelte-n31mvn">Diff viewer coming soon...</p></div></div>');function wa(t){var n=ya();$(t,n)}var xa=I('<div class="history-container svelte-1t4jzn8"><div class="history-header svelte-1t4jzn8"><h2 class="svelte-1t4jzn8">Conversation History</h2></div> <div class="history-content svelte-1t4jzn8"><p class="placeholder-text svelte-1t4jzn8">History viewer coming soon...</p></div></div>');function Ta(t){var n=xa();$(t,n)}var Sa=I(`<div class="bot-info svelte-x4gxra"><span class="bot-username svelte-x4gxra"> </span> <button class="open-telegram-btn svelte-x4gxra" title="Open in Telegram"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="svelte-x4gxra"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97
							9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002
							0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.654-.64.135-.954l11.566-4.458c.538-.196
							1.006.128.832.941z"></path></svg> Open in Telegram</button></div>`),ka=I('<div data-testid="telegram-status"> </div>'),Ca=I('<div class="test-result svelte-x4gxra"><h4 class="svelte-x4gxra">Bot Information:</h4> <ul class="svelte-x4gxra"><li class="svelte-x4gxra"><strong>Username:</strong> </li> <li class="svelte-x4gxra"><strong>Name:</strong> </li> <li class="svelte-x4gxra"><strong>ID:</strong> </li> <li class="svelte-x4gxra"><strong>Link:</strong> <a target="_blank" class="svelte-x4gxra"> </a></li></ul></div>'),Ea=I('<button class="btn btn-primary svelte-x4gxra" data-testid="telegram-test-button"> </button> <button class="btn btn-success svelte-x4gxra" data-testid="telegram-save-button"> </button>',1),$a=I('<button class="btn btn-danger svelte-x4gxra" data-testid="telegram-disconnect-button">Disconnect</button>'),qa=I('<div class="config-popup svelte-x4gxra" data-testid="telegram-config-popup">Enter a bot token in the configuration</div>'),Da=I(`<div class="telegram-settings svelte-x4gxra"><div class="settings-header svelte-x4gxra"><h2 class="svelte-x4gxra">Telegram Integration</h2> <p class="description svelte-x4gxra">Connect your Telegram bot to receive real-time notifications and interact with Claude Code
			from Telegram.</p></div> <div class="status-section svelte-x4gxra"><div><span class="status-dot svelte-x4gxra"></span> <span class="status-text svelte-x4gxra"> </span></div> <!></div> <div class="config-section svelte-x4gxra"><h3 class="svelte-x4gxra">Configuration</h3> <div class="instructions svelte-x4gxra"><p class="svelte-x4gxra"><strong>Setup Instructions:</strong></p> <ol class="svelte-x4gxra"><li class="svelte-x4gxra">Open Telegram and search for <a href="https://t.me/BotFather" target="_blank" class="svelte-x4gxra">@BotFather</a></li> <li class="svelte-x4gxra">Send <code class="svelte-x4gxra">/newbot</code> command and follow the prompts</li> <li class="svelte-x4gxra">Copy your bot token (looks like: <code class="svelte-x4gxra">123456:ABC-DEF1234...</code>)</li> <li class="svelte-x4gxra">Paste the token below and click "Save Credentials"</li> <li class="svelte-x4gxra">Open your bot in Telegram and send a message to activate it</li></ol></div> <div class="form-group svelte-x4gxra"><label for="bot-token" class="svelte-x4gxra">Bot Token</label> <input id="bot-token" type="password" placeholder="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11" class="token-input svelte-x4gxra"/> <span class="help-text svelte-x4gxra">Your Telegram bot token from @BotFather</span></div> <div class="form-group svelte-x4gxra"><label for="chat-id" class="svelte-x4gxra">Chat ID (Optional)</label> <input id="chat-id" type="text" placeholder="Auto-detected when you message the bot" class="chat-id-input svelte-x4gxra"/> <span class="help-text svelte-x4gxra">Leave empty for auto-detection</span></div> <!> <!> <div class="button-group svelte-x4gxra"><!></div></div> <!></div>`);function Oa(t,n){$e(n,!1);const e=()=>xe(ie,"$telegramStore",s),[s,u]=Ie();let o=H(""),c=H(""),g=H(""),f=H("info"),v=H(!1),k=H(!1),T=H(null);qe(async()=>{await ut()});async function m(){if(!a(o).trim()){_("Please enter a bot token","error");return}b(v,!0),_("Saving credentials...","info"),await Yt(a(o),a(c).trim()||void 0)?(_("Credentials saved successfully","success"),b(o,"")):_("Failed to save credentials","error"),b(v,!1)}async function y(){if(!a(o).trim()){_("Please enter a bot token","error");return}b(v,!0),_("Testing connection...","info"),b(T,await Qt(a(o))),a(T)?_(`Connection successful! Bot: @${a(T).username} (${a(T).first_name})`,"success"):(_("Connection failed. Please check your bot token.","error"),b(T,null)),b(v,!1)}function h(){Xt(),b(o,""),b(c,""),b(T,null),_("Disconnected from Telegram","info")}function C(){if(!e().connected||!e().bot_username){b(k,!0),window.setTimeout(()=>{b(k,!1)},3e3);return}Ae()}function _(p,S){b(g,p),b(f,S)}Ee();var L=Da(),z=d(i(L),2),x=i(z);let N;var O=d(i(x),2),J=i(O,!0);l(O),l(x);var P=d(x,2);{var X=p=>{var S=Sa(),A=i(S),Y=i(A);l(A);var ee=d(A,2);l(S),ae(()=>G(Y,`@${e().bot_username??""}`)),F("click",ee,C),$(p,S)};Q(P,p=>{e().connected&&e().bot_username&&p(X)})}l(z);var j=d(z,2),W=d(i(j),4),R=d(i(W),2);Re(R),Je(2),l(W);var Z=d(W,2),se=d(i(Z),2);Re(se),Je(2),l(Z);var ce=d(Z,2);{var re=p=>{var S=ka(),A=i(S,!0);l(S),ae(()=>{K(S,1,`status-message ${a(f)??""}`,"svelte-x4gxra"),G(A,a(g))}),$(p,S)};Q(ce,p=>{a(g)&&p(re)})}var w=d(ce,2);{var q=p=>{var S=Ca(),A=d(i(S),2),Y=i(A),ee=d(i(Y));l(Y);var ue=d(Y,2),U=d(i(ue));l(ue);var r=d(ue,2),D=d(i(r));l(r);var M=d(r,2),E=d(i(M),2),ne=i(E,!0);l(E),l(M),l(A),l(S),ae(()=>{G(ee,` @${a(T).username??""}`),G(U,` ${a(T).first_name??""}`),G(D,` ${a(T).id??""}`),ke(E,"href",a(T).deep_link),G(ne,a(T).deep_link)}),$(p,S)};Q(w,p=>{a(T)&&p(q)})}var B=d(w,2),le=i(B);{var de=p=>{var S=Ea(),A=Oe(S),Y=i(A,!0);l(A);var ee=d(A,2),ue=i(ee,!0);l(ee),ae((U,r)=>{A.disabled=U,G(Y,a(v)?"Testing...":"Test Connection"),ee.disabled=r,G(ue,a(v)?"Saving...":"Save Credentials")},[()=>a(v)||!a(o).trim(),()=>a(v)||!a(o).trim()]),F("click",A,y),F("click",ee,m),$(p,S)},te=p=>{var S=$a();F("click",S,h),$(p,S)};Q(le,p=>{e().connected?p(te,!1):p(de)})}l(B),l(j);var ve=d(j,2);{var fe=p=>{var S=qa();$(p,S)};Q(ve,p=>{a(k)&&p(fe)})}l(L),ae(p=>{N=K(x,1,"status-indicator svelte-x4gxra",null,N,p),G(J,e().connected?"Connected":"Disconnected"),R.disabled=a(v)||e().connected,se.disabled=a(v)||e().connected},[()=>({connected:e().connected})]),Ce(R,()=>a(o),p=>b(o,p)),Ce(se,()=>a(c),p=>b(c,p)),$(t,L),De(),u()}var Ia=I('<div class="general-settings svelte-anx9w7"><h2 class="svelte-anx9w7">General Settings</h2> <p class="placeholder-text svelte-anx9w7">General settings coming soon...</p></div>'),Ma=I('<div class="settings-container svelte-anx9w7"><div class="settings-sidebar svelte-anx9w7"><button>General</button> <button>Telegram</button></div> <div class="settings-content svelte-anx9w7"><!></div></div>');function Na(t){let n=H("telegram");var e=Ma(),s=i(e),u=i(s);let o;var c=d(u,2);let g;l(s);var f=d(s,2),v=i(f);{var k=m=>{var y=Ia();$(m,y)},T=m=>{var y=nt(),h=Oe(y);{var C=_=>{Oa(_,{})};Q(h,_=>{a(n)==="telegram"&&_(C)},!0)}$(m,y)};Q(v,m=>{a(n)==="general"?m(k):m(T,!1)})}l(f),l(e),ae((m,y)=>{o=K(u,1,"settings-tab svelte-anx9w7",null,o,m),g=K(c,1,"settings-tab svelte-anx9w7",null,g,y)},[()=>({active:a(n)==="general"}),()=>({active:a(n)==="telegram"})]),F("click",u,()=>b(n,"general")),F("click",c,()=>b(n,"telegram")),$(t,e)}var Ba=I('<div class="app-container svelte-1uha8ag"><header class="app-header svelte-1uha8ag"><div class="header-left svelte-1uha8ag"><h1 class="app-title svelte-1uha8ag">Claude Code</h1> <div class="project-selector svelte-1uha8ag"><span class="project-label svelte-1uha8ag">Project:</span> <span class="project-name svelte-1uha8ag"> </span></div></div> <div class="header-right svelte-1uha8ag"><button class="theme-toggle svelte-1uha8ag" title="Toggle Theme"><span class="theme-icon svelte-1uha8ag"> </span></button></div></header> <nav class="tab-nav svelte-1uha8ag"><button>Chat</button> <button>Terminal</button> <button>Diff</button> <button>History</button> <button>Settings</button></nav> <main class="tab-content svelte-1uha8ag"><div><!></div> <div><!></div> <div><!></div> <div><!></div> <div><!></div></main></div>');function Ja(t,n){$e(n,!1);const e=()=>xe(zt,"$themeIcon",u),s=()=>xe(At,"$activeTab",u),[u,o]=Ie();let c=H("");qe(async()=>{try{const r=await(await fetch("/api/cwd")).json();b(c,r.cwd),lt.set(a(c))}catch(U){console.error("Error fetching current directory:",U),b(c,"Current Directory")}});function g(U){Ft(U)}function f(U){if(!U)return"Loading...";const r=U.split(/[\\/]/).filter(Boolean);return r[r.length-1]||U}Ee();var v=Ba(),k=i(v),T=i(k),m=d(i(T),2),y=d(i(m),2),h=i(y,!0);l(y),l(m),l(T);var C=d(T,2),_=i(C),L=i(_),z=i(L,!0);l(L),l(_),l(C),l(k);var x=d(k,2),N=i(x);let O;var J=d(N,2);let P;var X=d(J,2);let j;var W=d(X,2);let R;var Z=d(W,2);let se;l(x);var ce=d(x,2),re=i(ce);let w;var q=i(re);ba(q,{}),l(re);var B=d(re,2);let le;var de=i(B);Rt(de,{}),l(B);var te=d(B,2);let ve;var fe=i(te);wa(fe),l(te);var p=d(te,2);let S;var A=i(p);Ta(A),l(p);var Y=d(p,2);let ee;var ue=i(Y);Na(ue),l(Y),l(ce),l(v),ae((U,r,D,M,E,ne,be,he,ge,_e,ye)=>{ke(y,"title",a(c)),G(h,U),G(z,e()),O=K(N,1,"tab-button svelte-1uha8ag",null,O,r),P=K(J,1,"tab-button svelte-1uha8ag",null,P,D),j=K(X,1,"tab-button svelte-1uha8ag",null,j,M),R=K(W,1,"tab-button svelte-1uha8ag",null,R,E),se=K(Z,1,"tab-button svelte-1uha8ag",null,se,ne),w=K(re,1,"tab-panel svelte-1uha8ag",null,w,be),le=K(B,1,"tab-panel svelte-1uha8ag",null,le,he),ve=K(te,1,"tab-panel svelte-1uha8ag",null,ve,ge),S=K(p,1,"tab-panel svelte-1uha8ag",null,S,_e),ee=K(Y,1,"tab-panel svelte-1uha8ag",null,ee,ye)},[()=>f(a(c)),()=>({active:s()==="chat"}),()=>({active:s()==="terminal"}),()=>({active:s()==="diff"}),()=>({active:s()==="history"}),()=>({active:s()==="settings"}),()=>({active:s()==="chat"}),()=>({active:s()==="terminal"}),()=>({active:s()==="diff"}),()=>({active:s()==="history"}),()=>({active:s()==="settings"})]),F("click",_,function(...U){Ut?.apply(this,U)}),F("click",N,()=>g("chat")),F("click",J,()=>g("terminal")),F("click",X,()=>g("diff")),F("click",W,()=>g("history")),F("click",Z,()=>g("settings")),$(t,v),De(),o()}export{Ja as component};
