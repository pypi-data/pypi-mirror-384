{% extends 'pbx_admin/base.html' %}

{% load i18n %}
{% load pbx_tags %}
{% load admin_tags %}

{% block panel_heading %}
    {{ opts.verbose_name_plural }}
    <span class="badge">{{ paginator.count|humanize_number }}</span>
    <span class="panel-heading-action">
        {% if can_add %}
            <a class="list-toolbar-btn"
               {% if admin.add_modal_fields %}href="#" data-toggle="modal" data-target="#add-modal"
               {% else %}href="add/"{% endif %}>
              <span title="" data-toggle="tooltip" class="label-tooltip"
                    data-original-title="Add new" data-html="true" data-placement="left">
                <i class="process-icon-new "></i>
              </span>
            </a>
        {% endif %}
        {% if can_import %}
            {% if admin.csv_import_view_class %}
            <a data-action="trigger-click" data-target="input[name='import_objects_csv']" class="list-toolbar-btn" href="#">
              <span title="" data-toggle="tooltip" class="label-tooltip"
                    data-original-title="CSV import" data-html="true"
                    data-placement="left">
                <i class="icon-circle-arrow-up center-block"></i>
              </span>
            </a>
            <form method="post" action="import-from-csv" enctype="multipart/form-data" style="display: none">
                {% csrf_token %}
                <input type="file" name="import_objects_csv" data-action="form-submit">
                <button type="submit"></button>
            </form>
            {% endif %}

            <a href="#"
               class="list-toolbar-btn"
               data-action="trigger-click"
               data-target="input[name='import_file']"
               data-mixpanel-enabled
               data-mixpanel-event-name="import_portable_package"
               data-mixpanel-extra-prop-model-name="{{ opts.verbose_name }}">
              <span title="" data-toggle="tooltip" class="label-tooltip"
                    data-original-title="Portable package import" data-html="true"
                    data-placement="left">
                <i class="process-icon-upload"></i>
              </span>
            </a>
            <form method="post" enctype="multipart/form-data" style="display: none">
                {% csrf_token %}
                <input type="file" name="import_file" data-action="form-submit">
                <button type="submit"></button>
            </form>
        {% endif %}
        <a class="list-toolbar-btn" href=".">
          <span title="" data-toggle="tooltip" class="label-tooltip" data-original-title="Refresh list" data-html="true" data-placement="left">
            <i class="process-icon-refresh "></i>
          </span>
        </a>
    </span>
{% endblock %}

{% block content %}
    <input id="id_total" class="hidden" value="{{ paginator.count|humanize_number }}">
    <table class="table tableDnD">
        <thead>
        <tr class="nodrag nodrop">
            <th scope="col">
                <div class="text"><a href="?{% for param, value in request.GET.items %}{% if param != 'o' %}&{{param}}={{value}}{% endif %}{% endfor %}">--</a></div>
                <div class="clear"></div>
            </th>

            {% for field in header %}
                <th {% include "django/forms/widgets/attrs.html" with widget=field %}>
                    <div class="text">
                    {% if field.order_field %}
                        <a href="?{{filter_params}}&o={% if field.is_ordered and not field.order_desc %}-{% endif %}{{ field.order_field }}">
                            {{ field.label|capfirst }}
                            {% if field.is_ordered %}
                                <i class="icon-caret-{% if field.order_desc %}up{% else %}down{% endif %}"></i>
                            {% endif %}
                        </a>
                    {% else %}
                        {{ field.label|capfirst }}
                    {% endif %}
                    </div>
                </th>
            {% endfor %}

            <th scope="col" class="column-result_actions">
                <div class="text">
                    <span>{% trans "Actions" %}</span>
                </div>
                <div class="clear"></div>
            </th>

        </tr>
        {% if form.non_field_errors %}
            <tr class="nodrag nodrop filter row_hover">
                <th colspan="20" class="alert alert-danger">{{ form.non_field_errors }}</th>
            </tr>
        {% endif %}
        <tr class="nodrag nodrop filter row_hover">
            <form id="search-form" action="" method="get">
                <th>
                    <span></span>
                </th>

                {% if request.GET.o %}
                    <input type="hidden" name="o" value="{{ request.GET.o }}" />
                {% endif %}

                {% for fname in fields_search_list %}
                    {% if fname in form.fields %}
                        {% for field in form %}
                            {% if fname == field.name %}
                                <th>{{ field }}</th>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <th></th>
                    {% endif %}
                {% endfor %}

                <th>
                    <button type="submit" class="btn btn-default"><i class="icon-search"></i> Search</button>
                </th>
            </form>
        </tr>
        </thead>
        <tbody>
            {% for obj in object_list %}
                {% render_list_row admin obj fields_list %}
            {% endfor %}
            <input type="hidden" name="everything-selected" value="" />
        </tbody>
    </table>
    <div class="row">
        <div class="col-lg-pull-1 pull-left">
            <div class="btn-group bulk-actions">
                <a data-toggle="dropdown" class="btn btn-default dropdown-toggle">
                    Bulk actions <span class="caret"></span>
                </a>
                <ul class="dropdown-menu">
                    <li><a href="#" data-action="select-all">
                        <i class="icon-check-sign"></i> {% if is_paginated %}Select all visible{% else %}Select all{% endif %}</a></li>
                    <li><a href="#" data-action="unselect-all">
                        <i class="icon-check-empty"></i> Unselect all</a></li>

                    {% if admin.csv_export_fields %}
                        <li>
                          <a href="export-to-csv/" data-action="{{ admin.csv_export_button_data_action }}">
                            <i class="icon-download"></i> Export selected to csv
                          </a>
                        </li>
                    {% endif %}

                    {% if can_export %}
                        <li>
                          <a href="export/"
                             data-action="link-query-params"
                             data-mixpanel-enabled
                             data-mixpanel-event-name="bulk_export_portable_package"
                             data-mixpanel-extra-prop-model-name="{{ opts.verbose_name }}">
                            <i class="icon-download"></i> Export selected to portable package
                          </a>
                        </li>

                        {% if admin.csv_template_export_view_class %}
                            <li><a href="export-template-to-csv/" data-action="link-submit">
                                <i class="icon-circle-arrow-down"></i> {{ admin.csv_template_export_title }}</a></li>
                        {% endif %}
                    {% endif %}
                    {% if can_import and admin.csv_template_import_view_class %}
                        <li>
                            <a data-action="trigger-click" data-target="input[name='import_product_csv']" class="list-toolbar-btn" href="">
                                <i class="icon-circle-arrow-up"></i> {{ admin.csv_import_title }}</a>
                            <form method="post" action="import-template-from-csv" enctype="multipart/form-data" style="display: none">
                              {% csrf_token %}
                              <input type="file" name="import_product_csv" data-action="form-submit">
                              <button type="submit"></button>
                            </form>
                          </li>
                    {% endif %}
                    <li><a href="#"
                           class="modal-confirm-click"
                           data-action="link-submit"
                           data-multiple-selector=".tableDnD input[type=checkbox]:checked"
                           data-title="Delete selected items?"
                           data-modal-number="3"
                           data-modal-type="confirm-deletion"
                           data-modal-title-1="How many items do you want to delete?"
                           data-modal-body-1="To be sure that you know what you are doing, please enter the number of items you want to delete."
                           data-modal-input-1="Number of items"
                           data-modal-cancel-msg-1="No"
                           data-modal-confirm-msg-1="Yes, delete"
                           data-modal-title-2="Incorrect value"
                           data-modal-body-2="Sorry, entered value is incorrect. Please check again."
                           data-modal-cancel-msg-2="Ok"
                           data-modal-confirm-msg-hide-2
                           data-modal-title-3="You are really going to delete [[selectedItems]] items"
                           data-modal-body-3="Are you really sure you want to delete these [[selectedItems]] items? They will be permanently deleted and cannot ever be recovered."
                           data-modal-cancel-msg-3="No!"
                           data-modal-confirm-msg-3="I am sure, go ahead"
                           data-click-after="#real-delete-link">
                        <i class="icon-trash"></i> Delete selected</a>
                        <input type="submit" name="action" value="delete_selected" data-target="selected-items" class="hide">
                        <a href="delete/"
                           id="real-delete-link"
                           data-action="link-submit"
                           data-title="Delete selected items?"
                           class="hidden">
                        </a>
                    </li>
                    {% block list_actions %}{% endblock list_actions %}
                </ul>

                <form id="bulk-action-submit-form" action="#" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="ids">
                    <input type="hidden" name="search_params">
                </form>
            </div>
        </div>
        <div class="col-lg-5 bulk-actions">
          <div>Selected <span id="selectedItemsCount">0</span> item(s).</div>
        </div>
        {% include "pbx_admin/pagination/control.html" %}
    </div>
    {% if is_paginated %}
        <div class="row bulk-actions hidden" id="selected-visible" style="margin-top: 15px">
          You have selected {{ object_list|length }} items that are displayed on this page. Do you want to <a href="#" data-action="select-all-all">select all {{ paginator.count|humanize_number }}</a> found items?
        </div>
        <div class="row bulk-actions hidden" id="selected-all" style="margin-top: 15px">
          All {{ paginator.count|humanize_number }} found items selected. <a href="#" data-action="unselect-all">Clear selection</a>.
        </div>
    {% endif %}
    {% if can_add and admin.add_modal_fields %}
        {% include 'pbx_admin/forms/modal.html' with form=add_form form_attrs=admin.add_modal_form_attrs add_button_attrs=admin.add_modal_button_attrs method='get' action='add/' id='add' title='Add' %}
    {% endif %}
    {% if admin.duplicate_modal_fields %}
        {% include 'pbx_admin/forms/modal.html' with form=duplicate_form method='get' add_button_attrs=admin.duplicate_modal_button_attrs action='duplicate/' id='duplicate' title='Duplicate' %}
    {% endif %}
{% endblock %}

{% block extra_bottom_js %}
{{ block.super }}
{% if admin.duplicate_modal_fields %}
    <script nonce="{{request.csp_nonce}}">
        $(document).ready(function() {
            initDuplicateModal('#duplicate-modal', 'a[data-target="#duplicate-modal"]');
        });
    </script>
{% endif %}

{% endblock extra_bottom_js %}
