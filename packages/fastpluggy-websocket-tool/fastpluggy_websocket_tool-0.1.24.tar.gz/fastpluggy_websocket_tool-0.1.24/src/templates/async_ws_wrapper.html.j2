{# ui_tools/extra_widget/async_ws_wrapper.html.j2 #}

<div id="async-{{ widget.widget_id }}" class="text-center">
  <div class="mb-3">
    <a href="." class="navbar-brand navbar-brand-autodark">
      <img src="/static/logo-small.svg" height="36" alt="Logo">
    </a>
  </div>
  <div class="text-secondary mb-3">Preparing widgetâ€¦</div>
  <div class="progress progress-sm">
    <div class="progress-bar progress-bar-indeterminate"></div>
  </div>
</div>

<script>
  (function() {
    const widgetId = "{{ widget.widget_id }}";
    const containerId = "async-" + widgetId;

    // Register a handler for messages of type "async_widget"
    // We assume `safeRegisterHandler` is already defined globally.
    safeRegisterHandler("async_widget", function(msg) {
      // Only process messages meant for this widget ID
      if (!msg.meta || msg.meta.widget_id !== widgetId) return;

      // Replace spinner with the real HTML payload
      document.getElementById(containerId).innerHTML = msg.meta.html;
    });
  })();
</script>
