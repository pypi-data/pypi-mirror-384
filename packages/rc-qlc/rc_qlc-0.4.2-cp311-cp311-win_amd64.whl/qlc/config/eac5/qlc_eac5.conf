# ============================================================================
# QLC EAC5 CONFIGURATION (eac5)
# ============================================================================
# This is a production-ready configuration for multi-region analysis.
#----------------------------------------------------------------------
# Source qlc base configuration
#----------------------------------------------------------------------
# Determine the path to qlc.conf relative to this file
if [ -n "${CONFIG_DIR}" ] && [ -f "${CONFIG_DIR}/../qlc.conf" ]; then
    source "${CONFIG_DIR}/../qlc.conf"
elif [ -f "$(dirname "${BASH_SOURCE[0]}")/../qlc.conf" ]; then
    # Fallback: use relative path from this script
    source "$(dirname "${BASH_SOURCE[0]}")/../qlc.conf"
else
    echo "[WARNING] Could not find qlc.conf - variable mappings may not be available"
fi

#----------------------------------------------------------------------
# Run-time definitions
#----------------------------------------------------------------------
SUBSCRIPT_NAMES=("A1" "B1a" "B2" "D1" "E1" "E2" "Z1")

# Global MARS retrievals (default for all regions unless overridden)
# Defines which model variables are available
MARS_RETRIEVALS=("K1_sfc")

#----------------------------------------------------------------------
# Common settings (apply to all regions)
#----------------------------------------------------------------------
# Name of the model being evaluated.
MODEL="IFS"
# Comma-separated list of labels for the experiments, in the same order.
# Used for plot legends. Leave empty to display exp IDs.
#EXP_LABELS="E4C,REF"
EXP_LABELS=""
# The model level to be used for analysis.
# A single integer might be provided (e.g., 9).
# If unset, the Python code will default to the surface level for all variables.
MODEL_LEVEL=""
# The specific plot type to generate.
# Leave empty for default behavior.
PLOT_TYPE=""
# The time averaging to be applied (e.g., daily, weekly, monthly, yearly).
TIME_AVERAGE="daily, weekly, monthly"
# The radius in degrees to search for model points around a station.
STATION_RADIUS_DEG=0.5
# How many stations to group into a single plot.
STATION_PLOT_GROUP_SIZE=5
# Enable or disable multiprocessing 
# (set to false = sequential processing for collocation plots)
MULTIPROCESSING=false
# Number of threads to use if multiprocessing is enabled.
N_THREADS=1
# Enable or disable debug mode.
DEBUG=false

#======================================================================
# MULTI-REGION CONFIGURATION
#======================================================================
# Enable multi-region mode for processing multiple regions in one execution
# Set to 'true' to enable, 'false' or leave unset for single-region mode (backward compatible)
#----------------------------------------------------------------------
MULTI_REGION_MODE=true

# Define which regions to process
# Leave empty to process all configured regions
#ACTIVE_REGIONS=("EU" "US_CASTNET" "US_AMON")
#ACTIVE_REGIONS=("EU" "EU_urban" "EU_rural")
#ACTIVE_REGIONS=("EU" "US_CASTNET")
ACTIVE_REGIONS=("EU" "US_CASTNET" "US_AMON" "US_AIRNOW" "Asia")

# TeX file generation mode
TEX_FILE_MODE="combined"  # "combined" or "per_region"

#----------------------------------------------------------------------
# REGION 1a: EUROPE (EBAS DAILY)
#----------------------------------------------------------------------
# European monitoring network with comprehensive species coverage
REGION_EU_NAME="EU"
REGION_EU_OBS_PATH="${QLC_HOME}/obs/data/ver0d"
REGION_EU_OBS_DATASET_TYPE="ebas_hourly"
REGION_EU_OBS_DATASET_VERSION="latest"
REGION_EU_STATION_FILE="${QLC_HOME}/config/qpy/csv/Ebas_station-locations.csv"
REGION_EU_PLOT_REGION="EU"  # (EU or Europe both work)
REGION_EU_VARIABLES="NH4_as,NH3,HNO3,NO2,SO2,O3,PM25,PM10,AOD"
REGION_EU_STATION_RADIUS_DEG=0.5  # Optional: Override global STATION_RADIUS_DEG for this region

# Optional: Region-specific MARS retrievals override
# Uncomment to use different retrievals for this region
#REGION_EU_MARS_RETRIEVALS=("B1_pl" "C1_sfc" "A3_sfc")

#----------------------------------------------------------------------
# REGION 1b: EUROPE (EBAS DAILY) -- urban stations only
#----------------------------------------------------------------------
# European monitoring network with comprehensive species coverage
REGION_EU_urban_NAME="EU"
REGION_EU_urban_OBS_PATH="${QLC_HOME}/obs/data/ver0d"
REGION_EU_urban_OBS_DATASET_TYPE="ebas_hourly"
REGION_EU_urban_OBS_DATASET_VERSION="latest"
REGION_EU_urban_STATION_FILE="${QLC_HOME}/config/qpy/csv/Ebas_station-locations-urban.csv"
REGION_EU_urban_PLOT_REGION="EU"  # (EU or Europe both work)
REGION_EU_urban_VARIABLES="NH4_as,NH3,HNO3,NO2,SO2,O3,PM25,PM10,AOD"
REGION_EU_urban_STATION_RADIUS_DEG=1.0  # Optional: Smaller radius for dense urban networks

# Optional: Region-specific MARS retrievals override
# Uncomment to use different retrievals for this region
#REGION_EU_MARS_RETRIEVALS=("B1_pl" "C1_sfc" "A3_sfc")

#----------------------------------------------------------------------
# REGION 1c: EUROPE (EBAS DAILY) -- rural stations only
#----------------------------------------------------------------------
# European monitoring network with comprehensive species coverage
REGION_EU_rural_NAME="EU"
REGION_EU_rural_OBS_PATH="${QLC_HOME}/obs/data/ver0d"
REGION_EU_rural_OBS_DATASET_TYPE="ebas_hourly"
REGION_EU_rural_OBS_DATASET_VERSION="latest"
REGION_EU_rural_STATION_FILE="${QLC_HOME}/config/qpy/csv/Ebas_station-locations-rural.csv"
REGION_EU_rural_PLOT_REGION="EU"  # (EU or Europe both work)
REGION_EU_rural_VARIABLES="NH4_as,NH3,HNO3,NO2,SO2,O3,PM25,PM10,AOD"
REGION_EU_rural_STATION_RADIUS_DEG=1.0  # Optional: Larger radius for sparse rural networks

# Optional: Region-specific MARS retrievals override
# Uncomment to use different retrievals for this region
#REGION_EU_MARS_RETRIEVALS=("B1_pl" "C1_sfc" "A3_sfc")

#----------------------------------------------------------------------
# REGION 2: UNITED STATES - CASTNET
#----------------------------------------------------------------------
# CASTNET provides weekly measurements of aerosols and select gases
# Note: NO NH3 data available in CASTNET
REGION_US_CASTNET_NAME="US_CASTNET"
REGION_US_CASTNET_OBS_PATH="${QLC_HOME}/obs/data"
REGION_US_CASTNET_OBS_DATASET_TYPE="castnet"
REGION_US_CASTNET_OBS_DATASET_VERSION="latest"
REGION_US_CASTNET_STATION_FILE="${QLC_HOME}/config/qpy/csv/Castnet_station-locations.csv"
REGION_US_CASTNET_PLOT_REGION="US"  # Matches style.py
REGION_US_CASTNET_VARIABLES="NH4_as,SO4_as,NO3_as"
REGION_US_CASTNET_STATION_RADIUS_DEG=1.0  # Optional: Larger radius for sparse CASTNET network

# Optional: Override to only retrieve NH4 for efficiency
#REGION_US_CASTNET_MARS_RETRIEVALS=("C1_sfc")

#----------------------------------------------------------------------
# REGION 3: UNITED STATES - AMoN
#----------------------------------------------------------------------
# Ammonia Monitoring Network - NH3 only
REGION_US_AMON_NAME="US_AMON"
REGION_US_AMON_OBS_PATH="${QLC_HOME}/obs/data"
REGION_US_AMON_OBS_DATASET_TYPE="AMoN"
REGION_US_AMON_OBS_DATASET_VERSION="latest"
REGION_US_AMON_STATION_FILE="${QLC_HOME}/config/qpy/csv/AMoN_station-locations.csv"
REGION_US_AMON_PLOT_REGION="US"
REGION_US_AMON_VARIABLES="NH3"
REGION_US_AMON_STATION_RADIUS_DEG=20.0  # Optional: Very sparse biweekly network

# Optional: Override to only retrieve NH3 for efficiency
#REGION_US_AMON_MARS_RETRIEVALS=("B1_pl")

#----------------------------------------------------------------------
# ADDITIONAL REGION EXAMPLES (Commented out)
#----------------------------------------------------------------------

#----------------------------------------------------------------------
# United States - AirNow (Real-time air quality)
#----------------------------------------------------------------------
REGION_US_AIRNOW_NAME="US_AIRNOW"
REGION_US_AIRNOW_OBS_PATH="${QLC_HOME}/obs/data/ver0d"
REGION_US_AIRNOW_OBS_DATASET_TYPE="airnow"
REGION_US_AIRNOW_OBS_DATASET_VERSION="latest"
REGION_US_AIRNOW_STATION_FILE="${QLC_HOME}/config/qpy/csv/AirNow_station-locations.csv"
REGION_US_AIRNOW_PLOT_REGION="US"
REGION_US_AIRNOW_VARIABLES="O3,NO2,SO2,PM25,PM10"
REGION_US_AIRNOW_STATION_RADIUS_DEG=0.5  # Optional: Dense hourly network
#REGION_US_AIRNOW_MARS_RETRIEVALS=("A3_sfc" "A4_sfc" "A1_sfc" "A2_sfc")

#----------------------------------------------------------------------
# Asia - China AQ (Chinese monitoring network)
#----------------------------------------------------------------------
REGION_Asia_NAME="Asia"
REGION_Asia_OBS_PATH="${QLC_HOME}/obs/data/ver0d"
REGION_Asia_OBS_DATASET_TYPE="china_aq"
REGION_Asia_OBS_DATASET_VERSION="latest"
REGION_Asia_STATION_FILE="${QLC_HOME}/config/qpy/csv/China-AQ_station-locations.csv"
REGION_Asia_PLOT_REGION="Asia"  # Matches style.py
REGION_Asia_VARIABLES="SO2,NO2,O3,PM25,PM10"
REGION_Asia_STATION_RADIUS_DEG=0.5  # Optional: Urban Chinese network
# Note: China AQ typically doesn't have NH3/NH4 data
#REGION_Asia_MARS_RETRIEVALS=("A3_sfc" "A4_sfc" "A1_sfc" "A2_sfc")

#----------------------------------------------------------------------
# LEGACY SINGLE-REGION SETTINGS (Backward Compatibility)
#----------------------------------------------------------------------
# These are used when MULTI_REGION_MODE=false
# Keep them for backward compatibility with existing workflows
STATION_FILE="${QLC_HOME}/config/qpy/csv/Ebas_station-locations-208101.csv"
OBS_DATA_PATH="${QLC_HOME}/obs/data/ver0d"
OBS_DATASET_TYPE="ebas_daily"
OBS_DATASET_VERSION="latest"
REGION="EU"

#======================================================================
# USAGE NOTES
#======================================================================
#
# ENABLING MULTI-REGION MODE:
# ---------------------------
# 1. Set MULTI_REGION_MODE=true above
# 2. Configure the regions you want to process
# 3. Set ACTIVE_REGIONS to list specific regions, or leave empty for all
# 4. Run qlc normally: qlc exp1 exp2 2018-12-01 2018-12-21 qpy
#
# VARIABLE FILTERING:
# -------------------
# Variables are automatically filtered based on:
# 1. MARS_RETRIEVALS (or region-specific override)
# 2. Region dataset capabilities
# 3. Actual file existence
# 
# Example: If you request NH3 for CASTNET, it will be automatically
# skipped (with a log warning) because CASTNET doesn't have NH3 data.
#
# OUTPUT STRUCTURE:
# -----------------
# Plots/exp1-exp2_DATE/
#   ├── EU/
#   │   ├── temp_qlc_D1_config.json
#   │   ├── plots/
#   │   └── texPlotfiles_qlc_D1.tex
#   ├── US_CASTNET/
#   │   └── ...
#   ├── US_AMON/
#   │   └── ...
#   └── texPlotfiles_qlc_D1_all_regions.tex (if TEX_FILE_MODE=combined)
#
# REGION NAMING:
# --------------
# Region codes (REGION_*_NAME) can be anything, but PLOT_REGION must
# match qlc-py style.py definitions:
#   - "EU" or "Europe" for Europe
#   - "US" for United States
#   - "Asia" for Asia
#   - Other values use default PlateCarree projection
#
# MARS_RETRIEVALS OVERRIDES:
# ---------------------------
# You can override MARS_RETRIEVALS per region for optimization:
#   REGION_US_AMON_MARS_RETRIEVALS=("B1_pl")  # Only NH3 for AMoN
#
# This avoids retrieving unnecessary variables for each region.
#
# STATION_RADIUS_DEG OVERRIDES:
# -----------------------------
# You can override STATION_RADIUS_DEG per region:
#   REGION_EU_urban_STATION_RADIUS_DEG=0.25   # Dense urban network
#   REGION_US_AMON_STATION_RADIUS_DEG=2.0     # Sparse biweekly network
#
# Different observation networks have different station densities:
# - Dense hourly networks (AirNow, urban EBAS): 0.25-0.5 degrees
# - Moderate networks (EBAS, CASTNET): 0.5-1.0 degrees
# - Sparse networks (AMoN biweekly): 1.0-2.0 degrees
#
# TESTING:
# --------
# Test single region first:
#   ACTIVE_REGIONS=("EU") qlc exp1 exp2 2018-12-01 2018-12-21 qpy
#
# Then test multiple regions:
#   ACTIVE_REGIONS=("EU" "US_AMON") qlc exp1 exp2 2018-12-01 2018-12-21 qpy
#
# BACKWARD COMPATIBILITY:
# -----------------------
# Set MULTI_REGION_MODE=false to use single-region mode (default)
# All existing configs will continue to work unchanged.
#
#======================================================================

