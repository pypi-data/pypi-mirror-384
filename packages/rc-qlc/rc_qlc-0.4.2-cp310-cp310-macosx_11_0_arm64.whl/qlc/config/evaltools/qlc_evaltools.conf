#----------------------------------------------------------------------
#----------------------- QLC EVALTOOLS TASK CONFIGURATION -------------
#----------------------------------------------------------------------
# This configuration is loaded when running: qlc ... evaltools
#
# Workflow:
#   1. Run qlc-py to create collocated station data (qpy task)
#   2. Run evaltools task:
#      - E1 script: Creates evaluators from qlc-py collocation
#      - E2 script: Generates evaltools plots from evaluators
#      - Z1 script: Generates final presentation PDF
#
# Usage:
#   cd ~/qlc/run
#   qlc b2ro b2rn 2018-12-01 2018-12-21 qpy       # Create collocation
#   qlc b2ro b2rn 2018-12-01 2018-12-21 evaltools # Create plots
#----------------------------------------------------------------------

#----------------------------------------------------------------------
# Source qlc base configuration
#----------------------------------------------------------------------
# Determine the path to qlc.conf relative to this file
if [ -n "${CONFIG_DIR}" ] && [ -f "${CONFIG_DIR}/../qlc.conf" ]; then
    source "${CONFIG_DIR}/../qlc.conf"
elif [ -f "$(dirname "${BASH_SOURCE[0]}")/../qlc.conf" ]; then
    # Fallback: use relative path from this script
    source "$(dirname "${BASH_SOURCE[0]}")/../qlc.conf"
else
    echo "[WARNING] Could not find qlc.conf - variable mappings may not be available"
fi
#----------------------------------------------------------------------
#----------------------- Subscripts to Run ----------------------------
#----------------------------------------------------------------------
# Define which subscripts to run for evaltools task
SUBSCRIPT_NAMES=("E1" "E2" "Z1")

#----------------------------------------------------------------------
#----------------------- Variable Definitions -------------------------
#----------------------------------------------------------------------
# Define which MARS retrievals/data to process
# These arrays map to the variables that qlc-py has already processed
#
# Format:
#   MARS_RETRIEVALS=("retrieval_name1" "retrieval_name2")
#   param_<name>=("GRIB parameter")
#   ncvar_<name>=("NetCDF variable name")
#   myvar_<name>=("Species name for output")

MARS_RETRIEVALS=("B1_pl" "C1_sfc")

# Example: NH3 from pressure levels
param_B1_pl=("19.217")
ncvar_B1_pl=("var19")
myvar_B1_pl=("NH3")

# Example: NH4 (ammonium) from surface
param_C1_sfc=("35.212")
ncvar_C1_sfc=("param35.212.192")
myvar_C1_sfc=("NH4_as")

#----------------------------------------------------------------------
#----------------------- Evaltools Settings ---------------------------
#----------------------------------------------------------------------

# Evaluator Output Configuration
EVALTOOLS_OUTPUT_DIR="${ANALYSIS_DIRECTORY}/evaluators"
EVALTOOLS_REGION="Europe"
EVALTOOLS_OUTPUT_PATTERN="{region}_{model}_{start}-{end}_{species}_{time_res}.evaluator.evaltools"

# Evaluator Processing Parameters (used by E1 script)
EVALTOOLS_FORECAST_HORIZON=1      # Lead time for model data (hours)
EVALTOOLS_AVAILABILITY_RATIO=0.25 # Minimum data availability threshold

# Conda Environment
EVALTOOLS_CONDA_ENV="evaltools"

# Debug Mode (set to 1 for verbose output)
EVALTOOLS_DEBUG=0

#----------------------------------------------------------------------
#----------------------- Export Variables -----------------------------
#----------------------------------------------------------------------
# Export variables for use by subscripts

export EVALTOOLS_OUTPUT_DIR
export EVALTOOLS_REGION
export EVALTOOLS_OUTPUT_PATTERN
export EVALTOOLS_FORECAST_HORIZON
export EVALTOOLS_AVAILABILITY_RATIO
export EVALTOOLS_CONDA_ENV
export EVALTOOLS_DEBUG

#----------------------------------------------------------------------
# END OF EVALTOOLS CONFIGURATION
#----------------------------------------------------------------------
