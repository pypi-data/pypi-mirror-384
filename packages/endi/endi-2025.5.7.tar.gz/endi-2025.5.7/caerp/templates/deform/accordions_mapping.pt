<!-- Mapping template for rendering multiple accordions -->
<tal:custom
	tal:define="style style|field.widget.style;				
				item_template item_template|field.widget.item_template;
				title title|field.title;
				errormsg errormsg|field.errormsg;
				description description|field.description;
				fields python: field.widget.accordions(field);
				top_level_fields fields[0];
				accordions fields[1];
				grid_item_template item_template|field.widget.item_template;
				default_item_template default_item_template|field.widget.default_item_template;
				"
>
	${field.start_mapping()}
	<!-- mapping -->
	<div tal:omit-tag="" tal:repeat="field top_level_fields">
		<tal:block tal:omit-tag="" tal:condition="field">
			<div tal:replace="structure field.render_template(default_item_template)" />
		</tal:block>
	</div>

	<div class='collapsible' id='mapping-${field.widget.tag_id}-accordion'>
		<div class="separate_block border_left_block"
			tal:repeat="accordion accordions.values()"
			i18n:domain="deform"
		>
			<h4 class="collapse_title title" id="${accordion['tag_id']}-heading">
				<a href='javascript:void(0);'
					onclick='toggleCollapse( this );' 
					class="${accordion['error'] and 'alert-error' or ''}"
					tal:attributes="aria-expanded 'true' if repeat.accordion.start else 'false'"
					title="${repeat.accordion.start and 'Masquer' or 'Afficher'} le contenu"
					aria-label="${repeat.accordion.start and 'Masquer' or 'Afficher'} le contenu"
				>
					<svg class="arrow"><use href="${request.static_url('caerp:static/icons/icones.svg')}#chevron-down"></use></svg>
					${accordion['name']}
				</a>
			</h4>
			<div class="collapse_content"
				tal:attributes='hidden None if repeat.accordion.start else 1'
			>
				<div class="content">
					<tal:if tal:condition="'rows' in accordion">
						<div class='panel-body' tal:define="childgroups accordion.rows" i18n:domain="deform">
							<div class="row form-row" tal:repeat="childgroup childgroups" i18n:domain="deform">
								<div tal:omit-tag="" tal:repeat="child childgroup">
									<tal:block tal:omit-tag="" tal:condition="child">
										<div tal:replace="structure child.render_template(grid_item_template)" />
									</tal:block>
								</div>
							</div>
						</div>
					</tal:if>
					<tal:if tal:condition="not 'rows' in accordion">
						<div class='panel-body' tal:define="childgroup accordion.children" i18n:domain="deform">
							<div tal:omit-tag="" tal:repeat="child childgroup">
								<tal:block tal:omit-tag="" tal:condition="child">
									<div tal:replace="structure child.render_template(default_item_template)" />
								</tal:block>
							</div>
						</div>
					</tal:if>
				</div>
			</div>
		</div>
	</div>
	<!-- /mapping -->
	${field.end_mapping()}
</tal:custom>
