"use strict";(self.webpackChunknearbeach=self.webpackChunknearbeach||[]).push([[7692],{7692:(a,e,t)=>{t.d(e,{A:()=>w});var n=t(641);const r={key:0,class:"kanban-row"},d={key:1,class:"kanban-row"};var l=t(2124),s=t(33);const i=["id","data-level","data-column"],o=["id","data-sort-number","data-card-id"],c=(0,n.Lk)("br",null,null,-1);var u=t(9336),m=t(2321),k=t(2243),p=t(432),b=t.n(p);const h={name:"KanbanColumn",components:{draggable:b(),Icon:m.In},props:{columnId:{type:Number,default:0},levelId:{type:Number,default:0},newCardInfo:{type:Array,default:()=>[]}},data:()=>({drag:!1,priorityList:["highest","high","normal","low","lowest"]}),computed:{...(0,l.L8)({allCards:"getCards",kanbanStatus:"getKanbanStatus",openCardOnLoad:"getOpenCardOnLoad",rootUrl:"getRootUrl"}),masterList(){let a=this.allCards.filter((a=>parseInt(a.fields.kanban_column)===this.columnId&&parseInt(a.fields.kanban_level)===this.levelId));return a=a.sort(((a,e)=>a.fields.kanban_card_sort_number-e.fields.kanban_card_sort_number)),a}},mixins:[k.A],methods:{checkCardOrder(){if(0===this.masterList.length)return;const a=this.masterList.map((a=>a.fields.kanban_card_sort_number)),e=Math.min.apply(null,a),t=Math.max.apply(null,a);0===e&&t===this.masterList.length-1||(document.getElementById("sort_error").style.display="flex",this.masterList.forEach(((a,e)=>{const t=new FormData;t.set("new_card_column",this.columnId.toString()),t.set("new_card_level",this.levelId.toString()),t.set("new_card_sort_number",e.toString()),t.set("old_card_column",a.fields.kanban_column),t.set("old_card_level",a.fields.kanban_level),t.set("old_card_sort_number",a.fields.kanban_card_sort_number),t.set("card_id",a.pk),this.$store.commit({type:"updateKanbanCard",card_id:a.pk,kanban_column:this.columnId,kanban_level:this.levelId,kanban_card_sort_number:e}),this.axios.post(`${this.rootUrl}kanban_information/${a.pk}/move_card/`,t)})),document.getElementById("sort_error").style.display="")},doubleClickCard(a){const e=this.masterList.filter((e=>e.pk===a.target.dataset.cardId))[0];this.sendDataUpstream(e)},isLinkedObject(a){let e="";return null!==a.fields.project&&(e="project"),null!==a.fields.requirement&&(e="requirement"),null!==a.fields.task&&(e="task"),e},sendDataUpstream(a){const e=this.isLinkedObject(a);if(e.length>0){const t=`${this.rootUrl}${e}_information/${a.fields[e]}/`;window.open(t,"_blank").focus()}else this.$store.dispatch({type:"updateCard",cardId:a.pk,cardTitle:a.fields.kanban_card_text,cardDescription:a.fields.kanban_card_description,cardColumn:a.fields.kanban_column,cardLevel:a.fields.kanban_level,cardLink:{},cardPriority:a.fields.kanban_card_priority}),new u.aF(document.getElementById("cardInformationModal")).show()},singleClickCard(a){const e=this.masterList.filter((e=>e.pk===a))[0];this.sendDataUpstream(e)}},watch:{newCardInfo(){this.columnId===this.newCardInfo[0].fields.kanban_column&&this.levelId===this.newCardInfo[0].fields.kanban_level&&this.masterList.push(this.newCardInfo[0])}},mounted(){this.masterList.filter((a=>{const e=a.pk===this.openCardOnLoad,t=0===this.isLinkedObject(a).length;return e&&t})).length>0&&this.singleClickCard(this.openCardOnLoad)}};var _=t(6262);const C=(0,_.A)(h,[["render",function(a,e,t,r,d,l){const u=(0,n.g2)("Icon");return(0,n.uX)(),(0,n.CE)("div",{class:"list-group kanban-cell",id:`kanban_cell_${t.levelId}_${t.columnId}`,"data-level":t.levelId,"data-column":t.columnId},[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(l.masterList,(t=>((0,n.uX)(),(0,n.CE)("div",{class:"list-group-item",key:t.pk,id:t.pk,"data-sort-number":t.fields.kanban_card_sort_number,"data-card-id":t.pk,onDblclick:e[0]||(e[0]=a=>l.doubleClickCard(a))},[(0,n.Lk)("div",{class:(0,s.normalizeClass)(`card-priority-line priority-${d.priorityList[t.fields.kanban_card_priority]}`)},null,2),l.isLinkedObject(t)?((0,n.uX)(),(0,n.Wv)(u,{key:0,icon:a.icons.linkOut,"data-sort-number":t.fields.kanban_card_sort_number,"data-card-id":t.pk,class:"card-external-link"},null,8,["icon","data-sort-number","data-card-id"])):(0,n.Q3)("v-if",!0),(0,n.Lk)("b",null,"#"+(0,s.toDisplayString)(t.pk),1),c,(0,n.eW)(" "+(0,s.toDisplayString)(t.fields.kanban_card_text)+" ",1),(0,n.bF)(u,{class:"kanban-card-info-icon",icon:a.icons.infoCircle,onClick:a=>l.singleClickCard(t.pk),onDblclick:a=>l.singleClickCard(t.pk)},null,8,["icon","onClick","onDblclick"])],40,o)))),128))],8,i)}]]),f=["id","data-sort-number","data-card-id","data-card-priority"],g=["data-card-id","data-sort-number","data-card-priority"],y=(0,n.Lk)("br",null,null,-1),v={class:"kanban-add-new-cards"},I={name:"kanbanColumnDraggable",components:{Icon:m.In,draggable:b()},props:{columnId:{type:Number,default:0},columnProperty:{type:String,default:"Normal"},levelId:{type:Number,default:0},newCardInfo:{type:Array,default:()=>[]}},data:()=>({drag:!1,priorityList:["highest","high","normal","low","lowest"]}),computed:{...(0,l.L8)({allCards:"getCards",canDragCards:"getCanDragCards",kanbanStatus:"getKanbanStatus",levelCollapseStatus:"getLevelCollapseStatus",openCardOnLoad:"getOpenCardOnLoad",rootUrl:"getRootUrl"}),dragOptions:()=>({animation:200,group:"description",disabled:!1,ghostClass:"ghost"}),masterList(){return this.$store.getters.getCardsOrder(this.columnId,this.levelId)}},mixins:[k.A],methods:{addNewKanbanCard(){const a=document.getElementById("addKanbanCardModal");a.dataset.kanbanLevel=this.levelId,a.dataset.kanbanColumn=this.columnId,new u.aF(a).show()},addNewLink(){const a=document.getElementById("newLinkModal");a.dataset.kanbanLevel=this.levelId,a.dataset.kanbanColumn=this.columnId,new u.aF(a).show()},archiveCards(){this.$store.commit({type:"updateArchiveDestination",column:this.columnId,level:this.levelId})},checkCardOrder(){if(0===this.masterList.length)return;const a=this.masterList.map((a=>a.fields.kanban_card_sort_number)),e=Math.min.apply(null,a),t=Math.max.apply(null,a);if(0===e&&t===this.masterList.length-1)return;document.getElementById("sort_error").style.display="flex";const n=new FormData;this.masterList.forEach(((a,e)=>{n.append("kanban_cards",a.pk),this.$store.commit({type:"updateKanbanCard",card_id:a.pk,kanban_card_sort_number:e})})),this.axios.post(`${this.rootUrl}kanban_information/fix_card_ordering/`,n).catch((a=>{this.$store.dispatch("newToast",{header:"Failed to move card",message:`Sorry, we could not move your card. Error -> ${a}`,extra_classes:"bg-danger",delay:0})})),document.getElementById("sort_error").style.display=""},doubleClickCard(a){const e=this.masterList.filter((e=>parseInt(e.pk)===parseInt(a.target.dataset.cardId)))[0];this.sendDataUpstream(e)},isLinkedObject(a){let e="";return null!==a.fields.project&&(e="project"),null!==a.fields.requirement&&(e="requirement"),null!==a.fields.task&&(e="task"),e},async onEnd(a){await this.$store.dispatch("kanbanCardMoved",{event:a});const e=a.to,t=a.from,n=a.item.dataset.cardId;let r=e.dataset.column,d=e.dataset.level,l=(a.newIndex,t.dataset.column),s=t.dataset.level,i=(a.oldIndex,e.dataset.columnProperty);const o=new FormData;o.set("new_card_column",r),o.set("new_card_level",d),this.$store.getters.getCardsOrder(r,d).forEach((a=>{o.append("new_destination",a.pk)})),this.$store.getters.getCardsOrder(l,s).forEach((a=>{o.append("old_destination",a.pk)})),this.axios.post(`${this.rootUrl}kanban_information/${n}/move_card/`,o).then((()=>{"Blocked"===i&&(this.$store.commit({type:"updateValue",field:"cardId",value:parseInt(n)}),new u.aF(document.getElementById("blockedNotesModal")).show())})).catch((a=>{this.$store.dispatch("newToast",{header:"Can not update Card",message:`Sorry, moving the card had an error. Error -> ${a}`,extra_classes:"bg-danger",delay:0})}))},sendDataUpstream(a){const e=this.isLinkedObject(a);if(e.length>0){const t=`${this.rootUrl}${e}_information/${a.fields[e]}/`;window.open(t,"_blank").focus()}else this.$store.dispatch({type:"updateCard",cardId:a.pk,cardTitle:a.fields.kanban_card_text,cardDescription:a.fields.kanban_card_description,cardColumn:a.fields.kanban_column,cardLevel:a.fields.kanban_level,cardLink:{},cardPriority:a.fields.kanban_card_priority}),new u.aF(document.getElementById("cardInformationModal")).show()},singleClickCard(a){const e=this.masterList.filter((e=>e.pk===a))[0];this.sendDataUpstream(e)}},watch:{newCardInfo(){this.columnId===this.newCardInfo[0].fields.kanban_column&&this.levelId===this.newCardInfo[0].fields.kanban_level&&this.masterList.push(this.newCardInfo[0])}},mounted(){this.checkCardOrder(),this.masterList.filter((a=>{const e=a.pk===this.openCardOnLoad,t=0===this.isLinkedObject(a).length;return e&&t})).length>0&&this.singleClickCard(this.openCardOnLoad)}},L={name:"KanbanRow",components:{KanbanColumn:C,KanbanColumnDraggable:(0,_.A)(I,[["render",function(a,e,t,r,d,l){const i=(0,n.g2)("Icon"),o=(0,n.g2)("draggable");return a.levelCollapseStatus(t.levelId)?(0,n.Q3)("v-if",!0):((0,n.uX)(),(0,n.Wv)(o,{key:0,class:"list-group kanban-cell",id:`kanban_cell_${t.levelId}_${t.columnId}`,"data-level":t.levelId,"data-column":t.columnId,"data-column-property":t.columnProperty,animation:200,disabled:"Closed"===a.kanbanStatus||!a.canDragCards,group:"tasks","ghost-class":"ghost",onEnd:e[4]||(e[4]=a=>l.onEnd(a)),modelValue:l.masterList,"onUpdate:modelValue":e[5]||(e[5]=a=>l.masterList=a),"item-key":"pk"},(0,n.eX)({item:(0,n.k6)((({element:t})=>[((0,n.uX)(),(0,n.CE)("div",{class:"list-group-item",key:t.pk,id:t.pk,"data-sort-number":t.fields.kanban_card_sort_number,"data-card-id":t.pk,"data-card-priority":t.fields.kanban_card_priority,onDblclick:e[0]||(e[0]=a=>l.doubleClickCard(a))},[(0,n.Lk)("div",{class:(0,s.normalizeClass)(`card-priority-line priority-${d.priorityList[t.fields.kanban_card_priority]}`),"data-card-id":t.pk,"data-sort-number":t.fields.kanban_card_sort_number,"data-card-priority":t.fields.kanban_card_priority},null,10,g),l.isLinkedObject(t).length>0?((0,n.uX)(),(0,n.Wv)(i,{key:0,icon:a.icons.linkOut,"data-card-id":t.pk,"data-sort-number":t.fields.kanban_card_sort_number,"data-card-priority":t.fields.kanban_card_priority,class:"card-external-link"},null,8,["icon","data-card-id","data-sort-number","data-card-priority"])):(0,n.Q3)("v-if",!0),(0,n.Lk)("b",null,"#"+(0,s.toDisplayString)(t.pk),1),y,(0,n.eW)(" "+(0,s.toDisplayString)(t.fields.kanban_card_text)+" ",1),(0,n.bF)(i,{class:"kanban-card-info-icon",icon:a.icons.infoCircle,onClick:a=>l.singleClickCard(t.pk),onDblclick:a=>l.singleClickCard(t.pk)},null,8,["icon","onClick","onDblclick"])],40,f))])),_:2},["Closed"!==a.kanbanStatus?{name:"footer",fn:(0,n.k6)((()=>[(0,n.Lk)("div",v,["Closed"!==t.columnProperty?((0,n.uX)(),(0,n.CE)("a",{key:0,class:"kanban-link btn btn-primary",href:"javascript:void(0)",onClick:e[1]||(e[1]=(...a)=>l.addNewKanbanCard&&l.addNewKanbanCard(...a))}," New Card ")):(0,n.Q3)("v-if",!0),"Closed"!==t.columnProperty?((0,n.uX)(),(0,n.CE)("a",{key:1,class:"kanban-link btn btn-warning",href:"javascript:void(0)",onClick:e[2]||(e[2]=(...a)=>l.addNewLink&&l.addNewLink(...a))}," Link Object ")):(0,n.Q3)("v-if",!0),l.masterList.length>0?((0,n.uX)(),(0,n.CE)("a",{key:2,class:"kanban-link btn btn-danger",href:"javascript:void(0)",onClick:e[3]||(e[3]=(...a)=>l.archiveCards&&l.archiveCards(...a))}," Archive Cards ")):(0,n.Q3)("v-if",!0)])])),key:"0"}:void 0]),1032,["id","data-level","data-column","data-column-property","disabled","modelValue"]))}]])},props:{levelId:{type:Number,default:0},newCardInfo:{type:Array,default:()=>[]}},computed:{...(0,l.L8)({columnResults:"getColumnResults",userLevel:"getUserLevel"})},methods:{doubleClickedCard(a){this.$emit("double_clicked_card",a)}}},w=(0,_.A)(L,[["render",function(a,e,t,l,s,i){const o=(0,n.g2)("kanban-column-draggable"),c=(0,n.g2)("kanban-column");return a.userLevel>1?((0,n.uX)(),(0,n.CE)("div",r,[(0,n.Q3)(" Users can edit kanban board - can drag "),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.columnResults,(a=>((0,n.uX)(),(0,n.Wv)(o,{key:a.pk,"level-id":t.levelId,"column-id":a.pk,"column-property":a.fields.kanban_column_property,"new-card-info":t.newCardInfo,onDouble_clicked_card:e[0]||(e[0]=a=>i.doubleClickedCard(a))},null,8,["level-id","column-id","column-property","new-card-info"])))),128))])):((0,n.uX)(),(0,n.CE)("div",d,[(0,n.Q3)(" Read Only Users "),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.columnResults,(a=>((0,n.uX)(),(0,n.Wv)(c,{key:a.pk,"level-id":t.levelId,"column-id":a.pk,"new-card-info":t.newCardInfo,onDouble_clicked_card:e[1]||(e[1]=a=>i.doubleClickedCard(a))},null,8,["level-id","column-id","new-card-info"])))),128))]))}]])}}]);