"use strict";(self.webpackChunknearbeach=self.webpackChunknearbeach||[]).push([[676],{676:(e,a,t)=>{t.d(a,{Z:()=>O});var n=t(6252);const r={key:0,class:"kanban-row"},d={key:1,class:"kanban-row"};var l=t(989),i=t(3577);const s=["id","data-level","data-column"],o=["id","data-sort-number","data-card-id"],c=(0,n._)("br",null,null,-1);var u=t(3138),m=t(6542),p=t(5808),k=t(9980),b=t.n(k);const h={name:"KanbanColumn",components:{draggable:b(),Icon:m.JO},props:{columnId:{type:Number,default:0},levelId:{type:Number,default:0},newCardInfo:{type:Array,default:()=>[]}},data:()=>({drag:!1,priorityList:["highest","high","normal","low","lowest"]}),computed:{...(0,l.Se)({allCards:"getCards",kanbanStatus:"getKanbanStatus",openCardOnLoad:"getOpenCardOnLoad",rootUrl:"getRootUrl"}),masterList(){let e=this.allCards.filter((e=>parseInt(e.fields.kanban_column)===this.columnId&&parseInt(e.fields.kanban_level)===this.levelId));return e=e.sort(((e,a)=>e.fields.kanban_card_sort_number-a.fields.kanban_card_sort_number)),e}},mixins:[p.Z],methods:{checkCardOrder(){if(0===this.masterList.length)return;const e=this.masterList.map((e=>e.fields.kanban_card_sort_number)),a=Math.min.apply(null,e),t=Math.max.apply(null,e);0===a&&t===this.masterList.length-1||(document.getElementById("sort_error").style.display="flex",this.masterList.forEach(((e,a)=>{const t=new FormData;t.set("new_card_column",this.columnId.toString()),t.set("new_card_level",this.levelId.toString()),t.set("new_card_sort_number",a.toString()),t.set("old_card_column",e.fields.kanban_column),t.set("old_card_level",e.fields.kanban_level),t.set("old_card_sort_number",e.fields.kanban_card_sort_number),t.set("card_id",e.pk),this.$store.commit({type:"updateKanbanCard",card_id:e.pk,kanban_column:this.columnId,kanban_level:this.levelId,kanban_card_sort_number:a}),this.axios.post(`${this.rootUrl}kanban_information/${e.pk}/move_card/`,t)})),document.getElementById("sort_error").style.display="")},doubleClickCard(e){const a=this.masterList.filter((a=>a.pk===e.target.dataset.cardId))[0];this.sendDataUpstream(a)},isLinkedObject(e){let a="";return null!==e.fields.project&&(a="project"),null!==e.fields.requirement&&(a="requirement"),null!==e.fields.task&&(a="task"),a},sendDataUpstream(e){const a=this.isLinkedObject(e);if(a.length>0){const t=`${this.rootUrl}${a}_information/${e.fields[a]}/`;window.open(t,"_blank").focus()}else this.$store.dispatch({type:"updateCard",cardId:e.pk,cardTitle:e.fields.kanban_card_text,cardDescription:e.fields.kanban_card_description,cardColumn:e.fields.kanban_column,cardLevel:e.fields.kanban_level,cardLink:{},cardPriority:e.fields.kanban_card_priority}),new u.u_(document.getElementById("cardInformationModal")).show()},singleClickCard(e){const a=this.masterList.filter((a=>a.pk===e))[0];this.sendDataUpstream(a)}},watch:{newCardInfo(){this.columnId===this.newCardInfo[0].fields.kanban_column&&this.levelId===this.newCardInfo[0].fields.kanban_level&&this.masterList.push(this.newCardInfo[0])}},mounted(){this.masterList.filter((e=>{const a=e.pk===this.openCardOnLoad,t=0===this.isLinkedObject(e).length;return a&&t})).length>0&&this.singleClickCard(this.openCardOnLoad)}};var _=t(3744);const g=(0,_.Z)(h,[["render",function(e,a,t,r,d,l){const u=(0,n.up)("Icon");return(0,n.wg)(),(0,n.iD)("div",{class:"list-group kanban-cell",id:`kanban_cell_${t.levelId}_${t.columnId}`,"data-level":t.levelId,"data-column":t.columnId},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(l.masterList,(t=>((0,n.wg)(),(0,n.iD)("div",{class:"list-group-item",key:t.pk,id:t.pk,"data-sort-number":t.fields.kanban_card_sort_number,"data-card-id":t.pk,onDblclick:a[0]||(a[0]=e=>l.doubleClickCard(e))},[(0,n._)("div",{class:(0,i.normalizeClass)(`card-priority-line priority-${d.priorityList[t.fields.kanban_card_priority]}`)},null,2),l.isLinkedObject(t)?((0,n.wg)(),(0,n.j4)(u,{key:0,icon:e.icons.linkOut,"data-sort-number":t.fields.kanban_card_sort_number,"data-card-id":t.pk,class:"card-external-link"},null,8,["icon","data-sort-number","data-card-id"])):(0,n.kq)("v-if",!0),(0,n._)("b",null,"#"+(0,i.toDisplayString)(t.pk),1),c,(0,n.Uk)(" "+(0,i.toDisplayString)(t.fields.kanban_card_text)+" ",1),(0,n.Wm)(u,{class:"kanban-card-info-icon",icon:e.icons.infoCircle,onClick:e=>l.singleClickCard(t.pk),onDblclick:e=>l.singleClickCard(t.pk)},null,8,["icon","onClick","onDblclick"])],40,o)))),128))],8,s)}]]),f=["id","data-sort-number","data-card-id","data-card-priority"],C=["data-card-id","data-sort-number","data-card-priority"],y=(0,n._)("br",null,null,-1),v=(0,n._)("br",null,null,-1),w={key:1,style:{"font-weight":"lighter"}},I={key:2,style:{"font-weight":"lighter"}},L={class:"kanban-add-new-cards"},D={name:"kanbanColumnDraggable",components:{Icon:m.JO,draggable:b()},props:{columnId:{type:Number,default:0},columnProperty:{type:String,default:"Normal"},levelId:{type:Number,default:0},newCardInfo:{type:Array,default:()=>[]}},data:()=>({drag:!1,priorityList:["highest","high","normal","low","lowest"]}),computed:{...(0,l.Se)({allCards:"getCards",canDragCards:"getCanDragCards",kanbanStatus:"getKanbanStatus",levelCollapseStatus:"getLevelCollapseStatus",openCardOnLoad:"getOpenCardOnLoad",rootUrl:"getRootUrl"}),dragOptions:()=>({animation:200,group:"description",disabled:!1,ghostClass:"ghost"}),masterList(){return this.$store.getters.getCardsOrder(this.columnId,this.levelId)}},mixins:[p.Z],methods:{addNewKanbanCard(){this.$store.commit({type:"updateNewCardLocation",columnId:this.columnId,levelId:this.levelId,userCanSelectLocation:!1}),new u.u_(document.getElementById("addKanbanCardModal")).show()},addNewLink(){this.$store.commit({type:"updateNewCardLocation",columnId:this.columnId,levelId:this.levelId,userCanSelectLocation:!1}),new u.u_(document.getElementById("newLinkModal")).show()},archiveCards(){this.$store.commit({type:"updateArchiveDestination",column:this.columnId,level:this.levelId})},checkCardOrder(){if(0===this.masterList.length)return;const e=this.masterList.map((e=>e.fields.kanban_card_sort_number)),a=Math.min.apply(null,e),t=Math.max.apply(null,e);if(0===a&&t===this.masterList.length-1)return;document.getElementById("sort_error").style.display="flex";const n=new FormData;this.masterList.forEach(((e,a)=>{n.append("kanban_cards",e.pk),this.$store.commit({type:"updateKanbanCard",card_id:e.pk,kanban_card_sort_number:a})})),this.axios.post(`${this.rootUrl}kanban_information/fix_card_ordering/`,n).catch((e=>{this.$store.dispatch("newToast",{header:"Failed to move card",message:`Sorry, we could not move your card. Error -> ${e}`,extra_classes:"bg-danger",delay:0})})),document.getElementById("sort_error").style.display=""},doubleClickCard(e){const a=this.masterList.filter((a=>parseInt(a.pk)===parseInt(e.target.dataset.cardId)))[0];this.sendDataUpstream(a)},isLinkedObject(e){let a="";return null!==e.fields.project&&(a="project"),null!==e.fields.requirement&&(a="requirement"),null!==e.fields.task&&(a="task"),a},async onEnd(e){await this.$store.dispatch("kanbanCardMoved",{event:e});const a=e.to,t=e.from,n=e.item.dataset.cardId;let r=a.dataset.column,d=a.dataset.level,l=(e.newIndex,t.dataset.column),i=t.dataset.level,s=(e.oldIndex,a.dataset.columnProperty);const o=new FormData;o.set("new_card_column",r),o.set("new_card_level",d),this.$store.getters.getCardsOrder(r,d).forEach((e=>{o.append("new_destination",e.pk)})),this.$store.getters.getCardsOrder(l,i).forEach((e=>{o.append("old_destination",e.pk)})),this.axios.post(`${this.rootUrl}kanban_information/${n}/move_card/`,o).then((()=>{"Blocked"===s&&(this.$store.commit({type:"updateValue",field:"cardId",value:parseInt(n)}),new u.u_(document.getElementById("blockedNotesModal")).show())})).catch((e=>{this.$store.dispatch("newToast",{header:"Can not update Card",message:`Sorry, moving the card had an error. Error -> ${e}`,extra_classes:"bg-danger",delay:0})}))},sendDataUpstream(e){const a=this.isLinkedObject(e);if(a.length>0){const t=`${this.rootUrl}${a}_information/${e.fields[a]}/`;window.open(t,"_blank").focus()}else this.$store.dispatch({type:"updateCard",cardId:e.pk,cardTitle:e.fields.kanban_card_text,cardDescription:e.fields.kanban_card_description,cardColumn:e.fields.kanban_column,cardLevel:e.fields.kanban_level,cardLink:{},cardPriority:e.fields.kanban_card_priority}),new u.u_(document.getElementById("cardInformationModal")).show()},singleClickCard(e){const a=this.masterList.filter((a=>a.pk===e))[0];this.sendDataUpstream(a)}},watch:{newCardInfo(){this.columnId===this.newCardInfo[0].fields.kanban_column&&this.levelId===this.newCardInfo[0].fields.kanban_level&&this.masterList.push(this.newCardInfo[0])}},mounted(){this.checkCardOrder(),this.masterList.filter((e=>{const a=e.pk===this.openCardOnLoad,t=0===this.isLinkedObject(e).length;return a&&t})).length>0&&this.singleClickCard(this.openCardOnLoad)}},$={name:"KanbanRow",components:{KanbanColumn:g,KanbanColumnDraggable:(0,_.Z)(D,[["render",function(e,a,t,r,d,l){const s=(0,n.up)("Icon"),o=(0,n.up)("draggable");return e.levelCollapseStatus(t.levelId)?(0,n.kq)("v-if",!0):((0,n.wg)(),(0,n.j4)(o,{key:0,class:"list-group kanban-cell",id:`kanban_cell_${t.levelId}_${t.columnId}`,"data-level":t.levelId,"data-column":t.columnId,"data-column-property":t.columnProperty,animation:200,disabled:"Closed"===e.kanbanStatus||!e.canDragCards,group:"tasks","ghost-class":"ghost",onEnd:a[4]||(a[4]=e=>l.onEnd(e)),modelValue:l.masterList,"onUpdate:modelValue":a[5]||(a[5]=e=>l.masterList=e),"item-key":"pk"},(0,n.Nv)({item:(0,n.w5)((({element:t})=>[((0,n.wg)(),(0,n.iD)("div",{class:"list-group-item",key:t.pk,id:t.pk,"data-sort-number":t.fields.kanban_card_sort_number,"data-card-id":t.pk,"data-card-priority":t.fields.kanban_card_priority,onDblclick:a[0]||(a[0]=e=>l.doubleClickCard(e))},[(0,n._)("div",{class:(0,i.normalizeClass)(`card-priority-line priority-${d.priorityList[t.fields.kanban_card_priority]}`),"data-card-id":t.pk,"data-sort-number":t.fields.kanban_card_sort_number,"data-card-priority":t.fields.kanban_card_priority},null,10,C),l.isLinkedObject(t).length>0?((0,n.wg)(),(0,n.j4)(s,{key:0,icon:e.icons.linkOut,"data-card-id":t.pk,"data-sort-number":t.fields.kanban_card_sort_number,"data-card-priority":t.fields.kanban_card_priority,class:"card-external-link"},null,8,["icon","data-card-id","data-sort-number","data-card-priority"])):(0,n.kq)("v-if",!0),(0,n._)("b",null,"#"+(0,i.toDisplayString)(t.pk),1),y,(0,n.Uk)(" "+(0,i.toDisplayString)(t.fields.kanban_card_text)+" ",1),v,e.canDragCards?((0,n.wg)(),(0,n.iD)("span",I,"   ")):((0,n.wg)(),(0,n.iD)("span",w,"- Movement Locked!")),(0,n.Wm)(s,{class:"kanban-card-info-icon",icon:e.icons.infoCircle,onClick:e=>l.singleClickCard(t.pk),onDblclick:e=>l.singleClickCard(t.pk)},null,8,["icon","onClick","onDblclick"])],40,f))])),_:2},["Closed"!==e.kanbanStatus?{name:"footer",fn:(0,n.w5)((()=>[(0,n._)("div",L,["Closed"!==t.columnProperty?((0,n.wg)(),(0,n.iD)("a",{key:0,class:"kanban-link btn btn-primary",href:"javascript:void(0)",onClick:a[1]||(a[1]=(...e)=>l.addNewKanbanCard&&l.addNewKanbanCard(...e))}," New Card ")):(0,n.kq)("v-if",!0),"Closed"!==t.columnProperty?((0,n.wg)(),(0,n.iD)("a",{key:1,class:"kanban-link btn btn-warning",href:"javascript:void(0)",onClick:a[2]||(a[2]=(...e)=>l.addNewLink&&l.addNewLink(...e))}," Link Object ")):(0,n.kq)("v-if",!0),l.masterList.length>0?((0,n.wg)(),(0,n.iD)("a",{key:2,class:"kanban-link btn btn-danger",href:"javascript:void(0)",onClick:a[3]||(a[3]=(...e)=>l.archiveCards&&l.archiveCards(...e))}," Archive Cards ")):(0,n.kq)("v-if",!0)])])),key:"0"}:void 0]),1032,["id","data-level","data-column","data-column-property","disabled","modelValue"]))}]])},props:{levelId:{type:Number,default:0},newCardInfo:{type:Array,default:()=>[]}},computed:{...(0,l.Se)({columnResults:"getColumnResults",userLevel:"getUserLevel"})},methods:{doubleClickedCard(e){this.$emit("double_clicked_card",e)}}},O=(0,_.Z)($,[["render",function(e,a,t,l,i,s){const o=(0,n.up)("kanban-column-draggable"),c=(0,n.up)("kanban-column");return e.userLevel>1?((0,n.wg)(),(0,n.iD)("div",r,[(0,n.kq)(" Users can edit kanban board - can drag "),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.columnResults,(e=>((0,n.wg)(),(0,n.j4)(o,{key:e.pk,"level-id":t.levelId,"column-id":e.pk,"column-property":e.fields.kanban_column_property,"new-card-info":t.newCardInfo,onDouble_clicked_card:a[0]||(a[0]=e=>s.doubleClickedCard(e))},null,8,["level-id","column-id","column-property","new-card-info"])))),128))])):((0,n.wg)(),(0,n.iD)("div",d,[(0,n.kq)(" Read Only Users "),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.columnResults,(e=>((0,n.wg)(),(0,n.j4)(c,{key:e.pk,"level-id":t.levelId,"column-id":e.pk,"new-card-info":t.newCardInfo,onDouble_clicked_card:a[1]||(a[1]=e=>s.doubleClickedCard(e))},null,8,["level-id","column-id","new-card-info"])))),128))]))}]])}}]);