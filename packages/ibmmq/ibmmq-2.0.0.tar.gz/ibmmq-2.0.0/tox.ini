[flake8]
max-line-length=160
exclude=*CMQ*

# A minimal set of flake8 diagnostics that we choose to ignore
#
# E302 expected 2 blank lines
# W503 line break before binary operator
# W504 line break after binary operator
# F403 ‘from module import *’ used; unable to detect undefined names
# F405 <function> may be undefined, or defined from star imports
ignore=E302,
       W503, W504,
       F403, F405

# Some extra diagnostics that we choose to ignore on a per-file basis.
per-file-ignores=
      # Ignore the unused imports in _init__.py as they are there
      # to be available in other modules
      __init__.py: F401
      mqinq.py: E241
      # The unittest programs can be a bit more lax
      config.py: E123
      test_rfh2.py: E128, E501
      test_setup.py: F401
      test_*.py: E123,E127,E501

# This section sets up the unittest environment
[testenv]
deps =
    -rcode/tests/requirements.txt
    pytest-cov

# "-x" means stop process after first failure
# I can't get the coverage stats to include all the files, maybe
# there's some magic. But I'm leaving the execution in here for now and
# will look again later.
commands =
    pytest -x code/tests/ {posargs}
#    pytest -x --cov=ibmmq --cov-config=code/tests/coveragerc code/tests/

# Common settings for Docker and local test environments
setenv =
   PY_IBMMQ_QM_NAME = QM1
   PY_IBMMQ_QM_HOST = localhost
   PY_IBMMQ_QM_TRANSPORT = TCP

   PY_IBMMQ_QM_CHANNEL = DEV.ADMIN.SVRCONN
   PY_IBMMQ_QM_USER = admin
   PY_IBMMQ_QM_PASSWORD = password

   PY_IBMMQ_QM_APP_CHANNEL = DEV.APP.SVRCONN
   PY_IBMMQ_QM_APP_USER = app
   PY_IBMMQ_QM_APP_PASSWORD = password

   PY_IBMMQ_QUEUE_PREFIX = PYTEST
   PY_IBMMQ_QM_CONNAUTH_SUPPORTED = 1
   PY_IBMMQ_QM_CONNAUTH_USE_PW = REQUIRED

[testenv:local]
setenv =
   PY_IBMMQ_QM_PORT = 1413

[testenv:container]
# Environment for testing with image icr.io/ibm-messaging/mq
setenv =
   PY_IBMMQ_QM_PORT = 1413

passenv =
   PY_IBMMQ_TLS_SKIP
   PY_IBMMQ_TLS_KEY_REPO_LOCATION_QMGR
   PY_IBMMQ_TLS_KEY_REPO_LOCATION_CLIENT
