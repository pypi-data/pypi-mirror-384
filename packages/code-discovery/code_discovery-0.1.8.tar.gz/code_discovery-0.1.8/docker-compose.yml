version: '3.8'

services:
  code-discovery:
    build: .
    image: code-discovery:latest
    container_name: code-discovery
    volumes:
      # Mount the repository you want to analyze
      - ./sample-repo:/workspace:ro
      # Mount config file
      - ./.codediscovery.yml:/app/.codediscovery.yml:ro
      # Mount output directory
      - ./output:/output
    environment:
      - API_DISCOVERY_TOKEN=${API_DISCOVERY_TOKEN:-}
    command: ["--repo-path", "/workspace", "--output", "/output/openapi-spec.yaml"]

  # Optional: Run as a service with file watcher
  code-discovery-watch:
    build: .
    image: code-discovery:latest
    container_name: code-discovery-watch
    volumes:
      - ./sample-repo:/workspace:ro
      - ./.codediscovery.yml:/app/.codediscovery.yml:ro
      - ./output:/output
    environment:
      - API_DISCOVERY_TOKEN=${API_DISCOVERY_TOKEN:-}
    # Add inotify for file watching in future enhancement
    command: ["--repo-path", "/workspace", "--output", "/output/openapi-spec.yaml", "--dry-run"]
    profiles:
      - watch

