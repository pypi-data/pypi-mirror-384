# ------------------------------------------------------------------------------
$schema: https://json-schema.org/draft/2020-12/schema

$defs:
  string1:
    type: string
    minLength: 1
  string_or_stringlist:
    oneOf:
      - $ref: '#/$defs/string1'
      - type: array
        items:
          $ref: '#/$defs/string1'

title: Docma configuration file schema

type: object

required:
  - id
  - description
  - owner
  - version
  - documents

properties:
  id:
    type: string
    pattern: '^[a-zA-Z][a-zA-Z0-9-_+=.]+[a-zA-Z0-9]$'
  description:
    $ref: '#/$defs/string1'
  owner:
    $ref: '#/$defs/string1'
  version:
    type: string
    format: semantic_version

  documents:
    description: A list of documents to assemble.
    type: array
    minItems: 1
    items:
      oneOf:
        - $ref: '#/$defs/string1'
        - type: object
          description: Complex document reference
          required:
            - src
          additionalProperties: false
          properties:
            src:
              $ref: '#/$defs/string1'
            if:
              $ref: '#/$defs/string1'

  overlays:
    description: Overlay document specifications for watermarks and stamps
    type: object
    additionalProperties:
      $ref: '#/$defs/string_or_stringlist'

  imports:
    description: External files to import
    type: array
    items:
      oneOf:
        - type: object
          required:
            - src
            - as
          additionalProperties: false
          properties:
            src:
              $ref: '#/$defs/string1'
            as:
              $ref: '#/$defs/string1'
        - $ref: '#/$defs/string1'

  options:
    description: >-
      Weasyprint options.
      See https://doc.courtbouillon.org/weasyprint/stable/api_reference.html#weasyprint.DEFAULT_OPTIONS
    type: object
    properties:
      stylesheets:
        type: array
        items:
          $ref: '#/$defs/string1'

  parameters:
    description: Parameter specifications for rendering.
    type: object
    additionalProperties: false
    properties:
      defaults:
        description: Default values for parameters.
        type: object
        properties:
          locale:
            description: Locale (e.g. en_AU)
            $ref: '#/$defs/string1'
            format: locale

      schema:
        description: Reserved for now
        type: object

  # For now, we allow the PDF (/Author) and HTML (author) variants. In future
  # we'll only support HTML as docma will adapt to the target format.
  metadata:
    description: PDF metadata
    type: object
    additionalProperties: false
    properties:
      author:
        $ref: '#/$defs/string1'
      /Author:
        $ref: '#/$defs/string1'
      subject:
        $ref: '#/$defs/string1'
      /Subject:
        $ref: '#/$defs/string1'
      title:
        $ref: '#/$defs/string1'
      /Title:
        $ref: '#/$defs/string1'
      keywords:
        $ref: '#/$defs/string_or_stringlist'
      /Keywords:
        $ref: '#/$defs/string_or_stringlist'
    not:
      anyOf:
        - required: [ author, /Author ]
        - required: [ title, /Title ]
        - required: [ subject, /Subject ]
        - required: [ keywords, /Keywords ]
