Metadata-Version: 2.4
Name: quantlabs
Version: 0.2.0
Summary: Professional quantitative trading research platform with ML-powered backtesting, multi-source options analysis, portfolio management, and interactive Plotly visualizations
Project-URL: Homepage, https://github.com/nittygritty-zzy/quantlab
Project-URL: Documentation, https://quantlabs.readthedocs.io
Project-URL: Repository, https://github.com/nittygritty-zzy/quantlab
Project-URL: Bug Tracker, https://github.com/nittygritty-zzy/quantlab/issues
Project-URL: Changelog, https://github.com/nittygritty-zzy/quantlab/releases
Author-email: QuantLab Team <quantlab@example.com>
Maintainer-email: QuantLab Team <quantlab@example.com>
License: MIT
License-File: LICENSE
Keywords: algorithmic-trading,backtesting,data-visualization,financial-analysis,machine-learning,options-trading,portfolio-management,qlib,quantitative-finance
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: Intended Audience :: Financial and Insurance Industry
Classifier: Intended Audience :: Science/Research
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Topic :: Office/Business :: Financial :: Investment
Classifier: Topic :: Scientific/Engineering :: Information Analysis
Requires-Python: >=3.8
Requires-Dist: click>=8.0.0
Requires-Dist: duckdb>=0.9.0
Requires-Dist: numpy>=1.24.0
Requires-Dist: pandas>=2.0.0
Requires-Dist: plotly>=5.18.0
Requires-Dist: polygon-api-client>=1.12.0
Requires-Dist: pyyaml>=6.0
Requires-Dist: requests>=2.31.0
Requires-Dist: scipy>=1.10.0
Requires-Dist: tabulate>=0.9.0
Requires-Dist: yfinance>=0.2.0
Provides-Extra: dev
Requires-Dist: black>=23.0.0; extra == 'dev'
Requires-Dist: myst-parser>=3.0.1; extra == 'dev'
Requires-Dist: pytest-cov>=5.0.0; extra == 'dev'
Requires-Dist: pytest>=7.0.0; extra == 'dev'
Requires-Dist: ruff>=0.1.0; extra == 'dev'
Requires-Dist: sphinx-autodoc-typehints>=2.0.1; extra == 'dev'
Requires-Dist: sphinx-rtd-theme>=3.0.2; extra == 'dev'
Requires-Dist: sphinx>=7.1.2; extra == 'dev'
Requires-Dist: sphinxcontrib-napoleon>=0.7; extra == 'dev'
Description-Content-Type: text/markdown

# QuantLab - Quantitative Trading Research Platform

[![Documentation Status](https://readthedocs.org/projects/quantlabs/badge/?version=latest)](https://quantlabs.readthedocs.io/en/latest/?badge=latest)
[![Python Version](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Release](https://img.shields.io/github/v/release/nittygritty-zzy/quantlab)](https://github.com/nittygritty-zzy/quantlab/releases)

A quantitative trading research platform powered by Microsoft's Qlib, designed for systematic alpha generation and backtesting.

ğŸ“š **[Full Documentation](https://quantlabs.readthedocs.io)** | ğŸš€ **[Quick Start Guide](https://quantlabs.readthedocs.io/en/latest/quickstart.html)** | ğŸ“– **[API Reference](https://quantlabs.readthedocs.io/en/latest/api/core.html)**

## ğŸ“ Project Structure

```
quantlab/
â”œâ”€â”€ README.md                       # This file
â”œâ”€â”€ .gitignore                      # Git ignore rules
â”œâ”€â”€ .venv/                          # Python virtual environment (uv)
â”‚
â”œâ”€â”€ docs/                           # Documentation
â”‚   â”œâ”€â”€ BACKTEST_SUMMARY.md         # Backtest results analysis
â”‚   â”œâ”€â”€ ALPHA158_SUMMARY.md         # Alpha158 features documentation
â”‚   â”œâ”€â”€ ALPHA158_CORRECTED.md       # Alpha158 corrections
â”‚   â”œâ”€â”€ USE_QLIB_ALPHA158.md        # Guide for using Alpha158
â”‚   â””â”€â”€ QUANTMINI_README.md         # QuantMini data setup
â”‚
â”œâ”€â”€ scripts/                        # Utility scripts
â”‚   â”œâ”€â”€ data/                       # Data processing
â”‚   â”‚   â”œâ”€â”€ convert_to_qlib.py      # Convert data to qlib format
â”‚   â”‚   â”œâ”€â”€ refresh_today_data.py   # Update latest data
â”‚   â”‚   â””â”€â”€ quantmini_setup.py      # QuantMini data setup
â”‚   â”œâ”€â”€ analysis/                   # Analysis tools
â”‚   â”‚   â””â”€â”€ visualize_results.py    # Backtest visualization
â”‚   â””â”€â”€ tests/                      # Test scripts
â”‚       â”œâ”€â”€ test_qlib_alpha158.py   # Test Alpha158 features
â”‚       â”œâ”€â”€ test_stocks_minute_fix.py
â”‚       â””â”€â”€ enable_alpha158.py
â”‚
â”œâ”€â”€ configs/                        # Qlib workflow configurations
â”‚   â”œâ”€â”€ lightgbm_external_data.yaml # Full universe (all stocks)
â”‚   â”œâ”€â”€ lightgbm_fixed_dates.yaml   # 2024 only (date filter)
â”‚   â””â”€â”€ lightgbm_liquid_universe.yaml # Filtered liquid stocks
â”‚
â”œâ”€â”€ results/                        # Backtest outputs
â”‚   â”œâ”€â”€ visualizations/             # Charts and plots
â”‚   â”‚   â””â”€â”€ backtest_visualization.png
â”‚   â””â”€â”€ mlruns/                     # MLflow experiment tracking
â”‚       â””â”€â”€ 489214785307856385/     # Experiment runs
â”‚
â”œâ”€â”€ data/                           # Local data storage
â”‚   â”œâ”€â”€ parquet/                    # Raw parquet files
â”‚   â””â”€â”€ metadata/                   # Metadata files
â”‚
â”œâ”€â”€ notebooks/                      # Jupyter notebooks
â”‚   â””â”€â”€ workflow_by_code.ipynb      # Qlib workflow examples
â”‚
â”œâ”€â”€ config/                         # System configuration
â”‚   â””â”€â”€ system_profile.yaml         # System settings
â”‚
â””â”€â”€ qlib_repo/                      # Qlib source (gitignored, 828MB)
    â””â”€â”€ (Microsoft qlib clone)
```

## ğŸš€ Quick Start

### 1. Setup Environment

```bash
# Using uv (recommended)
uv venv
source .venv/bin/activate
uv pip install qlib

# Or using pip
python -m venv .venv
source .venv/bin/activate
pip install qlib
```

### 2. Prepare Data

```bash
# Option A: Use external data (QuantMini on /Volumes/sandisk)
# Data is already at: /Volumes/sandisk/quantmini-data/data/qlib/stocks_daily

# Option B: Download community data
wget https://github.com/chenditc/investment_data/releases/latest/download/qlib_bin.tar.gz
mkdir -p ~/.qlib/qlib_data/cn_data
tar -zxvf qlib_bin.tar.gz -C ~/.qlib/qlib_data/cn_data --strip-components=1
```

### 3. Run a Backtest

```bash
# Navigate to qlib examples (if using qlib_repo)
cd qlib_repo/examples

# Run workflow with external data
uv run qrun ../../configs/lightgbm_liquid_universe.yaml
```

### 4. Visualize Results

```bash
# Update the experiment ID in visualize_results.py, then:
uv run python scripts/analysis/visualize_results.py
```

Results will be saved to `results/visualizations/backtest_visualization.png`

## ğŸ’¼ QuantLab CLI - Real-World Use Cases

QuantLab includes a powerful CLI for portfolio management, market analysis, and data queries.

### ğŸ¬ Use Case 1: Building a Tech Portfolio

**Scenario**: Create and manage a diversified tech portfolio with FAANG+ stocks.

```bash
# Initialize QuantLab
quantlab init

# Create a tech portfolio
quantlab portfolio create tech_giants --name "FAANG+ Portfolio" \
    --description "Large-cap tech companies"

# Add positions with target weights
quantlab portfolio add tech_giants AAPL GOOGL MSFT --weight 0.20
quantlab portfolio add tech_giants META AMZN --weight 0.15
quantlab portfolio add tech_giants NVDA --weight 0.10

# View your portfolio
quantlab portfolio show tech_giants

# Expected output:
# ğŸ“Š Portfolio: FAANG+ Portfolio
# ğŸ“ˆ Positions: 6
# â”œâ”€ AAPL    â”‚ Weight: 20.00% â”‚ Shares: -   â”‚ Cost Basis: -
# â”œâ”€ GOOGL   â”‚ Weight: 20.00% â”‚ Shares: -   â”‚ Cost Basis: -
# â”œâ”€ MSFT    â”‚ Weight: 20.00% â”‚ Shares: -   â”‚ Cost Basis: -
# â”œâ”€ META    â”‚ Weight: 15.00% â”‚ Shares: -   â”‚ Cost Basis: -
# â”œâ”€ AMZN    â”‚ Weight: 15.00% â”‚ Shares: -   â”‚ Cost Basis: -
# â””â”€ NVDA    â”‚ Weight: 10.00% â”‚ Shares: -   â”‚ Cost Basis: -
# Total Weight: 100.00%
```

### ğŸ“Š Use Case 2: Real Position Tracking

**Scenario**: Track actual shares purchased at specific cost basis.

```bash
# Update positions with real trade data
quantlab portfolio update tech_giants AAPL \
    --shares 50 \
    --cost-basis 178.25 \
    --notes "Bought on Q4 dip"

quantlab portfolio update tech_giants GOOGL \
    --shares 30 \
    --cost-basis 142.50 \
    --notes "Post-earnings entry"

quantlab portfolio update tech_giants NVDA \
    --shares 20 \
    --cost-basis 485.00 \
    --notes "AI boom position"

# View updated portfolio
quantlab portfolio show tech_giants

# Expected output:
# ğŸ“Š Portfolio: FAANG+ Portfolio
# ğŸ“ˆ Positions: 6
# â”œâ”€ AAPL    â”‚ Weight: 20.00% â”‚ Shares: 50  â”‚ Cost: $178.25 â”‚ "Bought on Q4 dip"
# â”œâ”€ GOOGL   â”‚ Weight: 20.00% â”‚ Shares: 30  â”‚ Cost: $142.50 â”‚ "Post-earnings entry"
# â”œâ”€ NVDA    â”‚ Weight: 10.00% â”‚ Shares: 20  â”‚ Cost: $485.00 â”‚ "AI boom position"
# Total Investment: $22,812.50
```

### ğŸ” Use Case 3: Analyzing a Stock Before Purchase

**Scenario**: Deep-dive analysis on ORCL before adding to portfolio.

```bash
# Comprehensive analysis with all data sources
quantlab analyze ticker ORCL \
    --include-fundamentals \
    --include-options \
    --include-sentiment \
    --include-technicals \
    --output results/orcl_analysis.json

# Expected output:
# ğŸ” Analyzing ORCL (Oracle Corporation)
#
# ğŸ“ˆ Price Information:
#    Current: $145.50
#    Change: +2.3% ($3.25)
#    Volume: 5,234,567
#
# ğŸ’° Fundamentals:
#    Market Cap: $401.2B
#    P/E Ratio: 28.5
#    Forward P/E: 21.2
#    Revenue Growth: 7.2%
#    Profit Margin: 21.5%
#    Debt/Equity: 2.84
#
# ğŸ“Š Options Activity:
#    Put/Call Ratio: 0.78 (Bullish)
#    Implied Volatility: 22.5%
#    Next Earnings: 2025-03-15 (30 days)
#
# ğŸ“° Sentiment Analysis:
#    Score: 0.72 (Positive)
#    Articles: 45 (7 days)
#    Buzz: High
#
# ğŸ¯ Analyst Consensus:
#    Rating: Buy (12) / Hold (8) / Sell (2)
#    Target Price: $165.00 (+13.4%)
#
# âœ… Analysis complete â†’ results/orcl_analysis.json

# Visualize price action
quantlab visualize price ORCL --period 90d --chart-type candlestick
quantlab visualize price ORCL --period 1year --chart-type line

# Quick decision check
quantlab lookup get company ORCL
quantlab lookup get ratings ORCL
```

### ğŸ“ˆ Use Case 4: Portfolio-Wide Analysis

**Scenario**: Analyze all positions in your tech portfolio.

```bash
# Analyze entire portfolio
quantlab analyze portfolio tech_giants \
    --include-options \
    --aggregate-metrics \
    --output results/tech_giants_analysis.json

# Expected output:
# ğŸ“Š Analyzing Portfolio: FAANG+ Portfolio (6 positions)
#
# Processing: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 6/6
#
# Individual Analyses:
# âœ“ AAPL  â”‚ Score: 82/100 â”‚ Sentiment: Positive â”‚ Analysts: 85% Buy
# âœ“ GOOGL â”‚ Score: 78/100 â”‚ Sentiment: Positive â”‚ Analysts: 80% Buy
# âœ“ MSFT  â”‚ Score: 88/100 â”‚ Sentiment: Very Positive â”‚ Analysts: 90% Buy
# âœ“ META  â”‚ Score: 75/100 â”‚ Sentiment: Neutral â”‚ Analysts: 75% Buy
# âœ“ AMZN  â”‚ Score: 81/100 â”‚ Sentiment: Positive â”‚ Analysts: 82% Buy
# âš  NVDA  â”‚ Score: 68/100 â”‚ Sentiment: Mixed â”‚ Analysts: 70% Buy
#
# Portfolio Metrics:
# Total Value: $52,450
# Avg P/E: 32.5
# Avg Sentiment: 0.68 (Positive)
# Portfolio Beta: 1.15
# Weighted Analyst Rating: 80% Buy
#
# âš ï¸ Alerts:
# - NVDA showing weakness (consider reducing position)
# - MSFT strongest performer (98% of analysts bullish)

# Visualize portfolio performance comparison
quantlab visualize compare AAPL GOOGL MSFT META AMZN NVDA \
    --period 90d \
    --normalize \
    --output results/tech_giants_comparison.html
```

### ğŸ” Use Case 5: Querying Historical Data

**Scenario**: Research historical price patterns for backtesting.

```bash
# Query daily stock data
quantlab data query AAPL GOOGL MSFT \
    --start 2024-01-01 \
    --end 2025-01-15 \
    --type stocks_daily \
    --limit 100

# Expected output:
# ğŸ“Š Querying data for 3 tickers...
#
# AAPL (Apple Inc.)
# Date Range: 2024-01-01 to 2025-01-15 (252 trading days)
#
# Recent Data (last 5 days):
# Date       â”‚ Open    â”‚ High    â”‚ Low     â”‚ Close   â”‚ Volume
# 2025-01-15 â”‚ $180.25 â”‚ $182.50 â”‚ $179.80 â”‚ $181.75 â”‚ 52.3M
# 2025-01-14 â”‚ $179.50 â”‚ $181.25 â”‚ $178.90 â”‚ $180.25 â”‚ 48.7M
# ...
#
# Performance: +15.3% YTD
# Volatility: 18.5% (annualized)

# Visualize historical price patterns
quantlab visualize price AAPL --period 2year --chart-type candlestick
quantlab visualize price AAPL --interval 5min --period 5d --chart-type line

# Check available data coverage
quantlab data check

# Expected output:
# ğŸ“ Parquet Data Availability
# âœ“ stocks_daily    â”‚ 13,187 tickers â”‚ 2024-09-01 to 2025-10-15 (442 days)
# âœ“ stocks_minute   â”‚ 8,523 tickers  â”‚ Last 90 days
# âœ“ options_daily   â”‚ 3,245 tickers  â”‚ 2024-09-01 to 2025-10-15
# âœ— options_minute  â”‚ Not available
```

### ğŸ¦ Use Case 6: Maintaining Reference Data

**Scenario**: Keep company info and analyst ratings up-to-date.

```bash
# Initialize lookup tables
quantlab lookup init

# Refresh data for your portfolio
quantlab lookup refresh portfolio tech_giants

# Expected output:
# ğŸ”„ Refreshing data for 6 tickers in tech_giants...
#
# Company Info:
# âœ“ AAPL  - Apple Inc. (Technology - Consumer Electronics)
# âœ“ GOOGL - Alphabet Inc. (Technology - Internet Services)
# âœ“ MSFT  - Microsoft Corporation (Technology - Software)
# âœ“ META  - Meta Platforms Inc. (Technology - Social Media)
# âœ“ AMZN  - Amazon.com Inc. (Consumer Cyclical - Internet Retail)
# âœ“ NVDA  - NVIDIA Corporation (Technology - Semiconductors)
#
# Analyst Ratings:
# âœ“ AAPL  - 35 analysts (Buy: 28, Hold: 6, Sell: 1) Target: $210
# âœ“ GOOGL - 42 analysts (Buy: 35, Hold: 6, Sell: 1) Target: $165
# âœ“ MSFT  - 48 analysts (Buy: 43, Hold: 4, Sell: 1) Target: $450
# âœ“ META  - 38 analysts (Buy: 28, Hold: 8, Sell: 2) Target: $520
# âœ“ AMZN  - 45 analysts (Buy: 38, Hold: 6, Sell: 1) Target: $215
# âœ“ NVDA  - 40 analysts (Buy: 32, Hold: 7, Sell: 1) Target: $850
#
# âœ… Refresh complete (6/6 successful)

# View stored data
quantlab lookup stats

# Expected output:
# ğŸ“Š Lookup Tables Statistics
#
# Company Information: 6 companies
# Analyst Ratings: 6 tickers (248 total analysts)
# Treasury Rates: Current (updated: 2025-10-15)
# Last Updated: 2025-10-15 14:32:15
```

### ğŸ¯ Use Case 7: Multi-Portfolio Strategy

**Scenario**: Manage multiple portfolios for different strategies.

```bash
# Create portfolios for different strategies
quantlab portfolio create growth --name "High Growth" \
    --description "Growth stocks with P/E > 30"

quantlab portfolio create value --name "Value Plays" \
    --description "Undervalued stocks with P/E < 15"

quantlab portfolio create dividend --name "Dividend Income" \
    --description "High dividend yield stocks"

# Add different stocks to each
quantlab portfolio add growth NVDA TSLA SNOW --weight 0.33
quantlab portfolio add value BAC JPM WFC --weight 0.33
quantlab portfolio add dividend T VZ SO --weight 0.33

# View all portfolios
quantlab portfolio list

# Expected output:
# ğŸ“Š Your Portfolios
#
# Portfolio ID    â”‚ Name              â”‚ Positions â”‚ Total Weight â”‚ Last Updated
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# tech_giants     â”‚ FAANG+ Portfolio  â”‚ 6         â”‚ 100.00%      â”‚ 2025-10-15
# growth          â”‚ High Growth       â”‚ 3         â”‚ 99.00%       â”‚ 2025-10-15
# value           â”‚ Value Plays       â”‚ 3         â”‚ 99.00%       â”‚ 2025-10-15
# dividend        â”‚ Dividend Income   â”‚ 3         â”‚ 99.00%       â”‚ 2025-10-15
#
# Total Portfolios: 4
# Total Unique Positions: 15
```

### ğŸ”¬ Use Case 8: Options Strategy Research

**Scenario**: Research options opportunities for covered calls.

```bash
# Analyze ticker specifically for options
quantlab analyze ticker AAPL \
    --include-options \
    --no-fundamentals \
    --no-sentiment \
    --output results/aapl_options.json

# Expected output:
# ğŸ” Options Analysis: AAPL
#
# Current Price: $181.75
#
# Near-Term Expiration (30 days):
# Call Options (Covered Call Candidates):
# Strike â”‚ Premium â”‚ IV    â”‚ Delta â”‚ Break-even â”‚ Return
# â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€
# $185   â”‚ $3.85   â”‚ 21.2% â”‚ 0.45  â”‚ $185.00    â”‚ 2.1%
# $190   â”‚ $2.15   â”‚ 19.8% â”‚ 0.28  â”‚ $190.00    â”‚ 4.6%
# $195   â”‚ $0.95   â”‚ 18.5% â”‚ 0.15  â”‚ $195.00    â”‚ 7.3%
#
# Put Options (Cash-Secured Put Candidates):
# Strike â”‚ Premium â”‚ IV    â”‚ Delta â”‚ Net Cost   â”‚ Yield
# â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€
# $175   â”‚ $2.80   â”‚ 22.5% â”‚ -0.35 â”‚ $172.20    â”‚ 1.6%
# $170   â”‚ $1.45   â”‚ 20.1% â”‚ -0.20 â”‚ $168.55    â”‚ 0.9%
#
# Volatility Metrics:
# Current IV: 21.2%
# Historical Vol (30d): 18.5%
# IV Percentile: 62% (Elevated)
#
# ğŸ’¡ Suggestion: Good conditions for selling premium
#    IV elevated vs historical - consider covered calls at $190 strike

# Visualize options payoff diagrams
quantlab visualize options long_call --current-price 181.75 --strike 190 --premium 2.15
quantlab visualize options bull_call_spread \
    --current-price 181.75 --strike1 185 --strike2 195 --premium 1.70
```

### ğŸ“… Use Case 9: Regular Portfolio Review

**Scenario**: Monthly portfolio review workflow.

```bash
# Step 1: Refresh all market data
quantlab lookup refresh portfolio tech_giants

# Step 2: Get comprehensive analysis
quantlab analyze portfolio tech_giants --aggregate-metrics

# Step 3: Visualize portfolio performance
quantlab visualize compare AAPL GOOGL MSFT META AMZN NVDA --period 30d --normalize

# Step 4: Review individual positions
quantlab visualize price AAPL --period 90d --chart-type candlestick
quantlab visualize price NVDA --period 90d --chart-type candlestick

# Step 5: Check for rebalancing needs
quantlab portfolio show tech_giants

# Step 6: Look for new opportunities
quantlab data tickers --type stocks_daily | grep -E "^[A-Z]{1,4}$" | head -20
quantlab analyze ticker CRM --include-fundamentals
quantlab visualize price CRM --period 90d --chart-type candlestick

# Step 7: Update positions based on analysis
quantlab portfolio update tech_giants NVDA --weight 0.05 --notes "Reduced - valuation concerns"
quantlab portfolio add tech_giants CRM --weight 0.05 --notes "New position - cloud growth"

# Step 8: Export for records
quantlab analyze portfolio tech_giants --output results/monthly_review_2025_10.json
```

### ğŸš¨ Use Case 10: Risk Monitoring

**Scenario**: Monitor portfolio risk daily.

```bash
# Create a monitoring script
cat > scripts/daily_monitor.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y-%m-%d)

echo "ğŸ” Daily Portfolio Monitor - $DATE"
echo "=================================="

# Analyze each portfolio
for portfolio in tech_giants growth value dividend; do
    echo ""
    echo "ğŸ“Š Portfolio: $portfolio"
    quantlab analyze portfolio $portfolio \
        --include-options \
        --output "results/monitoring/${portfolio}_${DATE}.json" 2>&1 | \
        grep -E "(Score:|Sentiment:|Analysts:|âš |âŒ)"
done

# Check treasury rates for risk-free rate
echo ""
echo "ğŸ“ˆ Current Treasury Rates:"
quantlab lookup get treasury 10y

echo ""
echo "âœ… Monitoring complete"
EOF

chmod +x scripts/daily_monitor.sh

# Run daily monitoring
./scripts/daily_monitor.sh

# Expected output:
# ğŸ” Daily Portfolio Monitor - 2025-10-15
# ==================================
#
# ğŸ“Š Portfolio: tech_giants
# âœ“ AAPL  â”‚ Score: 82/100 â”‚ Sentiment: Positive
# âœ“ GOOGL â”‚ Score: 78/100 â”‚ Sentiment: Positive
# âš  NVDA  â”‚ Score: 68/100 â”‚ Sentiment: Mixed
#
# ğŸ“ˆ Current Treasury Rates:
# 10-Year Treasury: 4.25% (as of 2025-10-15)
#
# âœ… Monitoring complete
```

## ğŸ“Š Available Configurations

### 1. **Liquid Universe** (Recommended)
- **File**: `configs/lightgbm_liquid_universe.yaml`
- **Universe**: 13,187 stocks (filtered - no warrants, units)
- **Period**: Sept 2024 - Sept 2025
- **Best for**: Realistic backtesting with tradable stocks

### 2. **Fixed Dates**
- **File**: `configs/lightgbm_fixed_dates.yaml`
- **Universe**: All stocks
- **Period**: July 2024 - Dec 2024
- **Best for**: Testing on stable period

### 3. **Full Universe**
- **File**: `configs/lightgbm_external_data.yaml`
- **Universe**: All 14,310 instruments (includes warrants, penny stocks)
- **Period**: Sept 2024 - Sept 2025
- **Best for**: Maximum alpha discovery (but risky)

## ğŸ¯ Key Metrics from Latest Runs

| Configuration | IC | Rank IC | Sharpe | Max DD | Universe Size |
|--------------|-----|---------|--------|--------|---------------|
| Liquid Universe | 0.066 | -0.006 | 3.94 | -39.2% | 13,187 |
| Fixed Dates | 0.079 | -0.008 | 4.54 | -35.3% | 14,310 |
| Full Universe | 0.080 | -0.004 | 2.98 | -41.7% | 14,310 |

**IC (Information Coefficient)**: 0.06-0.08 is good - shows predictive power
**Rank IC**: Near zero - model struggles with relative ranking
**Sharpe Ratio**: 2.98-4.54 - excellent risk-adjusted returns

## ğŸ“Š Visualization Capabilities

QuantLab includes comprehensive interactive visualization tools powered by Plotly.

### Price Charts

```bash
# Candlestick charts (daily data)
quantlab visualize price AAPL --period 90d --chart-type candlestick

# Line charts with volume
quantlab visualize price AAPL --period 1year --chart-type line

# Intraday charts (5min, 15min, 1hour intervals)
quantlab visualize price AAPL --interval 5min --period 5d --chart-type candlestick
quantlab visualize price NVDA --interval 1hour --period 30d --chart-type line
```

**Features:**
- Multiple timeframes: 1d, 5d, 30d, 90d, 1year, 2year
- Intraday intervals: 1min, 5min, 15min, 1hour
- Categorical x-axis for gap-free intraday charts
- Timezone-aware (US Eastern Time)
- Regular market hours filtering (9:30 AM - 4:00 PM ET)

**Example Charts:**
- [Daily Candlestick (90d)](docs/images/price_candlestick_90d.html)
- [Intraday 5-minute Line](docs/images/price_intraday_5min.html)

### Multi-Ticker Comparison

```bash
# Compare normalized performance
quantlab visualize compare AAPL GOOGL MSFT --period 90d --normalize

# Absolute price comparison
quantlab visualize compare AAPL GOOGL MSFT --period 1year
```

**Example Chart:**
- [Normalized Comparison (90d)](docs/images/comparison_normalized.html)

### Options Payoff Diagrams

```bash
# Single leg strategies
quantlab visualize options long_call --current-price 180 --strike 190 --premium 2.15
quantlab visualize options long_put --current-price 180 --strike 175 --premium 2.80

# Spread strategies
quantlab visualize options bull_call_spread \
    --current-price 180 --strike1 185 --strike2 195 --premium 1.70

quantlab visualize options iron_condor \
    --current-price 180 --strike1 170 --strike2 175 --strike3 195 --strike4 200
```

**Available Strategies:**
- Single: `long_call`, `long_put`, `short_call`, `short_put`
- Spreads: `bull_call_spread`, `bear_put_spread`, `iron_condor`, `butterfly`
- Volatility: `long_straddle`, `short_straddle`, `long_strangle`, `short_strangle`

**Example Chart:**
- [Bull Call Spread Payoff](docs/images/options_bull_call_spread.html)

### Backtest Results

```bash
# Visualize backtest performance
quantlab visualize backtest results/mlruns/[experiment_id]
```

**Metrics Displayed:**
- Cumulative returns vs benchmark
- Drawdown analysis
- Rolling Sharpe ratio
- Win/loss distribution
- Monthly returns heatmap

## ğŸ“š Documentation

- **[BACKTEST_SUMMARY.md](docs/BACKTEST_SUMMARY.md)** - Comprehensive analysis of backtest results, root cause analysis, and recommendations
- **[ALPHA158_SUMMARY.md](docs/ALPHA158_SUMMARY.md)** - Overview of Alpha158 features used
- **[USE_QLIB_ALPHA158.md](docs/USE_QLIB_ALPHA158.md)** - How to use Alpha158 in your strategies
- **[CLI_VISUALIZATION_GUIDE.md](docs/CLI_VISUALIZATION_GUIDE.md)** - Complete guide to visualization features

## ğŸ”§ Data Setup

### External Data Location
```
/Volumes/sandisk/quantmini-data/data/qlib/stocks_daily/
â”œâ”€â”€ calendars/day.txt           # Trading calendar (442 days)
â”œâ”€â”€ instruments/
â”‚   â”œâ”€â”€ all.txt                 # All 14,310 instruments
â”‚   â””â”€â”€ liquid_stocks.txt       # Filtered 13,187 instruments
â””â”€â”€ features/                   # Stock price data (OHLCV)
```

### Creating Custom Universe Filters

```python
# See scripts/data/ for examples
# Filter by:
# - Market cap
# - Average volume
# - Exclude warrants/units
# - Sector/industry
```

## ğŸ§ª Testing

```bash
# Test Alpha158 features
python scripts/tests/test_qlib_alpha158.py

# Test data conversion
python scripts/data/convert_to_qlib.py

# Refresh latest data
python scripts/data/refresh_today_data.py
```

## ğŸ” Next Steps

### Improve Model Performance
1. **Fix Rank IC** - Try ensemble models (XGBoost, TabNet, LSTM)
2. **Better features** - Add momentum, volatility, cross-sectional features
3. **Risk controls** - Add position limits, volatility weighting

### Data Quality
1. Validate corporate actions (splits, dividends)
2. Check for survivorship bias
3. Add liquidity filters (min volume, market cap)

### Alternative Strategies
1. Market-neutral long-short
2. Factor-based weighting
3. Multi-timeframe approaches

## ğŸ“ Notes

- **Data Source**: External data from QuantMini (US stocks, daily, 2024-2025)
- **ML Framework**: Qlib by Microsoft Research
- **Models Tested**: LightGBM with Alpha158 features
- **Tracking**: MLflow for experiment management

## âš ï¸ Known Issues

1. **Unrealistic backtest returns** - Investigating data quality and backtest engine
2. **Rank IC near zero** - Model can predict returns but not rank stocks well
3. **High volatility** - Some instruments show extreme price movements
4. See [BACKTEST_SUMMARY.md](docs/BACKTEST_SUMMARY.md) for detailed analysis

## ğŸ¤ Contributing

This is a research project. Key areas for improvement:
- Better universe filters
- Alternative features
- Improved ranking models
- Risk management strategies

## ğŸ“„ License

Research and educational purposes.

## ğŸ”— Resources

- [Qlib Documentation](https://qlib.readthedocs.io/)
- [Qlib GitHub](https://github.com/microsoft/qlib)
- [Alpha158 Paper](https://arxiv.org/abs/2107.08321)
