var wn=Object.defineProperty;var kn=(t,e,a)=>e in t?wn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var J=(t,e,a)=>kn(t,typeof e!="symbol"?e+"":e,a);import{s as dt,t as Cn}from"./chunk-DZLz74EQ.js";import{a as Cr,n as Tn,r as En}from"./react-7g8sREeT.js";import{t as In}from"./react-BcIddLXZ.js";import{D as Sn,Er as An,Mr as Nn,Nr as On,S as Rn,Ut as Mn,Vt as jn,Wt as Tr,Yn as Pn,fr as Zn,it as $n,jt as Ln,ln as Er,o as Dn,pt as Fn,s as zn,wr as Un,xr as Vn,xt as Bn,yn as Wn}from"./cells-BEhFXxEH.js";import{A as T,D as qn,E as ae,F as N,G as Ir,H as ee,I as ue,L as Vt,N as Ie,O as Kn,P as Tt,R as Y,S as Jn,T as Sr,U as Yn,V as ce,Y as Ar,b as Bt,j as ft,k as Hn,w as $e,x as Wt,z as h}from"./zod-U2NFpcFA.js";import{n as ka,t as Gn}from"./jsx-runtime-DvsdsEjx.js";import{r as Nr}from"./invariant-B43sqCFA.js";import{t as pe}from"./Logger-BkkOJyg0.js";import{o as Qn}from"./hotkeys-ZAWHeY7d.js";import{a as Xn}from"./config-BeIk_wvs.js";import{t as Or}from"./cn-CwmWKpZ_.js";import{t as Le}from"./button-g1jf7cM6.js";import{Ft as ei,Gt as ti,Ht as qt,It as ai,Q as Ca,Rt as ri,Ut as Kt,_t as Ta,et as Rr,gt as si,it as Mr,rt as ni}from"./dist-BNtnpgX8.js";import{t as ii}from"./createReducer-CFr1RdS2.js";import{r as oi,t as li}from"./requests-BW3DqHQI.js";import{h as di,o as ui,r as ci}from"./dist-B8v7AWk6.js";import{i as pi}from"./dist-D80s9YgJ.js";import{t as jr}from"./use-toast-BKA5A0CC.js";import{r as mi}from"./useTheme-BWXNjHkw.js";import{t as Pr}from"./createLucideIcon-Dz-D6iuz.js";import{t as hi}from"./ai-model-dropdown-D-i9tuGn.js";import{h as fi}from"./select-DIqNYEaz.js";import{c as gi,n as yi,u as vi}from"./ansi_up-CAiCs1Gk.js";import{a as Zr,c as _i,p as bi,r as xi,t as wi}from"./dropdown-menu-D3tww20d.js";import{n as ki}from"./spinner-fS9J74Ro.js";import{t as Ci}from"./play-C5VC4Hal.js";import{t as Ti}from"./sparkles-DLotTEZ2.js";import{a as Et,i as gt,o as It,r as yt,s as Ei,t as Ii}from"./datasource-CwGVmPnG.js";import{r as Si}from"./useNonce-DvpkYOW9.js";import{t as Ai}from"./tooltip-CW-4dtRh.js";import{t as Ni}from"./shim-FF_l0CN4.js";import{n as Oi}from"./useEvent-itkPNnCe.js";import{n as Ri}from"./errors-CmwnOe1B.js";import{n as St}from"./renderShortcut-Bjp5Xukk.js";import{t as Mi}from"./es-Ctpp-mTr.js";import{n as ji}from"./dom-Ckypy4pz.js";import{t as Pi}from"./blob-BC4M7Onc.js";import{r as Zi,t as $i}from"./esm-Bp1Lbm07.js";import{t as Li}from"./useDeleteCell-CIqS2s5l.js";import{n as Di}from"./add-missing-import-0FwDfOhv.js";import{n as Fi}from"./icons-15z_NdNZ.js";var zi=Pr("at-sign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),Ui=Pr("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]),$r="vercel.ai.error",Vi=Symbol.for($r),Lr,Bi=class hn extends Error{constructor({name:e,message:a,cause:r}){super(a),this[Lr]=!0,this.name=e,this.cause=r}static isInstance(e){return hn.hasMarker(e,$r)}static hasMarker(e,a){let r=Symbol.for(a);return typeof e=="object"&&!!e&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}};Lr=Vi;var tt=Bi;function Dr(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var Fr="AI_InvalidArgumentError",zr=`vercel.ai.error.${Fr}`,Wi=Symbol.for(zr),Ur,qi=class extends tt{constructor({message:t,cause:e,argument:a}){super({name:Fr,message:t,cause:e}),this[Ur]=!0,this.argument=a}static isInstance(t){return tt.hasMarker(t,zr)}};Ur=Wi;var Vr="AI_JSONParseError",Br=`vercel.ai.error.${Vr}`,Ki=Symbol.for(Br),Wr,qr=class extends tt{constructor({text:t,cause:e}){super({name:Vr,message:`JSON parsing failed: Text: ${t}.
Error message: ${Dr(e)}`,cause:e}),this[Wr]=!0,this.text=t}static isInstance(t){return tt.hasMarker(t,Br)}};Wr=Ki;var Kr="AI_TypeValidationError",Jr=`vercel.ai.error.${Kr}`,Ji=Symbol.for(Jr),Yr,Yi=class vr extends tt{constructor({value:e,cause:a}){super({name:Kr,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${Dr(a)}`,cause:a}),this[Yr]=!0,this.value=e}static isInstance(e){return tt.hasMarker(e,Jr)}static wrap({value:e,cause:a}){return vr.isInstance(a)&&a.value===e?a:new vr({value:e,cause:a})}};Yr=Ji;var Jt=Yi,Hr=class extends Error{constructor(t,e){super(t),this.name="ParseError",this.type=e.type,this.field=e.field,this.value=e.value,this.line=e.line}};function Ea(t){}function Hi(t){if(typeof t=="function")throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:e=Ea,onError:a=Ea,onRetry:r=Ea,onComment:s}=t,n="",o=!0,i,l="",d="";function u(f){let c=o?f.replace(/^\xEF\xBB\xBF/,""):f,[m,_]=Gi(`${n}${c}`);for(let C of m)p(C);n=_,o=!1}function p(f){if(f===""){g();return}if(f.startsWith(":")){s&&s(f.slice(f.startsWith(": ")?2:1));return}let c=f.indexOf(":");if(c!==-1){let m=f.slice(0,c),_=f[c+1]===" "?2:1;v(m,f.slice(c+_),f);return}v(f,"",f)}function v(f,c,m){switch(f){case"event":d=c;break;case"data":l=`${l}${c}
`;break;case"id":i=c.includes("\0")?void 0:c;break;case"retry":/^\d+$/.test(c)?r(parseInt(c,10)):a(new Hr(`Invalid \`retry\` value: "${c}"`,{type:"invalid-retry",value:c,line:m}));break;default:a(new Hr(`Unknown field "${f.length>20?`${f.slice(0,20)}\u2026`:f}"`,{type:"unknown-field",field:f,value:c,line:m}));break}}function g(){l.length>0&&e({id:i,event:d||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),i=void 0,l="",d=""}function x(f={}){n&&f.consume&&p(n),o=!0,i=void 0,l="",d="",n=""}return{feed:u,reset:x}}function Gi(t){let e=[],a="",r=0;for(;r<t.length;){let s=t.indexOf("\r",r),n=t.indexOf(`
`,r),o=-1;if(s!==-1&&n!==-1?o=Math.min(s,n):s===-1?n!==-1&&(o=n):o=s===t.length-1?-1:s,o===-1){a=t.slice(r);break}else{let i=t.slice(r,o);e.push(i),r=o+1,t[r-1]==="\r"&&t[r]===`
`&&r++}}return[e,a]}var Qi=class extends TransformStream{constructor({onError:t,onRetry:e,onComment:a}={}){let r;super({start(s){r=Hi({onEvent:n=>{s.enqueue(n)},onError(n){t==="terminate"?s.error(n):typeof t=="function"&&t(n)},onRetry:e,onComment:a})},transform(s){r.feed(s)}})}},F;(function(t){t.assertEqual=s=>{};function e(s){}t.assertIs=e;function a(s){throw Error()}t.assertNever=a,t.arrayToEnum=s=>{let n={};for(let o of s)n[o]=o;return n},t.getValidEnumValues=s=>{let n=t.objectKeys(s).filter(i=>typeof s[s[i]]!="number"),o={};for(let i of n)o[i]=s[i];return t.objectValues(o)},t.objectValues=s=>t.objectKeys(s).map(function(n){return s[n]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let n=[];for(let o in s)Object.prototype.hasOwnProperty.call(s,o)&&n.push(o);return n},t.find=(s,n)=>{for(let o of s)if(n(o))return o},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,n=" | "){return s.map(o=>typeof o=="string"?`'${o}'`:o).join(n)}t.joinValues=r,t.jsonStringifyReplacer=(s,n)=>typeof n=="bigint"?n.toString():n})(F||(F={}));var Xi;(function(t){t.mergeShapes=(e,a)=>({...e,...a})})(Xi||(Xi={}));const k=F.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),at=t=>{switch(typeof t){case"undefined":return k.undefined;case"string":return k.string;case"number":return Number.isNaN(t)?k.nan:k.number;case"boolean":return k.boolean;case"function":return k.function;case"bigint":return k.bigint;case"symbol":return k.symbol;case"object":return Array.isArray(t)?k.array:t===null?k.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?k.promise:typeof Map<"u"&&t instanceof Map?k.map:typeof Set<"u"&&t instanceof Set?k.set:typeof Date<"u"&&t instanceof Date?k.date:k.object;default:return k.unknown}},y=F.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var De=class fn extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=e}format(e){let a=e||function(n){return n.message},r={_errors:[]},s=n=>{for(let o of n.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)r._errors.push(a(o));else{let i=r,l=0;for(;l<o.path.length;){let d=o.path[l];l===o.path.length-1?(i[d]=i[d]||{_errors:[]},i[d]._errors.push(a(o))):i[d]=i[d]||{_errors:[]},i=i[d],l++}}};return s(this),r}static assert(e){if(!(e instanceof fn))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,F.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=a=>a.message){let a={},r=[];for(let s of this.issues)if(s.path.length>0){let n=s.path[0];a[n]=a[n]||[],a[n].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:a}}get formErrors(){return this.flatten()}};De.create=t=>new De(t);var At=(t,e)=>{let a;switch(t.code){case y.invalid_type:a=t.received===k.undefined?"Required":`Expected ${t.expected}, received ${t.received}`;break;case y.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(t.expected,F.jsonStringifyReplacer)}`;break;case y.unrecognized_keys:a=`Unrecognized key(s) in object: ${F.joinValues(t.keys,", ")}`;break;case y.invalid_union:a="Invalid input";break;case y.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${F.joinValues(t.options)}`;break;case y.invalid_enum_value:a=`Invalid enum value. Expected ${F.joinValues(t.options)}, received '${t.received}'`;break;case y.invalid_arguments:a="Invalid function arguments";break;case y.invalid_return_type:a="Invalid function return type";break;case y.invalid_date:a="Invalid date";break;case y.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(a=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?a=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?a=`Invalid input: must end with "${t.validation.endsWith}"`:F.assertNever(t.validation):a=t.validation==="regex"?"Invalid":`Invalid ${t.validation}`;break;case y.too_small:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"||t.type==="bigint"?`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:"Invalid input";break;case y.too_big:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:"Invalid input";break;case y.custom:a="Invalid input";break;case y.invalid_intersection_types:a="Intersection results could not be merged";break;case y.not_multiple_of:a=`Number must be a multiple of ${t.multipleOf}`;break;case y.not_finite:a="Number must be finite";break;default:a=e.defaultError,F.assertNever(t)}return{message:a}},eo=At;function Ia(){return eo}const Sa=t=>{let{data:e,path:a,errorMaps:r,issueData:s}=t,n=[...a,...s.path||[]],o={...s,path:n};if(s.message!==void 0)return{...s,path:n,message:s.message};let i="",l=r.filter(d=>!!d).slice().reverse();for(let d of l)i=d(o,{data:e,defaultError:i}).message;return{...s,path:n,message:i}};function w(t,e){let a=Ia(),r=Sa({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,a,a===At?void 0:At].filter(s=>!!s)});t.common.issues.push(r)}var we=class gn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,a){let r=[];for(let s of a){if(s.status==="aborted")return O;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,a){let r=[];for(let s of a){let n=await s.key,o=await s.value;r.push({key:n,value:o})}return gn.mergeObjectSync(e,r)}static mergeObjectSync(e,a){let r={};for(let s of a){let{key:n,value:o}=s;if(n.status==="aborted"||o.status==="aborted")return O;n.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),n.value!=="__proto__"&&(o.value!==void 0||s.alwaysSet)&&(r[n.value]=o.value)}return{status:e.value,value:r}}};const O=Object.freeze({status:"aborted"}),Aa=t=>({status:"dirty",value:t}),ye=t=>({status:"valid",value:t}),Gr=t=>t.status==="aborted",Qr=t=>t.status==="dirty",vt=t=>t.status==="valid",Yt=t=>typeof Promise<"u"&&t instanceof Promise;var I;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(I||(I={}));var Fe=class{constructor(t,e,a,r){this._cachedPath=[],this.parent=t,this.data=e,this._path=a,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Xr=(t,e)=>{if(vt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){return this._error||(this._error=new De(t.common.issues)),this._error}}};function M(t){if(!t)return{};let{errorMap:e,invalid_type_error:a,required_error:r,description:s}=t;if(e&&(a||r))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(n,o)=>{let{message:i}=t;return n.code==="invalid_enum_value"?{message:i??o.defaultError}:o.data===void 0?{message:i??r??o.defaultError}:n.code==="invalid_type"?{message:i??a??o.defaultError}:{message:o.defaultError}},description:s}}var Z=class{get description(){return this._def.description}_getType(t){return at(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:at(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new we,ctx:{common:t.parent.common,data:t.data,parsedType:at(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){let e=this._parse(t);if(Yt(e))throw Error("Synchronous parse encountered promise.");return e}_parseAsync(t){let e=this._parse(t);return Promise.resolve(e)}parse(t,e){let a=this.safeParse(t,e);if(a.success)return a.data;throw a.error}safeParse(t,e){let a={common:{issues:[],async:(e==null?void 0:e.async)??!1,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:at(t)};return Xr(a,this._parseSync({data:t,path:a.path,parent:a}))}"~validate"(t){var a,r;let e={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:at(t)};if(!this["~standard"].async)try{let s=this._parseSync({data:t,path:[],parent:e});return vt(s)?{value:s.value}:{issues:e.common.issues}}catch(s){(r=(a=s==null?void 0:s.message)==null?void 0:a.toLowerCase())!=null&&r.includes("encountered")&&(this["~standard"].async=!0),e.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:e}).then(s=>vt(s)?{value:s.value}:{issues:e.common.issues})}async parseAsync(t,e){let a=await this.safeParseAsync(t,e);if(a.success)return a.data;throw a.error}async safeParseAsync(t,e){let a={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:at(t)},r=this._parse({data:t,path:a.path,parent:a});return Xr(a,await(Yt(r)?r:Promise.resolve(r)))}refine(t,e){let a=r=>typeof e=="string"||e===void 0?{message:e}:typeof e=="function"?e(r):e;return this._refinement((r,s)=>{let n=t(r),o=()=>s.addIssue({code:y.custom,...a(r)});return typeof Promise<"u"&&n instanceof Promise?n.then(i=>i?!0:(o(),!1)):n?!0:(o(),!1)})}refinement(t,e){return this._refinement((a,r)=>t(a)?!0:(r.addIssue(typeof e=="function"?e(a,r):e),!1))}_refinement(t){return new qe({schema:this,typeName:b.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Ke.create(this,this._def)}nullable(){return ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return bt.create(this)}promise(){return Nt.create(this,this._def)}or(t){return Xt.create([this,t],this._def)}and(t){return ea.create(this,t,this._def)}transform(t){return new qe({...M(this._def),schema:this,typeName:b.ZodEffects,effect:{type:"transform",transform:t}})}default(t){let e=typeof t=="function"?t:()=>t;return new na({...M(this._def),innerType:this,defaultValue:e,typeName:b.ZodDefault})}brand(){return new ss({typeName:b.ZodBranded,type:this,...M(this._def)})}catch(t){let e=typeof t=="function"?t:()=>t;return new ia({...M(this._def),innerType:this,catchValue:e,typeName:b.ZodCatch})}describe(t){let e=this.constructor;return new e({...this._def,description:t})}pipe(t){return ns.create(this,t)}readonly(){return oa.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},to=/^c[^\s-]{8,}$/i,ao=/^[0-9a-z]+$/,ro=/^[0-9A-HJKMNP-TV-Z]{26}$/i,so=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,no=/^[a-z0-9_-]{21}$/i,io=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,oo=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,lo=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,uo="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",es,co=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,po=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,mo=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ho=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,fo=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,go=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ts="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",yo=RegExp(`^${ts}$`);function as(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision??(e=`${e}(\\.\\d+)?`);let a=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${a}`}function vo(t){return RegExp(`^${as(t)}$`)}function _o(t){let e=`${ts}T${as(t)}`,a=[];return a.push(t.local?"Z?":"Z"),t.offset&&a.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${a.join("|")})`,RegExp(`^${e}$`)}function bo(t,e){return!!((e==="v4"||!e)&&co.test(t)||(e==="v6"||!e)&&mo.test(t))}function xo(t,e){if(!io.test(t))return!1;try{let[a]=t.split(".");if(!a)return!1;let r=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||!s||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function wo(t,e){return!!((e==="v4"||!e)&&po.test(t)||(e==="v6"||!e)&&ho.test(t))}var Ht=class zt extends Z{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==k.string){let s=this._getOrReturnCtx(e);return w(s,{code:y.invalid_type,expected:k.string,received:s.parsedType}),O}let a=new we,r;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:y.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="max")e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:y.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="length"){let n=e.data.length>s.value,o=e.data.length<s.value;(n||o)&&(r=this._getOrReturnCtx(e,r),n?w(r,{code:y.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&w(r,{code:y.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),a.dirty())}else if(s.kind==="email")lo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"email",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="emoji")es||(es=new RegExp(uo,"u")),es.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"emoji",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="uuid")so.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"uuid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="nanoid")no.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"nanoid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid")to.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cuid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid2")ao.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cuid2",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="ulid")ro.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"ulid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),w(r,{validation:"url",code:y.invalid_string,message:s.message}),a.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"regex",code:y.invalid_string,message:s.message}),a.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(r=this._getOrReturnCtx(e,r),w(r,{code:y.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),a.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),w(r,{code:y.invalid_string,validation:{startsWith:s.value},message:s.message}),a.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),w(r,{code:y.invalid_string,validation:{endsWith:s.value},message:s.message}),a.dirty()):s.kind==="datetime"?_o(s).test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:y.invalid_string,validation:"datetime",message:s.message}),a.dirty()):s.kind==="date"?yo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:y.invalid_string,validation:"date",message:s.message}),a.dirty()):s.kind==="time"?vo(s).test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:y.invalid_string,validation:"time",message:s.message}),a.dirty()):s.kind==="duration"?oo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"duration",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="ip"?bo(e.data,s.version)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"ip",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="jwt"?xo(e.data,s.alg)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"jwt",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="cidr"?wo(e.data,s.version)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cidr",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="base64"?fo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"base64",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="base64url"?go.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"base64url",code:y.invalid_string,message:s.message}),a.dirty()):F.assertNever(s);return{status:a.value,value:e.data}}_regex(e,a,r){return this.refinement(s=>e.test(s),{validation:a,code:y.invalid_string,...I.errToObj(r)})}_addCheck(e){return new zt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...I.errToObj(e)})}url(e){return this._addCheck({kind:"url",...I.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...I.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...I.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...I.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...I.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...I.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...I.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...I.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...I.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...I.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...I.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...I.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...I.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,...I.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...I.errToObj(e)})}regex(e,a){return this._addCheck({kind:"regex",regex:e,...I.errToObj(a)})}includes(e,a){return this._addCheck({kind:"includes",value:e,position:a==null?void 0:a.position,...I.errToObj(a==null?void 0:a.message)})}startsWith(e,a){return this._addCheck({kind:"startsWith",value:e,...I.errToObj(a)})}endsWith(e,a){return this._addCheck({kind:"endsWith",value:e,...I.errToObj(a)})}min(e,a){return this._addCheck({kind:"min",value:e,...I.errToObj(a)})}max(e,a){return this._addCheck({kind:"max",value:e,...I.errToObj(a)})}length(e,a){return this._addCheck({kind:"length",value:e,...I.errToObj(a)})}nonempty(e){return this.min(1,I.errToObj(e))}trim(){return new zt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new zt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new zt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxLength(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};Ht.create=t=>new Ht({checks:[],typeName:b.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...M(t)});function ko(t,e){let a=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=a>r?a:r;return Number.parseInt(t.toFixed(s).replace(".",""))%Number.parseInt(e.toFixed(s).replace(".",""))/10**s}var Na=class _r extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==k.number){let s=this._getOrReturnCtx(e);return w(s,{code:y.invalid_type,expected:k.number,received:s.parsedType}),O}let a,r=new we;for(let s of this._def.checks)s.kind==="int"?F.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),w(a,{code:y.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:y.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:y.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="multipleOf"?ko(e.data,s.value)!==0&&(a=this._getOrReturnCtx(e,a),w(a,{code:y.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),w(a,{code:y.not_finite,message:s.message}),r.dirty()):F.assertNever(s);return{status:r.value,value:e.data}}gte(e,a){return this.setLimit("min",e,!0,I.toString(a))}gt(e,a){return this.setLimit("min",e,!1,I.toString(a))}lte(e,a){return this.setLimit("max",e,!0,I.toString(a))}lt(e,a){return this.setLimit("max",e,!1,I.toString(a))}setLimit(e,a,r,s){return new _r({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:I.toString(s)}]})}_addCheck(e){return new _r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:I.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:I.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:I.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:I.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:I.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:I.toString(a)})}finite(e){return this._addCheck({kind:"finite",message:I.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:-(2**53-1),message:I.toString(e)})._addCheck({kind:"max",inclusive:!0,value:2**53-1,message:I.toString(e)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&F.isInteger(e.value))}get isFinite(){let e=null,a=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(a===null||r.value>a)&&(a=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(a)&&Number.isFinite(e)}};Na.create=t=>new Na({checks:[],typeName:b.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...M(t)});var Oa=class br extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==k.bigint)return this._getInvalidInput(e);let a,r=new we;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:y.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:y.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),w(a,{code:y.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):F.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){let a=this._getOrReturnCtx(e);return w(a,{code:y.invalid_type,expected:k.bigint,received:a.parsedType}),O}gte(e,a){return this.setLimit("min",e,!0,I.toString(a))}gt(e,a){return this.setLimit("min",e,!1,I.toString(a))}lte(e,a){return this.setLimit("max",e,!0,I.toString(a))}lt(e,a){return this.setLimit("max",e,!1,I.toString(a))}setLimit(e,a,r,s){return new br({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:I.toString(s)}]})}_addCheck(e){return new br({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:I.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:I.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:I.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:I.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:I.toString(a)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};Oa.create=t=>new Oa({checks:[],typeName:b.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...M(t)});var Ra=class extends Z{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==k.boolean){let e=this._getOrReturnCtx(t);return w(e,{code:y.invalid_type,expected:k.boolean,received:e.parsedType}),O}return ye(t.data)}};Ra.create=t=>new Ra({typeName:b.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...M(t)});var Ma=class yn extends Z{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==k.date){let s=this._getOrReturnCtx(e);return w(s,{code:y.invalid_type,expected:k.date,received:s.parsedType}),O}if(Number.isNaN(e.data.getTime()))return w(this._getOrReturnCtx(e),{code:y.invalid_date}),O;let a=new we,r;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:y.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),a.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:y.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),a.dirty()):F.assertNever(s);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new yn({...this._def,checks:[...this._def.checks,e]})}min(e,a){return this._addCheck({kind:"min",value:e.getTime(),message:I.toString(a)})}max(e,a){return this._addCheck({kind:"max",value:e.getTime(),message:I.toString(a)})}get minDate(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e==null?null:new Date(e)}get maxDate(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e==null?null:new Date(e)}};Ma.create=t=>new Ma({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:b.ZodDate,...M(t)});var ja=class extends Z{_parse(t){if(this._getType(t)!==k.symbol){let e=this._getOrReturnCtx(t);return w(e,{code:y.invalid_type,expected:k.symbol,received:e.parsedType}),O}return ye(t.data)}};ja.create=t=>new ja({typeName:b.ZodSymbol,...M(t)});var Gt=class extends Z{_parse(t){if(this._getType(t)!==k.undefined){let e=this._getOrReturnCtx(t);return w(e,{code:y.invalid_type,expected:k.undefined,received:e.parsedType}),O}return ye(t.data)}};Gt.create=t=>new Gt({typeName:b.ZodUndefined,...M(t)});var Qt=class extends Z{_parse(t){if(this._getType(t)!==k.null){let e=this._getOrReturnCtx(t);return w(e,{code:y.invalid_type,expected:k.null,received:e.parsedType}),O}return ye(t.data)}};Qt.create=t=>new Qt({typeName:b.ZodNull,...M(t)});var Pa=class extends Z{constructor(){super(...arguments),this._any=!0}_parse(t){return ye(t.data)}};Pa.create=t=>new Pa({typeName:b.ZodAny,...M(t)});var _t=class extends Z{constructor(){super(...arguments),this._unknown=!0}_parse(t){return ye(t.data)}};_t.create=t=>new _t({typeName:b.ZodUnknown,...M(t)});var rt=class extends Z{_parse(t){let e=this._getOrReturnCtx(t);return w(e,{code:y.invalid_type,expected:k.never,received:e.parsedType}),O}};rt.create=t=>new rt({typeName:b.ZodNever,...M(t)});var Za=class extends Z{_parse(t){if(this._getType(t)!==k.undefined){let e=this._getOrReturnCtx(t);return w(e,{code:y.invalid_type,expected:k.void,received:e.parsedType}),O}return ye(t.data)}};Za.create=t=>new Za({typeName:b.ZodVoid,...M(t)});var bt=class xa extends Z{_parse(e){let{ctx:a,status:r}=this._processInputParams(e),s=this._def;if(a.parsedType!==k.array)return w(a,{code:y.invalid_type,expected:k.array,received:a.parsedType}),O;if(s.exactLength!==null){let o=a.data.length>s.exactLength.value,i=a.data.length<s.exactLength.value;(o||i)&&(w(a,{code:o?y.too_big:y.too_small,minimum:i?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&a.data.length<s.minLength.value&&(w(a,{code:y.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&a.data.length>s.maxLength.value&&(w(a,{code:y.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),a.common.async)return Promise.all([...a.data].map((o,i)=>s.type._parseAsync(new Fe(a,o,a.path,i)))).then(o=>we.mergeArray(r,o));let n=[...a.data].map((o,i)=>s.type._parseSync(new Fe(a,o,a.path,i)));return we.mergeArray(r,n)}get element(){return this._def.type}min(e,a){return new xa({...this._def,minLength:{value:e,message:I.toString(a)}})}max(e,a){return new xa({...this._def,maxLength:{value:e,message:I.toString(a)}})}length(e,a){return new xa({...this._def,exactLength:{value:e,message:I.toString(a)}})}nonempty(e){return this.min(1,e)}};bt.create=(t,e)=>new bt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:b.ZodArray,...M(e)});function xt(t){if(t instanceof Oe){let e={};for(let a in t.shape){let r=t.shape[a];e[a]=Ke.create(xt(r))}return new Oe({...t._def,shape:()=>e})}else return t instanceof bt?new bt({...t._def,type:xt(t.element)}):t instanceof Ke?Ke.create(xt(t.unwrap())):t instanceof ct?ct.create(xt(t.unwrap())):t instanceof ut?ut.create(t.items.map(e=>xt(e))):t}var Oe=class Pe extends Z{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape();return this._cached={shape:e,keys:F.objectKeys(e)},this._cached}_parse(e){if(this._getType(e)!==k.object){let l=this._getOrReturnCtx(e);return w(l,{code:y.invalid_type,expected:k.object,received:l.parsedType}),O}let{status:a,ctx:r}=this._processInputParams(e),{shape:s,keys:n}=this._getCached(),o=[];if(!(this._def.catchall instanceof rt&&this._def.unknownKeys==="strip"))for(let l in r.data)n.includes(l)||o.push(l);let i=[];for(let l of n){let d=s[l],u=r.data[l];i.push({key:{status:"valid",value:l},value:d._parse(new Fe(r,u,r.path,l)),alwaysSet:l in r.data})}if(this._def.catchall instanceof rt){let l=this._def.unknownKeys;if(l==="passthrough")for(let d of o)i.push({key:{status:"valid",value:d},value:{status:"valid",value:r.data[d]}});else if(l==="strict")o.length>0&&(w(r,{code:y.unrecognized_keys,keys:o}),a.dirty());else if(l!=="strip")throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let d of o){let u=r.data[d];i.push({key:{status:"valid",value:d},value:l._parse(new Fe(r,u,r.path,d)),alwaysSet:d in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let l=[];for(let d of i){let u=await d.key,p=await d.value;l.push({key:u,value:p,alwaysSet:d.alwaysSet})}return l}).then(l=>we.mergeObjectSync(a,l)):we.mergeObjectSync(a,i)}get shape(){return this._def.shape()}strict(e){return I.errToObj,new Pe({...this._def,unknownKeys:"strict",...e===void 0?{}:{errorMap:(a,r)=>{var n,o;let s=((o=(n=this._def).errorMap)==null?void 0:o.call(n,a,r).message)??r.defaultError;return a.code==="unrecognized_keys"?{message:I.errToObj(e).message??s}:{message:s}}}})}strip(){return new Pe({...this._def,unknownKeys:"strip"})}passthrough(){return new Pe({...this._def,unknownKeys:"passthrough"})}extend(e){return new Pe({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Pe({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:b.ZodObject})}setKey(e,a){return this.augment({[e]:a})}catchall(e){return new Pe({...this._def,catchall:e})}pick(e){let a={};for(let r of F.objectKeys(e))e[r]&&this.shape[r]&&(a[r]=this.shape[r]);return new Pe({...this._def,shape:()=>a})}omit(e){let a={};for(let r of F.objectKeys(this.shape))e[r]||(a[r]=this.shape[r]);return new Pe({...this._def,shape:()=>a})}deepPartial(){return xt(this)}partial(e){let a={};for(let r of F.objectKeys(this.shape)){let s=this.shape[r];e&&!e[r]?a[r]=s:a[r]=s.optional()}return new Pe({...this._def,shape:()=>a})}required(e){let a={};for(let r of F.objectKeys(this.shape))if(e&&!e[r])a[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof Ke;)s=s._def.innerType;a[r]=s}return new Pe({...this._def,shape:()=>a})}keyof(){return rs(F.objectKeys(this.shape))}};Oe.create=(t,e)=>new Oe({shape:()=>t,unknownKeys:"strip",catchall:rt.create(),typeName:b.ZodObject,...M(e)}),Oe.strictCreate=(t,e)=>new Oe({shape:()=>t,unknownKeys:"strict",catchall:rt.create(),typeName:b.ZodObject,...M(e)}),Oe.lazycreate=(t,e)=>new Oe({shape:t,unknownKeys:"strip",catchall:rt.create(),typeName:b.ZodObject,...M(e)});var Xt=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a=this._def.options;function r(s){for(let o of s)if(o.result.status==="valid")return o.result;for(let o of s)if(o.result.status==="dirty")return e.common.issues.push(...o.ctx.common.issues),o.result;let n=s.map(o=>new De(o.ctx.common.issues));return w(e,{code:y.invalid_union,unionErrors:n}),O}if(e.common.async)return Promise.all(a.map(async s=>{let n={...e,common:{...e.common,issues:[]},parent:null};return{result:await s._parseAsync({data:e.data,path:e.path,parent:n}),ctx:n}})).then(r);{let s,n=[];for(let i of a){let l={...e,common:{...e.common,issues:[]},parent:null},d=i._parseSync({data:e.data,path:e.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!s&&(s={result:d,ctx:l}),l.common.issues.length&&n.push(l.common.issues)}if(s)return e.common.issues.push(...s.ctx.common.issues),s.result;let o=n.map(i=>new De(i));return w(e,{code:y.invalid_union,unionErrors:o}),O}}get options(){return this._def.options}};Xt.create=(t,e)=>new Xt({options:t,typeName:b.ZodUnion,...M(e)});var st=t=>t instanceof ta?st(t.schema):t instanceof qe?st(t.innerType()):t instanceof aa?[t.value]:t instanceof ra?t.options:t instanceof sa?F.objectValues(t.enum):t instanceof na?st(t._def.innerType):t instanceof Gt?[void 0]:t instanceof Qt?[null]:t instanceof Ke?[void 0,...st(t.unwrap())]:t instanceof ct?[null,...st(t.unwrap())]:t instanceof ss||t instanceof oa?st(t.unwrap()):t instanceof ia?st(t._def.innerType):[],Co=class vn extends Z{_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==k.object)return w(a,{code:y.invalid_type,expected:k.object,received:a.parsedType}),O;let r=this.discriminator,s=a.data[r],n=this.optionsMap.get(s);return n?a.common.async?n._parseAsync({data:a.data,path:a.path,parent:a}):n._parseSync({data:a.data,path:a.path,parent:a}):(w(a,{code:y.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),O)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,a,r){let s=new Map;for(let n of a){let o=st(n.shape[e]);if(!o.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let i of o){if(s.has(i))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);s.set(i,n)}}return new vn({typeName:b.ZodDiscriminatedUnion,discriminator:e,options:a,optionsMap:s,...M(r)})}};function $a(t,e){let a=at(t),r=at(e);if(t===e)return{valid:!0,data:t};if(a===k.object&&r===k.object){let s=F.objectKeys(e),n=F.objectKeys(t).filter(i=>s.indexOf(i)!==-1),o={...t,...e};for(let i of n){let l=$a(t[i],e[i]);if(!l.valid)return{valid:!1};o[i]=l.data}return{valid:!0,data:o}}else if(a===k.array&&r===k.array){if(t.length!==e.length)return{valid:!1};let s=[];for(let n=0;n<t.length;n++){let o=t[n],i=e[n],l=$a(o,i);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return a===k.date&&r===k.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var ea=class extends Z{_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=(s,n)=>{if(Gr(s)||Gr(n))return O;let o=$a(s.value,n.value);return o.valid?((Qr(s)||Qr(n))&&e.dirty(),{status:e.value,value:o.data}):(w(a,{code:y.invalid_intersection_types}),O)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([s,n])=>r(s,n)):r(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}};ea.create=(t,e,a)=>new ea({left:t,right:e,typeName:b.ZodIntersection,...M(a)});var ut=class _n extends Z{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==k.array)return w(r,{code:y.invalid_type,expected:k.array,received:r.parsedType}),O;if(r.data.length<this._def.items.length)return w(r,{code:y.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),O;!this._def.rest&&r.data.length>this._def.items.length&&(w(r,{code:y.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());let s=[...r.data].map((n,o)=>{let i=this._def.items[o]||this._def.rest;return i?i._parse(new Fe(r,n,r.path,o)):null}).filter(n=>!!n);return r.common.async?Promise.all(s).then(n=>we.mergeArray(a,n)):we.mergeArray(a,s)}get items(){return this._def.items}rest(e){return new _n({...this._def,rest:e})}};ut.create=(t,e)=>{if(!Array.isArray(t))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ut({items:t,typeName:b.ZodTuple,rest:null,...M(e)})};var To=class xr extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==k.object)return w(r,{code:y.invalid_type,expected:k.object,received:r.parsedType}),O;let s=[],n=this._def.keyType,o=this._def.valueType;for(let i in r.data)s.push({key:n._parse(new Fe(r,i,r.path,i)),value:o._parse(new Fe(r,r.data[i],r.path,i)),alwaysSet:i in r.data});return r.common.async?we.mergeObjectAsync(a,s):we.mergeObjectSync(a,s)}get element(){return this._def.valueType}static create(e,a,r){return a instanceof Z?new xr({keyType:e,valueType:a,typeName:b.ZodRecord,...M(r)}):new xr({keyType:Ht.create(),valueType:e,typeName:b.ZodRecord,...M(a)})}},La=class extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:e,ctx:a}=this._processInputParams(t);if(a.parsedType!==k.map)return w(a,{code:y.invalid_type,expected:k.map,received:a.parsedType}),O;let r=this._def.keyType,s=this._def.valueType,n=[...a.data.entries()].map(([o,i],l)=>({key:r._parse(new Fe(a,o,a.path,[l,"key"])),value:s._parse(new Fe(a,i,a.path,[l,"value"]))}));if(a.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let i of n){let l=await i.key,d=await i.value;if(l.status==="aborted"||d.status==="aborted")return O;(l.status==="dirty"||d.status==="dirty")&&e.dirty(),o.set(l.value,d.value)}return{status:e.value,value:o}})}else{let o=new Map;for(let i of n){let l=i.key,d=i.value;if(l.status==="aborted"||d.status==="aborted")return O;(l.status==="dirty"||d.status==="dirty")&&e.dirty(),o.set(l.value,d.value)}return{status:e.value,value:o}}}};La.create=(t,e,a)=>new La({valueType:e,keyType:t,typeName:b.ZodMap,...M(a)});var Da=class wr extends Z{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==k.set)return w(r,{code:y.invalid_type,expected:k.set,received:r.parsedType}),O;let s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(w(r,{code:y.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),a.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(w(r,{code:y.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),a.dirty());let n=this._def.valueType;function o(l){let d=new Set;for(let u of l){if(u.status==="aborted")return O;u.status==="dirty"&&a.dirty(),d.add(u.value)}return{status:a.value,value:d}}let i=[...r.data.values()].map((l,d)=>n._parse(new Fe(r,l,r.path,d)));return r.common.async?Promise.all(i).then(l=>o(l)):o(i)}min(e,a){return new wr({...this._def,minSize:{value:e,message:I.toString(a)}})}max(e,a){return new wr({...this._def,maxSize:{value:e,message:I.toString(a)}})}size(e,a){return this.min(e,a).max(e,a)}nonempty(e){return this.min(1,e)}};Da.create=(t,e)=>new Da({valueType:t,minSize:null,maxSize:null,typeName:b.ZodSet,...M(e)});var Eo=class wa extends Z{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==k.function)return w(a,{code:y.invalid_type,expected:k.function,received:a.parsedType}),O;function r(i,l){return Sa({data:i,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,Ia(),At].filter(d=>!!d),issueData:{code:y.invalid_arguments,argumentsError:l}})}function s(i,l){return Sa({data:i,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,Ia(),At].filter(d=>!!d),issueData:{code:y.invalid_return_type,returnTypeError:l}})}let n={errorMap:a.common.contextualErrorMap},o=a.data;if(this._def.returns instanceof Nt){let i=this;return ye(async function(...l){let d=new De([]),u=await i._def.args.parseAsync(l,n).catch(v=>{throw d.addIssue(r(l,v)),d}),p=await Reflect.apply(o,this,u);return await i._def.returns._def.type.parseAsync(p,n).catch(v=>{throw d.addIssue(s(p,v)),d})})}else{let i=this;return ye(function(...l){let d=i._def.args.safeParse(l,n);if(!d.success)throw new De([r(l,d.error)]);let u=Reflect.apply(o,this,d.data),p=i._def.returns.safeParse(u,n);if(!p.success)throw new De([s(u,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new wa({...this._def,args:ut.create(e).rest(_t.create())})}returns(e){return new wa({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,a,r){return new wa({args:e||ut.create([]).rest(_t.create()),returns:a||_t.create(),typeName:b.ZodFunction,...M(r)})}},ta=class extends Z{get schema(){return this._def.getter()}_parse(t){let{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}};ta.create=(t,e)=>new ta({getter:t,typeName:b.ZodLazy,...M(e)});var aa=class extends Z{_parse(t){if(t.data!==this._def.value){let e=this._getOrReturnCtx(t);return w(e,{received:e.data,code:y.invalid_literal,expected:this._def.value}),O}return{status:"valid",value:t.data}}get value(){return this._def.value}};aa.create=(t,e)=>new aa({value:t,typeName:b.ZodLiteral,...M(e)});function rs(t,e){return new ra({values:t,typeName:b.ZodEnum,...M(e)})}var ra=class kr extends Z{_parse(e){if(typeof e.data!="string"){let a=this._getOrReturnCtx(e),r=this._def.values;return w(a,{expected:F.joinValues(r),received:a.parsedType,code:y.invalid_type}),O}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let a=this._getOrReturnCtx(e),r=this._def.values;return w(a,{received:a.data,code:y.invalid_enum_value,options:r}),O}return ye(e.data)}get options(){return this._def.values}get enum(){let e={};for(let a of this._def.values)e[a]=a;return e}get Values(){let e={};for(let a of this._def.values)e[a]=a;return e}get Enum(){let e={};for(let a of this._def.values)e[a]=a;return e}extract(e,a=this._def){return kr.create(e,{...this._def,...a})}exclude(e,a=this._def){return kr.create(this.options.filter(r=>!e.includes(r)),{...this._def,...a})}};ra.create=rs;var sa=class extends Z{_parse(t){let e=F.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(t);if(a.parsedType!==k.string&&a.parsedType!==k.number){let r=F.objectValues(e);return w(a,{expected:F.joinValues(r),received:a.parsedType,code:y.invalid_type}),O}if(this._cache||(this._cache=new Set(F.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){let r=F.objectValues(e);return w(a,{received:a.data,code:y.invalid_enum_value,options:r}),O}return ye(t.data)}get enum(){return this._def.values}};sa.create=(t,e)=>new sa({values:t,typeName:b.ZodNativeEnum,...M(e)});var Nt=class extends Z{unwrap(){return this._def.type}_parse(t){let{ctx:e}=this._processInputParams(t);return e.parsedType!==k.promise&&e.common.async===!1?(w(e,{code:y.invalid_type,expected:k.promise,received:e.parsedType}),O):ye((e.parsedType===k.promise?e.data:Promise.resolve(e.data)).then(a=>this._def.type.parseAsync(a,{path:e.path,errorMap:e.common.contextualErrorMap})))}};Nt.create=(t,e)=>new Nt({type:t,typeName:b.ZodPromise,...M(e)});var qe=class extends Z{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===b.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=this._def.effect||null,s={addIssue:n=>{w(a,n),n.fatal?e.abort():e.dirty()},get path(){return a.path}};if(s.addIssue=s.addIssue.bind(s),r.type==="preprocess"){let n=r.transform(a.data,s);if(a.common.async)return Promise.resolve(n).then(async o=>{if(e.value==="aborted")return O;let i=await this._def.schema._parseAsync({data:o,path:a.path,parent:a});return i.status==="aborted"?O:i.status==="dirty"||e.value==="dirty"?Aa(i.value):i});{if(e.value==="aborted")return O;let o=this._def.schema._parseSync({data:n,path:a.path,parent:a});return o.status==="aborted"?O:o.status==="dirty"||e.value==="dirty"?Aa(o.value):o}}if(r.type==="refinement"){let n=o=>{let i=r.refinement(o,s);if(a.common.async)return Promise.resolve(i);if(i instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(a.common.async===!1){let o=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return o.status==="aborted"?O:(o.status==="dirty"&&e.dirty(),n(o.value),{status:e.value,value:o.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(o=>o.status==="aborted"?O:(o.status==="dirty"&&e.dirty(),n(o.value).then(()=>({status:e.value,value:o.value}))))}if(r.type==="transform")if(a.common.async===!1){let n=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!vt(n))return O;let o=r.transform(n.value,s);if(o instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:o}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(n=>vt(n)?Promise.resolve(r.transform(n.value,s)).then(o=>({status:e.value,value:o})):O);F.assertNever(r)}};qe.create=(t,e,a)=>new qe({schema:t,typeName:b.ZodEffects,effect:e,...M(a)}),qe.createWithPreprocess=(t,e,a)=>new qe({schema:e,effect:{type:"preprocess",transform:t},typeName:b.ZodEffects,...M(a)});var Ke=class extends Z{_parse(t){return this._getType(t)===k.undefined?ye(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Ke.create=(t,e)=>new Ke({innerType:t,typeName:b.ZodOptional,...M(e)});var ct=class extends Z{_parse(t){return this._getType(t)===k.null?ye(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};ct.create=(t,e)=>new ct({innerType:t,typeName:b.ZodNullable,...M(e)});var na=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return e.parsedType===k.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:e.path,parent:e})}removeDefault(){return this._def.innerType}};na.create=(t,e)=>new na({innerType:t,typeName:b.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...M(e)});var ia=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a={...e,common:{...e.common,issues:[]}},r=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return Yt(r)?r.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new De(a.common.issues)},input:a.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new De(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}};ia.create=(t,e)=>new ia({innerType:t,typeName:b.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...M(e)});var Fa=class extends Z{_parse(t){if(this._getType(t)!==k.nan){let e=this._getOrReturnCtx(t);return w(e,{code:y.invalid_type,expected:k.nan,received:e.parsedType}),O}return{status:"valid",value:t.data}}};Fa.create=t=>new Fa({typeName:b.ZodNaN,...M(t)});var ss=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return this._def.type._parse({data:a,path:e.path,parent:e})}unwrap(){return this._def.type}},ns=class bn extends Z{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?O:s.status==="dirty"?(a.dirty(),Aa(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{let s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?O:s.status==="dirty"?(a.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,a){return new bn({in:e,out:a,typeName:b.ZodPipeline})}},oa=class extends Z{_parse(t){let e=this._def.innerType._parse(t),a=r=>(vt(r)&&(r.value=Object.freeze(r.value)),r);return Yt(e)?e.then(r=>a(r)):a(e)}unwrap(){return this._def.innerType}};oa.create=(t,e)=>new oa({innerType:t,typeName:b.ZodReadonly,...M(e)}),Oe.lazycreate;var b;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(b||(b={})),Ht.create,Na.create,Fa.create,Oa.create,Ra.create,Ma.create,ja.create,Gt.create,Qt.create,Pa.create,_t.create,rt.create,Za.create,bt.create,Oe.create,Oe.strictCreate,Xt.create,Co.create,ea.create,ut.create,To.create,La.create,Da.create,Eo.create,ta.create,aa.create,ra.create,sa.create,Nt.create,qe.create,Ke.create,ct.create,qe.createWithPreprocess,ns.create;var Ot=({prefix:t,size:e=16,alphabet:a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let s=()=>{let n=a.length,o=Array(e);for(let i=0;i<e;i++)o[i]=a[Math.random()*n|0];return o.join("")};if(t==null)return s;if(a.includes(r))throw new qi({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${a}".`});return()=>`${t}${r}${s()}`},Io=Ot(),So=/"__proto__"\s*:/,Ao=/"constructor"\s*:/;function No(t){let e=JSON.parse(t);return typeof e!="object"||!e||So.test(t)===!1&&Ao.test(t)===!1?e:Oo(e)}function Oo(t){let e=[t];for(;e.length;){let a=e;e=[];for(let r of a){if(Object.prototype.hasOwnProperty.call(r,"__proto__")||Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let s in r){let n=r[s];n&&typeof n=="object"&&e.push(n)}}}return t}function Ro(t){let{stackTraceLimit:e}=Error;Error.stackTraceLimit=0;try{return No(t)}finally{Error.stackTraceLimit=e}}var la=Symbol.for("vercel.ai.validator");function Mo(t){return{[la]:!0,validate:t}}function jo(t){return typeof t=="object"&&!!t&&la in t&&t[la]===!0&&"validate"in t}function Po(t){return jo(t)?t:Zo(t)}function Zo(t){return Mo(async e=>{let a=await t["~standard"].validate(e);return a.issues==null?{success:!0,value:a.value}:{success:!1,error:new Jt({value:e,cause:a.issues})}})}async function is({value:t,schema:e}){let a=await za({value:t,schema:e});if(!a.success)throw Jt.wrap({value:t,cause:a.error});return a.value}async function za({value:t,schema:e}){let a=Po(e);try{if(a.validate==null)return{success:!0,value:t,rawValue:t};let r=await a.validate(t);return r.success?{success:!0,value:r.value,rawValue:t}:{success:!1,error:Jt.wrap({value:t,cause:r.error}),rawValue:t}}catch(r){return{success:!1,error:Jt.wrap({value:t,cause:r}),rawValue:t}}}async function da({text:t,schema:e}){try{let a=Ro(t);return e==null?{success:!0,value:a,rawValue:a}:await za({value:a,schema:e})}catch(a){return{success:!1,error:qr.isInstance(a)?a:new qr({text:t,cause:a}),rawValue:void 0}}}function os({stream:t,schema:e}){return t.pipeThrough(new TextDecoderStream).pipeThrough(new Qi).pipeThrough(new TransformStream({async transform({data:a},r){a!=="[DONE]"&&r.enqueue(await da({text:a,schema:e}))}}))}async function wt(t){return typeof t=="function"&&(t=t()),Promise.resolve(t)}var $o=(t,e)=>{let a=0;for(;a<t.length&&a<e.length&&t[a]===e[a];a++);return[(t.length-a).toString(),...e.slice(a)].join("/")},Lo=Symbol("Let zodToJsonSchema decide on which parser to use"),ls={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Do=t=>typeof t=="string"?{...ls,name:t}:{...ls,...t};function ke(){return{}}function Fo(t,e){var r,s,n;let a={type:"array"};return(r=t.type)!=null&&r._def&&((n=(s=t.type)==null?void 0:s._def)==null?void 0:n.typeName)!==b.ZodAny&&(a.items=W(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&(a.minItems=t.minLength.value),t.maxLength&&(a.maxItems=t.maxLength.value),t.exactLength&&(a.minItems=t.exactLength.value,a.maxItems=t.exactLength.value),a}function zo(t){let e={type:"integer",format:"int64"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function Uo(){return{type:"boolean"}}function ds(t,e){return W(t.type._def,e)}var Vo=(t,e)=>W(t.innerType._def,e);function us(t,e,a){let r=a??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,n)=>us(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Bo(t)}}var Bo=t=>{let e={type:"integer",format:"unix-time"};for(let a of t.checks)switch(a.kind){case"min":e.minimum=a.value;break;case"max":e.maximum=a.value;break}return e};function Wo(t,e){return{...W(t.innerType._def,e),default:t.defaultValue()}}function qo(t,e){return e.effectStrategy==="input"?W(t.schema._def,e):ke()}function Ko(t){return{type:"string",enum:Array.from(t.values)}}var Jo=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function Yo(t,e){let a=[W(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),W(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),r=[];return a.forEach(s=>{if(Jo(s))r.push(...s.allOf);else{let n=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:o,...i}=s;n=i}r.push(n)}}),r.length?{allOf:r}:void 0}function Ho(t){let e=typeof t.value;return e!=="bigint"&&e!=="number"&&e!=="boolean"&&e!=="string"?{type:Array.isArray(t.value)?"array":"object"}:{type:e==="bigint"?"integer":e,const:t.value}}var Ua=void 0,Re={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Ua===void 0&&(Ua=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ua),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function cs(t,e){let a={type:"string"};if(t.checks)for(let r of t.checks)switch(r.kind){case"min":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value;break;case"max":a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"email":switch(e.emailStrategy){case"format:email":Me(a,"email",r.message,e);break;case"format:idn-email":Me(a,"idn-email",r.message,e);break;case"pattern:zod":fe(a,Re.email,r.message,e);break}break;case"url":Me(a,"uri",r.message,e);break;case"uuid":Me(a,"uuid",r.message,e);break;case"regex":fe(a,r.regex,r.message,e);break;case"cuid":fe(a,Re.cuid,r.message,e);break;case"cuid2":fe(a,Re.cuid2,r.message,e);break;case"startsWith":fe(a,RegExp(`^${Va(r.value,e)}`),r.message,e);break;case"endsWith":fe(a,RegExp(`${Va(r.value,e)}$`),r.message,e);break;case"datetime":Me(a,"date-time",r.message,e);break;case"date":Me(a,"date",r.message,e);break;case"time":Me(a,"time",r.message,e);break;case"duration":Me(a,"duration",r.message,e);break;case"length":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value,a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"includes":fe(a,RegExp(Va(r.value,e)),r.message,e);break;case"ip":r.version!=="v6"&&Me(a,"ipv4",r.message,e),r.version!=="v4"&&Me(a,"ipv6",r.message,e);break;case"base64url":fe(a,Re.base64url,r.message,e);break;case"jwt":fe(a,Re.jwt,r.message,e);break;case"cidr":r.version!=="v6"&&fe(a,Re.ipv4Cidr,r.message,e),r.version!=="v4"&&fe(a,Re.ipv6Cidr,r.message,e);break;case"emoji":fe(a,Re.emoji(),r.message,e);break;case"ulid":fe(a,Re.ulid,r.message,e);break;case"base64":switch(e.base64Strategy){case"format:binary":Me(a,"binary",r.message,e);break;case"contentEncoding:base64":a.contentEncoding="base64";break;case"pattern:zod":fe(a,Re.base64,r.message,e);break}break;case"nanoid":fe(a,Re.nanoid,r.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return a}function Va(t,e){return e.patternStrategy==="escape"?Qo(t):t}var Go=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Qo(t){let e="";for(let a=0;a<t.length;a++)Go.has(t[a])||(e+="\\"),e+=t[a];return e}function Me(t,e,a,r){var s;t.format||(s=t.anyOf)!=null&&s.some(n=>n.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format}),delete t.format),t.anyOf.push({format:e,...a&&r.errorMessages&&{errorMessage:{format:a}}})):t.format=e}function fe(t,e,a,r){var s;t.pattern||(s=t.allOf)!=null&&s.some(n=>n.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern}),delete t.pattern),t.allOf.push({pattern:ps(e,r),...a&&r.errorMessages&&{errorMessage:{pattern:a}}})):t.pattern=ps(e,r)}function ps(t,e){var l;if(!e.applyRegexFlags||!t.flags)return t.source;let a={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=a.i?t.source.toLowerCase():t.source,s="",n=!1,o=!1,i=!1;for(let d=0;d<r.length;d++){if(n){s+=r[d],n=!1;continue}if(a.i){if(o){if(r[d].match(/[a-z]/)){i?(s+=r[d],s+=`${r[d-2]}-${r[d]}`.toUpperCase(),i=!1):r[d+1]==="-"&&((l=r[d+2])!=null&&l.match(/[a-z]/))?(s+=r[d],i=!0):s+=`${r[d]}${r[d].toUpperCase()}`;continue}}else if(r[d].match(/[a-z]/)){s+=`[${r[d]}${r[d].toUpperCase()}]`;continue}}if(a.m){if(r[d]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[d]==="$"){s+=`($|(?=[\r
]))`;continue}}if(a.s&&r[d]==="."){s+=o?`${r[d]}\r
`:`[${r[d]}\r
]`;continue}s+=r[d],r[d]==="\\"?n=!0:o&&r[d]==="]"?o=!1:!o&&r[d]==="["&&(o=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s}function ms(t,e){var r,s,n,o,i;let a={type:"object",additionalProperties:W(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(((r=t.keyType)==null?void 0:r._def.typeName)===b.ZodString&&((s=t.keyType._def.checks)!=null&&s.length)){let{type:l,...d}=cs(t.keyType._def,e);return{...a,propertyNames:d}}else{if(((n=t.keyType)==null?void 0:n._def.typeName)===b.ZodEnum)return{...a,propertyNames:{enum:t.keyType._def.values}};if(((o=t.keyType)==null?void 0:o._def.typeName)===b.ZodBranded&&t.keyType._def.type._def.typeName===b.ZodString&&((i=t.keyType._def.type._def.checks)!=null&&i.length)){let{type:l,...d}=ds(t.keyType._def,e);return{...a,propertyNames:d}}}return a}function Xo(t,e){return e.mapStrategy==="record"?ms(t,e):{type:"array",maxItems:125,items:{type:"array",items:[W(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||ke(),W(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||ke()],minItems:2,maxItems:2}}}function el(t){let e=t.values,a=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),r=Array.from(new Set(a.map(s=>typeof s)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:a}}function tl(){return{not:ke()}}function al(){return{type:"null"}}var Ba={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function rl(t,e){let a=t.options instanceof Map?Array.from(t.options.values()):t.options;if(a.every(r=>r._def.typeName in Ba&&(!r._def.checks||!r._def.checks.length))){let r=a.reduce((s,n)=>{let o=Ba[n._def.typeName];return o&&!s.includes(o)?[...s,o]:s},[]);return{type:r.length>1?r:r[0]}}else if(a.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=a.reduce((s,n)=>{let o=typeof n._def.value;switch(o){case"string":case"number":case"boolean":return[...s,o];case"bigint":return[...s,"integer"];case"object":if(n._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===a.length){let s=r.filter((n,o,i)=>i.indexOf(n)===o);return{type:s.length>1?s:s[0],enum:a.reduce((n,o)=>n.includes(o._def.value)?n:[...n,o._def.value],[])}}}else if(a.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((r,s)=>[...r,...s._def.values.filter(n=>!r.includes(n))],[])};return sl(t,e)}var sl=(t,e)=>{let a=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>W(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return a.length?{anyOf:a}:void 0};function nl(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return{type:[Ba[t.innerType._def.typeName],"null"]};let a=W(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}function il(t){let e={type:"number"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"int":e.type="integer";break;case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function ol(t,e){let a={type:"object",properties:{}},r=[],s=t.shape();for(let o in s){let i=s[o];if(i===void 0||i._def===void 0)continue;let l=dl(i),d=W(i._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});d!==void 0&&(a.properties[o]=d,l||r.push(o))}r.length&&(a.required=r);let n=ll(t,e);return n!==void 0&&(a.additionalProperties=n),a}function ll(t,e){if(t.catchall._def.typeName!=="ZodNever")return W(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function dl(t){try{return t.isOptional()}catch{return!0}}var ul=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return W(t.innerType._def,e);let a=W(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return a?{anyOf:[{not:ke()},a]}:ke()},cl=(t,e)=>{if(e.pipeStrategy==="input")return W(t.in._def,e);if(e.pipeStrategy==="output")return W(t.out._def,e);let a=W(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]});return{allOf:[a,W(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",a?"1":"0"]})].filter(r=>r!==void 0)}};function pl(t,e){return W(t.type._def,e)}function ml(t,e){let a={type:"array",uniqueItems:!0,items:W(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&(a.minItems=t.minSize.value),t.maxSize&&(a.maxItems=t.maxSize.value),a}function hl(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((a,r)=>W(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[]),additionalItems:W(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((a,r)=>W(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[])}}function fl(){return{not:ke()}}function gl(){return ke()}var yl=(t,e)=>W(t.innerType._def,e),vl=(t,e,a)=>{switch(e){case b.ZodString:return cs(t,a);case b.ZodNumber:return il(t);case b.ZodObject:return ol(t,a);case b.ZodBigInt:return zo(t);case b.ZodBoolean:return Uo();case b.ZodDate:return us(t,a);case b.ZodUndefined:return fl();case b.ZodNull:return al();case b.ZodArray:return Fo(t,a);case b.ZodUnion:case b.ZodDiscriminatedUnion:return rl(t,a);case b.ZodIntersection:return Yo(t,a);case b.ZodTuple:return hl(t,a);case b.ZodRecord:return ms(t,a);case b.ZodLiteral:return Ho(t);case b.ZodEnum:return Ko(t);case b.ZodNativeEnum:return el(t);case b.ZodNullable:return nl(t,a);case b.ZodOptional:return ul(t,a);case b.ZodMap:return Xo(t,a);case b.ZodSet:return ml(t,a);case b.ZodLazy:return()=>t.getter()._def;case b.ZodPromise:return pl(t,a);case b.ZodNaN:case b.ZodNever:return tl();case b.ZodEffects:return qo(t,a);case b.ZodAny:return ke();case b.ZodUnknown:return gl();case b.ZodDefault:return Wo(t,a);case b.ZodBranded:return ds(t,a);case b.ZodReadonly:return yl(t,a);case b.ZodCatch:return Vo(t,a);case b.ZodPipeline:return cl(t,a);case b.ZodFunction:case b.ZodVoid:case b.ZodSymbol:return;default:return(r=>{})(e)}};function W(t,e,a=!1){var i;let r=e.seen.get(t);if(e.override){let l=(i=e.override)==null?void 0:i.call(e,t,e,r,a);if(l!==Lo)return l}if(r&&!a){let l=_l(r,e);if(l!==void 0)return l}let s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);let n=vl(t,t.typeName,e),o=typeof n=="function"?W(n(),e):n;if(o&&bl(t,e,o),e.postProcess){let l=e.postProcess(o,t,e);return s.jsonSchema=o,l}return s.jsonSchema=o,o}var _l=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:$o(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((a,r)=>e.currentPath[r]===a)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),ke()):e.$refStrategy==="seen"?ke():void 0}},bl=(t,e,a)=>(t.description&&(a.description=t.description),a),xl=t=>{let e=Do(t),a=e.name===void 0?e.basePath:[...e.basePath,e.definitionPath,e.name];return{...e,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}},wl=(t,e)=>{let a=xl(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((l,[d,u])=>({...l,[d]:W(u._def,{...a,currentPath:[...a.basePath,a.definitionPath,d]},!0)??ke()}),{}):void 0,s=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,n=W(t._def,s===void 0?a:{...a,currentPath:[...a.basePath,a.definitionPath,s]},!1)??ke(),o=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;o!==void 0&&(n.title=o);let i=s===void 0?r?{...n,[a.definitionPath]:r}:n:{$ref:[...a.$refStrategy==="relative"?[]:a.basePath,a.definitionPath,s].join("/"),[a.definitionPath]:{...r,[s]:n}};return i.$schema="http://json-schema.org/draft-07/schema#",i};function kl(t,e){return qa(wl(t,{$refStrategy:(e==null?void 0:e.useReferences)??!1?"root":"none"}),{validate:async a=>{let r=await t.safeParseAsync(a);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}function Cl(t,e){return qa(Ir(t,{target:"draft-7",io:"output",reused:(e==null?void 0:e.useReferences)??!1?"ref":"inline"}),{validate:async a=>{let r=await Yn(t,a);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}function Tl(t){return"_zod"in t}function El(t,e){return Tl(t)?Cl(t,e):kl(t,e)}var Wa=Symbol.for("vercel.ai.schema");function qa(t,{validate:e}={}){return{[Wa]:!0,_type:void 0,[la]:!0,jsonSchema:t,validate:e}}function Il(t){return typeof t=="object"&&!!t&&Wa in t&&t[Wa]===!0&&"jsonSchema"in t&&"validate"in t}function Sl(t){return t==null?qa({properties:{},additionalProperties:!1}):Il(t)?t:El(t)}var{btoa:$c,atob:Lc}=globalThis,Al=Object.defineProperty,Nl=(t,e)=>{for(var a in e)Al(t,a,{get:e[a],enumerable:!0})},hs="AI_NoObjectGeneratedError",fs=`vercel.ai.error.${hs}`,Ol=Symbol.for(fs),gs,ys=class extends tt{constructor({message:t="No object generated.",cause:e,text:a,response:r,usage:s,finishReason:n}){super({name:hs,message:t,cause:e}),this[gs]=!0,this.text=a,this.response=r,this.usage=s,this.finishReason=n}static isInstance(t){return tt.hasMarker(t,fs)}};gs=Ol;var vs=ce([h(),Wt(Uint8Array),Wt(ArrayBuffer),qn(t=>{var e;return((e=globalThis.Buffer)==null?void 0:e.isBuffer(t))??!1},{message:"Must be a Buffer"})]),Rt=Hn(()=>ce([Jn(),h(),Tt(),ae(),Vt(h(),Rt),$e(Rt)])),L=Vt(h(),Vt(h(),Rt)),_s=N({type:T("text"),text:h(),providerOptions:L.optional()}),Rl=N({type:T("image"),image:ce([vs,Wt(URL)]),mediaType:h().optional(),providerOptions:L.optional()}),bs=N({type:T("file"),data:ce([vs,Wt(URL)]),filename:h().optional(),mediaType:h(),providerOptions:L.optional()}),Ml=N({type:T("reasoning"),text:h(),providerOptions:L.optional()}),jl=N({type:T("tool-call"),toolCallId:h(),toolName:h(),input:ee(),providerOptions:L.optional(),providerExecuted:ae().optional()}),Pl=Kn("type",[N({type:T("text"),value:h()}),N({type:T("json"),value:Rt}),N({type:T("error-text"),value:h()}),N({type:T("error-json"),value:Rt}),N({type:T("content"),value:$e(ce([N({type:T("text"),text:h()}),N({type:T("media"),data:h(),mediaType:h()})]))})]),xs=N({type:T("tool-result"),toolCallId:h(),toolName:h(),output:Pl,providerOptions:L.optional()});ce([N({role:T("system"),content:h(),providerOptions:L.optional()}),N({role:T("user"),content:ce([h(),$e(ce([_s,Rl,bs]))]),providerOptions:L.optional()}),N({role:T("assistant"),content:ce([h(),$e(ce([_s,bs,Ml,jl,xs]))]),providerOptions:L.optional()}),N({role:T("tool"),content:$e(xs),providerOptions:L.optional()})]),Ot({prefix:"aitxt",size:24});var ws=ce([Y({type:T("text-start"),id:h(),providerMetadata:L.optional()}),Y({type:T("text-delta"),id:h(),delta:h(),providerMetadata:L.optional()}),Y({type:T("text-end"),id:h(),providerMetadata:L.optional()}),Y({type:T("error"),errorText:h()}),Y({type:T("tool-input-start"),toolCallId:h(),toolName:h(),providerExecuted:ae().optional(),dynamic:ae().optional()}),Y({type:T("tool-input-delta"),toolCallId:h(),inputTextDelta:h()}),Y({type:T("tool-input-available"),toolCallId:h(),toolName:h(),input:ee(),providerExecuted:ae().optional(),providerMetadata:L.optional(),dynamic:ae().optional()}),Y({type:T("tool-input-error"),toolCallId:h(),toolName:h(),input:ee(),providerExecuted:ae().optional(),providerMetadata:L.optional(),dynamic:ae().optional(),errorText:h()}),Y({type:T("tool-output-available"),toolCallId:h(),output:ee(),providerExecuted:ae().optional(),dynamic:ae().optional(),preliminary:ae().optional()}),Y({type:T("tool-output-error"),toolCallId:h(),errorText:h(),providerExecuted:ae().optional(),dynamic:ae().optional()}),Y({type:T("reasoning"),text:h(),providerMetadata:L.optional()}),Y({type:T("reasoning-start"),id:h(),providerMetadata:L.optional()}),Y({type:T("reasoning-delta"),id:h(),delta:h(),providerMetadata:L.optional()}),Y({type:T("reasoning-end"),id:h(),providerMetadata:L.optional()}),Y({type:T("reasoning-part-finish")}),Y({type:T("source-url"),sourceId:h(),url:h(),title:h().optional(),providerMetadata:L.optional()}),Y({type:T("source-document"),sourceId:h(),mediaType:h(),title:h(),filename:h().optional(),providerMetadata:L.optional()}),Y({type:T("file"),url:h(),mediaType:h(),providerMetadata:L.optional()}),Y({type:h().startsWith("data-"),id:h().optional(),data:ee(),transient:ae().optional()}),Y({type:T("start-step")}),Y({type:T("finish-step")}),Y({type:T("start"),messageId:h().optional(),messageMetadata:ee().optional()}),Y({type:T("finish"),messageMetadata:ee().optional()}),Y({type:T("abort")}),Y({type:T("message-metadata"),messageMetadata:ee()})]);function Zl(t){return t.type.startsWith("data-")}function ks(t,e){if(t===void 0&&e===void 0)return;if(t===void 0)return e;if(e===void 0)return t;let a={...t};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let s=e[r];if(s===void 0)continue;let n=r in t?t[r]:void 0,o=typeof s=="object"&&!!s&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp),i=typeof n=="object"&&!!n&&!Array.isArray(n)&&!(n instanceof Date)&&!(n instanceof RegExp);o&&i?a[r]=ks(n,s):a[r]=s}return a}function $l(t){let e=["ROOT"],a=-1,r=null;function s(l,d,u){switch(l){case'"':a=d,e.pop(),e.push(u),e.push("INSIDE_STRING");break;case"f":case"t":case"n":a=d,r=d,e.pop(),e.push(u),e.push("INSIDE_LITERAL");break;case"-":e.pop(),e.push(u),e.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=d,e.pop(),e.push(u),e.push("INSIDE_NUMBER");break;case"{":a=d,e.pop(),e.push(u),e.push("INSIDE_OBJECT_START");break;case"[":a=d,e.pop(),e.push(u),e.push("INSIDE_ARRAY_START");break}}function n(l,d){switch(l){case",":e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=d,e.pop();break}}function o(l,d){switch(l){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=d,e.pop();break}}for(let l=0;l<t.length;l++){let d=t[l];switch(e[e.length-1]){case"ROOT":s(d,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break;case"}":a=l,e.pop();break}break;case"INSIDE_OBJECT_AFTER_COMMA":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break}break;case"INSIDE_OBJECT_KEY":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY");break}break;case"INSIDE_OBJECT_AFTER_KEY":switch(d){case":":e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE");break}break;case"INSIDE_OBJECT_BEFORE_VALUE":s(d,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(d,l);break;case"INSIDE_STRING":switch(d){case'"':e.pop(),a=l;break;case"\\":e.push("INSIDE_STRING_ESCAPE");break;default:a=l}break;case"INSIDE_ARRAY_START":switch(d){case"]":a=l,e.pop();break;default:a=l,s(d,l,"INSIDE_ARRAY_AFTER_VALUE");break}break;case"INSIDE_ARRAY_AFTER_VALUE":switch(d){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=l,e.pop();break;default:a=l;break}break;case"INSIDE_ARRAY_AFTER_COMMA":s(d,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":e.pop(),a=l;break;case"INSIDE_NUMBER":switch(d){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=l;break;case"e":case"E":case"-":case".":break;case",":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(d,l),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(d,l);break;case"}":e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(d,l);break;case"]":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(d,l);break;default:e.pop();break}break;case"INSIDE_LITERAL":{let u=t.substring(r,l+1);!"false".startsWith(u)&&!"true".startsWith(u)&&!"null".startsWith(u)?(e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?n(d,l):e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(d,l)):a=l;break}}}let i=t.slice(0,a+1);for(let l=e.length-1;l>=0;l--)switch(e[l]){case"INSIDE_STRING":i+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":i+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":i+="]";break;case"INSIDE_LITERAL":{let d=t.substring(r,t.length);"true".startsWith(d)?i+="true".slice(d.length):"false".startsWith(d)?i+="false".slice(d.length):"null".startsWith(d)&&(i+="null".slice(d.length))}}return i}async function Cs(t){if(t===void 0)return{value:void 0,state:"undefined-input"};let e=await da({text:t});return e.success?{value:e.value,state:"successful-parse"}:(e=await da({text:$l(t)}),e.success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}function ua(t){return t.type.startsWith("tool-")}function Ll(t){return t.type==="dynamic-tool"}function Ts(t){return ua(t)||Ll(t)}function Es(t){return t.type.split("-").slice(1).join("-")}function Dl({lastMessage:t,messageId:e}){return{message:(t==null?void 0:t.role)==="assistant"?t:{id:e,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function Fl({stream:t,messageMetadataSchema:e,dataPartSchemas:a,runUpdateMessageJob:r,onError:s,onToolCall:n,onData:o}){return t.pipeThrough(new TransformStream({async transform(i,l){await r(async({state:d,write:u})=>{function p(c){let m=d.message.parts.filter(ua).find(_=>_.toolCallId===c);if(m==null)throw Error("tool-output-error must be preceded by a tool-input-available");return m}function v(c){let m=d.message.parts.filter(_=>_.type==="dynamic-tool").find(_=>_.toolCallId===c);if(m==null)throw Error("tool-output-error must be preceded by a tool-input-available");return m}function g(c){let m=d.message.parts.find(A=>ua(A)&&A.toolCallId===c.toolCallId),_=c,C=m;m==null?d.message.parts.push({type:`tool-${c.toolName}`,toolCallId:c.toolCallId,state:c.state,input:_.input,output:_.output,rawInput:_.rawInput,errorText:_.errorText,providerExecuted:_.providerExecuted,preliminary:_.preliminary,..._.providerMetadata==null?{}:{callProviderMetadata:_.providerMetadata}}):(m.state=c.state,C.input=_.input,C.output=_.output,C.errorText=_.errorText,C.rawInput=_.rawInput,C.preliminary=_.preliminary,C.providerExecuted=_.providerExecuted??m.providerExecuted,_.providerMetadata!=null&&m.state==="input-available"&&(m.callProviderMetadata=_.providerMetadata))}function x(c){let m=d.message.parts.find(A=>A.type==="dynamic-tool"&&A.toolCallId===c.toolCallId),_=c,C=m;m==null?d.message.parts.push({type:"dynamic-tool",toolName:c.toolName,toolCallId:c.toolCallId,state:c.state,input:_.input,output:_.output,errorText:_.errorText,preliminary:_.preliminary,..._.providerMetadata==null?{}:{callProviderMetadata:_.providerMetadata}}):(m.state=c.state,C.toolName=c.toolName,C.input=_.input,C.output=_.output,C.errorText=_.errorText,C.rawInput=_.rawInput??C.rawInput,C.preliminary=_.preliminary,_.providerMetadata!=null&&m.state==="input-available"&&(m.callProviderMetadata=_.providerMetadata))}async function f(c){if(c!=null){let m=d.message.metadata==null?c:ks(d.message.metadata,c);e!=null&&await is({value:m,schema:e}),d.message.metadata=m}}switch(i.type){case"text-start":{let c={type:"text",text:"",providerMetadata:i.providerMetadata,state:"streaming"};d.activeTextParts[i.id]=c,d.message.parts.push(c),u();break}case"text-delta":{let c=d.activeTextParts[i.id];c.text+=i.delta,c.providerMetadata=i.providerMetadata??c.providerMetadata,u();break}case"text-end":{let c=d.activeTextParts[i.id];c.state="done",c.providerMetadata=i.providerMetadata??c.providerMetadata,delete d.activeTextParts[i.id],u();break}case"reasoning-start":{let c={type:"reasoning",text:"",providerMetadata:i.providerMetadata,state:"streaming"};d.activeReasoningParts[i.id]=c,d.message.parts.push(c),u();break}case"reasoning-delta":{let c=d.activeReasoningParts[i.id];c.text+=i.delta,c.providerMetadata=i.providerMetadata??c.providerMetadata,u();break}case"reasoning-end":{let c=d.activeReasoningParts[i.id];c.providerMetadata=i.providerMetadata??c.providerMetadata,c.state="done",delete d.activeReasoningParts[i.id],u();break}case"file":d.message.parts.push({type:"file",mediaType:i.mediaType,url:i.url}),u();break;case"source-url":d.message.parts.push({type:"source-url",sourceId:i.sourceId,url:i.url,title:i.title,providerMetadata:i.providerMetadata}),u();break;case"source-document":d.message.parts.push({type:"source-document",sourceId:i.sourceId,mediaType:i.mediaType,title:i.title,filename:i.filename,providerMetadata:i.providerMetadata}),u();break;case"tool-input-start":{let c=d.message.parts.filter(ua);d.partialToolCalls[i.toolCallId]={text:"",toolName:i.toolName,index:c.length,dynamic:i.dynamic},i.dynamic?x({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-streaming",input:void 0}):g({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-streaming",input:void 0,providerExecuted:i.providerExecuted}),u();break}case"tool-input-delta":{let c=d.partialToolCalls[i.toolCallId];c.text+=i.inputTextDelta;let{value:m}=await Cs(c.text);c.dynamic?x({toolCallId:i.toolCallId,toolName:c.toolName,state:"input-streaming",input:m}):g({toolCallId:i.toolCallId,toolName:c.toolName,state:"input-streaming",input:m}),u();break}case"tool-input-available":i.dynamic?x({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-available",input:i.input,providerMetadata:i.providerMetadata}):g({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-available",input:i.input,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}),u(),n&&!i.providerExecuted&&await n({toolCall:i});break;case"tool-input-error":i.dynamic?x({toolCallId:i.toolCallId,toolName:i.toolName,state:"output-error",input:i.input,errorText:i.errorText,providerMetadata:i.providerMetadata}):g({toolCallId:i.toolCallId,toolName:i.toolName,state:"output-error",input:void 0,rawInput:i.input,errorText:i.errorText,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}),u();break;case"tool-output-available":if(i.dynamic){let c=v(i.toolCallId);x({toolCallId:i.toolCallId,toolName:c.toolName,state:"output-available",input:c.input,output:i.output,preliminary:i.preliminary})}else{let c=p(i.toolCallId);g({toolCallId:i.toolCallId,toolName:Es(c),state:"output-available",input:c.input,output:i.output,providerExecuted:i.providerExecuted,preliminary:i.preliminary})}u();break;case"tool-output-error":if(i.dynamic){let c=v(i.toolCallId);x({toolCallId:i.toolCallId,toolName:c.toolName,state:"output-error",input:c.input,errorText:i.errorText})}else{let c=p(i.toolCallId);g({toolCallId:i.toolCallId,toolName:Es(c),state:"output-error",input:c.input,rawInput:c.rawInput,errorText:i.errorText})}u();break;case"start-step":d.message.parts.push({type:"step-start"});break;case"finish-step":d.activeTextParts={},d.activeReasoningParts={};break;case"start":i.messageId!=null&&(d.message.id=i.messageId),await f(i.messageMetadata),(i.messageId!=null||i.messageMetadata!=null)&&u();break;case"finish":await f(i.messageMetadata),i.messageMetadata!=null&&u();break;case"message-metadata":await f(i.messageMetadata),i.messageMetadata!=null&&u();break;case"error":s==null||s(Error(i.errorText));break;default:if(Zl(i)){(a==null?void 0:a[i.type])!=null&&await is({value:i.data,schema:a[i.type]});let c=i;if(c.transient){o==null||o(c);break}let m=c.id==null?void 0:d.message.parts.find(_=>c.type===_.type&&c.id===_.id);m==null?d.message.parts.push(c):m.data=c.data,o==null||o(c),u()}}l.enqueue(i)})}}))}async function Is({stream:t,onError:e}){let a=t.getReader();try{for(;;){let{done:r}=await a.read();if(r)break}}catch(r){e==null||e(r)}finally{a.releaseLock()}}Ot({prefix:"aitxt",size:24}),Ot({prefix:"aiobj",size:24});var zl=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(t){return new Promise((e,a)=>{this.queue.push(async()=>{try{await t(),e()}catch(r){a(r)}}),this.processQueue()})}};Ot({prefix:"aiobj",size:24}),Nl({},{object:()=>Vl,text:()=>Ul});var Ul=()=>({type:"text",responseFormat:{type:"text"},async parsePartial({text:t}){return{partial:t}},async parseOutput({text:t}){return t}}),Vl=({schema:t})=>{let e=Sl(t);return{type:"object",responseFormat:{type:"json",schema:e.jsonSchema},async parsePartial({text:a}){let r=await Cs(a);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{let s=r.state;throw Error(`Unsupported parse state: ${s}`)}}},async parseOutput({text:a},r){let s=await da({text:a});if(!s.success)throw new ys({message:"No object generated: could not parse the response.",cause:s.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});let n=await za({value:s.value,schema:e});if(!n.success)throw new ys({message:"No object generated: response did not match schema.",cause:n.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});return n.value}}},Bl=ft({name:h(),version:h()}),Ka=ft({_meta:ue(N({}).loose())}),Mt=Ka,Wl=N({method:h(),params:ue(Ka)}),ql=ft({experimental:ue(N({}).loose()),logging:ue(N({}).loose()),prompts:ue(ft({listChanged:ue(ae())})),resources:ue(ft({subscribe:ue(ae()),listChanged:ue(ae())})),tools:ue(ft({listChanged:ue(ae())}))});Mt.extend({protocolVersion:h(),capabilities:ql,serverInfo:Bl,instructions:ue(h())});var Kl=Mt.extend({nextCursor:ue(h())}),Jl=N({name:h(),description:ue(h()),inputSchema:N({type:T("object"),properties:ue(N({}).loose())}).loose()}).loose();Kl.extend({tools:$e(Jl)});var Yl=N({type:T("text"),text:h()}).loose(),Hl=N({type:T("image"),data:Sr(),mimeType:h()}).loose(),Ss=N({uri:h(),mimeType:ue(h())}).loose(),Gl=Ss.extend({text:h()}),Ql=Ss.extend({blob:Sr()}),Xl=N({type:T("resource"),resource:ce([Gl,Ql])}).loose();Mt.extend({content:$e(ce([Yl,Hl,Xl])),isError:ae().default(!1).optional()}).or(Mt.extend({toolResult:ee()}));var ca="2.0",ed=N({jsonrpc:T(ca),id:ce([h(),Tt().int()])}).merge(Wl).strict(),td=N({jsonrpc:T(ca),id:ce([h(),Tt().int()]),result:Mt}).strict(),ad=N({jsonrpc:T(ca),id:ce([h(),Tt().int()]),error:N({code:Tt().int(),message:h(),data:ue(ee())})}).strict();ce([ed,N({jsonrpc:T(ca)}).merge(N({method:h(),params:ue(Ka)})).strict(),td,ad]);async function rd({stream:t,onTextPart:e}){let a=t.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:r,value:s}=await a.read();if(r)break;await e(s)}}var sd=()=>fetch;async function nd({api:t,prompt:e,credentials:a,headers:r,body:s,streamProtocol:n="data",setCompletion:o,setLoading:i,setError:l,setAbortController:d,onFinish:u,onError:p,fetch:v=sd()}){try{i(!0),l(void 0);let g=new AbortController;d(g),o("");let x=await v(t,{method:"POST",body:JSON.stringify({prompt:e,...s}),credentials:a,headers:{"Content-Type":"application/json",...r},signal:g.signal}).catch(c=>{throw c});if(!x.ok)throw Error(await x.text()??"Failed to fetch the chat response.");if(!x.body)throw Error("The response body is empty.");let f="";switch(n){case"text":await rd({stream:x.body,onTextPart:c=>{f+=c,o(f)}});break;case"data":await Is({stream:os({stream:x.body,schema:ws}).pipeThrough(new TransformStream({async transform(c){if(!c.success)throw c.error;let m=c.value;if(m.type==="text-delta")f+=m.delta,o(f);else if(m.type==="error")throw Error(m.errorText)}})),onError:c=>{throw c}});break;default:throw Error(`Unknown stream protocol: ${n}`)}return u&&u(e,f),d(null),f}catch(g){if(g.name==="AbortError")return d(null),null;g instanceof Error&&p&&p(g),l(g)}finally{i(!1)}}async function id(t){if(t==null)return[];if(!globalThis.FileList||!(t instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(t).map(async e=>{let{name:a,type:r}=e;return{type:"file",mediaType:r,filename:a,url:await new Promise((s,n)=>{let o=new FileReader;o.onload=i=>{var l;s((l=i.target)==null?void 0:l.result)},o.onerror=i=>n(i),o.readAsDataURL(e)})}}))}var od=class{constructor({api:t="/api/chat",credentials:e,headers:a,body:r,fetch:s,prepareSendMessagesRequest:n,prepareReconnectToStreamRequest:o}){this.api=t,this.credentials=e,this.headers=a,this.body=r,this.fetch=s,this.prepareSendMessagesRequest=n,this.prepareReconnectToStreamRequest=o}async sendMessages({abortSignal:t,...e}){var p;let a=await wt(this.body),r=await wt(this.headers),s=await wt(this.credentials),n=await((p=this.prepareSendMessagesRequest)==null?void 0:p.call(this,{api:this.api,id:e.chatId,messages:e.messages,body:{...a,...e.body},headers:{...r,...e.headers},credentials:s,requestMetadata:e.metadata,trigger:e.trigger,messageId:e.messageId})),o=(n==null?void 0:n.api)??this.api,i=(n==null?void 0:n.headers)===void 0?{...r,...e.headers}:n.headers,l=(n==null?void 0:n.body)===void 0?{...a,...e.body,id:e.chatId,messages:e.messages,trigger:e.trigger,messageId:e.messageId}:n.body,d=(n==null?void 0:n.credentials)??s,u=await(this.fetch??globalThis.fetch)(o,{method:"POST",headers:{"Content-Type":"application/json",...i},body:JSON.stringify(l),credentials:d,signal:t});if(!u.ok)throw Error(await u.text()??"Failed to fetch the chat response.");if(!u.body)throw Error("The response body is empty.");return this.processResponseStream(u.body)}async reconnectToStream(t){var d;let e=await wt(this.body),a=await wt(this.headers),r=await wt(this.credentials),s=await((d=this.prepareReconnectToStreamRequest)==null?void 0:d.call(this,{api:this.api,id:t.chatId,body:{...e,...t.body},headers:{...a,...t.headers},credentials:r,requestMetadata:t.metadata})),n=(s==null?void 0:s.api)??`${this.api}/${t.chatId}/stream`,o=(s==null?void 0:s.headers)===void 0?{...a,...t.headers}:s.headers,i=(s==null?void 0:s.credentials)??r,l=await(this.fetch??globalThis.fetch)(n,{method:"GET",headers:o,credentials:i});if(l.status===204)return null;if(!l.ok)throw Error(await l.text()??"Failed to fetch the chat response.");if(!l.body)throw Error("The response body is empty.");return this.processResponseStream(l.body)}},Ja=class extends od{constructor(t={}){super(t)}processResponseStream(t){return os({stream:t,schema:ws}).pipeThrough(new TransformStream({async transform(e,a){if(!e.success)throw e.error;a.enqueue(e.value)}}))}},ld=class{constructor({generateId:t=Io,id:e=t(),transport:a=new Ja,messageMetadataSchema:r,dataPartSchemas:s,state:n,onError:o,onToolCall:i,onFinish:l,onData:d,sendAutomaticallyWhen:u}){this.activeResponse=void 0,this.jobExecutor=new zl,this.sendMessage=async(p,v)=>{var x;if(p==null){await this.makeRequest({trigger:"submit-message",messageId:(x=this.lastMessage)==null?void 0:x.id,...v});return}let g;if(g="text"in p||"files"in p?{parts:[...Array.isArray(p.files)?p.files:await id(p.files),..."text"in p&&p.text!=null?[{type:"text",text:p.text}]:[]]}:p,p.messageId!=null){let f=this.state.messages.findIndex(c=>c.id===p.messageId);if(f===-1)throw Error(`message with id ${p.messageId} not found`);if(this.state.messages[f].role!=="user")throw Error(`message with id ${p.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,f+1),this.state.replaceMessage(f,{...g,id:p.messageId,role:g.role??"user",metadata:p.metadata})}else this.state.pushMessage({...g,id:g.id??this.generateId(),role:g.role??"user",metadata:p.metadata});await this.makeRequest({trigger:"submit-message",messageId:p.messageId,...v})},this.regenerate=async({messageId:p,...v}={})=>{let g=p==null?this.state.messages.length-1:this.state.messages.findIndex(x=>x.id===p);if(g===-1)throw Error(`message ${p} not found`);this.state.messages=this.state.messages.slice(0,this.messages[g].role==="assistant"?g:g+1),await this.makeRequest({trigger:"regenerate-message",messageId:p,...v})},this.resumeStream=async(p={})=>{await this.makeRequest({trigger:"resume-stream",...p})},this.clearError=()=>{this.status==="error"&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolResult=async({tool:p,toolCallId:v,output:g})=>this.jobExecutor.run(async()=>{var c,m;let x=this.state.messages,f=x[x.length-1];this.state.replaceMessage(x.length-1,{...f,parts:f.parts.map(_=>Ts(_)&&_.toolCallId===v?{..._,state:"output-available",output:g}:_)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(_=>Ts(_)&&_.toolCallId===v?{..._,state:"output-available",output:g,errorText:void 0}:_)),this.status!=="streaming"&&this.status!=="submitted"&&((c=this.sendAutomaticallyWhen)!=null&&c.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:(m=this.lastMessage)==null?void 0:m.id})}),this.stop=async()=>{var p;this.status!=="streaming"&&this.status!=="submitted"||(p=this.activeResponse)!=null&&p.abortController&&this.activeResponse.abortController.abort()},this.id=e,this.transport=a,this.generateId=t,this.messageMetadataSchema=r,this.dataPartSchemas=s,this.state=n,this.onError=o,this.onToolCall=i,this.onFinish=l,this.onData=d,this.sendAutomaticallyWhen=u}get status(){return this.state.status}setStatus({status:t,error:e}){this.status!==t&&(this.state.status=t,this.state.error=e)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(t){this.state.messages=t}async makeRequest({trigger:t,metadata:e,headers:a,body:r,messageId:s}){var u,p;var n;this.setStatus({status:"submitted",error:void 0});let o=this.lastMessage,i=!1,l=!1,d=!1;try{let v={state:Dl({lastMessage:this.state.snapshot(o),messageId:this.generateId()}),abortController:new AbortController};v.abortController.signal.addEventListener("abort",()=>{i=!0}),this.activeResponse=v;let g;if(t==="resume-stream"){let x=await this.transport.reconnectToStream({chatId:this.id,metadata:e,headers:a,body:r});if(x==null){this.setStatus({status:"ready"});return}g=x}else g=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:v.abortController.signal,metadata:e,headers:a,body:r,trigger:t,messageId:s});await Is({stream:Fl({stream:g,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:x=>this.jobExecutor.run(()=>x({state:v.state,write:()=>{var f;this.setStatus({status:"streaming"}),v.state.message.id===((f=this.lastMessage)==null?void 0:f.id)?this.state.replaceMessage(this.state.messages.length-1,v.state.message):this.state.pushMessage(v.state.message)}})),onError:x=>{throw x}}),onError:x=>{throw x}}),this.setStatus({status:"ready"})}catch(v){if(i||v.name==="AbortError")return i=!0,this.setStatus({status:"ready"}),null;d=!0,v instanceof TypeError&&(v.message.toLowerCase().includes("fetch")||v.message.toLowerCase().includes("network"))&&(l=!0),this.onError&&v instanceof Error&&this.onError(v),this.setStatus({status:"error",error:v})}finally{try{(n=this.onFinish)==null||n.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:i,isDisconnect:l,isError:d})}catch(v){console.error(v)}this.activeResponse=void 0}(u=this.sendAutomaticallyWhen)!=null&&u.call(this,{messages:this.state.messages})&&await this.makeRequest({trigger:"submit-message",messageId:(p=this.lastMessage)==null?void 0:p.id,metadata:e,headers:a,body:r})}},dd=N({type:T("text"),text:h(),state:Bt(["streaming","done"]).optional(),providerMetadata:L.optional()}),ud=N({type:T("reasoning"),text:h(),state:Bt(["streaming","done"]).optional(),providerMetadata:L.optional()}),cd=N({type:T("source-url"),sourceId:h(),url:h(),title:h().optional(),providerMetadata:L.optional()}),pd=N({type:T("source-document"),sourceId:h(),mediaType:h(),title:h(),filename:h().optional(),providerMetadata:L.optional()}),md=N({type:T("file"),mediaType:h(),filename:h().optional(),url:h(),providerMetadata:L.optional()}),hd=N({type:T("step-start")}),fd=N({type:h().startsWith("data-"),id:h().optional(),data:ee()}),gd=[N({type:T("dynamic-tool"),toolName:h(),toolCallId:h(),state:T("input-streaming"),input:ee().optional(),output:Ie().optional(),errorText:Ie().optional()}),N({type:T("dynamic-tool"),toolName:h(),toolCallId:h(),state:T("input-available"),input:ee(),output:Ie().optional(),errorText:Ie().optional(),callProviderMetadata:L.optional()}),N({type:T("dynamic-tool"),toolName:h(),toolCallId:h(),state:T("output-available"),input:ee(),output:ee(),errorText:Ie().optional(),callProviderMetadata:L.optional(),preliminary:ae().optional()}),N({type:T("dynamic-tool"),toolName:h(),toolCallId:h(),state:T("output-error"),input:ee(),output:Ie().optional(),errorText:h(),callProviderMetadata:L.optional()})],yd=[N({type:h().startsWith("tool-"),toolCallId:h(),state:T("input-streaming"),input:ee().optional(),output:Ie().optional(),errorText:Ie().optional()}),N({type:h().startsWith("tool-"),toolCallId:h(),state:T("input-available"),input:ee(),output:Ie().optional(),errorText:Ie().optional(),callProviderMetadata:L.optional()}),N({type:h().startsWith("tool-"),toolCallId:h(),state:T("output-available"),input:ee(),output:ee(),errorText:Ie().optional(),callProviderMetadata:L.optional(),preliminary:ae().optional()}),N({type:h().startsWith("tool-"),toolCallId:h(),state:T("output-error"),input:ee(),output:Ie().optional(),errorText:h(),callProviderMetadata:L.optional()})];N({id:h(),role:Bt(["system","user","assistant"]),metadata:ee().optional(),parts:$e(ce([dd,ud,cd,pd,md,hd,fd,...gd,...yd]))});var vd=Cn(((t,e)=>{function a(r,s){if(typeof r!="function")throw TypeError(`Expected the first argument to be a \`function\`, got \`${typeof r}\`.`);let n,o=0;return function(...i){clearTimeout(n);let l=Date.now(),d=s-(l-o);d<=0?(o=l,r.apply(this,i)):n=setTimeout(()=>{o=Date.now(),r.apply(this,i)},d)}}e.exports=a})),As=Object.prototype.hasOwnProperty;function Ya(t,e){var a,r;if(t===e)return!0;if(t&&e&&(a=t.constructor)===e.constructor){if(a===Date)return t.getTime()===e.getTime();if(a===RegExp)return t.toString()===e.toString();if(a===Array){if((r=t.length)===e.length)for(;r--&&Ya(t[r],e[r]););return r===-1}if(!a||typeof t=="object"){for(a in r=0,t)if(As.call(t,a)&&++r&&!As.call(e,a)||!(a in e)||!Ya(t[a],e[a]))return!1;return Object.keys(e).length===r}}return t!==t&&e!==e}var R=dt(In(),1),Je=new WeakMap,pt=()=>{},he=void 0,pa=Object,D=t=>t===he,je=t=>typeof t=="function",Ye=(t,e)=>({...t,...e}),Ns=t=>je(t.then),Ha={},ma={},Ga="undefined",jt=typeof window!=Ga,Qa=typeof document!=Ga,_d=jt&&"Deno"in window,bd=()=>jt&&typeof window.requestAnimationFrame!=Ga,Os=(t,e)=>{let a=Je.get(t);return[()=>!D(e)&&t.get(e)||Ha,r=>{if(!D(e)){let s=t.get(e);e in ma||(ma[e]=s),a[5](e,Ye(s,r),s||Ha)}},a[6],()=>!D(e)&&e in ma?ma[e]:!D(e)&&t.get(e)||Ha]},Xa=!0,xd=()=>Xa,[er,tr]=jt&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[pt,pt],wd=()=>{let t=Qa&&document.visibilityState;return D(t)||t!=="hidden"},kd=t=>(Qa&&document.addEventListener("visibilitychange",t),er("focus",t),()=>{Qa&&document.removeEventListener("visibilitychange",t),tr("focus",t)}),Cd=t=>{let e=()=>{Xa=!0,t()},a=()=>{Xa=!1};return er("online",e),er("offline",a),()=>{tr("online",e),tr("offline",a)}},Td={isOnline:xd,isVisible:wd},Ed={initFocus:kd,initReconnect:Cd},Rs=!R.useId,Pt=!jt||_d,Id=t=>bd()?window.requestAnimationFrame(t):setTimeout(t,1),ha=Pt?R.useEffect:R.useLayoutEffect,ar=typeof navigator<"u"&&navigator.connection,Ms=!Pt&&ar&&(["slow-2g","2g"].includes(ar.effectiveType)||ar.saveData),fa=new WeakMap,Sd=t=>pa.prototype.toString.call(t),rr=(t,e)=>t===`[object ${e}]`,Ad=0,sr=t=>{let e=typeof t,a=Sd(t),r=rr(a,"Date"),s=rr(a,"RegExp"),n=rr(a,"Object"),o,i;if(pa(t)===t&&!r&&!s){if(o=fa.get(t),o)return o;if(o=++Ad+"~",fa.set(t,o),Array.isArray(t)){for(o="@",i=0;i<t.length;i++)o+=sr(t[i])+",";fa.set(t,o)}if(n){o="#";let l=pa.keys(t).sort();for(;!D(i=l.pop());)D(t[i])||(o+=i+":"+sr(t[i])+",");fa.set(t,o)}}else o=r?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return o},nr=t=>{if(je(t))try{t=t()}catch{t=""}let e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?sr(t):"",[t,e]},Nd=0,ir=()=>++Nd;async function js(...t){let[e,a,r,s]=t,n=Ye({populateCache:!0,throwOnError:!0},typeof s=="boolean"?{revalidate:s}:s||{}),o=n.populateCache,i=n.rollbackOnError,l=n.optimisticData,d=v=>typeof i=="function"?i(v):i!==!1,u=n.throwOnError;if(je(a)){let v=a,g=[],x=e.keys();for(let f of x)!/^\$(inf|sub)\$/.test(f)&&v(e.get(f)._k)&&g.push(f);return Promise.all(g.map(p))}return p(a);async function p(v){let[g]=nr(v);if(!g)return;let[x,f]=Os(e,g),[c,m,_,C]=Je.get(e),A=()=>{let Q=c[g];return(je(n.revalidate)?n.revalidate(x().data,v):n.revalidate!==!1)&&(delete _[g],delete C[g],Q&&Q[0])?Q[0](2).then(()=>x().data):x().data};if(t.length<3)return A();let E=r,P,z=!1,j=ir();m[g]=[j,0];let G=!D(l),$=x(),le=$.data,de=$._c,re=D(de)?le:de;if(G&&(l=je(l)?l(re,le):l,f({data:l,_c:re})),je(E))try{E=E(re)}catch(Q){P=Q,z=!0}if(E&&Ns(E))if(E=await E.catch(Q=>{P=Q,z=!0}),j!==m[g][0]){if(z)throw P;return E}else z&&G&&d(P)&&(o=!0,f({data:re,_c:he}));if(o&&(z||(je(o)?f({data:o(E,re),error:he,_c:he}):f({data:E,error:he,_c:he}))),m[g][1]=ir(),Promise.resolve(A()).then(()=>{f({_c:he})}),z){if(u)throw P;return}return E}}var Ps=(t,e)=>{for(let a in t)t[a][0]&&t[a][0](e)},Zs=(t,e)=>{if(!Je.has(t)){let a=Ye(Ed,e),r=Object.create(null),s=js.bind(he,t),n=pt,o=Object.create(null),i=(u,p)=>{let v=o[u]||[];return o[u]=v,v.push(p),()=>v.splice(v.indexOf(p),1)},l=(u,p,v)=>{t.set(u,p);let g=o[u];if(g)for(let x of g)x(p,v)},d=()=>{if(!Je.has(t)&&(Je.set(t,[r,Object.create(null),Object.create(null),Object.create(null),s,l,i]),!Pt)){let u=a.initFocus(setTimeout.bind(he,Ps.bind(he,r,0))),p=a.initReconnect(setTimeout.bind(he,Ps.bind(he,r,1)));n=()=>{u&&u(),p&&p(),Je.delete(t)}}};return d(),[t,s,d,n]}return[t,Je.get(t)[4]]},Od=(t,e,a,r,s)=>{let n=a.errorRetryCount,o=s.retryCount,i=~~((Math.random()+.5)*(1<<(o<8?o:8)))*a.errorRetryInterval;!D(n)&&o>n||setTimeout(r,i,s)},Rd=Ya,[or,Md]=Zs(new Map),$s=Ye({onLoadingSlow:pt,onSuccess:pt,onError:pt,onErrorRetry:Od,onDiscarded:pt,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Ms?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:Ms?5e3:3e3,compare:Rd,isPaused:()=>!1,cache:or,mutate:Md,fallback:{}},Td),Ls=(t,e)=>{let a=Ye(t,e);if(e){let{use:r,fallback:s}=t,{use:n,fallback:o}=e;r&&n&&(a.use=r.concat(n)),s&&o&&(a.fallback=Ye(s,o))}return a},lr=(0,R.createContext)({}),jd=t=>{let{value:e}=t,a=(0,R.useContext)(lr),r=je(e),s=(0,R.useMemo)(()=>r?e(a):e,[r,a,e]),n=(0,R.useMemo)(()=>r?s:Ls(a,s),[r,a,s]),o=s&&s.provider,i=(0,R.useRef)(he);o&&!i.current&&(i.current=Zs(o(n.cache||or),s));let l=i.current;return l&&(n.cache=l[0],n.mutate=l[1]),ha(()=>{if(l)return l[2]&&l[2](),l[3]},[]),(0,R.createElement)(lr.Provider,Ye(t,{value:n}))},Ds=jt&&window.__SWR_DEVTOOLS_USE__,Pd=Ds?window.__SWR_DEVTOOLS_USE__:[],Zd=()=>{Ds&&(window.__SWR_DEVTOOLS_REACT__=R.default)},$d=t=>je(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],Ld=()=>Ye($s,(0,R.useContext)(lr)),Dd=Pd.concat(t=>(e,a,r)=>t(e,a&&((...s)=>{let[n]=nr(e),[,,,o]=Je.get(or);if(n.startsWith("$inf$"))return a(...s);let i=o[n];return D(i)?a(...s):(delete o[n],i)}),r)),Fd=t=>function(...e){let a=Ld(),[r,s,n]=$d(e),o=Ls(a,n),i=t,{use:l}=o,d=(l||[]).concat(Dd);for(let u=d.length;u--;)i=d[u](i);return i(r,s||o.fetcher||null,o)},zd=(t,e,a)=>{let r=e[t]||(e[t]=[]);return r.push(a),()=>{let s=r.indexOf(a);s>=0&&(r[s]=r[r.length-1],r.pop())}};Zd();var Ud=dt(Ni(),1),dr=R.use||(t=>{switch(t.status){case"pending":throw t;case"fulfilled":return t.value;case"rejected":throw t.reason;default:throw t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t}}),ur={dedupe:!0},Vd=(t,e,a)=>{let{cache:r,compare:s,suspense:n,fallbackData:o,revalidateOnMount:i,revalidateIfStale:l,refreshInterval:d,refreshWhenHidden:u,refreshWhenOffline:p,keepPreviousData:v}=a,[g,x,f,c]=Je.get(r),[m,_]=nr(t),C=(0,R.useRef)(!1),A=(0,R.useRef)(!1),E=(0,R.useRef)(m),P=(0,R.useRef)(e),z=(0,R.useRef)(a),j=()=>z.current,G=()=>j().isVisible()&&j().isOnline(),[$,le,de,re]=Os(r,m),Q=(0,R.useRef)({}).current,q=D(o)?D(a.fallback)?he:a.fallback[m]:o,K=(U,V)=>{for(let te in Q){let B=te;if(B==="data"){if(!s(U[B],V[B])&&(!D(U[B])||!s(Ne,V[B])))return!1}else if(V[B]!==U[B])return!1}return!0},se=(0,R.useMemo)(()=>{let U=!m||!e?!1:D(i)?j().isPaused()||n?!1:l!==!1:i,V=ie=>{let be=Ye(ie);return delete be._k,U?{isValidating:!0,isLoading:!0,...be}:be},te=$(),B=re(),Te=V(te),ge=te===B?Te:V(B),ne=Te;return[()=>{let ie=V($());return K(ie,ne)?(ne.data=ie.data,ne.isLoading=ie.isLoading,ne.isValidating=ie.isValidating,ne.error=ie.error,ne):(ne=ie,ie)},()=>ge]},[r,m]),X=(0,Ud.useSyncExternalStore)((0,R.useCallback)(U=>de(m,(V,te)=>{K(te,V)||U()}),[r,m]),se[0],se[1]),Ae=!C.current,ve=g[m]&&g[m].length>0,_e=X.data,Ce=D(_e)?q&&Ns(q)?dr(q):q:_e,Ge=X.error,Qe=(0,R.useRef)(Ce),Ne=v?D(_e)?D(Qe.current)?Ce:Qe.current:_e:Ce,ot=ve&&!D(Ge)?!1:Ae&&!D(i)?i:j().isPaused()?!1:n?D(Ce)?!1:l:D(Ce)||l,Ue=!!(m&&e&&Ae&&ot),ht=D(X.isValidating)?Ue:X.isValidating,Xe=D(X.isLoading)?Ue:X.isLoading,Ze=(0,R.useCallback)(async U=>{let V=P.current;if(!m||!V||A.current||j().isPaused())return!1;let te,B,Te=!0,ge=U||{},ne=!f[m]||!ge.dedupe,ie=()=>Rs?!A.current&&m===E.current&&C.current:m===E.current,be={isValidating:!1,isLoading:!1},Be=()=>{le(be)},We=()=>{let oe=f[m];oe&&oe[1]===B&&delete f[m]},lt={isValidating:!0};D($().data)&&(lt.isLoading=!0);try{if(ne&&(le(lt),a.loadingTimeout&&D($().data)&&setTimeout(()=>{Te&&ie()&&j().onLoadingSlow(m,a)},a.loadingTimeout),f[m]=[V(_),ir()]),[te,B]=f[m],te=await te,ne&&setTimeout(We,a.dedupingInterval),!f[m]||f[m][1]!==B)return ne&&ie()&&j().onDiscarded(m),!1;be.error=he;let oe=x[m];if(!D(oe)&&(B<=oe[0]||B<=oe[1]||oe[1]===0))return Be(),ne&&ie()&&j().onDiscarded(m),!1;let me=$().data;be.data=s(me,te)?me:te,ne&&ie()&&j().onSuccess(te,m,a)}catch(oe){We();let me=j(),{shouldRetryOnError:et}=me;me.isPaused()||(be.error=oe,ne&&ie()&&(me.onError(oe,m,me),(et===!0||je(et)&&et(oe))&&(!j().revalidateOnFocus||!j().revalidateOnReconnect||G())&&me.onErrorRetry(oe,m,me,xe=>{let Ee=g[m];Ee&&Ee[0]&&Ee[0](3,xe)},{retryCount:(ge.retryCount||0)+1,dedupe:!0})))}return Te=!1,Be(),!0},[m,r]),Ve=(0,R.useCallback)((...U)=>js(r,E.current,...U),[]);if(ha(()=>{P.current=e,z.current=a,D(_e)||(Qe.current=_e)}),ha(()=>{if(!m)return;let U=Ze.bind(he,ur),V=0;j().revalidateOnFocus&&(V=Date.now()+j().focusThrottleInterval);let te=zd(m,g,(B,Te={})=>{if(B==0){let ge=Date.now();j().revalidateOnFocus&&ge>V&&G()&&(V=ge+j().focusThrottleInterval,U())}else if(B==1)j().revalidateOnReconnect&&G()&&U();else{if(B==2)return Ze();if(B==3)return Ze(Te)}});return A.current=!1,E.current=m,C.current=!0,le({_k:_}),ot&&(f[m]||(D(Ce)||Pt?U():Id(U))),()=>{A.current=!0,te()}},[m]),ha(()=>{let U;function V(){let B=je(d)?d($().data):d;B&&U!==-1&&(U=setTimeout(te,B))}function te(){!$().error&&(u||j().isVisible())&&(p||j().isOnline())?Ze(ur).then(V):V()}return V(),()=>{U&&(U=(clearTimeout(U),-1))}},[d,u,p,m]),(0,R.useDebugValue)(Ne),n&&D(Ce)&&m){if(!Rs&&Pt)throw Error("Fallback data is required when using Suspense in SSR.");P.current=e,z.current=a,A.current=!1;let U=c[m];if(D(U)||dr(Ve(U)),D(Ge)){let V=Ze(ur);D(Ne)||(V.status="fulfilled",V.value=!0),dr(V)}else throw Ge}return{mutate:Ve,get data(){return Q.data=!0,Ne},get error(){return Q.error=!0,Ge},get isValidating(){return Q.isValidating=!0,ht},get isLoading(){return Q.isLoading=!0,Xe}}};pa.defineProperty(jd,"defaultValue",{value:$s});var Fs=Fd(Vd),Bd=dt(vd(),1),zs=(t,e,a)=>{if(!e.has(t))throw TypeError("Cannot "+a)},H=(t,e,a)=>(zs(t,e,"read from private field"),a?a.call(t):e.get(t)),ze=(t,e,a)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,a)},nt=(t,e,a,r)=>(zs(t,e,"write to private field"),r?r.call(t,a):e.set(t,a),a);function Us(t,e){return e==null?t:(0,Bd.default)(t,e)}var Se,ga,ya,Zt,$t,Lt,kt,cr,pr,Wd=class{constructor(t=[]){ze(this,Se,void 0),ze(this,ga,"ready"),ze(this,ya,void 0),ze(this,Zt,new Set),ze(this,$t,new Set),ze(this,Lt,new Set),this.pushMessage=e=>{nt(this,Se,H(this,Se).concat(e)),H(this,kt).call(this)},this.popMessage=()=>{nt(this,Se,H(this,Se).slice(0,-1)),H(this,kt).call(this)},this.replaceMessage=(e,a)=>{nt(this,Se,[...H(this,Se).slice(0,e),this.snapshot(a),...H(this,Se).slice(e+1)]),H(this,kt).call(this)},this.snapshot=e=>structuredClone(e),this["~registerMessagesCallback"]=(e,a)=>{let r=a?Us(e,a):e;return H(this,Zt).add(r),()=>{H(this,Zt).delete(r)}},this["~registerStatusCallback"]=e=>(H(this,$t).add(e),()=>{H(this,$t).delete(e)}),this["~registerErrorCallback"]=e=>(H(this,Lt).add(e),()=>{H(this,Lt).delete(e)}),ze(this,kt,()=>{H(this,Zt).forEach(e=>e())}),ze(this,cr,()=>{H(this,$t).forEach(e=>e())}),ze(this,pr,()=>{H(this,Lt).forEach(e=>e())}),nt(this,Se,t)}get status(){return H(this,ga)}set status(t){nt(this,ga,t),H(this,cr).call(this)}get error(){return H(this,ya)}set error(t){nt(this,ya,t),H(this,pr).call(this)}get messages(){return H(this,Se)}set messages(t){nt(this,Se,[...t]),H(this,kt).call(this)}};Se=new WeakMap,ga=new WeakMap,ya=new WeakMap,Zt=new WeakMap,$t=new WeakMap,Lt=new WeakMap,kt=new WeakMap,cr=new WeakMap,pr=new WeakMap;var Ct,Vs=class extends ld{constructor({messages:t,...e}){let a=new Wd(t);super({...e,state:a}),ze(this,Ct,void 0),this["~registerMessagesCallback"]=(r,s)=>H(this,Ct)["~registerMessagesCallback"](r,s),this["~registerStatusCallback"]=r=>H(this,Ct)["~registerStatusCallback"](r),this["~registerErrorCallback"]=r=>H(this,Ct)["~registerErrorCallback"](r),nt(this,Ct,a)}};Ct=new WeakMap;function Bs({experimental_throttle:t,resume:e=!1,...a}={}){let r=(0,R.useRef)("chat"in a?a.chat:new Vs(a));("chat"in a&&a.chat!==r.current||"id"in a&&r.current.id!==a.id)&&(r.current="chat"in a?a.chat:new Vs(a));let s=(0,R.useSyncExternalStore)((0,R.useCallback)(l=>r.current["~registerMessagesCallback"](l,t),[t,"id"in a?a.id:null]),()=>r.current.messages,()=>r.current.messages),n=(0,R.useSyncExternalStore)(r.current["~registerStatusCallback"],()=>r.current.status,()=>r.current.status),o=(0,R.useSyncExternalStore)(r.current["~registerErrorCallback"],()=>r.current.error,()=>r.current.error),i=(0,R.useCallback)(l=>{typeof l=="function"&&(l=l(r.current.messages)),r.current.messages=l},[r]);return(0,R.useEffect)(()=>{e&&r.current.resumeStream()},[e,r]),{id:r.current.id,messages:s,setMessages:i,sendMessage:r.current.sendMessage,regenerate:r.current.regenerate,clearError:r.current.clearError,stop:r.current.stop,error:o,resumeStream:r.current.resumeStream,status:n,addToolResult:r.current.addToolResult}}function qd({api:t="/api/completion",id:e,initialCompletion:a="",initialInput:r="",credentials:s,headers:n,body:o,streamProtocol:i="data",fetch:l,onFinish:d,onError:u,experimental_throttle:p}={}){let v=(0,R.useId)(),g=e||v,{data:x,mutate:f}=Fs([t,g],null,{fallbackData:a}),{data:c=!1,mutate:m}=Fs([g,"loading"],null),[_,C]=(0,R.useState)(void 0),A=x,[E,P]=(0,R.useState)(null),z=(0,R.useRef)({credentials:s,headers:n,body:o});(0,R.useEffect)(()=>{z.current={credentials:s,headers:n,body:o}},[s,n,o]);let j=(0,R.useCallback)(async(q,K)=>nd({api:t,prompt:q,credentials:z.current.credentials,headers:{...z.current.headers,...K==null?void 0:K.headers},body:{...z.current.body,...K==null?void 0:K.body},streamProtocol:i,fetch:l,setCompletion:Us(se=>f(se,!1),p),setLoading:m,setError:C,setAbortController:P,onFinish:d,onError:u}),[f,m,t,z,P,d,u,C,i,l,p]),G=(0,R.useCallback)(()=>{E&&(E.abort(),P(null))},[E]),$=(0,R.useCallback)(q=>{f(q,!1)},[f]),le=(0,R.useCallback)(async(q,K)=>j(q,K),[j]),[de,re]=(0,R.useState)(r),Q=(0,R.useCallback)(q=>{var K;return(K=q==null?void 0:q.preventDefault)==null||K.call(q),de?le(de):void 0},[de,le]);return{completion:A,complete:le,error:_,setCompletion:$,stop:G,input:de,setInput:re,handleInputChange:(0,R.useCallback)(q=>{re(q.target.value)},[re]),handleSubmit:Q,isLoading:c}}var Ws=class extends Error{constructor(t,e="TOOL_ERROR",a=!1,r,s){super(t),this.name="ToolExecutionError",this.code=e,this.isRetryable=a,this.suggestedFix=r,this.meta=s}toStructuredString(){let t=JSON.stringify({message:this.message,code:this.code,is_retryable:this.isRetryable,suggested_fix:this.suggestedFix,meta:this.meta??{}});return`Error invoking tool ${this.name}: ${t}`}};N({status:Bt(["success","error","warning"]).optional(),auth_required:ae().optional(),next_steps:$e(h()).optional(),action_url:h().optional(),message:h().optional(),meta:Vt(h(),ee()).optional()});var qs,Dt;function Kd(t,e,a,r,s){var n={};return Object.keys(r).forEach(function(o){n[o]=r[o]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=a.slice().reverse().reduce(function(o,i){return i(t,e,o)||o},n),s&&n.initializer!==void 0&&(n.value=n.initializer?n.initializer.call(s):void 0,n.initializer=void 0),n.initializer===void 0?(Object.defineProperty(t,e,n),null):n}const mr=new(qs=Un(),Dt=class{constructor(t=[]){J(this,"tools",new Map);this.tools=new Map(t.map(e=>[e.name,e]))}has(t){return this.tools.has(t)}getToolOrThrow(t){let e=this.tools.get(t);if(!e)throw Error(`Tool ${t} not found`);return e}async invoke(t,e){var o;let a=this.getToolOrThrow(t),r=a.handler,s=a.schema,n=a.outputSchema;try{let i=await s.safeParseAsync(e);if(i.error){let p=Ar(i.error);throw Error(`Tool ${t} returned invalid input: ${p}`)}let l=i.data,d=await r(l),u=await n.safeParseAsync(d);if(u.error){let p=Ar(u.error);throw Error(`Tool ${t} returned invalid output: ${p}`)}return{tool_name:t,result:u.data,error:null}}catch(i){return i instanceof Ws?{tool_name:t,result:null,error:i.toStructuredString()}:{tool_name:t,result:null,error:new Ws(i instanceof Error?i.message:String(i),"TOOL_ERROR",!1,"Check the error message and try again with valid arguments.",{args:e,errorType:((o=i==null?void 0:i.constructor)==null?void 0:o.name)??typeof i}).toStructuredString()}}}getToolSchemas(){return[...this.tools.values()].map(t=>({name:t.name,description:t.description,parameters:Ir(t.schema),source:"frontend",mode:t.mode}))}},Kd(Dt.prototype,"getToolSchemas",[qs],Object.getOwnPropertyDescriptor(Dt.prototype,"getToolSchemas"),Dt.prototype),Dt)([]);function hr(t,e){return new Promise(a=>{let r=new FileReader;r.readAsDataURL(t),r.onload=s=>{var n;if((n=s.target)!=null&&n.result){let o=s.target.result;a(e==="base64"?o.slice(o.indexOf(",")+1):o)}}})}function Jd(t){return Promise.all(t.map(e=>hr(e,"base64").then(a=>[e.name,a])))}function Yd(t,e){return t?!!(["image/","video/","audio/","application/pdf"].some(a=>t.startsWith(a))||["svg","vega"].some(a=>t.includes(a))||t==="text/html"&&["<img","<video","<audio","<iframe","<canvas","<svg","<marimo-ui-element"].some(a=>e.includes(a))):!1}var Hd=class extends It{constructor(e){super();J(this,"title","Cell Outputs");J(this,"mentionPrefix","@");J(this,"contextType","cell-output");this.store=e}getItems(){let e=this.store.get(Rn),a=[];for(let[r,s]of e.cellIds.inOrderIds.entries()){let n=e.cellRuntime[s];if(!(n!=null&&n.output)||gi(n.output))continue;let o=e.cellData[s],i=n.output,l=i.mimetype,d=Yd(l,String(i.data))?"media":"text",u=Fn(o.name,r),p,v,g=!1;d==="text"&&typeof i.data=="string"&&(p=l==="text/html"?ji(i.data):i.data),d==="media"&&(typeof i.data=="string"&&i.data.startsWith("data:")||typeof i.data=="string"&&i.data.startsWith("http")?v=i.data:g=!0),a.push({uri:this.asURI(s),name:u,type:this.contextType,description:`Cell output (${l||"unknown"})`,data:{cellId:s,cellName:u,cellCode:(o==null?void 0:o.code)||"",output:i,outputType:d,processedContent:p,imageUrl:v,shouldDownloadImage:g}})}return a}formatCompletion(e){let{data:a}=e;return{label:`@${a.cellName}`,displayLabel:a.cellName,detail:`${a.outputType} output`,boost:a.outputType==="media"?yt.HIGH:yt.MEDIUM,type:this.contextType,section:gt.CELL_OUTPUT,apply:`@${a.cellName}`,info:()=>{let r=document.createElement("div");r.classList.add("mo-cm-tooltip","docs-documentation","min-w-[300px]","max-w-[500px]","flex","flex-col","gap-2");let s=document.createElement("div");s.classList.add("flex","flex-col","gap-1");let n=document.createElement("div");n.classList.add("font-bold","text-base"),n.textContent=a.cellName,s.append(n);let o=document.createElement("div");if(o.classList.add("text-sm","text-muted-foreground"),s.append(o),r.append(s),a.cellCode){let i=document.createElement("div");i.classList.add("text-xs","font-medium","text-muted-foreground"),i.textContent="Code:",r.append(i);let l=document.createElement("div");l.classList.add("text-xs","font-mono","bg-muted","p-2","rounded","max-h-20","overflow-y-auto"),l.textContent=a.cellCode.slice(0,200)+(a.cellCode.length>200?"...":""),r.append(l)}if(a.processedContent){let i=document.createElement("div");i.classList.add("text-xs","font-medium","text-muted-foreground","mt-2"),i.textContent="Output Preview:",r.append(i);let l=document.createElement("div");l.classList.add("text-xs","bg-muted","p-2","rounded","max-h-24","overflow-y-auto","mb-2"),l.textContent=a.processedContent.slice(0,300)+(a.processedContent.length>300?"...":""),r.append(l)}if(a.outputType==="media"){let i=document.createElement("div");i.classList.add("text-xs","text-muted-foreground","italic","mb-2"),i.textContent="A screenshot of the output will be attached",r.append(i)}return r}}}formatContext(e){let{data:a}=e,r={name:a.cellName,cellId:a.cellId,outputType:a.outputType,mimetype:a.output.mimetype},s=`Cell Code:
${a.cellCode}

`;return a.outputType==="text"&&a.processedContent?s+=`Output:
${a.processedContent}`:a.outputType==="media"&&(s+=`Media Output: Contains ${a.output.mimetype} content`,a.imageUrl&&(s+=`
Image URL: ${a.imageUrl}`)),Et({type:this.contextType,data:r,details:s})}async getAttachments(e){let a=e.filter(s=>s.data.shouldDownloadImage&&s.data.outputType==="media");if(a.length===0)return[];let r=a.flatMap(s=>{let n=document.getElementById(On.create(s.data.cellId));return n?{cellId:s.data.cellId,cellName:s.data.cellName,mimetype:s.data.output.mimetype,element:n}:(pe.warn(`Output element not found for cell ${s.data.cellId}`),[])});try{return await Promise.all(r.map(async s=>({type:"file",filename:`${s.cellName}-output-screenshot`,mediaType:"image/png",url:await Mi(s.element)})))}catch(s){return pe.error("Error downloading cell output images:",s),[]}}};function Gd(t){return t.type==="setup-refs"?"The setup cell cannot have references":t.type==="cycle"?"This cell is in a cycle":t.type==="multiple-defs"?`The variable '${t.name}' was defined by another cell`:t.type==="import-star"||t.type==="ancestor-stopped"||t.type==="ancestor-prevented"||t.type==="exception"||t.type==="strict-exception"?t.msg:t.type==="interruption"?"This cell was interrupted and needs to be re-run":t.type==="syntax"||t.type==="unknown"||t.type==="sql-error"?t.msg:t.type==="internal"?t.msg||"An internal error occurred":(Si(t),"Unknown error")}var Ks=new Bn("error","errors"),Qd=class extends It{constructor(e){super();J(this,"title","Errors");J(this,"mentionPrefix","@");J(this,"contextType","error");this.store=e}getItems(){let e=this.store.get(Dn);return e.length===0?[]:[{uri:this.asURI("all"),name:"Errors",type:this.contextType,data:{type:"all-errors",errors:e.map(a=>({cellId:a.cellId,cellName:a.cellName,errorData:a.output.data}))},description:"All errors in the notebook"}]}formatCompletion(e){return e.data.type==="all-errors"?{label:"@Errors",displayLabel:"Errors",detail:`${e.data.errors.length} ${Ks.pluralize(e.data.errors.length)}`,type:"error",apply:"@Errors",section:gt.ERROR,info:()=>{let a=document.createElement("div");a.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let r=document.createElement("div");r.classList.add("flex","flex-col","gap-1");let s=document.createElement("div");s.classList.add("font-bold","text-base"),s.textContent="Errors",r.append(s);let n=document.createElement("div");return n.classList.add("text-sm","text-muted-foreground"),n.textContent=`${e.data.errors.length} ${Ks.pluralize(e.data.errors.length)}`,r.append(n),a.append(r),a}}:{label:"Error",displayLabel:"Error",section:gt.ERROR}}formatContext(e){let{data:a}=e;return a.errors.map(r=>Et({type:this.contextType,data:{name:r.cellName||`Cell ${r.cellId}`,description:r.errorData.map(s=>Gd(s)).join(`
`)}})).join(`

`)}};const Js=Zn();var Xd={maxDepth:3,maxResults:20,defaultResultsLimit:5,includeDirectories:!1},eu=class extends It{constructor(e,a=Xd){super();J(this,"title","Files");J(this,"mentionPrefix","#");J(this,"contextType","file");J(this,"searchFiles",async(e,a={})=>{let{maxDepth:r,maxResults:s,includeDirectories:n}={...this.config,...a};return(await this.apiRequests.sendSearchFiles({query:e,includeFiles:!0,includeDirectories:n,depth:r,limit:s})).files});this.apiRequests=e,this.config=a}createCompletionSource(){return async e=>{let a=e.matchBefore(/#[^\s#]*/);if(!a)return null;let r=a.text;if(!r.startsWith("#"))return null;let s=r.slice(1);if(s.length===0)return this.getDefaultCompletions(a);try{let n=(await this.searchFiles(s)||[]).map(o=>{let i={uri:this.asURI(o.path),name:o.name,type:this.contextType,description:o.isDirectory?"Directory":"File",data:{path:o.path,isDirectory:o.isDirectory}};return this.formatCompletion(i)});return{from:a.from,options:n}}catch(n){return pe.error("Failed to search files:",n),null}}}async getDefaultCompletions(e){try{for(let a of["py","md","csv"])try{let r=await this.searchFiles(a,{maxDepth:1,maxResults:5});if(r&&r.length>0){let s=r.map(n=>{let o={uri:this.asURI(n.path),name:n.name,type:this.contextType,description:n.isDirectory?"Directory":"File",data:{path:n.path,isDirectory:n.isDirectory}};return this.formatCompletion(o)});return{from:e.from,options:s}}}catch(r){pe.error("Failed to get default file completions:",r)}return{from:e.from,options:[]}}catch(a){return pe.error("Failed to get default file completions:",a),null}}getItems(){return[]}formatCompletion(e){let{data:a,name:r}=e,s=a.isDirectory?"\u{1F4C1}":"\u{1F4C4}";return{...this.createBasicCompletion(e),type:"file",section:gt.FILE,boost:a.isDirectory?yt.MEDIUM:yt.LOW,detail:a.path,displayLabel:`${s} ${r}`,apply:async(n,o,i,l)=>{var g;let d=(g=n.state.facet(Js))==null?void 0:g.addAttachment;if(!d){pe.warn("No addAttachment callback provided");return}let u=await this.apiRequests.sendFileDetails({path:a.path}).catch(x=>(jr({title:"Failed to get file details",description:x.message}),null));if(!u)return;let p=u.mimeType||"text/plain",v;if(p.startsWith("text/")||p.includes("json")||p.includes("xml"))v=new Blob([u.contents||""],{type:p});else if(u.contents)try{v=await Pi(yi(u.contents,p))}catch{v=new Blob([u.contents],{type:p})}else v=new Blob([""],{type:p});d(new File([v],r,{type:p})),n.dispatch({changes:{from:i,to:l,insert:""}}),ui(n)},info:()=>{let n=document.createElement("div");n.classList.add("flex","flex-col","gap-1","p-2");let o=document.createElement("div");o.classList.add("font-bold"),o.textContent=r,n.append(o);let i=document.createElement("div");return i.classList.add("text-xs","text-muted-foreground"),i.textContent=a.path,n.append(i),n}}}formatContext(e){let{data:a,name:r}=e;return Et({type:this.contextType,data:{name:r,path:a.path,isDirectory:a.isDirectory},details:a.isDirectory?"Directory containing files and subdirectories":"File"})}},tu=class extends It{constructor(e){super();J(this,"title","Tables");J(this,"mentionPrefix","@");J(this,"contextType","data");this.tablesMap=e}getItems(){return[...this.tablesMap.entries()].map(([e,a])=>({uri:this.asURI(e),name:e,type:this.contextType,description:a.source==="memory"?"in-memory":a.source,data:a}))}formatContext(e){let{data:a}=e,{columns:r,source:s,num_rows:n,num_columns:o,name:i,variable_name:l}=a,d=[n==null?void 0:`${n} rows`,o==null?void 0:`${o} columns`].filter(Boolean).join(", "),u="";if(d&&(u+=`Shape: ${d}
`),l&&(u+=`Variable: ${l}
`),r&&r.length>0){u+=`Columns:
`;for(let p of r){let v=`  ${p.name} (${p.type})`;if(p.sample_values&&p.sample_values.length>0){let g=p.sample_values.slice(0,3).map(x=>x===null?"null":String(x)).join(", ");v+=` - samples: [${g}]`}u+=`${v}
`}}return Et({type:this.contextType,data:{name:i,source:s??"unknown"},details:u.trim()})}formatCompletion(e){let a=e.data.name,r=e.data;return{label:`@${a}`,displayLabel:a,detail:r.source==="memory"?"in-memory":r.source,boost:r.source_type==="local"?yt.LOCAL_TABLE:yt.REMOTE_TABLE,type:Tr(r),apply:`@${a}`,section:{name:Tr(r)==="dataframe"?"Dataframe":"Table",rank:gt.TABLE.rank},info:()=>this.createTableInfoElement(a,r)}}createTableInfoElement(e,a){let r=document.createElement("div");r.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let s=document.createElement("div");s.classList.add("flex","flex-col","gap-1");let n=document.createElement("div");if(n.classList.add("font-bold","text-base"),n.textContent=e,s.append(n),a.source){let i=document.createElement("div");i.classList.add("text-xs","text-muted-foreground"),i.textContent=`Source: ${a.source}`,s.append(i)}r.append(s);let o=[a.num_rows==null?void 0:`${a.num_rows} rows`,a.num_columns==null?void 0:`${a.num_columns} columns`].filter(Boolean).join(", ");if(o){let i=document.createElement("div");i.classList.add("text-xs","bg-muted","px-2","py-1","rounded"),i.textContent=o,r.append(i)}if(a.columns&&a.columns.length>0){let i=document.createElement("div");i.classList.add("overflow-auto","max-h-60");let l=document.createElement("table");l.classList.add("w-full","text-xs","border-collapse");let d=l.insertRow();d.classList.add("bg-muted");let u=d.insertCell();u.classList.add("p-2","font-medium","text-left"),u.textContent="Column";let p=d.insertCell();p.classList.add("p-2","font-medium","text-left"),p.textContent="Type";let v=a.columns.some(x=>this.getItemMetadata(a,x)!==void 0),g;v&&(g=d.insertCell(),g.classList.add("p-2","font-medium","text-left"),g.textContent="Metadata"),a.columns.forEach((x,f)=>{let c=l.insertRow();c.classList.add(f%2==0?"bg-background":"bg-muted/30");let m=c.insertCell();m.classList.add("p-2","font-mono"),m.textContent=x.name;let _=c.insertCell();if(_.classList.add("p-2","text-muted-foreground"),_.textContent=x.type,v){let C=c.insertCell();C.classList.add("p-2");let A=this.getItemMetadata(a,x);A&&C.append(A)}}),i.append(l),r.append(i)}return r}getItemMetadata(e,a){var n,o;let r=(n=e.primary_keys)==null?void 0:n.includes(a.name),s=(o=e.indexes)==null?void 0:o.includes(a.name);if(r||s){let i=document.createElement("span");i.textContent=r?"PK":"IDX";let l=r?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200";return i.classList.add("text-xs","px-1.5","py-0.5","rounded-full","font-medium",...l.split(" ")),i}}},au=class extends It{constructor(e,a){super();J(this,"title","Variables");J(this,"mentionPrefix","@");J(this,"contextType","variable");this.variables=e,this.tablesMap=a}getItems(){let e=new Set(this.tablesMap.keys());return Object.entries(this.variables).flatMap(([a,r])=>e.has(a)?[]:[{uri:this.asURI(a),name:a,type:this.contextType,description:r.dataType??"",dataType:r.dataType,data:{variable:r}}])}formatCompletion(e){let{data:a}=e,{variable:r}=a;return{label:`@${r.name}`,displayLabel:r.name,detail:r.dataType??"",type:this.contextType,section:gt.VARIABLE,info:()=>Wn(r)}}formatContext(e){let{data:a}=e,{variable:r}=a;return Et({type:this.contextType,data:{name:r.name,dataType:r.dataType},details:r.value==null?void 0:JSON.stringify(r.value)})}};function mt(t){let e=t.get(Mn),a=t.get(jn),r=t.get(Pn);return new Ei().register(new tu(a)).register(new au(r,a)).register(new Qd(t)).register(new Hd(t)).register(new Ii(e.connectionsMap,a))}function ru(){return new eu(li())}const su="@";function nu({input:t}){let e="";return t.includes("@")&&(e=ou(t),pe.debug("Included context",e)),{includeOtherCode:Er(""),context:{plainText:e,schema:[],variables:[]}}}async function iu({input:t}){let e="",a=[];if(t.includes("@")){let r=mt(Nr),s=r.parseAllContextIds(t);e=r.formatContextForAI(s);try{a=await r.getAttachmentsForContext(s),pe.debug("Included attachments",a.length)}catch(n){pe.error("Error getting attachments:",n)}}return{body:{includeOtherCode:Er(""),context:{plainText:e,schema:[],variables:[]}},attachments:a}}function ou(t){let e=mt(Nr),a=e.parseAllContextIds(t);return e.formatContextForAI(a)}function lu(t,e=[]){return a=>{let r=t.map(s=>a.matchBefore(s)).find(Boolean);return!r||r&&r.from===r.to&&!a.explicit?null:{from:r==null?void 0:r.from,options:[...e]}}}function du(t){var e;if((e=t.current)!=null&&e.view){let a=t.current.view.state.selection.main.from;t.current.view.dispatch({changes:{from:a,to:a,insert:"@"},selection:{anchor:a+1,head:a+1}}),t.current.view.focus(),di(t.current.view)}}function uu(t){if(t.trim().length===0)return[];if(!t.includes("```"))return[{language:"python",code:t}];let e=[],a=0,r=t.indexOf("```",a);for(;r!==-1;){let s=t.indexOf(`
`,r);if(s===-1){let d=t.slice(r+3),u=d.indexOf(" "),p=u===-1?d:d.slice(0,u),v=p==="markdown"?"markdown":p==="sql"?"sql":"python",g=u===-1?"":d.slice(u+1);g.trim()&&e.push({language:v,code:g.trim()});break}let n=t.slice(r+3,s).trim()||"";n=n==="markdown"?"markdown":n==="sql"?"sql":"python";let o=s+1,i=t.indexOf("```",o);if(i===-1){let d=t.slice(o).replace(/\n+$/,"");d.trim()&&e.push({language:n,code:d});break}let l=t.slice(o,i).replace(/\n+$/,"");l.trim()&&e.push({language:n,code:l}),a=i+3,r=t.indexOf("```",a)}return e.length===0&&e.push({language:"python",code:t}),e}function cu(t){return t.length>50?`${t.slice(0,50)}...`:t}async function pu(t){return await Promise.all(t.map(async e=>({type:"file",mediaType:e.type,filename:e.name,url:await hr(e,"dataUrl")})))}function mu(t){if(t.length===0)return!1;let e=t.at(-1);if(!e||e.role!=="assistant"||!e.parts)return!1;let a=e.parts;return a.length===0?!1:a[a.length-1].type==="reasoning"}function Ys(t){return t.map(e=>e.type==="text"?e.text:"").join(`
`)}async function Hs(t){let e=await iu({input:Ys(t.flatMap(r=>r.parts))});function a(r,s){let n=[...r.parts];return s&&n.push(...e.attachments),{role:r.role,content:Ys(r.parts),parts:n}}return{...e.body,messages:t.map((r,s)=>a(r,s===t.length-1))}}async function Gs({invokeAiTool:t,addToolResult:e,toolCall:a}){try{if(mr.has(a.toolName)){let r=await mr.invoke(a.toolName,a.input);e({tool:a.toolName,toolCallId:a.toolCallId,output:r.result||r.error})}else{let r=await t({toolName:a.toolName,arguments:a.input});e({tool:a.toolName,toolCallId:a.toolCallId,output:r.result||r.error})}}catch(r){pe.error("Tool call failed:",r),e({tool:a.toolName,toolCallId:a.toolCallId,output:`Error: ${r instanceof Error?r.message:String(r)}`})}}function hu(t){var i;if(t.length===0)return!1;let e=t[t.length-1],a=e.parts;if(a.length===0||e.role!=="assistant")return!1;let r=a.filter(l=>l.type.startsWith("tool-"));if(r.length===0)return!1;let s=r.every(l=>l.state==="output-available"),n=a[a.length-1],o=n.type==="text"&&((i=n.text)==null?void 0:i.trim().length)>0;return pe.warn("All tool calls completed: %s",s),s&&!o}function fu(t){return ai.define({combine:e=>e[0]??t})}var Qs=fu({}),fr=qt.define(),va=qt.define(),gu=50,gr=Kt.define({create(){return{prompts:[],navigationIndex:-1,originalText:""}},update(t,e){var r,s;let a={...t};e.docChanged&&t.navigationIndex!==-1&&(e.effects.some(n=>n.is(va)||n.is(fr))||(a.navigationIndex=-1,a.originalText=""));for(let n of e.effects)if(n.is(fr)){let o=n.value.trim();o&&(a.prompts=[o,...t.prompts.filter(i=>i!==o)].slice(0,gu),(s=(r=e.state.facet(Qs)).save)==null||s.call(r,a.prompts)),a.navigationIndex=-1,a.originalText=""}else n.is(va)&&(a.navigationIndex=n.value.index,a.originalText=n.value.originalText);return a}}),yu=t=>{let e=t.state.field(gr),a=t.state.doc;if(e.prompts.length===0)return!1;let r,s=e.originalText;if(e.navigationIndex===-1){if(a.length>0)return!1;r=0,s=a.toString()}else if(r=Math.min(e.navigationIndex+1,e.prompts.length-1),r===e.navigationIndex)return!1;let n=e.prompts[r];return t.dispatch({changes:{from:0,to:t.state.doc.length,insert:n},effects:va.of({index:r,originalText:s})}),!0},vu=t=>{let e=t.state.field(gr);if(e.navigationIndex===-1)return!1;let a,r;return e.navigationIndex===0?(a=e.originalText,r=-1):(r=e.navigationIndex-1,a=e.prompts[r]??""),t.dispatch({changes:{from:0,to:t.state.doc.length,insert:a},effects:va.of({index:r,originalText:e.originalText})}),!0};const Xs=t=>{let e=t.state.doc.toString();return e.trim()?(t.dispatch({effects:fr.of(e)}),!0):!1};function _u(t={}){let{storage:e,defaultKeymap:a=!0}=t,r=[gr.init(()=>{var s;return{prompts:((s=e==null?void 0:e.load)==null?void 0:s.call(e))??[],navigationIndex:-1,originalText:""}}),Qs.of(e??{})];return a&&r.push(Ta.of([{key:"ArrowUp",run:yu},{key:"ArrowDown",run:vu}])),r}var bu=dt(ka()),en=()=>new Set,{valueAtom:_a,useActions:xu,createActions:Dc,reducer:Fc}=ii(en,{addStagedCell:(t,e)=>{let{cellId:a}=e;return new Set([...t,a])},removeStagedCell:(t,e)=>new Set([...t].filter(a=>a!==e)),clearStagedCells:()=>en()});function tn(t){let e=(0,bu.c)(26),{addStagedCell:a,removeStagedCell:r,clearStagedCells:s}=xu(),{createNewCell:n}=Sn(),o=Li(),i=(0,R.useRef)(null),l;e[0]!==a||e[1]!==n?(l=C=>{let A=Nn.create();return a({cellId:A}),n({cellId:"__end__",code:C,before:!1,newCellId:A}),A},e[0]=a,e[1]=n,e[2]=l):l=e[2];let d=l,u;e[3]===t?u=e[4]:(u=C=>{var z,j;let{cellId:A,code:E}=C;if(!t.get(_a).has(A)){pe.error("Staged cell not found",{cellId:A});return}let P=(j=(z=t.get(zn(A)))==null?void 0:z.current)==null?void 0:j.editorViewOrNull;if(!P){pe.error("Editor for this cell not found",{cellId:A});return}$n(P,E)},e[3]=t,e[4]=u);let p=u,v;e[5]!==o||e[6]!==r?(v=C=>{r(C),o({cellId:C})},e[5]=o,e[6]=r,e[7]=v):v=e[7];let g=v,x;e[8]!==s||e[9]!==o||e[10]!==t?(x=()=>{let C=t.get(_a);for(let A of C)o({cellId:A});s()},e[8]=s,e[9]=o,e[10]=t,e[11]=x):x=e[11];let f=x,c;e[12]!==a||e[13]!==n||e[14]!==d||e[15]!==p?(c=C=>{e:switch(C.type){case"text-start":i.current=new wu(d,p,a,n);break e;case"text-delta":if(!i.current){pe.error("Cell creation stream not found");return}i.current.stream(C);break e;case"text-end":case"finish":if(!i.current){pe.error("Cell creation stream not found");return}i.current.stop();break e;default:pe.error("Unknown chunk type",{chunk:C})}},e[12]=a,e[13]=n,e[14]=d,e[15]=p,e[16]=c):c=e[16];let m=c,_;return e[17]!==a||e[18]!==s||e[19]!==d||e[20]!==f||e[21]!==g||e[22]!==m||e[23]!==r||e[24]!==p?(_={createStagedCell:d,updateStagedCell:p,addStagedCell:a,removeStagedCell:r,clearStagedCells:s,deleteStagedCell:g,deleteAllStagedCells:f,onStream:m},e[17]=a,e[18]=s,e[19]=d,e[20]=f,e[21]=g,e[22]=m,e[23]=r,e[24]=p,e[25]=_):_=e[25],_}var wu=class{constructor(t,e,a,r){J(this,"createdCells",[]);J(this,"buffer","");J(this,"hasMarimoImport",!1);this.onCreateCell=t,this.onUpdateCell=e,this.addStagedCell=a,this.createNewCell=r}stream(t){let e=t.delta;this.buffer+=e;let a=uu(this.buffer);for(let[r,s]of a.entries())if(r<this.createdCells.length){this.addMarimoImport(s.language);let n=this.createdCells[r];this.createdCells[r]={...n,cell:s},this.onUpdateCell({cellId:n.cellId,code:s.code,language:s.language})}else{let n=this.onCreateCell(s.code);this.createdCells.push({cellId:n,cell:s})}}addMarimoImport(t){var a;if(this.hasMarimoImport||t==="python")return;let e=Di({autoInstantiate:!1,createNewCell:this.createNewCell,fromCellId:(a=this.createdCells[0])==null?void 0:a.cellId,before:!0});e&&this.addStagedCell({cellId:e}),this.hasMarimoImport=!0}stop(){this.buffer=""}};const yr=qt.define(),He=Kt.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(yr)){a||(a=(r=new Map(t),!0));for(let[n,o]of s.value)r.set(n,o)}return r}}),ku=Kt.define({create(){return{onResourceClick:void 0,onResourceMouseOver:void 0,onResourceMouseOut:void 0,onPromptSubmit:void 0}},update(t){return t}}),Cu=qt.define();Kt.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(Cu)){a||(a=(r=new Map(t),!0));for(let[n,o]of s.value)r.set(n,o)}return r}});const Tu=(t,e)=>async a=>{let r=a.matchBefore(/@(\w+)?/);if(!r||r.from===r.to&&!a.explicit)return null;let s=await t();if(s.length===0)return null;let n=yr.of(new Map(s.map(i=>[i.uri,i])));a.view&&a.view.dispatch({effects:n});let o=s.map(i=>({label:`@${i.name}`,displayLabel:i.name,detail:i.uri,info:i.description||void 0,type:i.mimeType?"constant":"variable",boost:i.description?100:0,...e==null?void 0:e(i),apply:(l,d,u,p)=>{l.dispatch({changes:{from:u,to:p,insert:`@${i.uri} `}})}}));return{from:r.from,options:o}},Eu=/@[\w-]+:\/\/(?!\/)[^\s]+/;function it(t){return t.matchAll(new RegExp(Eu.source,"g"))}var Iu=class extends Mr{constructor(e,a){super();J(this,"resource");J(this,"view");this.resource=e,this.view=a}eq(e){return e.resource.uri===this.resource.uri}toDOM(){let e=document.createElement("span");e.className="cm-resource-widget",e.textContent=`@${this.resource.name}`;let a=this.view.state.field(ku,!1),r=a==null?void 0:a.onResourceClick,s=a==null?void 0:a.onResourceMouseOver,n=a==null?void 0:a.onResourceMouseOut;return r&&(e.style.cursor="pointer",e.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),r(this.resource)})),s&&e.addEventListener("mouseover",o=>{o.preventDefault(),o.stopPropagation(),s(this.resource)}),n&&e.addEventListener("mouseout",o=>{o.preventDefault(),o.stopPropagation(),n(this.resource)}),e}},Su=class extends Mr{constructor(e,a){super();J(this,"uri");J(this,"view");this.uri=e,this.view=a}eq(e){return e.uri===this.uri}toDOM(){let e=document.createElement("span");return e.className="cm-not-found-resource-widget",e.textContent=`@${this.uri.split("://")[1]??this.uri}`,e}};function an(t){let e=t.state.field(He),a=[];for(let{from:r,to:s}of t.visibleRanges){let n=t.state.doc.sliceString(r,s);for(let o of it(n)){let i=r+o.index,l=o[0].slice(1),d=e.get(l);d?a.push(Ca.replace({widget:new Iu(d,t)}).range(i,i+o[0].length)):a.push(Ca.replace({widget:new Su(l,t)}).range(i,i+o[0].length))}}return Ca.set(a)}const Au=ni.fromClass(class{constructor(t){J(this,"decorations");this.decorations=an(t)}update(t){(t.docChanged||t.viewportChanged||t.transactions.some(e=>e.effects.some(a=>a.is(yr))))&&(this.decorations=an(t.view))}},{decorations:t=>t.decorations});function Nu(t){let e=document.createElement("div");e.className="cm-tooltip-cursor";let a=document.createElement("div");if(a.className="cm-tooltip-cursor-title",a.textContent=`${t.name} (${t.uri})`,e.appendChild(a),t.description){let r=document.createElement("div");r.className="cm-tooltip-cursor-description",r.textContent=t.description,e.appendChild(r)}if(t.mimeType){let r=document.createElement("div");r.className="cm-tooltip-cursor-mimetype",r.textContent=t.mimeType,e.appendChild(r)}return{dom:e}}function Ou(t,e,a,r=0){for(let s of it(t)){let n=r+s.index,o=n+s[0].length;if(e>=n&&e<=o){let i=s[0].slice(1),l=a.get(i);if(l)return{resource:l,start:n,end:o}}}return null}function Ru(t){return si((e,a)=>{let{from:r,text:s}=e.state.doc.lineAt(a),n=Ou(s,a,e.state.field(He),r);return n?{pos:n.start,end:n.end,above:!0,create(){return(t.createTooltip??Nu)(n.resource)}}:null})}function Mu(t,e){let a=t.field(He),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),o=Array.from(it(n));if(o.length===0)return null;for(let i of o){let l=s.from+i.index,d=l+i[0].length,u=i[0].slice(1);if(e===d&&a.has(u))return{from:l,to:d,uri:u}}return null}function ju(t,e){let a=t.field(He),r=t.doc,s=r.lineAt(e).to,n=r.sliceString(e,s),o=Array.from(it(n));if(o.length===0)return null;let i=o[0];if(!i||i.index!==0)return null;let l=e,d=e+i[0].length,u=i[0].slice(1);return a.has(u)?{from:l,to:d,uri:u}:null}function rn(t,e){let a=t.field(He),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),o=Array.from(it(n));for(let i of o){let l=s.from+i.index,d=l+i[0].length,u=i[0].slice(1);if(e>l&&e<d&&a.has(u))return{from:l,to:d,uri:u}}return null}function Pu(t,e){let a=t.field(He),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,e),o=Array.from(it(n)),i=null;for(let l of o){let d=s.from+l.index,u=d+l[0].length,p=l[0].slice(1);a.has(p)&&u<=e&&(e>u?i=u:e===u&&(i=d))}return i}function Zu(t,e){let a=t.field(He),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),o=Array.from(it(n));for(let i of o){let l=s.from+i.index,d=l+i[0].length,u=i[0].slice(1);if(a.has(u)&&l>=e){if(e<l)return l;if(e===l)return d}}return null}const $u=ei.transactionFilter.of(t=>{var r;let e=t.annotation(ti.userEvent);if(!e)return t;let a=t.startState.selection.main;if(!a.empty)return t;if(e==="input.type"||e.startsWith("input")){if(t.changes.empty)return t;let s=t.startState.field(He),n=t.startState.doc,o=!1,i=0,l=[];if(t.changes.iterChanges((d,u,p,v,g)=>{let x=g.toString(),f=d;if(/^\s+$/.test(x)){l.push({from:d,to:u,insert:x});return}let c=n.lineAt(f),m=n.sliceString(c.from,c.to),_=Array.from(it(m)),C=!1,A=!1;for(let P of _){let z=c.from+P.index,j=z+P[0].length,G=P[0].slice(1);if(s.has(G)){if(f===z){let $=f>0?n.sliceString(f-1,f):"";$!==""&&$!==" "&&$!==`
`&&$!=="	"&&(C=!0)}if(f===j){let $=f<n.length?n.sliceString(f,f+1):"";($===""||$!==" "&&$!==`
`&&$!=="	")&&(A=!0)}}}let E=x;C&&(E=` ${E}`,i+=1),A&&(E=` ${E}`,i+=1),E!==x&&(o=!0),l.push({from:d,to:u,insert:E})}),o)return[{changes:l,selection:t.selection?{anchor:t.selection.main.anchor+i,head:t.selection.main.head+i}:void 0,scrollIntoView:t.scrollIntoView}]}if(e==="delete.backward"||e==="delete.forward"){let s=null;return e==="delete.backward"?s=Mu(t.startState,a.head):e==="delete.forward"&&(s=ju(t.startState,a.head)),s?[{changes:{from:s.from,to:s.to,insert:""},selection:{anchor:s.from},scrollIntoView:!0}]:t}if((r=t.selection)!=null&&r.main.empty&&a.empty&&!e.startsWith("input")&&e!=="input.type"){let s=a.head,n=t.selection.main.head,o=null;if(n<s){let i=rn(t.startState,s);o=i&&s>i.from?i.from:Pu(t.startState,s)}else if(n>s){let i=rn(t.startState,s);o=i&&s<i.to?i.to:Zu(t.startState,s)}if(o!==null&&o!==n)return[{selection:{anchor:o},scrollIntoView:!0}]}return t}),Lu=Rr.baseTheme({".cm-resource-widget":{background:"light-dark(rgba(86,156,214,0.08),rgba(86,156,214,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#2367a2,#7ecbff)",fontWeight:"500"},".cm-resource-widget:hover":{background:"light-dark(rgba(86,156,214,0.18),rgba(86,156,214,0.28))"},".cm-not-found-resource-widget":{background:"light-dark(rgba(151,151,151,0.08),rgba(151,151,151,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#b00020,#ff8080)",fontWeight:"500"}});var sn="_none_",Du=[{uri:"",name:"No resources",type:sn,data:{}}],Fu={info:"Variables, dataframes, and tables will appear here.",apply:()=>{}};function zu(t){let{language:e,store:a,onAddFiles:r}=t;return[e.data.of({autocomplete:Tu(async()=>{let s=mt(a).getAllItems();return s.length===0?Du:s},s=>{var n;return s.type===sn?Fu:((n=mt(a).getProvider(s.type))==null?void 0:n.formatCompletion(s))||{}})}),Js.of({addAttachment:s=>r==null?void 0:r([s])}),...r?[e.data.of({autocomplete:ru().createCompletionSource()})]:[],Au,$u,He.init(()=>{let s=mt(a).getAllItems();return new Map(s.map(n=>[n.uri,n]))}),Lu,Ru({createTooltip:s=>{let n=mt(a).getProvider(s.type);if(!n)return pe.warn("No provider found for resource",s),Ft(s.description||s.name);let o=n.formatCompletion(s),i=s.description||s.name;if(!(o!=null&&o.info))return Ft(i);if(typeof o.info=="string")return Ft(o.info);let l=o.info(o);return l?"dom"in l?{dom:l.dom}:"then"in l?(pe.warn("info is a promise. This is not supported",l),Ft(i)):{dom:l}:Ft(i)}})]}function Ft(t){let e=document.createElement("div");return e.innerHTML=t,{dom:e}}var ba=dt(ka()),S=dt(Gn());const nn=t=>{let{handleAcceptCompletion:e,handleDeclineCompletion:a,isLoading:r,hasCompletion:s}=t;return n=>{let o=Qn()?n.metaKey:n.ctrlKey;o&&n.key==="Enter"&&!r&&s&&e(),(n.key==="Delete"||n.key==="Backspace")&&o&&n.shiftKey&&(a(),n.preventDefault(),n.stopPropagation())}},on=t=>{let e=(0,ba.c)(22),{isLoading:a,onAccept:r,onDecline:s,size:n,acceptShortcut:o,declineShortcut:i,multipleCompletions:l}=t,d=n===void 0?"sm":n,u=o===void 0?"Mod-\u21B5":o,p=i===void 0?"Shift-Mod-Delete":i,v=l===void 0?!1:l,g=v&&" all",x;e[0]===u?x=e[1]:(x=(0,S.jsx)(St,{className:"ml-1 inline",shortcut:u}),e[0]=u,e[1]=x);let f;e[2]!==g||e[3]!==x?(f=(0,S.jsxs)("span",{className:"text-(--grass-11) opacity-100",children:["Accept",g," ",x]}),e[2]=g,e[3]=x,e[4]=f):f=e[4];let c;e[5]!==a||e[6]!==r||e[7]!==d||e[8]!==f?(c=(0,S.jsx)(Le,{"data-testid":"accept-completion-button",variant:"text",size:d,className:"mb-0",disabled:a,onClick:r,children:f}),e[5]=a,e[6]=r,e[7]=d,e[8]=f,e[9]=c):c=e[9];let m=v&&" all",_;e[10]===p?_=e[11]:(_=(0,S.jsx)(St,{className:"ml-1 inline",shortcut:p}),e[10]=p,e[11]=_);let C;e[12]!==_||e[13]!==m?(C=(0,S.jsxs)("span",{className:"text-(--red-10)",children:["Reject",m," ",_]}),e[12]=_,e[13]=m,e[14]=C):C=e[14];let A;e[15]!==s||e[16]!==d||e[17]!==C?(A=(0,S.jsx)(Le,{"data-testid":"decline-completion-button",variant:"text",size:d,className:"mb-0 pl-1 pr-0",onClick:s,children:C}),e[15]=s,e[16]=d,e[17]=C,e[18]=A):A=e[18];let E;return e[19]!==A||e[20]!==c?(E=(0,S.jsxs)(S.Fragment,{children:[c,A]}),e[19]=A,e[20]=c,e[21]=E):E=e[21],E},Uu=t=>{let e=(0,ba.c)(8),{isLoading:a,onAccept:r,onDecline:s}=t,n;e[0]!==a||e[1]!==r?(n=(0,S.jsx)(ln,{isLoading:a,onAccept:r,size:"xs"}),e[0]=a,e[1]=r,e[2]=n):n=e[2];let o;e[3]===s?o=e[4]:(o=(0,S.jsx)(dn,{onDecline:s,size:"xs"}),e[3]=s,e[4]=o);let i;return e[5]!==n||e[6]!==o?(i=(0,S.jsxs)(S.Fragment,{children:[n,o]}),e[5]=n,e[6]=o,e[7]=i):i=e[7],i},ln=t=>{let e=(0,ba.c)(28),{isLoading:a,onAccept:r,size:s,buttonStyles:n,acceptShortcut:o,runCell:i,playButtonStyles:l}=t,d=s===void 0?"sm":s,u;e[0]!==r||e[1]!==i?(u=()=>{r(),i&&i()},e[0]=r,e[1]=i,e[2]=u):u=e[2];let p=u;if(i){let f=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded-r-none ${n}`,c;e[3]===o?c=e[4]:(c=o&&(0,S.jsx)(St,{className:"ml-1 inline",shortcut:o}),e[3]=o,e[4]=c);let m;e[5]!==a||e[6]!==r||e[7]!==d||e[8]!==f||e[9]!==c?(m=(0,S.jsxs)(Le,{variant:"text",size:d,disabled:a,onClick:r,className:f,children:["Accept",c]}),e[5]=a,e[6]=r,e[7]=d,e[8]=f,e[9]=c,e[10]=m):m=e[10];let _=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded-l-none px-1.5 ${l}`,C;e[11]===Symbol.for("react.memo_cache_sentinel")?(C=(0,S.jsx)(Ci,{className:"h-2.5 w-2.5 mt-0.5"}),e[11]=C):C=e[11];let A;e[12]!==p||e[13]!==a||e[14]!==d||e[15]!==_?(A=(0,S.jsx)(Ai,{content:"Accept and run cell",children:(0,S.jsx)(Le,{variant:"text",size:d,disabled:a,onClick:p,className:_,children:C})}),e[12]=p,e[13]=a,e[14]=d,e[15]=_,e[16]=A):A=e[16];let E;return e[17]!==m||e[18]!==A?(E=(0,S.jsxs)("div",{className:"flex",children:[m,A]}),e[17]=m,e[18]=A,e[19]=E):E=e[19],E}let v=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded px-3 ${n}`,g;e[20]===o?g=e[21]:(g=o&&(0,S.jsx)(St,{className:"ml-1 inline",shortcut:o}),e[20]=o,e[21]=g);let x;return e[22]!==a||e[23]!==r||e[24]!==d||e[25]!==v||e[26]!==g?(x=(0,S.jsxs)(Le,{variant:"text",size:d,disabled:a,onClick:r,className:v,children:["Accept",g]}),e[22]=a,e[23]=r,e[24]=d,e[25]=v,e[26]=g,e[27]=x):x=e[27],x},dn=t=>{let e=(0,ba.c)(7),{onDecline:a,size:r,className:s,declineShortcut:n}=t,o=r===void 0?"sm":r,i=`h-6 text-(--red-10) bg-(--red-3)/60 hover:bg-(--red-3)
    dark:bg-(--red-4)/80 dark:hover:bg-(--red-3) rounded px-3 font-semibold
    active:bg-(--red-5) dark:active:bg-(--red-4)
    border-(--red-6) border hover:shadow-xs ${s}`,l;e[0]===n?l=e[1]:(l=n&&(0,S.jsx)(St,{className:"ml-1 inline",shortcut:n}),e[0]=n,e[1]=l);let d;return e[2]!==a||e[3]!==o||e[4]!==i||e[5]!==l?(d=(0,S.jsxs)(Le,{variant:"text",size:o,onClick:a,className:i,children:["Reject",l]}),e[2]=a,e[3]=o,e[4]=i,e[5]=l,e[6]=d):d=e[6],d};var Vu=class extends Ja{constructor(t,e){super(t),this.onChunkReceived=e}processResponseStream(t){let e=this.onChunkReceived;return super.processResponseStream(t).pipeThrough(new TransformStream({async transform(a,r){e(a),r.enqueue(a)}}))}},un=dt(ka()),Bu=An("marimo:ai-language","python"),cn="marimo:ai-prompt-history",pn=new Vn($e(h()),()=>[]);const Wu=t=>{let e=(0,un.c)(83),{onClose:a}=t,r=Cr(),[s,n]=(0,R.useState)(""),{deleteAllStagedCells:o,clearStagedCells:i,onStream:l}=tn(r),[d,u]=Tn(Bu),p=Xn(),{invokeAiTool:v}=oi(),g=En(_a),x=(0,R.useRef)(null),f;if(e[0]!==d||e[1]!==l||e[2]!==p){let xe;e[4]===d?xe=e[5]:(xe=async Ut=>{let xn=await Hs(Ut.messages);return{body:{...Ut,...xn,code:"",prompt:"",language:d}}},e[4]=d,e[5]=xe);let Ee;e[6]===l?Ee=e[7]:(Ee=Ut=>{l(Ut)},e[6]=l,e[7]=Ee),f=new Vu({api:p.getAiURL("completion").toString(),headers:p.headers(),prepareSendMessagesRequest:xe},Ee),e[0]=d,e[1]=l,e[2]=p,e[3]=f}else f=e[3];let{sendMessage:c,stop:m,status:_,addToolResult:C}=Bs({experimental_throttle:100,transport:f,onToolCall:async xe=>{let{toolCall:Ee}=xe;await Gs({invokeAiTool:v,addToolResult:A,toolCall:{toolName:Ee.toolName,toolCallId:Ee.toolCallId,input:Ee.input}})},onError:qu}),A=C,E=_==="streaming"||_==="submitted",P=g.size>0,z=g.size>1,j;e[8]!==o||e[9]!==s||e[10]!==E||e[11]!==c?(j=()=>{var xe;E||((xe=x.current)!=null&&xe.view&&Xs(x.current.view),o(),c({text:s}))},e[8]=o,e[9]=s,e[10]=E,e[11]=c,e[12]=j):j=e[12];let G=j,$;e[13]===Symbol.for("react.memo_cache_sentinel")?($=(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(Fi,{className:"size-4 mr-2"}),"Python"]}),e[13]=$):$=e[13];let le=$,de;e[14]===Symbol.for("react.memo_cache_sentinel")?(de=(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(Ln,{className:"size-4 mr-2"}),"SQL"]}),e[14]=de):de=e[14];let re=de,Q=d==="python"?le:re,q;e[15]===Symbol.for("react.memo_cache_sentinel")?(q=(0,S.jsx)(vi,{className:"ml-1 h-3.5 w-3.5 text-muted-foreground/70"}),e[15]=q):q=e[15];let K;e[16]===Q?K=e[17]:(K=(0,S.jsx)(bi,{asChild:!0,children:(0,S.jsxs)(Le,{variant:"text",className:"ml-2",size:"xs","data-testid":"language-button",children:[Q,q]})}),e[16]=Q,e[17]=K);let se,X;e[18]===Symbol.for("react.memo_cache_sentinel")?(se=(0,S.jsx)("div",{className:"px-2 py-1 font-semibold",children:"Select language"}),X=(0,S.jsx)(_i,{}),e[18]=se,e[19]=X):(se=e[18],X=e[19]);let Ae;e[20]===u?Ae=e[21]:(Ae=(0,S.jsx)(Zr,{onClick:()=>u("python"),children:le}),e[20]=u,e[21]=Ae);let ve;e[22]===u?ve=e[23]:(ve=(0,S.jsx)(Zr,{onClick:()=>u("sql"),children:re}),e[22]=u,e[23]=ve);let _e;e[24]!==Ae||e[25]!==ve?(_e=(0,S.jsxs)(xi,{align:"center",children:[se,X,Ae,ve]}),e[24]=Ae,e[25]=ve,e[26]=_e):_e=e[26];let Ce;e[27]!==_e||e[28]!==K?(Ce=(0,S.jsxs)(wi,{modal:!1,children:[K,_e]}),e[27]=_e,e[28]=K,e[29]=Ce):Ce=e[29];let Ge=Ce,Qe;e[30]!==i||e[31]!==a?(Qe=()=>{i(),a()},e[30]=i,e[31]=a,e[32]=Qe):Qe=e[32];let Ne=Qe,ot;e[33]===o?ot=e[34]:(ot=()=>{o()},e[33]=o,e[34]=ot);let Ue=ot,ht;e[35]===Symbol.for("react.memo_cache_sentinel")?(ht=(0,S.jsx)(Ti,{className:"size-4 text-(--blue-11) mr-2"}),e[35]=ht):ht=e[35];let Xe;e[36]!==o||e[37]!==a?(Xe=()=>{o(),a()},e[36]=o,e[37]=a,e[38]=Xe):Xe=e[38];let Ze;e[39]===Symbol.for("react.memo_cache_sentinel")?(Ze=xe=>{n(xe)},e[39]=Ze):Ze=e[39];let Ve;e[40]!==Ne||e[41]!==Ue||e[42]!==P||e[43]!==E?(Ve=nn({handleAcceptCompletion:Ne,handleDeclineCompletion:Ue,isLoading:E,hasCompletion:P}),e[40]=Ne,e[41]=Ue,e[42]=P,e[43]=E,e[44]=Ve):Ve=e[44];let U;e[45]!==s||e[46]!==G||e[47]!==Xe||e[48]!==Ve?(U=(0,S.jsx)(mn,{inputRef:x,onClose:Xe,value:s,onChange:Ze,onSubmit:G,onKeyDown:Ve}),e[45]=s,e[46]=G,e[47]=Xe,e[48]=Ve,e[49]=U):U=e[49];let V;e[50]!==E||e[51]!==m?(V=E&&(0,S.jsxs)(Le,{"data-testid":"stop-completion-button",variant:"text",size:"sm",className:"mb-0",onClick:m,children:[(0,S.jsx)(ki,{className:"animate-spin mr-1",size:14}),"Stop"]}),e[50]=E,e[51]=m,e[52]=V):V=e[52];let te;e[53]===Symbol.for("react.memo_cache_sentinel")?(te=(0,S.jsx)(Ui,{className:"size-4"}),e[53]=te):te=e[53];let B;e[54]===G?B=e[55]:(B=(0,S.jsx)(Le,{variant:"text",size:"sm",onClick:G,title:"Submit",children:te}),e[54]=G,e[55]=B);let Te;e[56]===Symbol.for("react.memo_cache_sentinel")?(Te=(0,S.jsx)(fi,{className:"size-4"}),e[56]=Te):Te=e[56];let ge;e[57]===a?ge=e[58]:(ge=(0,S.jsx)(Le,{variant:"text",size:"sm",className:"mb-0 px-1",onClick:a,children:Te}),e[57]=a,e[58]=ge);let ne;e[59]!==U||e[60]!==V||e[61]!==B||e[62]!==ge?(ne=(0,S.jsxs)("div",{className:"flex items-center px-3",children:[ht,U,V,B,ge]}),e[59]=U,e[60]=V,e[61]=B,e[62]=ge,e[63]=ne):ne=e[63];let ie=ne,be;e[64]===Symbol.for("react.memo_cache_sentinel")?(be=Or("flex flex-col w-full gap-2 py-2"),e[64]=be):be=e[64];let Be;e[65]===P?Be=e[66]:(Be=!P&&(0,S.jsxs)("span",{className:"text-xs text-muted-foreground px-3 flex flex-col gap-1",children:[(0,S.jsxs)("span",{children:["You can mention"," ",(0,S.jsx)("span",{className:"text-(--cyan-11)",children:"@dataframe"})," or"," ",(0,S.jsx)("span",{className:"text-(--cyan-11)",children:"@sql_table"})," to pull additional context such as column names."]}),(0,S.jsx)("span",{children:"Code from other cells is automatically included."})]}),e[65]=P,e[66]=Be);let We;e[67]!==Ne||e[68]!==Ue||e[69]!==P||e[70]!==E||e[71]!==z?(We=P&&(0,S.jsx)(on,{isLoading:E,onAccept:Ne,onDecline:Ue,size:"sm",multipleCompletions:z}),e[67]=Ne,e[68]=Ue,e[69]=P,e[70]=E,e[71]=z,e[72]=We):We=e[72];let lt;e[73]===Symbol.for("react.memo_cache_sentinel")?(lt=(0,S.jsx)(hi,{triggerClassName:"h-7 text-xs max-w-64",iconSize:"small",forRole:"edit"}),e[73]=lt):lt=e[73];let oe;e[74]===Ge?oe=e[75]:(oe=(0,S.jsxs)("div",{className:"ml-auto flex items-center gap-1",children:[Ge,lt]}),e[74]=Ge,e[75]=oe);let me;e[76]!==Be||e[77]!==We||e[78]!==oe?(me=(0,S.jsxs)("div",{className:"flex flex-row justify-between -mt-1 ml-1 mr-3",children:[Be,We,oe]}),e[76]=Be,e[77]=We,e[78]=oe,e[79]=me):me=e[79];let et;return e[80]!==ie||e[81]!==me?(et=(0,S.jsxs)("div",{className:be,children:[ie,me]}),e[80]=ie,e[81]=me,e[82]=et):et=e[82],et},mn=t=>{let e=(0,un.c)(35),{value:a,placeholder:r,inputRef:s,className:n,onChange:o,onSubmit:i,onKeyDown:l,onClose:d,onAddFiles:u,additionalCompletions:p,maxHeight:v}=t,g=i,x=d,f=Cr(),{theme:c}=mi(),m;e[0]===p?m=e[1]:(m=se=>p?lu([p.triggerCompletionRegex],p.completions)(se):null,e[0]=p,e[1]=m);let _=Oi(m),C,A,E,P;if(e[2]!==_||e[3]!==u||e[4]!==f){let se=pi();e[9]===Symbol.for("react.memo_cache_sentinel")?(C=ci({}),e[9]=C):C=e[9],A=se,E=zu({language:se.language,store:f,onAddFiles:u}),P=se.language.data.of({autocomplete:_}),e[2]=_,e[3]=u,e[4]=f,e[5]=C,e[6]=A,e[7]=E,e[8]=P}else C=e[5],A=e[6],E=e[7],P=e[8];let z;e[10]===Symbol.for("react.memo_cache_sentinel")?(z=_u({storage:{load:Ku,save:Ju}}),e[10]=z):z=e[10];let j;e[11]===Symbol.for("react.memo_cache_sentinel")?(j=Zi(),e[11]=j):j=e[11];let G;e[12]===g?G=e[13]:(G=ri.highest(Ta.of([{preventDefault:!0,stopPropagation:!0,any:(se,X)=>{let Ae=X.metaKey||X.ctrlKey||X.shiftKey;if(X.key==="Enter"&&!Ae)return g(X,se.state.doc.toString()),X.preventDefault(),X.stopPropagation(),!0;if(X.key==="Enter"&&X.shiftKey){let ve=se.state.selection.main.from;return se.dispatch({changes:{from:ve,to:ve,insert:`
`},selection:{anchor:ve+1,head:ve+1}}),X.preventDefault(),X.stopPropagation(),!0}return!1}}])),e[12]=g,e[13]=G);let $;e[14]===x?$=e[15]:($=Ta.of([{key:"Escape",preventDefault:!0,stopPropagation:!0,run:()=>(x(),!0)}]),e[14]=x,e[15]=$);let le;e[16]!==C||e[17]!==A||e[18]!==E||e[19]!==P||e[20]!==G||e[21]!==$?(le=[C,A,E,P,z,Rr.lineWrapping,j,G,$],e[16]=C,e[17]=A,e[18]=E,e[19]=P,e[20]=G,e[21]=$,e[22]=le):le=e[22];let de=le,re;e[23]===n?re=e[24]:(re=Or("flex-1 font-sans overflow-auto my-1",n),e[23]=n,e[24]=re);let Q=c==="dark"?"dark":"light",q=r||"Generate with AI, @ to include context",K;return e[25]!==de||e[26]!==s||e[27]!==v||e[28]!==o||e[29]!==l||e[30]!==re||e[31]!==Q||e[32]!==q||e[33]!==a?(K=(0,S.jsx)($i,{ref:s,className:re,width:"100%",maxHeight:v,value:a,basicSetup:!1,extensions:de,onChange:o,onKeyDown:l,theme:Q,placeholder:q}),e[25]=de,e[26]=s,e[27]=v,e[28]=o,e[29]=l,e[30]=re,e[31]=Q,e[32]=q,e[33]=a,e[34]=K):K=e[34],K};function qu(t){jr({title:"Generate with AI failed",description:Ri(t)})}function Ku(){return pn.get(cn)}function Ju(t){return pn.set(cn,t)}export{mr as C,zi as D,Ja as E,Jd as S,qd as T,su as _,Uu as a,mt as b,_a as c,Hs as d,pu as f,mu as g,hu as h,on as i,tn as l,Gs as m,mn as n,dn as o,cu as p,ln as r,nn as s,Wu as t,Xs as u,du as v,Bs as w,hr as x,nu as y};
