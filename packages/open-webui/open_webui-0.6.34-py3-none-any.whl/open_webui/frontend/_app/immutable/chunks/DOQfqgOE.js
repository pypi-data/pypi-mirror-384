import{S as je,i as ze,s as Re,H as Pe,I as Ge,e as m,C as Y,l as S,t as O,c as h,a as p,D as Z,d as u,p as T,b as H,f,g as ne,h as r,E as ee,G as pe,J as Je,y as Ke,r as q,u as Qe,q as L,j as z,K as Xe,F as te,v as Ye,k as Ze,n as Ne,L as ce,M as $e}from"./BsAB9Z30.js";import"./IHki7fMi.js";import{g as et}from"./CfFtnCED.js";import{C as tt}from"./CGsWN7_l.js";import{C as nt}from"./CWL6JHPL.js";import{B as st}from"./HNTRN4uT.js";import{T as Ie}from"./cMkWkffq.js";import{C as ot}from"./CvyCbeyv.js";function lt(n){let e,t,o,a,s;return t=new ot({props:{strokeWidth:"2.5"}}),{c(){e=m("button"),Y(t.$$.fragment),this.h()},l(i){e=h(i,"BUTTON",{class:!0,type:!0});var _=p(e);Z(t.$$.fragment,_),_.forEach(u),this.h()},h(){f(e,"class","w-full text-left text-sm py-1.5 px-1 rounded-lg dark:text-gray-300 dark:hover:text-white hover:bg-black/5 dark:hover:bg-gray-850"),f(e,"type","button")},m(i,_){ne(i,e,_),ee(t,e,null),o=!0,a||(s=pe(e,"click",n[15]),a=!0)},p:Ne,i(i){o||(L(t.$$.fragment,i),o=!0)},o(i){q(t.$$.fragment,i),o=!1},d(i){i&&u(e),te(t),a=!1,s()}}}function at(n){let e,t,o,a;return{c(){e=m("input"),this.h()},l(s){e=h(s,"INPUT",{class:!0,type:!0,placeholder:!0}),this.h()},h(){f(e,"class","w-full text-2xl font-medium bg-transparent outline-hidden font-primary"),f(e,"type","text"),f(e,"placeholder",t=n[9].t("Function Name")),e.required=!0},m(s,i){ne(s,e,i),ce(e,n[0]),o||(a=pe(e,"input",n[16]),o=!0)},p(s,i){i&512&&t!==(t=s[9].t("Function Name"))&&f(e,"placeholder",t),i&1&&e.value!==s[0]&&ce(e,s[0])},d(s){s&&u(e),o=!1,a()}}}function it(n){let e,t;return e=new Ie({props:{className:"w-full",content:n[9].t("e.g. my_filter"),placement:"top-start",$$slots:{default:[ft]},$$scope:{ctx:n}}}),{c(){Y(e.$$.fragment)},l(o){Z(e.$$.fragment,o)},m(o,a){ee(e,o,a),t=!0},p(o,a){const s={};a&512&&(s.content=o[9].t("e.g. my_filter")),a&1073742356&&(s.$$scope={dirty:a,ctx:o}),e.$set(s)},i(o){t||(L(e.$$.fragment,o),t=!0)},o(o){q(e.$$.fragment,o),t=!1},d(o){te(e,o)}}}function rt(n){let e,t;return{c(){e=m("div"),t=O(n[2]),this.h()},l(o){e=h(o,"DIV",{class:!0});var a=p(e);t=H(a,n[2]),a.forEach(u),this.h()},h(){f(e,"class","text-sm text-gray-500 shrink-0")},m(o,a){ne(o,e,a),r(e,t)},p(o,a){a&4&&z(t,o[2])},i:Ne,o:Ne,d(o){o&&u(e)}}}function ft(n){let e,t,o,a;return{c(){e=m("input"),this.h()},l(s){e=h(s,"INPUT",{class:!0,type:!0,placeholder:!0}),this.h()},h(){f(e,"class","w-full text-sm disabled:text-gray-500 bg-transparent outline-hidden"),f(e,"type","text"),f(e,"placeholder",t=n[9].t("Function ID")),e.required=!0,e.disabled=n[4]},m(s,i){ne(s,e,i),ce(e,n[2]),o||(a=pe(e,"input",n[17]),o=!0)},p(s,i){i&512&&t!==(t=s[9].t("Function ID"))&&f(e,"placeholder",t),i&16&&(e.disabled=s[4]),i&4&&e.value!==s[2]&&ce(e,s[2])},d(s){s&&u(e),o=!1,a()}}}function ut(n){let e,t,o,a;return{c(){e=m("input"),this.h()},l(s){e=h(s,"INPUT",{class:!0,type:!0,placeholder:!0}),this.h()},h(){f(e,"class","w-full text-sm bg-transparent outline-hidden"),f(e,"type","text"),f(e,"placeholder",t=n[9].t("Function Description")),e.required=!0},m(s,i){ne(s,e,i),ce(e,n[3].description),o||(a=pe(e,"input",n[18]),o=!0)},p(s,i){i&512&&t!==(t=s[9].t("Function Description"))&&f(e,"placeholder",t),i&8&&e.value!==s[3].description&&ce(e,s[3].description)},d(s){s&&u(e),o=!1,a()}}}function ct(n){let e,t,o,a=n[9].t("Please carefully review the following warnings:")+"",s,i,_,w,$=n[9].t("Functions allow arbitrary code execution.")+"",F,b,C,I=n[9].t("Do not install functions from sources you do not fully trust.")+"",k,W,v,y=n[9].t("I acknowledge that I have read and I understand the implications of my action. I am aware of the risks associated with executing arbitrary code and I have verified the trustworthiness of the source.")+"",E;return{c(){e=m("div"),t=m("div"),o=m("div"),s=O(a),i=S(),_=m("ul"),w=m("li"),F=O($),b=S(),C=m("li"),k=O(I),W=S(),v=m("div"),E=O(y),this.h()},l(D){e=h(D,"DIV",{class:!0});var g=p(e);t=h(g,"DIV",{class:!0});var A=p(t);o=h(A,"DIV",{});var M=p(o);s=H(M,a),M.forEach(u),i=T(A),_=h(A,"UL",{class:!0});var V=p(_);w=h(V,"LI",{});var R=p(w);F=H(R,$),R.forEach(u),b=T(V),C=h(V,"LI",{});var N=p(C);k=H(N,I),N.forEach(u),V.forEach(u),A.forEach(u),W=T(g),v=h(g,"DIV",{class:!0});var x=p(v);E=H(x,y),x.forEach(u),g.forEach(u),this.h()},h(){f(_,"class","mt-1 list-disc pl-4 text-xs"),f(t,"class","bg-yellow-500/20 text-yellow-700 dark:text-yellow-200 rounded-lg px-4 py-3"),f(v,"class","my-3"),f(e,"class","text-sm text-gray-500")},m(D,g){ne(D,e,g),r(e,t),r(t,o),r(o,s),r(t,i),r(t,_),r(_,w),r(w,F),r(_,b),r(_,C),r(C,k),r(e,W),r(e,v),r(v,E)},p(D,g){g&512&&a!==(a=D[9].t("Please carefully review the following warnings:")+"")&&z(s,a),g&512&&$!==($=D[9].t("Functions allow arbitrary code execution.")+"")&&z(F,$),g&512&&I!==(I=D[9].t("Do not install functions from sources you do not fully trust.")+"")&&z(k,I),g&512&&y!==(y=D[9].t("I acknowledge that I have read and I understand the implications of my action. I am aware of the risks associated with executing arbitrary code and I have verified the trustworthiness of the source.")+"")&&z(E,y)},d(D){D&&u(e)}}}function dt(n){let e,t,o,a,s,i,_,w,$,F,b,C,I,k,W,v,y,E,D,g,A,M,V,R,N,x,P,G,se=n[9].t("Warning:")+"",ae,c,de=n[9].t("Functions allow arbitrary code execution.")+"",_e,ke,Ee,De,ie,me=n[9].t("don't install random functions from sources you don't trust.")+"",ve,Fe,oe,he=n[9].t("Save")+"",ge,be,B,Ve,J,Ce,Se;w=new Ie({props:{content:n[9].t("Back"),$$slots:{default:[lt]},$$scope:{ctx:n}}}),b=new Ie({props:{content:n[9].t("e.g. My Filter"),placement:"top-start",$$slots:{default:[at]},$$scope:{ctx:n}}}),k=new st({props:{type:"muted",content:n[9].t("Function")}});const Te=[rt,it],K=[];function Me(l,d){return l[4]?0:1}y=Me(n),E=K[y]=Te[y](n),g=new Ie({props:{className:"w-full self-center items-center flex",content:n[9].t("e.g. A filter to remove profanity from text"),placement:"top-start",$$slots:{default:[ut]},$$scope:{ctx:n}}});let He={value:n[1],lang:"python",boilerplate:n[11],onChange:n[19],onSave:n[20]};V=new tt({props:He}),n[21](V);function We(l){n[24](l)}let xe={$$slots:{default:[ct]},$$scope:{ctx:n}};return n[6]!==void 0&&(xe.show=n[6]),B=new nt({props:xe}),Pe.push(()=>Ge(B,"show",We)),B.$on("confirm",n[25]),{c(){e=m("div"),t=m("div"),o=m("form"),a=m("div"),s=m("div"),i=m("div"),_=m("div"),Y(w.$$.fragment),$=S(),F=m("div"),Y(b.$$.fragment),C=S(),I=m("div"),Y(k.$$.fragment),W=S(),v=m("div"),E.c(),D=S(),Y(g.$$.fragment),A=S(),M=m("div"),Y(V.$$.fragment),R=S(),N=m("div"),x=m("div"),P=m("div"),G=m("span"),ae=O(se),c=S(),_e=O(de),ke=S(),Ee=m("br"),De=O(`—
							`),ie=m("span"),ve=O(me),Fe=S(),oe=m("button"),ge=O(he),be=S(),Y(B.$$.fragment),this.h()},l(l){e=h(l,"DIV",{class:!0});var d=p(e);t=h(d,"DIV",{class:!0});var re=p(t);o=h(re,"FORM",{class:!0});var fe=p(o);a=h(fe,"DIV",{class:!0});var j=p(a);s=h(j,"DIV",{class:!0});var Q=p(s);i=h(Q,"DIV",{class:!0});var U=p(i);_=h(U,"DIV",{class:!0});var le=p(_);Z(w.$$.fragment,le),le.forEach(u),$=T(U),F=h(U,"DIV",{class:!0});var ue=p(F);Z(b.$$.fragment,ue),ue.forEach(u),C=T(U),I=h(U,"DIV",{});var Ae=p(I);Z(k.$$.fragment,Ae),Ae.forEach(u),U.forEach(u),W=T(Q),v=h(Q,"DIV",{class:!0});var we=p(v);E.l(we),D=T(we),Z(g.$$.fragment,we),we.forEach(u),Q.forEach(u),A=T(j),M=h(j,"DIV",{class:!0});var Be=p(M);Z(V.$$.fragment,Be),Be.forEach(u),R=T(j),N=h(j,"DIV",{class:!0});var ye=p(N);x=h(ye,"DIV",{class:!0});var Ue=p(x);P=h(Ue,"DIV",{class:!0});var X=p(P);G=h(X,"SPAN",{class:!0});var qe=p(G);ae=H(qe,se),qe.forEach(u),c=T(X),_e=H(X,de),ke=T(X),Ee=h(X,"BR",{}),De=H(X,`—
							`),ie=h(X,"SPAN",{class:!0});var Le=p(ie);ve=H(Le,me),Le.forEach(u),X.forEach(u),Ue.forEach(u),Fe=T(ye),oe=h(ye,"BUTTON",{class:!0,type:!0});var Oe=p(oe);ge=H(Oe,he),Oe.forEach(u),ye.forEach(u),j.forEach(u),fe.forEach(u),re.forEach(u),d.forEach(u),be=T(l),Z(B.$$.fragment,l),this.h()},h(){f(_,"class","shrink-0 mr-2"),f(F,"class","flex-1"),f(i,"class","flex w-full items-center"),f(v,"class","flex gap-2 px-1 items-center"),f(s,"class","w-full mb-2 flex flex-col gap-0.5"),f(M,"class","mb-2 flex-1 overflow-auto h-0 rounded-lg"),f(G,"class","font-semibold dark:text-gray-200"),f(ie,"class","font-medium dark:text-gray-400"),f(P,"class","text-xs text-gray-500 line-clamp-2"),f(x,"class","flex-1 pr-3"),f(oe,"class","px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full"),f(oe,"type","submit"),f(N,"class","pb-3 flex justify-between"),f(a,"class","flex flex-col flex-1 overflow-auto h-0 rounded-lg"),f(o,"class","flex flex-col max-h-[100dvh] h-full"),f(t,"class","mx-auto w-full md:px-0 h-full"),f(e,"class","flex flex-col justify-between w-full overflow-y-auto h-full")},m(l,d){ne(l,e,d),r(e,t),r(t,o),r(o,a),r(a,s),r(s,i),r(i,_),ee(w,_,null),r(i,$),r(i,F),ee(b,F,null),r(i,C),r(i,I),ee(k,I,null),r(s,W),r(s,v),K[y].m(v,null),r(v,D),ee(g,v,null),r(a,A),r(a,M),ee(V,M,null),r(a,R),r(a,N),r(N,x),r(x,P),r(P,G),r(G,ae),r(P,c),r(P,_e),r(P,ke),r(P,Ee),r(P,De),r(P,ie),r(ie,ve),r(N,Fe),r(N,oe),r(oe,ge),n[22](o),ne(l,be,d),ee(B,l,d),J=!0,Ce||(Se=pe(o,"submit",Je(n[23])),Ce=!0)},p(l,[d]){const re={};d&512&&(re.content=l[9].t("Back")),d&1073741824&&(re.$$scope={dirty:d,ctx:l}),w.$set(re);const fe={};d&512&&(fe.content=l[9].t("e.g. My Filter")),d&1073742337&&(fe.$$scope={dirty:d,ctx:l}),b.$set(fe);const j={};d&512&&(j.content=l[9].t("Function")),k.$set(j);let Q=y;y=Me(l),y===Q?K[y].p(l,d):(Ke(),q(K[Q],1,1,()=>{K[Q]=null}),Qe(),E=K[y],E?E.p(l,d):(E=K[y]=Te[y](l),E.c()),L(E,1),E.m(v,D));const U={};d&512&&(U.content=l[9].t("e.g. A filter to remove profanity from text")),d&1073742344&&(U.$$scope={dirty:d,ctx:l}),g.$set(U);const le={};d&2&&(le.value=l[1]),d&128&&(le.onChange=l[19]),d&32&&(le.onSave=l[20]),V.$set(le),(!J||d&512)&&se!==(se=l[9].t("Warning:")+"")&&z(ae,se),(!J||d&512)&&de!==(de=l[9].t("Functions allow arbitrary code execution.")+"")&&z(_e,de),(!J||d&512)&&me!==(me=l[9].t("don't install random functions from sources you don't trust.")+"")&&z(ve,me),(!J||d&512)&&he!==(he=l[9].t("Save")+"")&&z(ge,he);const ue={};d&1073742336&&(ue.$$scope={dirty:d,ctx:l}),!Ve&&d&64&&(Ve=!0,ue.show=l[6],Xe(()=>Ve=!1)),B.$set(ue)},i(l){J||(L(w.$$.fragment,l),L(b.$$.fragment,l),L(k.$$.fragment,l),L(E),L(g.$$.fragment,l),L(V.$$.fragment,l),L(B.$$.fragment,l),J=!0)},o(l){q(w.$$.fragment,l),q(b.$$.fragment,l),q(k.$$.fragment,l),q(E),q(g.$$.fragment,l),q(V.$$.fragment,l),q(B.$$.fragment,l),J=!1},d(l){l&&(u(e),u(be)),te(w),te(b),te(k),K[y].d(),te(g),n[21](null),te(V),n[22](null),te(B,l),Ce=!1,Se()}}}function mt(n,e,t){let o;const a=Ye("i18n");Ze(n,a,c=>t(9,o=c));let s=null,i=!1,{onSave:_=()=>{}}=e,{edit:w=!1}=e,{clone:$=!1}=e,{id:F=""}=e,{name:b=""}=e,{meta:C={description:""}}=e,{content:I=""}=e,k="";const W=()=>{t(7,k=I)};let v,y=`"""
title: Example Filter
author: open-webui
author_url: https://github.com/open-webui
funding_url: https://github.com/open-webui
version: 0.1
"""

from pydantic import BaseModel, Field
from typing import Optional


class Filter:
    class Valves(BaseModel):
        priority: int = Field(
            default=0, description="Priority level for the filter operations."
        )
        max_turns: int = Field(
            default=8, description="Maximum allowable conversation turns for a user."
        )
        pass

    class UserValves(BaseModel):
        max_turns: int = Field(
            default=4, description="Maximum allowable conversation turns for a user."
        )
        pass

    def __init__(self):
        # Indicates custom file handling logic. This flag helps disengage default routines in favor of custom
        # implementations, informing the WebUI to defer file-related operations to designated methods within this class.
        # Alternatively, you can remove the files directly from the body in from the inlet hook
        # self.file_handler = True

        # Initialize 'valves' with specific configurations. Using 'Valves' instance helps encapsulate settings,
        # which ensures settings are managed cohesively and not confused with operational flags like 'file_handler'.
        self.valves = self.Valves()
        pass

    def inlet(self, body: dict, __user__: Optional[dict] = None) -> dict:
        # Modify the request body or validate it before processing by the chat completion API.
        # This function is the pre-processor for the API where various checks on the input can be performed.
        # It can also modify the request before sending it to the API.
        print(f"inlet:{__name__}")
        print(f"inlet:body:{body}")
        print(f"inlet:user:{__user__}")

        if __user__.get("role", "admin") in ["user", "admin"]:
            messages = body.get("messages", [])

            max_turns = min(__user__["valves"].max_turns, self.valves.max_turns)
            if len(messages) > max_turns:
                raise Exception(
                    f"Conversation turn limit exceeded. Max turns: {max_turns}"
                )

        return body

    def outlet(self, body: dict, __user__: Optional[dict] = None) -> dict:
        # Modify or analyze the response body after processing by the API.
        # This function is the post-processor for the API, which can be used to modify the response
        # or perform additional checks and analytics.
        print(f"outlet:{__name__}")
        print(f"outlet:body:{body}")
        print(f"outlet:user:{__user__}")

        return body
`;const E=async()=>{_({id:F,name:b,meta:C,content:I})},D=async()=>{if(v){t(1,I=k),await $e();const c=await v.formatPythonCodeHandler();await $e(),t(1,I=k),await $e(),c&&(console.info("Code formatted successfully"),E())}},g=()=>{et("/admin/functions")};function A(){b=this.value,t(0,b)}function M(){F=this.value,t(2,F),t(0,b),t(4,w),t(14,$)}function V(){C.description=this.value,t(3,C)}const R=c=>{t(7,k=c)},N=async()=>{s&&s.requestSubmit()};function x(c){Pe[c?"unshift":"push"](()=>{v=c,t(8,v)})}function P(c){Pe[c?"unshift":"push"](()=>{s=c,t(5,s)})}const G=()=>{w?D():t(6,i=!0)};function se(c){i=c,t(6,i)}const ae=()=>{D()};return n.$$set=c=>{"onSave"in c&&t(13,_=c.onSave),"edit"in c&&t(4,w=c.edit),"clone"in c&&t(14,$=c.clone),"id"in c&&t(2,F=c.id),"name"in c&&t(0,b=c.name),"meta"in c&&t(3,C=c.meta),"content"in c&&t(1,I=c.content)},n.$$.update=()=>{n.$$.dirty&2&&I&&W(),n.$$.dirty&16401&&b&&!w&&!$&&t(2,F=b.replace(/\s+/g,"_").toLowerCase())},[b,I,F,C,w,s,i,k,v,o,a,y,D,_,$,g,A,M,V,R,N,x,P,G,se,ae]}class It extends je{constructor(e){super(),ze(this,e,mt,dt,Re,{onSave:13,edit:4,clone:14,id:2,name:0,meta:3,content:1})}}export{It as F};
//# sourceMappingURL=DOQfqgOE.js.map
