[tox]
envlist = py38,py39,py310,py311,py312,lint,type,docs
isolated_build = True

[testenv]
deps =
    -r requirements-test.txt
commands =
    pytest {posargs:tests/}

[testenv:coverage]
deps =
    -r requirements-test.txt
commands =
    pytest --cov=fastalloc --cov-report=term-missing --cov-report=html --cov-report=xml {posargs:tests/}

[testenv:lint]
deps =
    -r requirements-dev.txt
commands =
    black --check src/ tests/ examples/ benchmarks/
    isort --check src/ tests/ examples/ benchmarks/
    flake8 src/ tests/ examples/ benchmarks/
    pylint src/fastalloc/

[testenv:type]
deps =
    -r requirements-dev.txt
commands =
    mypy src/fastalloc/

[testenv:docs]
deps =
    -r requirements-dev.txt
changedir = docs
commands =
    sphinx-build -W -b html . _build/html

[testenv:benchmark]
deps =
    -r requirements-test.txt
commands =
    pytest benchmarks/ --benchmark-only

[testenv:format]
deps =
    black>=23.0.0
    isort>=5.12.0
commands =
    black src/ tests/ examples/ benchmarks/
    isort src/ tests/ examples/ benchmarks/
