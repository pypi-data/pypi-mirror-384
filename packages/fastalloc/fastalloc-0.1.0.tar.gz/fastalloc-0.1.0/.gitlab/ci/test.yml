test:python38:
  stage: test
  image: python:3.8
  script:
    - pip install -r requirements-test.txt
    - pytest $PYTEST_ARGS tests/
  coverage: '/TOTAL.*\s+(\d+%)$/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage.xml

test:python39:
  stage: test
  image: python:3.9
  script:
    - pip install -r requirements-test.txt
    - pytest $PYTEST_ARGS tests/

test:python310:
  stage: test
  image: python:3.10
  script:
    - pip install -r requirements-test.txt
    - pytest $PYTEST_ARGS tests/

test:python311:
  stage: test
  image: python:3.11
  script:
    - pip install -r requirements-test.txt
    - pytest $PYTEST_ARGS tests/

test:python312:
  stage: test
  image: python:3.12
  script:
    - pip install -r requirements-test.txt
    - pytest $PYTEST_ARGS tests/

test:coverage:
  stage: test
  image: python:3.11
  script:
    - pip install -r requirements-test.txt
    - pytest --cov=fastalloc --cov-report=html --cov-report=term --cov-fail-under=95 tests/
  coverage: '/TOTAL.*\s+(\d+%)$/'
  artifacts:
    paths:
      - htmlcov/
    expire_in: 1 week
