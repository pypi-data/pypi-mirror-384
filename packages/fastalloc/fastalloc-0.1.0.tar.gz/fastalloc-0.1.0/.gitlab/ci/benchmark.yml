benchmark:
  stage: benchmark
  image: python:3.11
  script:
    - pip install -r requirements-test.txt
    - pytest benchmarks/ --benchmark-only --benchmark-json=benchmark_results.json
  artifacts:
    paths:
      - benchmark_results.json
    expire_in: 1 month
  only:
    - main
    - tags

benchmark:compare:
  stage: benchmark
  image: python:3.11
  script:
    - pip install -r requirements-test.txt
    - pytest benchmarks/ --benchmark-only --benchmark-compare --benchmark-compare-fail=mean:10%
  allow_failure: true
  only:
    - merge_requests
