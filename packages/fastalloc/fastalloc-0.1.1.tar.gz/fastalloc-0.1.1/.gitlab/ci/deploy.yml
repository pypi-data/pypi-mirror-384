deploy:pypi:
  stage: deploy
  image: python:3.11
  script:
    - pip install build twine
    - python -m build
    - twine check dist/*
    - twine upload dist/* --username __token__ --password $PYPI_TOKEN
  only:
    - tags
  when: manual
  environment:
    name: production
    url: https://pypi.org/project/fastalloc/

deploy:test-pypi:
  stage: deploy
  image: python:3.11
  script:
    - pip install build twine
    - python -m build
    - twine check dist/*
    - twine upload --repository testpypi dist/* --username __token__ --password $TEST_PYPI_TOKEN
  only:
    - main
  when: manual
  environment:
    name: staging
    url: https://test.pypi.org/project/fastalloc/
