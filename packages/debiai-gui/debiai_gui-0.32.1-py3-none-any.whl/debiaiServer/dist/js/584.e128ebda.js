"use strict";(self["webpackChunkdebiai_frontend"]=self["webpackChunkdebiai_frontend"]||[]).push([[584],{3470:function(e,t,s){s.r(t),s.d(t,{default:function(){return ve}});var l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"project"}},[e.settings&&e.project?s("Modal",{on:{close:function(t){e.settings=!1}}},[s("h2",{staticClass:"aligned spaced"},[e._v(" Project columns "),s("button",{staticClass:"red",on:{click:function(t){e.settings=!1}}},[e._v(" Close ")])]),s("ProjectColumnsVisualization")],1):e._e(),s("Header",{attrs:{project:e.project},on:{settings:function(t){e.settings=!e.settings},refresh:e.loadProject,deleteProject:e.deleteProject,backToProjects:e.backToProjects}}),s("transition",{attrs:{name:"fade"}},[e.project?s("div",{attrs:{id:"projectContent"}},[s("div",{attrs:{id:"selectionAndModels"}},[s("Selections",{attrs:{project:e.project,nbSelectedSamples:e.nbSelectedSamples},on:{selectionSelected:e.selectionSelected,selectionDeleted:e.selectionDeleted,setSelectionIntersection:function(t){return e.selectionIntersection=t},newSelection:e.loadProject}}),s("Models",{attrs:{project:e.project,nbEvaluatedSamples:e.nbEvaluatedSamples,nbSelectedSamples:e.nbSelectedSamples,nbResults:e.nbResults},on:{modelSelected:e.modelSelected,modelDeleted:e.modelDeleted,setCommonModelResults:function(t){return e.commonModelResults=t}}})],1),s("div",{staticClass:"card",staticStyle:{margin:"5px"},attrs:{id:"bot"}},[s("CachePanel",{attrs:{project:e.project}}),s("button",{attrs:{id:"startAnalysisBtn",disabled:!e.readyToAnalyze},on:{click:function(t){return e.startAnalysis(!1)},mousedown:function(t){return"button"in t&&1!==t.button?null:e.startAnalysis(!0)}}},[e._v(" Start analysis ")]),s("button",{attrs:{id:"startExplorationBtn",disabled:!e.readyToAnalyze},on:{click:function(t){return e.openExplorations(!1)},mousedown:function(t){return"button"in t&&1!==t.button?null:e.openExplorations(!0)}}},[e._v(" Explorations ")])],1)]):e._e()])],1)},o=[],a=(s(7658),function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{attrs:{id:"Header"}},[l("div",{attrs:{id:"left"}},[l("div",{attrs:{id:"logoAndName"}},[l("a",{on:{click:[function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.$emit("backToProjects")},function(t){return t.ctrlKey?t.shiftKey||t.altKey||t.metaKey?null:e.$emit("backToProjects",!0):null}],mouseup:function(t){return"button"in t&&1!==t.button||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.$emit("backToProjects",!0)}}},[l("img",{attrs:{src:s(5737),alt:"DebiAI",id:"debiaiLogo",height:"48"}})]),e.project?l("div",{attrs:{id:"projectName"}},[l("a",{on:{click:[function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.$emit("backToProjects")},function(t){return t.ctrlKey?t.shiftKey||t.altKey||t.metaKey?null:e.$emit("backToProjects",!0):null}],mouseup:function(t){return"button"in t&&1!==t.button||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.$emit("backToProjects",!0)}}},[e._v(" Projects ")]),e._v(" / "+e._s(e.project.name)+" ")]):e._e()]),e.project?l("div",{attrs:{id:"items"}},[void 0!==e.project.metrics.nbSamples&&null!==e.project.metrics.nbSamples?l("div",{staticClass:"item nbSamples",attrs:{title:"Number of samples"}},[l("inline-svg",{attrs:{src:s(2798)}}),e._v(" "+e._s(e.project.metrics.nbSamples)+" samples ")],1):l("div",{staticClass:"item nbSamples",attrs:{title:"Number of samples"}},[l("inline-svg",{attrs:{src:s(2798)}}),e._v(" ? ")],1),void 0!==e.project.metrics.nbSelections&&null!==e.project.metrics.nbSelections?l("div",{staticClass:"item nbSelections",attrs:{title:"Project selections"}},[l("inline-svg",{attrs:{src:s(7352)}}),e._v(" "+e._s(e.project.metrics.nbSelections)+" selections ")],1):l("div",{staticClass:"item nbSelections",attrs:{title:"Project selections"}},[l("inline-svg",{attrs:{src:s(7352)}}),e._v(" ? ")],1),void 0!==e.project.metrics.nbModels&&null!==e.project.metrics.nbModels?l("div",{staticClass:"item nbModel",attrs:{title:"Model added to the project"}},[l("inline-svg",{attrs:{src:s(1375)}}),e._v(" "+e._s(e.project.metrics.nbModels)+" models ")],1):l("div",{staticClass:"item nbModel",attrs:{title:"Model added to the project"}},[l("inline-svg",{attrs:{src:s(1375)}}),e._v(" ? ")],1)]):e._e()]),l("div",{attrs:{id:"right"}},[e.project&&(e.project.creationDate||e.project.updateDate)?l("div",{attrs:{id:"dates"}},[e.project.creationDate?l("span",{attrs:{title:e.$services.timeStampToDate(e.project.creationDate)}},[e._v(" Created "+e._s(e.$services.prettyTimeStamp(e.project.creationDate))+" ")]):e._e(),e.project.updateDate?l("span",{attrs:{title:e.$services.timeStampToDate(e.project.updateDate)}},[e._v(" Updated "+e._s(e.$services.prettyTimeStamp(e.project.updateDate))+" ")]):e._e()]):e._e(),l("div",{attrs:{id:"buttonsTop"}},[l("button",{attrs:{id:"settings"},on:{click:function(t){return e.$emit("settings")}}},[l("inline-svg",{attrs:{src:s(7364),width:"12",height:"12",fill:"white"}})],1),l("button",{staticClass:"warning",attrs:{id:"refresh"},on:{click:function(t){return e.$emit("refresh")}}},[l("inline-svg",{attrs:{src:s(9866),width:"10",height:"10"}}),e._v(" Refresh ")],1),e.$store.state.ProjectPage.dataProviderInfo&&e.$store.state.ProjectPage.dataProviderInfo.canDelete&&e.$store.state.ProjectPage.dataProviderInfo.canDelete.projects?l("button",{staticClass:"red",attrs:{id:"delete"},on:{click:function(t){return e.$emit("deleteProject")}}},[e._v(" Delete ")]):e._e()])])])}),n=[],i={name:"Header",props:{project:{type:Object}}},r=i,c=s(3736),d=(0,c.Z)(r,a,n,!1,null,"009bb8ed",null),u=d.exports,m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"ProjectColumnsVisualization"}},[s("h3",[e._v("Data columns")]),s("div",{attrs:{id:"columns"}},e._l(Object.keys(e.dataColumnsPerGroup),(function(t,l){return s("div",{key:l,staticClass:"category"},[s("div",{staticClass:"categoryName"},[e._v(e._s(t)+":")]),e._l(Object.keys(e.dataColumnsPerGroup[t]),(function(l){return s("div",{key:l,staticClass:"group"},[l?s("div",[s("Collapsible",{staticStyle:{margin:"3px"},scopedSlots:e._u([{key:"header",fn:function(){return[e._v(" "+e._s(l)+" "),s("span",{staticClass:"nbItem"},[e._v(" "+e._s(e.dataColumnsPerGroup[t][l].length)+" ")])]},proxy:!0},{key:"body",fn:function(){return[s("div",{staticClass:"columns"},[s("Columns",{attrs:{columns:e.dataColumnsPerGroup[t][l]}})],1)]},proxy:!0}],null,!0)})],1):s("div",{staticClass:"group"},[s("Columns",{attrs:{columns:e.dataColumnsPerGroup[t][l]}})],1)])}))],2)})),0),e.projectColumns.length?e._e():s("div",[e._v("No columns")]),s("h3",[e._v("Results columns")]),e.projectResultsColumns.length?s("div",{attrs:{id:"results"}},e._l(Object.keys(e.resultsColumnsPerGroup.results),(function(t){return s("div",{key:t,staticClass:"group"},[t?s("div",[s("Collapsible",{staticStyle:{margin:"3px"},scopedSlots:e._u([{key:"header",fn:function(){return[e._v(" "+e._s(t)+" "),s("span",{staticClass:"nbItem"},[e._v(" "+e._s(e.resultsColumnsPerGroup.results[t].length)+" ")])]},proxy:!0},{key:"body",fn:function(){return[s("div",{staticClass:"columns"},[s("Columns",{attrs:{columns:e.resultsColumnsPerGroup.results[t]}})],1)]},proxy:!0}],null,!0)})],1):s("div",{staticClass:"group"},[s("Columns",{attrs:{columns:e.resultsColumnsPerGroup.results[t]}})],1)])})),0):s("div",[e._v("No results columns")])])},h=[],p=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"columns"},e._l(e.columns,(function(t){return s("div",{key:t.name,staticClass:"column"},[s("div",{staticClass:"columnInfo"},[s("span",{staticClass:"columnName"},[e._v(" "+e._s(t.name)+" ")]),t.metrics&&void 0!==t.metrics.nbUniqueValues?s("span",{staticClass:"tag"},[e._v(" "+e._s(t.metrics.nbUniqueValues)+" "),s("span",{staticClass:"columnType"},[e._v(" "+e._s(void 0!==t.type?t.type:"auto")+" ")])]):s("span",{staticClass:"columnType"},[e._v(" "+e._s(void 0!==t.type?t.type:"auto")+" ")]),t.tags&&t.tags.length?s("span",{staticClass:"tags"},e._l(t.tags,(function(t){return s("span",{key:t,staticClass:"tag"},[e._v(e._s(t))])})),0):e._e(),s("div",{staticStyle:{flex:"1"}}),t.metrics?s("documentationBlock",[s("div",{staticClass:"metrics-info"},[s("div",[s("strong",[e._v("Unique values:")]),e._v(" "+e._s(t.metrics.nbUniqueValues))]),s("div",[s("strong",[e._v("Null values:")]),e._v(" "+e._s(t.metrics.nbNullValues))]),"number"===t.type&&null!==t.metrics.average?s("div",[s("strong",[e._v("Average:")]),e._v(" "+e._s(e.formatNumber(t.metrics.average))+" ")]):e._e(),"number"===t.type&&null!==t.metrics.min?s("div",[s("strong",[e._v("Min:")]),e._v(" "+e._s(e.formatNumber(t.metrics.min))+" ")]):e._e(),"number"===t.type&&null!==t.metrics.max?s("div",[s("strong",[e._v("Max:")]),e._v(" "+e._s(e.formatNumber(t.metrics.max))+" ")]):e._e(),t.metadata&&t.metadata.category?s("div",[s("strong",[e._v("Category:")]),e._v(" "+e._s(t.metadata.category)+" ")]):e._e()])]):e._e()],1)])})),0)},g=[],v={name:"Columns",components:{},props:{columns:{type:Array,required:!0}},data:()=>({}),created(){},methods:{formatNumber(e){return null===e||void 0===e?"N/A":"object"===typeof e&&void 0!==e.parsedValue?Number(e.parsedValue).toFixed(2):Number(e).toFixed(2)}},computed:{}},b=v,f=(0,c.Z)(b,p,g,!1,null,"10da7fba",null),y=f.exports,I={name:"ProjectColumnsVisualization",components:{Columns:y},data:()=>({projectColumns:[],projectResultsColumns:[]}),created(){this.projectColumns=this.$store.state.ProjectPage.projectColumns,this.projectColumns||(this.projectColumns=[]),this.projectResultsColumns=this.$store.state.ProjectPage.projectResultsColumns,this.projectResultsColumns||(this.projectResultsColumns=[])},methods:{groupCategoriesPerGroup(e){const t={};for(let s in e){const l={"":[]};for(let t of e[s]){const e=t.metadata.group;e?(l[e]||(l[e]=[]),l[e].push(t)):l[""].push(t)}t[s]=l}return t}},computed:{columnsPerCategory(){let e={};for(let t=0;t<this.projectColumns.length;t++){let s=this.projectColumns[t],l=s.metadata.category+"s";l=l.charAt(0).toUpperCase()+l.slice(1),l||(l="other"),e[l]||(e[l]=[]),e[l].push(s)}return e},dataColumnsPerGroup(){return this.groupCategoriesPerGroup(this.columnsPerCategory)},resultsColumnsPerGroup(){return this.groupCategoriesPerGroup({results:this.projectResultsColumns})}}},j=I,S=(0,c.Z)(j,m,h,!1,null,"026e86ca",null),C=S.exports,_=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{attrs:{id:"models"}},[l("div",{attrs:{id:"modelsPanel"}},[l("div",{attrs:{id:"title"}},[l("h2",[l("inline-svg",{staticStyle:{"margin-right":"10px"},attrs:{src:s(1375),width:"25",height:"25"}}),e._v(" Models ")],1),l("span",{staticStyle:{display:"flex","align-items":"center"}},[l("button",{on:{click:e.selectAll}},[e._v("All")]),l("button",{staticStyle:{"margin-right":"5px"},on:{click:e.selectNone}},[e._v(" None ")]),l("input",{directives:[{name:"model",rawName:"v-model",value:e.searchBar,expression:"searchBar"}],staticClass:"search",attrs:{type:"text",placeholder:"Search a model"},domProps:{value:e.searchBar},on:{input:function(t){t.target.composing||(e.searchBar=t.target.value)}}})])]),e.project.models.length>0?l("div",{staticClass:"itemList",attrs:{id:"modelList"}},e._l(e.filteredModels,(function(t){return l("div",{key:t.id,class:"model item selectable "+(e.selectedModelIds.includes(t.id)?"selected":""),on:{click:function(s){return e.selectModel(t.id)}}},[l("div",{staticClass:"title"},[l("h3",{staticClass:"name"},[e._v(e._s(t.name))]),t.creationDate?l("span",{staticClass:"date",attrs:{title:e.$services.timeStampToDate(t.creationDate)}},[e._v(" Created "+e._s(e.$services.prettyTimeStamp(t.creationDate))+" ")]):l("span",{staticClass:"date"},[e._v(" No creation date ")])]),l("div",{staticClass:"allButtons"},[t.metadata&&Object.keys(t.metadata).length>0?l("DocumentationBlock",[l("h4",[e._v("Model Metadata")]),l("br"),l("div",{staticStyle:{"white-space":"pre-wrap"}},[l("span",{domProps:{innerHTML:e._s(e.$services.prettifyJSON(t.metadata))}})])]):e._e(),l("div",{staticClass:"sampleNumber",attrs:{title:"Number of samples for which we have model results "}},[l("inline-svg",{attrs:{src:s(2798),width:"20",height:"20"}}),e._v(e._s("nbResults"in t&&null!==t.nbResults?t.nbResults:"?")+" ")],1),e.$store.state.ProjectPage.dataProviderInfo&&e.$store.state.ProjectPage.dataProviderInfo.canDelete&&e.$store.state.ProjectPage.dataProviderInfo.canDelete.models?l("button",{staticClass:"red",on:{click:function(s){return e.deleteModel(t.id,s)}}},[e._v(" Delete ")]):e._e()],1)])})),0):l("div",{staticStyle:{"text-align":"center","padding-top":"20px"},attrs:{id:"Model"}},[e._v(" No models ")])]),l("transition",{attrs:{name:"fade"}},[e.selectedModelIds.length>0?l("div",{staticClass:"card",attrs:{id:"modelsControls"}},[l("transition",{attrs:{name:"fade"}},[e.selectedModelIds.length>1?l("div",{attrs:{id:"commonModelResults"}},[e._v(" Multiple model results selected : "),l("div",{staticClass:"dataGroup"},[e._v(" Union "),l("input",{directives:[{name:"model",rawName:"v-model",value:e.commonModelResults,expression:"commonModelResults"}],staticClass:"customCbx",staticStyle:{display:"none"},attrs:{type:"checkbox",id:"commonModelResultsToggle"},domProps:{checked:Array.isArray(e.commonModelResults)?e._i(e.commonModelResults,null)>-1:e.commonModelResults},on:{change:function(t){var s=e.commonModelResults,l=t.target,o=!!l.checked;if(Array.isArray(s)){var a=null,n=e._i(s,a);l.checked?n<0&&(e.commonModelResults=s.concat([a])):n>-1&&(e.commonModelResults=s.slice(0,n).concat(s.slice(n+1)))}else e.commonModelResults=o}}}),l("label",{staticClass:"toggle",attrs:{for:"commonModelResultsToggle"}},[l("span")]),e._v(" Intersection ")])]):e._e()]),l("div",{attrs:{id:"nbEvaluatedSamples"}},[e._v(" Number of results : "),l("div",{staticClass:"dataGroup"},[e._v(" "+e._s(null===e.nbResults?"?":e.nbResults)+" ")])])],1):e._e()])],1)},P=[],w={props:{project:{type:Object,required:!0},nbEvaluatedSamples:{type:Number},nbResults:{type:Number},nbSelectedSamples:{type:Number}},data:()=>({searchBar:"",selectedModelIds:[],commonModelResults:!0}),mounted(){},methods:{selectModel(e){this.selectedModelIds.includes(e)?this.selectedModelIds=this.selectedModelIds.filter((t=>t!==e)):this.selectedModelIds.push(e),this.$emit("modelSelected",this.selectedModelIds)},selectAll(){this.selectedModelIds=this.project.models.map((e=>e.id)),this.$emit("modelSelected",this.selectedModelIds)},selectNone(){this.selectedModelIds=[],this.$emit("modelSelected",this.selectedModelIds)},deleteModel(e,t){this.$backendDialog.delModel(e).then((()=>{this.$store.commit("sendMessage",{title:"success",msg:"Model deleted"}),this.selectedModelIds=this.selectedModelIds.filter((t=>t!==e)),this.$emit("modelSelected",this.selectedModelIds),this.$emit("modelDeleted",e)})).catch((e=>{console.log(e),this.$store.commit("sendMessage",{title:"error",msg:"Couldn't delete the model"})})),t.stopPropagation()}},computed:{filteredModels(){return null===this.project?[]:""===this.searchBar?this.project.models:this.project.models.filter((e=>e.name.toLowerCase().includes(this.searchBar.toLowerCase())))}},watch:{commonModelResults(){this.$emit("setCommonModelResults",this.commonModelResults)}}},R=w,M=(0,c.Z)(R,_,P,!1,null,"808b7302",null),$=M.exports,k=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{attrs:{id:"selections"}},[l("div",{attrs:{id:"selectionsPanel"}},[l("div",{attrs:{id:"title"}},[l("span",{staticClass:"aligned gapped"},[l("h2",[l("inline-svg",{staticStyle:{"margin-right":"10px"},attrs:{src:s(7352),width:"25",height:"25"}}),e._v(" Selections ")],1),l("DocumentationBlock",[e._v(" A "),l("b",[e._v(" selection ")]),e._v(" is a list of samples, it can be created from the analysis dashboard. "),l("br"),e._v(" Selections are used to start analysis on a specific subset of the data project, they can be extracted by the DebiAI python library. ")])],1),l("span",{staticClass:"aligned"},[l("button",{on:{click:e.selectAll}},[e._v("All")]),l("button",{staticStyle:{"margin-right":"5px"},on:{click:e.selectNone}},[e._v(" None ")]),l("input",{directives:[{name:"model",rawName:"v-model",value:e.searchBar,expression:"searchBar"}],staticClass:"search",attrs:{type:"text",placeholder:"Search a selection"},domProps:{value:e.searchBar},on:{input:function(t){t.target.composing||(e.searchBar=t.target.value)}}})])]),l("div",{staticClass:"itemList",attrs:{id:"selectionList"}},[l("div",{class:"selection item selectable "+(0==e.selectedSelectionIds.length?"selected":""),attrs:{id:"allData"},on:{click:e.selectNone}},[e._m(0),l("div",{staticClass:"sampleNumber",attrs:{title:"Selection sample number"}},[l("inline-svg",{attrs:{src:s(2798),height:"25"}}),e._v(e._s(null!==e.project.metrics.nbSamples?e.project.metrics.nbSamples:"?")+" ")],1)]),e._l(e.filteredSelections,(function(t){return l("Selection",{key:t.id,class:"item selectable "+(e.selectedSelectionIds.includes(t.id)?"selected":""),attrs:{selection:t},on:{selected:function(s){return e.selectSelection(t.id)},delete:function(s){return e.deleteSelection(t.id)},selectRequest:e.selectRequest}})})),0==e.project.selections.length?l("div",{staticStyle:{"text-align":"center","padding-top":"20px"}},[e._v(" No selections ")]):e._e()],2)]),l("transition",{attrs:{name:"fade"}},[l("div",{staticClass:"card",attrs:{id:"analysisControls"}},[l("transition",{attrs:{name:"fade"}},[e.selectedSelectionIds.length>1?l("div",{attrs:{id:"selectionIntersection"}},[e._v(" Multiple selection selected : "),l("div",{staticClass:"dataGroup",staticStyle:{"margin-right":"40px"}},[e._v(" Union "),l("input",{directives:[{name:"model",rawName:"v-model",value:e.selectionIntersection,expression:"selectionIntersection"}],staticClass:"customCbx",staticStyle:{display:"none"},attrs:{type:"checkbox",id:"selectionIntersectionToggle"},domProps:{checked:Array.isArray(e.selectionIntersection)?e._i(e.selectionIntersection,null)>-1:e.selectionIntersection},on:{change:function(t){var s=e.selectionIntersection,l=t.target,o=!!l.checked;if(Array.isArray(s)){var a=null,n=e._i(s,a);l.checked?n<0&&(e.selectionIntersection=s.concat([a])):n>-1&&(e.selectionIntersection=s.slice(0,n).concat(s.slice(n+1)))}else e.selectionIntersection=o}}}),l("label",{staticClass:"toggle",attrs:{for:"selectionIntersectionToggle"}},[l("span")]),e._v(" Intersection ")])]):e._e()]),l("div",{attrs:{id:"nbSelectedSamples"}},[l("span",{staticStyle:{padding:"0px 5px"}},[e._v(" "+e._s(e.nbSelectedSamples)+" ")]),l("inline-svg",{attrs:{src:s(2798),width:"20",height:"20"}}),e.project.metrics.nbSamples?l("span",{staticStyle:{padding:"0 5px 0 2px","font-weight":"normal"},attrs:{title:100*e.nbSelectedSamples/e.project.metrics.nbSamples+"%"}},[e._v(" ("+e._s(Math.ceil(100*e.nbSelectedSamples/e.project.metrics.nbSamples))+"%) ")]):e._e(),e._v(" Selected samples ")],1)],1)])],1)},D=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"title"},[s("h3",{staticClass:"name"},[e._v("All data")])])}],q=s(249),x={components:{Selection:q.Z},props:{project:{type:Object,required:!0},nbSelectedSamples:{type:Number,default:0}},data:()=>({searchBar:"",selectedSelectionIds:[],selectionIntersection:!0,selectionCreation:!1,selectedRequestId:null}),mounted(){},methods:{selectSelection(e){this.selectedSelectionIds.includes(e)?this.selectedSelectionIds=this.selectedSelectionIds.filter((t=>t!==e)):this.selectedSelectionIds.push(e),this.$emit("selectionSelected",this.selectedSelectionIds)},selectAll(){this.selectedSelectionIds=this.project.selections.map((e=>e.id)),this.$emit("selectionSelected",this.selectedSelectionIds)},selectNone(){this.selectedSelectionIds=[],this.$emit("selectionSelected",this.selectedSelectionIds)},deleteSelection(e){this.$backendDialog.delSelection(e).then((()=>{this.$store.commit("sendMessage",{title:"success",msg:"Selection deleted"}),this.selectedSelectionIds=this.selectedSelectionIds.filter((t=>t!==e)),this.$emit("selectionSelected",this.selectedSelectionIds),this.$emit("selectionDeleted",e)})).catch((e=>{console.log(e),this.$store.commit("sendMessage",{title:"error",msg:"Couldn't delete the selection"})}))},selectRequest(e){this.selectedRequestId=e}},computed:{filteredSelections(){return this.project&&this.project.selections?""===this.searchBar?this.project.selections:this.project.selections.filter((e=>e.name.toLowerCase().includes(this.searchBar.toLowerCase()))):[]}},watch:{selectionIntersection(){this.$emit("setSelectionIntersection",this.selectionIntersection)}}},N=x,L=(0,c.Z)(N,k,D,!1,null,"5fca57c9",null),Z=L.exports,A=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{attrs:{id:"CachePanel"}},[l("h3",[l("inline-svg",{attrs:{src:s(2798),width:"20",height:"20"}}),l("span",[e._v(" Cache ")]),l("documentation-block",{attrs:{top:""}},[l("h4",[e._v("What is the cache?")]),l("p",[e._v(" The cache allows to avoid requesting the server for data that has already been requested. ")]),l("h4",[e._v("How does it work?")]),l("p",[e._v(" When you request data from the server, the data is stored in your browser's cache. "),l("br"),e._v(" If you request the same data again, the cache will be used instead of requesting the server. ")]),l("p",[e._v(" The cache is based on the project update date, if the project update date changes, the cache will be cleared. ")])])],1),e.updateDate?l("div",{attrs:{id:"content"}},[l("div",{attrs:{id:"useCache"}},[e._v(" Enable project data cache: "),l("input",{directives:[{name:"model",rawName:"v-model",value:e.useCache,expression:"useCache"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.useCache)?e._i(e.useCache,null)>-1:e.useCache},on:{change:function(t){var s=e.useCache,l=t.target,o=!!l.checked;if(Array.isArray(s)){var a=null,n=e._i(s,a);l.checked?n<0&&(e.useCache=s.concat([a])):n>-1&&(e.useCache=s.slice(0,n).concat(s.slice(n+1)))}else e.useCache=o}}})]),l("div",{attrs:{id:"nbCached"}},[e._v("Project cached items: "+e._s(e.nbCacheItems))]),l("div",{attrs:{id:"buttons"}},[l("button",{attrs:{id:"clearCache",disabled:e.loading},on:{click:e.clearCache}},[e._v(" Clear cache ")]),l("button",{staticClass:"warning",attrs:{title:"Refresh cache info"},on:{click:e.getNbCacheItems}},[l("inline-svg",{attrs:{src:s(9866),width:"15",height:"15"}})],1)])]):l("p",{staticClass:"warning"},[e._v(" The project has no update date. "),l("br"),e._v(" The cache will not be used. "),l("documentation-block",{attrs:{top:""}},[l("h4",[e._v("Why?")]),l("p",[e._v(" The cache is based on the project update date. "),l("br"),e._v(" If we don't know when the project was updated, we can't know if the cache is up to date. If the project has no update date, the cache will not be used. ")])])],1)])},E=[],T=s(8938),B={props:{project:{type:Object,require:!0}},data:()=>({useCache:!0,nbCacheItems:null,updateDate:null,loading:!1}),mounted(){this.project.updateDate&&(this.getNbCacheItems(),"false"===localStorage.getItem("useCache")&&(this.useCache=!1))},methods:{getNbCacheItems(){this.nbCacheItems=null,this.updateDate=this.project.updateDate,T.Z.getNbSamples(this.updateDate).then((e=>{this.nbCacheItems=e}))},clearCache(){this.loading=!0;const e=this.$services.uuid();this.$store.commit("startRequest",{name:"Clearing the project cache",code:e}),T.Z.resetDb().then((()=>{this.nbCacheItems=0,this.$store.commit("sendMessage",{title:"success",msg:"Cache cleared"})})).catch((e=>{console.log(e),this.$store.commit("sendMessage",{title:"error",msg:"Error while clearing cache"})})).finally((()=>{this.$store.commit("endRequest",e),this.loading=!1}))}},computed:{},watch:{useCache:{handler:function(e){localStorage.setItem("useCache",e),this.$store.commit("setUseCache",e)}}}},K=B,G=(0,c.Z)(K,A,E,!1,null,"0cd0571b",null),O=G.exports,F=s(8135),V=s(3304);s(9669);const U=s(6371),z=s(112).Z;let H={};function W(){H={id:null,canceled:!1,requestCodes:{analysisStarting:null,projectSamplesIdList:null,modelResults:null}}}const J=[{blName:"inputs",singleName:"input"},{blName:"groundTruth",singleName:"ground truth"},{blName:"contexts",singleName:"context"},{blName:"others",singleName:"other"},{blName:"features",singleName:"features"},{blName:"annotations",singleName:"annotations"}];async function Q(){try{const e=F.Z.state.ProjectPage.dataProviderInfo,t={maxIdLimit:e?.maxSampleIdByRequest||1e4,maxDataLimit:e?.maxSampleDataByRequest||2e3,maxResultLimit:e?.maxResultByRequest||5e3};return t}catch(e){return console.log("Error while getting data provider limit, using default values"),console.log(e),{maxIdLimit:1e4,maxDataLimit:2e3,maxResultLimit:5e3}}}async function Y(e,t=[],s=!1,l=[],o=!1){if(H.canceled)return;const a=e.dataProvider.maxIdLimit,n=e.nbSamples;if(0===n)return[];if(null!==n&&n<=a||t.length>0||l.length>0){const e=await z.getIdList({analysis:{id:H.id,start:!0,end:!0},selectionIds:t,selectionIntersection:s,modelIds:l,commonResults:o});return e.samples}if(null===n){let e=[],t=0;console.warn("Project samples number is not known, loading samples ID list by chunks");let s=V.Z.startRequest("Step 1/2: Loading the data ID list");H.requestCodes.projectSamplesIdList=s;try{console.time("getProjectSamplesIdList");while(1){const l=t*a,o=(t+1)*a-1,n={id:H.id,start:!1,end:!1};0===t&&(n.start=!0);const i=await z.getIdList({analysis:n,from:l,to:o});if(0===i.samples.length){console.log("No samples found while loading project samples ID list");break}if(e=e.concat(i.samples),console.log("Current samples ID list length: ",e.length),i.samples.length<a){console.log("Last samples found while loading project samples ID list",i.samples.length,"<",a);break}if(H.canceled)break;V.Z.updateRequestQuantity(s,e.length),t++}console.timeEnd("getProjectSamplesIdList"),V.Z.endRequest(s)}catch(i){throw console.timeEnd("getProjectSamplesIdList"),V.Z.endRequest(s),i}return console.log("Request done, ",e.length," samples found"),e}{let e=Math.ceil(n/a),t=[];console.log("Splitting ID list request in ",e," requests");let s=V.Z.startProgressRequest("Step 1/2: Loading the data ID list");H.requestCodes.projectSamplesIdList=s;try{console.time("getProjectSamplesIdList");for(let l=0;l<e;l++){const o=l*a,i=Math.min((l+1)*a,n)-1,r={id:H.id,start:!1,end:!1};0===l&&(r.start=!0),l===e-1&&(r.end=!0);const c=await U.default.getProjectIdList(r,o,i);if(0===c.length)throw"No samples found while loading project samples ID list from "+o+" to "+i;if(c.length!==i-o+1)throw"Wrong number of samples while loading project samples ID list from "+o+" to "+i+", got "+c.length+" instead of "+(i-o+1);if(t=t.concat(c),V.Z.updateRequestProgress(s,(l+1)/e),H.canceled)break}console.timeEnd("getProjectSamplesIdList"),V.Z.endRequest(s)}catch(i){throw console.timeEnd("getProjectSamplesIdList"),V.Z.endRequest(s),i}console.log("Request done, ",t.length," samples found over ",n," samples requested");let l=[...new Set(t)];return l.length!==t.length&&console.warn("Samples ID list is not unique, ",t.length-l.length," duplicates found over ",t.length," samples"),t}}async function X({considerResults:e}){let t=await U.default.getProject();void 0===t.nbSamples&&(t.nbSamples=null);var s={timestamp:t.updateDate,nbSamples:t.nbSamples,labels:["Data ID"],categories:["other"],type:["auto"],groups:[null]};t.columns.forEach((e=>{s.labels.push(e.name),s.categories.push(e.category),s.type.push(e.type),s.groups.push(e.group)})),e&&"resultStructure"in t&&(s.labels.push("model"),s.categories.push("results"),s.type.push("auto"),s.groups.push(null),t.resultStructure.forEach((e=>{s.labels.push(e.name),s.categories.push("results"),s.type.push(e.type),s.groups.push(e.group)})));const l=F.Z.state.ProjectPage.enableCache;return l||(s.timestamp=null),s}async function ee(e,t){if(H.canceled)return;const s=e.dataProvider.maxDataLimit;let l=0,o=t.length,a=V.Z.startProgressRequest("Loading the project data");console.time("Loading the project data");let n=[],i=[];try{while(l<o){let r=t.slice(l,l+s);if(e.timestamp){let t=await T.Z.getSamplesByIds(e.timestamp,r);n=[...n,...Object.values(t)],i=[...i,...Object.keys(t)],r=r.filter((e=>!(e in t)))}if(r.length){console.log(r.length+" samples to download");const t={id:H.id,start:!1,end:!1};0===l&&(t.start=!0),l+r.length===o&&(t.end=!0);const s=await U.default.getBlocksFromSampleIds(r,t),a=s.data;for(let e in a)a[e].unshift(e);n=[...n,...Object.values(a)],i=[...i,...Object.keys(a)],e.timestamp&&T.Z.saveSamples(e.timestamp,a)}if(l+=s,V.Z.updateRequestProgress(a,l/o),H.canceled)break}}finally{V.Z.endRequest(a),console.timeEnd("Loading the project data")}return{dataArray:n,sampleIdList:i}}async function te(e,t,s){const l=e.dataProvider.maxResultLimit;let o=0,a=V.Z.startProgressRequest(t);H.requestCodes.modelResults=a;let n={};try{let e=s.length;while(o<e){let i=s.slice(o,o+l),r=await U.default.getModelResults(t,i);if(n=Object.assign({},n,r),o+=l,V.Z.updateRequestProgress(a,o/e),H.canceled)break}V.Z.updateRequestProgress(a,1)}finally{V.Z.endRequest(a)}return n}async function se(e,t){return await le(e,t)}async function le(e,t){let s=await X({considerResults:!1}),l=await Q();s["dataProvider"]=l;let o=await Y(s,e,t);if(H.canceled)return;const{dataArray:a,sampleIdList:n}=await ee(s,o);return{metaData:s,array:[s.labels,...a],sampleIdList:n}}async function oe(e,t,s,l){let o=await X({considerResults:!0}),a=await Q();o["dataProvider"]=a;let n=await Y(o,e,t,s,l);const{dataArray:i,sampleIdList:r}=await ee(o,n);let c=V.Z.startProgressRequest("Loading the model results");try{let e=[],t=[];for(let l=0;l<s.length;l++){if(H.canceled)break;const a=s[l];let d=await te(o,a,n);const u=[],m=[];r.forEach(((e,t)=>{e in d&&(u.push([...i[t],a,...d[e]]),m.push(e))})),e=[...e,...u],t=[...t,...m],V.Z.updateRequestProgress(c,(l+1)/s.length)}return{metaData:o,array:[o.labels,...e],sampleIdList:t}}catch(d){throw console.error(d),d}finally{V.Z.endRequest(c)}}async function ae(e,t){let s=V.Z.startProgressRequest("Preparing the analysis");console.time("Preparing the analysis");let l={labels:[],nbLines:0,nbColumns:0,columns:new Array(t.labels.length).fill(null),categories:[...J.map((e=>e.singleName)),"results"]};l.labels=e[0],l.nbLines=e.length-1,l.nbColumns=e[0].length;for(const[o,a]of l.labels.entries()){let e=l.labels.findIndex(((e,t)=>a==e&&o!=t)),t=2;while(e>=0)l.labels[e]=l.labels[e]+"_"+t,e=l.labels.findIndex(((e,t)=>a==e&&o!=t))}for await(const[o,a]of l.labels.entries()){const n=[];for(let t=1;t<l.nbLines+1;t++)n.push(e[t][o]);const i=t.categories[o],r=t.type[o],c=t.groups[o];l.columns[o]={index:o,label:a,values:n,category:i,type:r,group:c},V.Z.updateRequestProgress(s,(o+1)/l.nbColumns),console.timeLog("Preparing the analysis","Column "+a+" "+(o+1)+" / "+l.nbColumns)}return V.Z.endRequest(s),console.timeEnd("Preparing the analysis"),l}async function ne({selectionIds:e=null,selectionIntersection:t=!1,modelIds:s=null,commonModelResults:l=!1}){if(re())throw new Error("Analysis already running");W();let o,a,n=V.Z.startRequest("The analysis is starting",ie);H.requestCodes.analysisStarting=n,H.id=V.Z.uuid();try{if(a=s&&s.length>0?await oe(e,t,s,l):await se(e,t),!H.canceled){let e=a.metaData,t=a.array,s=a.sampleIdList;o=await ae(t,e),o.sampleIdList=s}}catch(i){throw console.error(i),W(),i}finally{V.Z.endRequest(n)}if(!H.canceled)return W(),o;W()}function ie(){console.log("cancelCallback"),H.canceled=!0,V.Z.endRequest(H.requestCodes.analysisStarting),V.Z.endRequest(H.requestCodes.projectSamplesIdList),V.Z.endRequest(H.requestCodes.modelResults)}function re(){return null!=H.id&&!H.canceled}var ce={loadProjectSamples:ne,cancelAnalysis:ie,isAnalysisLoading:re},de=s(112),ue=s(6737),me=s.n(ue),he={name:"Project",components:{Header:u,ProjectColumnsVisualization:C,Models:$,Selections:Z,CachePanel:O},data:()=>({dataProviderId:null,projectId:null,project:null,loading:!1,settings:!1,selectedSelectionsIds:[],selectionIntersection:!0,nbSelectedSamples:0,selectedModelIds:[],commonModelResults:!0,nbEvaluatedSamples:0,nbResults:0}),created(){let e=this.$route.params.dataProviderId?this.$route.params.dataProviderId:this.$route.query.dataProviderId,t=this.$route.params.projectId?this.$route.params.projectId:this.$route.query.projectId,s=this.$route.query.startAnalysis;e&&t?(this.dataProviderId=e,this.projectId=t,this.$store.commit("setDataProviderId",e),this.$store.commit("setProjectId",t),this.$backendDialog.getSingleDataInfo().then((l=>{this.$store.commit("setDataProviderInfo",l),this.loadProject().then((()=>{if(s){console.log("Start analysis");let s=this.$route.query.selectionIds,l=this.$route.query.selectionIntersection,o=this.$route.query.modelIds,a=this.$route.query.commonModelResults;s&&(s=s.split(".")),o&&(o=o.split(".")),l=!0===l,a=!0===a,this.loadData({dataProviderId:e,projectId:t,selectionIds:s,selectionIntersection:l,modelIds:o,commonModelResults:a})}}))}))):(console.log("No project ID or no data provider ID"),this.$router.push("/"))},methods:{async loadProject(){return this.project=null,this.$backendDialog.getProject().then((e=>{this.project=e,this.nbSelectedSamples=this.project.metrics.nbSamples,this.project.selections=this.project.selections.sort(((e,t)=>t.updateDate-e.updateDate)),this.project.models=this.project.models.sort(((e,t)=>t.updateDate-e.updateDate)),this.$store.commit("setProjectColumns",this.project.columns),this.$store.commit("setProjectResultsColumns",this.project.resultStructure),this.$store.commit("setProjectName",this.project.name),this.project.name?document.title=this.project.name:document.title=this.project.id})).catch((e=>{e.response&&500===e.response.status?this.$store.commit("sendMessage",{title:"error",msg:"Internal server error while loading project"}):e.response&&404===e.response.status?this.$store.commit("sendMessage",{title:"error",msg:"Project not found"}):this.$store.commit("sendMessage",{title:"error",msg:"Error while loading project"}),console.log(e),this.$router.push("/")}))},selectionSelected(e){this.selectedSelectionsIds=e,this.updateNbSamples()},modelSelected(e){this.selectedModelIds=e,this.updateNbSamples()},updateNbSamples(){if(0===this.selectedSelections.length&&0===this.selectedModels.length)return this.nbSelectedSamples=this.project.metrics.nbSamples,this.nbEvaluatedSamples=0,void(this.nbResults=0);const e={analysis:{id:this.$services.uuid(),start:!0,end:!0},selectionIds:this.selectedSelections.map((e=>e.id)),selectionIntersection:this.selectionIntersection,modelIds:this.selectedModels.map((e=>e.id)),commonResults:this.commonModelResults};this.loading=!0,de.Z.getIdList(e).finally((()=>this.loading=!1)).then((e=>{this.nbSelectedSamples=e.nbFromSelection,this.nbEvaluatedSamples=e.nbSamples,this.nbResults=e.nbFromModels})).catch((e=>{console.log(e),this.$store.commit("sendMessage",{title:"error",msg:"Something went wrong while getting the samples list"}),this.loadProject()}))},startAnalysis(e){if(e){let e=this.$router.resolve({path:"/dataprovider/"+this.dataProviderId+"/project/"+this.projectId,query:{selectionIds:this.selectedSelectionsIds,selectionIntersection:this.selectionIntersection,modelIds:this.selectedModelIds,commonModelResults:this.commonModelResults,startAnalysis:!0}});window.open(e.href,"_blank")}else this.loadData({dataProviderId:this.dataProviderId,projectId:this.projectId,selectionIds:this.selectedSelectionsIds,selectionIntersection:this.selectionIntersection,modelIds:this.selectedModelIds,commonModelResults:this.commonModelResults})},loadData({dataProviderId:e,projectId:t,selectionIds:s=[],selectionIntersection:l=!1,modelIds:o=[],commonModelResults:a=!1}){console.time("Loading data"),this.loading=!0,ce.loadProjectSamples({selectionIds:s,selectionIntersection:l,modelIds:o,commonModelResults:a}).then((n=>{n?(this.$store.commit("setSelectionsIds",s),this.$store.commit("setColoredColumnIndex",0),this.$store.commit("clearAllFilters"),s&&s.length>0&&(s=s.reduce(((e,t)=>t+"."+e))),o&&o.length>0&&(o=o.reduce(((e,t)=>t+"."+e))),console.timeEnd("Loading data"),this.$router.push({name:"dataAnalysis",query:{dataProviderId:e,projectId:t,selectionIds:s,selectionIntersection:l,modelIds:o,commonModelResults:a},params:{data:n}})):this.$store.commit("sendMessage",{title:"info",msg:"Analysis canceled"})})).finally((()=>this.loading=!1)).catch((e=>{console.log(e.response.status),e.response&&500===e.response.status?this.$store.commit("sendMessage",{title:"error",msg:"Internal server error while loading data"}):e.response&&404===e.response.status?this.$store.commit("sendMessage",{title:"error",msg:"Data not found"}):this.$store.commit("sendMessage",{title:"error",msg:"Error while loading data"}),this.loadProject()}))},deleteProject(){me()({title:"Delete the project ?",text:"Do you really want to delete the project ? There is no way back.",buttons:!0,icon:"warning",dangerMode:!0}).then((e=>{e&&this.$backendDialog.deleteProject().then((()=>{this.$store.commit("sendMessage",{title:"success",msg:"Project deleted"}),this.$router.push("/")})).catch((e=>{console.log(e),this.$store.commit("sendMessage",{title:"error",msg:"Could not delete the project"})}))}))},selectionDeleted(e){this.project.selections=this.project.selections.filter((t=>t.id!==e))},modelDeleted(e){this.project.models=this.project.models.filter((t=>t.id!==e))},backToProjects(e=!1){if(e){const e=this.$router.resolve({name:"projects"});window.open(e.href,"_blank")}else ce.isAnalysisLoading()?me()({title:"Cancel the analysis?",text:"Do you really want to cancel the analysis and go back to the projects list?",buttons:{cancel:"No",validate:"Yes"},icon:"warning",dangerMode:!0}).then((e=>{e&&(ce.cancelAnalysis(),this.$router.push("/"))})):this.$router.push("/")},openExplorations(e){if(e){const e=this.$router.resolve({path:"/dataprovider/"+this.dataProviderId+"/project/"+this.projectId,name:"explorations"});window.open(e.href,"_blank")}else this.$router.push({name:"explorations"})}},computed:{readyToAnalyze(){return!this.disabled&&!this.loading&&0!==this.nbSelectedSamples&&!(this.selectedModelIds.length>0&&0===this.nbEvaluatedSamples)},selectedSelections(){return this.selectedSelectionsIds.map((e=>this.project.selections.find((t=>e===t.id))))},selectedModels(){return this.selectedModelIds.map((e=>this.project.models.find((t=>e===t.id))))}},watch:{selectionIntersection(){this.updateNbSamples()},commonModelResults(){this.updateNbSamples()}},beforeDestroy(){ce.isAnalysisLoading()&&ce.cancelAnalysis();try{me().close()}catch(e){}}},pe=he,ge=(0,c.Z)(pe,l,o,!1,null,"3fdfacb9",null),ve=ge.exports},112:function(e,t,s){var l=s(6371),o=s(3304);async function a(e){const t=o.Z.startRequest("Getting samples ID list");let s=[],a=new Set,n=0,i=0;if((!e.selectionIds||0===e.selectionIds.length)&&(!e.modelIds||0===e.modelIds.length))try{s=void 0!==e.from&&void 0!==e.to?await l["default"].getProjectIdList(e.analysis,e.from,e.to):await l["default"].getProjectIdList(e.analysis),n=s.length}catch(r){throw o.Z.endRequest(t),r}if(e.selectionIds&&e.selectionIds.length>0){const i=o.Z.startProgressRequest("Getting selections ID list"),r=e.selectionIntersection;try{let t=0;for(const a of e.selectionIds){t++,o.Z.updateRequestProgress(i,t/e.selectionIds.length);const c=await l["default"].getSelectionIdList(a);if(0===s.length)s=c;else if(r){const e=new Set(c);if(s=s.filter((t=>e.has(t))),0===s.length){n=0;break}}else s=[...new Set([...s,...c])]}}catch(c){throw o.Z.endRequest(t),c}finally{o.Z.endRequest(i)}a=new Set(s),s=[...a],n=s.length}if(e.modelIds&&e.modelIds.length>0){if(e.selectionIds&&e.selectionIds.length>0&&0===s.length)return i=null,o.Z.endRequest(t),{samples:[],nbSamples:0,nbFromSelection:0,nbFromModels:0};const r=o.Z.startProgressRequest("Getting models ID list"),d=e.commonResults;let u=[];try{let t=0;for(const s of e.modelIds){t++,o.Z.updateRequestProgress(r,t/e.modelIds.length);let c=await l["default"].getModelResultsIdList(s);if(e.selectionIds&&e.selectionIds.length>0?c=c.filter((e=>a.has(e))):n+=c.length,0===u.length)u=c,d||(i+=c.length);else if(d){const e=new Set(c);if(u=u.filter((t=>e.has(t))),0===u.length){i=0;break}}else i+=c.length,u=[...new Set([...u,...c])]}d&&(i=u.length*e.modelIds.length),s=u}catch(c){throw o.Z.endRequest(t),c}finally{o.Z.endRequest(r)}}return o.Z.endRequest(t),{samples:s,nbSamples:s.length,nbFromSelection:n,nbFromModels:i}}t["Z"]={getIdList:a}}}]);
//# sourceMappingURL=584.e128ebda.js.map