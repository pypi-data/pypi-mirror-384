{{- if and (eq $.Values.secretProvider "externalsecret") (not $.Values.reuseStore) }}
apiVersion: external-secrets.io/v1beta1
kind: {{ ternary "ClusterSecretStore" "SecretStore" (eq $.Values.storeScope "cluster") }}
metadata:
  name: {{ $.Release.Name }}-secretstore
spec:
  provider:
    vault:
      server: "https://vault.example.com"
      path: "secret/"
      version: "v2"
      auth:
        tokenSecretRef:
          name: "vault-auth"
          key: "token"
{{- end }}
