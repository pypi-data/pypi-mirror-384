<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      metal:use-macro="context/main_template/macros/master"
      data-portal-url="${portal_url}"
      tal:define="
        portal_url context/portal_url;
      "
      i18n:domain="cs_dynamicpages"
>

  <body>
    <metal:main fill-slot="main">
      <main id="content">
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
          <div class="toast"
               id="liveToast"
               aria-atomic="true"
               aria-live="assertive"
               role="alert"
          >
            <div class="toast-header">
              <strong class="me-auto"
                      i18n:translate=""
              >Notification</strong>
              <button class="btn-close"
                      aria-label="Close"
                      type="button"
                      data-bs-dismiss="toast"
                      i18n:attributes="aria-label"
              ></button>
            </div>
            <div class="toast-body">
            </div>
          </div>
        </div>
        <tal:condition-configuration condition="view/dynamic_page_folder_element">
          <div class="sticky-top right-0 d-flex justify-content-end py-2 me-2"
               tal:condition="view/can_edit"
          >
            <div class="d-inline-flex align-items-center mb-3 px-3 py-2 fw-semibold text-warning-emphasis bg-warning-subtle border border-warning-subtle rounded-5">
              <div class="form-check form-switch">
                <input class="form-check-input"
                       id="editModeToggle"
                       checked
                       role="switch"
                       type="checkbox"
                />
                <label class="form-check-label"
                       for="editModeToggle"
                       i18n:translate=""
                >Edit Mode</label>
              </div>
            </div>
          </div>
          <tal:features define="
                          rows view/rows;
                        ">
            <tal:featured repeat="brain rows">
              <section class="dynamic-row ${row/row_template} state-${row/review_state} ${row/extra_class}"
                       id="${row/id}"
                       data-delete-target="true"
                       data-elementid="${row/id}"
                       data-elementurl="${row/absolute_url}"
                       data-move-target="true"
                       data-parenturl="${row/aq_parent/absolute_url}"
                       tal:define="
                         row brain/getObject;
                       "
              >
                <div class="edit-options edit-buttons d-flex gap-2"
                     tal:condition="row/can_edit"
                >
                  <small class="d-inline-flex align-items-center mb-3 px-2 py-1 fw-semibold text-warning-emphasis bg-warning-subtle border border-warning-subtle rounded-2 position-relative">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         class="bi bi-info-circle"
                         fill="currentColor"
                         height="16"
                         viewbox="0 0 16 16"
                         width="16"
                    >
                      <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"></path>
                      <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0">
                      </path>
                    </svg><span i18n:translate="">Template:
                      <span i18n:name="template_id">${row/row_template}</span></span>
                  </small>

                  <a class="btn btn-outline-primary btn-sm align-self-start"
                     href="${row/absolute_url}/edit"
                     title="Edit"
                     i18n:attributes="title"
                  ><svg xmlns="http://www.w3.org/2000/svg"
                         class="bi bi-pencil-fill"
                         fill="currentColor"
                         height="16"
                         viewbox="0 0 16 16"
                         width="16"
                    >
                      <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.5.5 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11z">
                      </path>
                    </svg></a>
                  <a class="btn btn-sm btn-danger align-self-start btn-delete-element"
                     href="#"
                     title="Delete"
                     data-bs-target="#deleteElementModal"
                     data-bs-toggle="modal"
                     data-rowid="${row/id}"
                     i18n:attributes="title"
                  ><svg xmlns="http://www.w3.org/2000/svg"
                         class="bi bi-trash3"
                         fill="currentColor"
                         height="16"
                         viewbox="0 0 16 16"
                         width="16"
                    >
                      <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5">
                      </path>
                    </svg></a>

                  <div class="ms-auto d-flex gap-2 align-items-start">

                    <a class="btn btn-outline-primary btn-sm align-self-start"
                       href="#"
                       title="Move up"
                       data-action="move-up"
                       tal:condition="python:not(repeat['brain'].start)"
                       i18n:attributes="title"
                    ><svg xmlns="http://www.w3.org/2000/svg"
                           class="bi bi-arrow-up"
                           fill="currentColor"
                           height="16"
                           viewbox="0 0 16 16"
                           width="16"
                      >
                        <path d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5"
                              fill-rule="evenodd"
                        ></path>
                      </svg></a>
                    <a class="btn btn-outline-primary btn-sm align-self-start"
                       href="#"
                       title="Move down"
                       data-action="move-down"
                       tal:condition="python:not(repeat['brain'].end)"
                       i18n:attributes="title"
                    ><svg xmlns="http://www.w3.org/2000/svg"
                           class="bi bi-arrow-down"
                           fill="currentColor"
                           height="16"
                           viewbox="0 0 16 16"
                           width="16"
                      >
                        <path d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1"
                              fill-rule="evenodd"
                        ></path>
                      </svg></a>
                    <div class="btn-group">
                      <a class="btn btn-secondary dropdown-toggle"
                         aria-expanded="false"
                         type="button"
                         data-bs-display="static"
                         data-bs-toggle="dropdown"
                         tal:attributes="
                           class python:row.review_state() == 'published' and
                    'position-relative btn btn-outline-success btn-sm bg-success-subtle dropdown-toggle' or
                    'position-relative btn btn-outline-danger btn-sm bg-danger-subtle dropdown-toggle';
                         "
                      >
                        <svg xmlns="http://www.w3.org/2000/svg"
                             class="bi bi-info-circle"
                             fill="currentColor"
                             height="16"
                             viewbox="0 0 16 16"
                             width="16"
                        >
                          <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"></path>
                          <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0">
                          </path>
                        </svg><span tal:omit-tag=""
                              i18n:translate=""
                        >Review state:
                          <span tal:omit-tag=""
                                i18n:domain="plone"
                                i18n:name="state"
                                i18n:translate=""
                          >${row/review_state}</span></span>
                        <span tal:attributes="
                                class python:row.review_state() == 'published' and 'position-absolute top-0 start-100 translate-middle p-2 bg-success border border-light rounded-circle' or 'position-absolute top-0 start-100 translate-middle p-2 bg-danger border border-light rounded-circle';
                              ">
                        </span>
                      </a>
                      <ul class="dropdown-menu"
                          tal:define="
                            transitions python:context.portal_workflow.getTransitionsFor(row);
                          "
                      >
                        <tal:transitions repeat="transition transitions">
                          <li><a class="dropdown-item"
                               href="${transition/url}&amp;_authenticator=${context/@@authenticator/token}"
                               i18n:domain="plone"
                               i18n:translate=""
                            >${transition/name}</a>
                          </li>
                        </tal:transitions>
                      </ul>
                    </div>
                  </div>

                </div>
                <tal:condition tal:condition="row/can_edit">
                  <div class="edit-options features-list d-flex flex-wrap gap-2 align-items-start mb-3"
                       tal:define="
                         features_list row/featured_list;
                       "
                  >
                    <tal:conditionfeatures tal:condition="features_list">
                      <tal:featured repeat="featured_brain features_list">
                        <div tal:define="
                               featured_obj featured_brain/getObject;
                             ">
                          <div class="btn-group"
                               data-delete-target="true"
                               data-elementid="${featured_obj/id}"
                               data-elementurl="${featured_obj/absolute_url}"
                               data-move-target="true"
                               data-parenturl="${row/absolute_url}"
                          >
                            <a class="btn btn-secondary dropdown-toggle"
                               aria-expanded="false"
                               type="button"
                               data-bs-display="static"
                               data-bs-toggle="dropdown"
                               tal:attributes="
                                 class python:featured_obj.review_state() == 'published' and
                                          'position-relative btn btn-outline-success btn-sm bg-success-subtle dropdown-toggle' or
                                          'position-relative btn btn-outline-danger btn-sm bg-danger-subtle dropdown-toggle';
                               "
                            >
                            ${featured_obj/Title}
                              <span tal:attributes="
                                      class python:featured_obj.review_state() == 'published' and 'text-white position-absolute top-0 start-100 translate-middle p-1 bg-success border border-light rounded-circle' or 'text-white position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle';
                                    ">
                              </span>
                            </a>
                            <ul class="dropdown-menu">
                              <li><a class="dropdown-item"
                                   href="${featured_obj/absolute_url}/edit"
                                   i18n:translate=""
                                >Edit</a>
                              </li>
                              <li>
                                <h5 class="dropdown-header"
                                    i18n:translate=""
                                >State</h5>
                              </li>
                              <tal:define tal:define="
                                            featured_transitions python:context.portal_workflow.getTransitionsFor(featured_obj);
                                          ">
                                <tal:featured_transitions repeat="featured_transition featured_transitions">
                                  <li><a class="dropdown-item"
                                       href="${featured_transition/url}&amp;_authenticator=${context/@@authenticator/token}"
                                    >${featured_transition/name}</a>
                                  </li>
                                </tal:featured_transitions>
                              </tal:define>
                              <li>
                                <h5 class="dropdown-header"
                                    i18n:translate=""
                                >Move actions</h5>
                              </li>
                              <li><a class="dropdown-item"
                                   href="#"
                                   data-action="move-up"
                                   tal:condition="python:not(repeat['featured_brain'].start)"
                                   i18n:translate=""
                                >Move up</a></li>
                              <li><a class="dropdown-item"
                                   href="#"
                                   data-action="move-down"
                                   tal:condition="python:not(repeat['featured_brain'].end)"
                                   i18n:translate=""
                                >Move down</a></li>
                              <li>
                                <hr class="dropdown-divider" />
                              </li>
                              <li><a class="ms-3 btn btn-sm btn-danger align-self-start btn-delete-element"
                                   href="#"
                                   data-bs-target="#deleteElementModal"
                                   data-bs-toggle="modal"
                                   i18n:translate=""
                                >Delete</a></li>
                            </ul>
                          </div>
                        </div>
                      </tal:featured>
                    </tal:conditionfeatures>

                    <tal:featured_add_button tal:condition="row/show_featured_add_button">
                      <a class="btn btn-outline-primary btn-sm align-self-start"
                         href="${row/absolute_url}/++add++DynamicPageRowFeatured"
                         title="Add featured"
                         i18n:attributes="title"
                      ><svg xmlns="http://www.w3.org/2000/svg"
                             class="bi bi-plus-lg"
                             fill="currentColor"
                             height="16"
                             viewbox="0 0 16 16"
                             width="16"
                        >
                          <path d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2"
                                fill-rule="evenodd"
                          ></path>
                        </svg></a>
                    </tal:featured_add_button>
                  </div>
                </tal:condition>
                <div class="content row">
                  <div class="${row/width}">
                    <replace tal:replace="structure python:row.render(request)"></replace>
                  </div>
                </div>
              </section>
            </tal:featured>
          </tal:features>
          <tal:condition tal:condition="view/can_edit">
            <div class="sticky-bottom edit-options dynamic-row d-flex justify-content-center align-items-center"
                 tal:condition="view/dynamic_page_folder_element_url"
            >
              <a class="btn btn-primary btn-lg"
                 aria-controls="offcanvasRight"
                 title="Add row"
                 data-bs-target="#addrow-offcanvasRight"
                 data-bs-toggle="offcanvas"
                 i18n:attributes="title"
              ><svg xmlns="http://www.w3.org/2000/svg"
                     class="bi bi-plus-lg"
                     fill="currentColor"
                     height="16"
                     viewbox="0 0 16 16"
                     width="16"
                >
                  <path d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2"
                        fill-rule="evenodd"
                  ></path>
                </svg></a>
            </div>
            <div class="offcanvas offcanvas-end"
                 id="addrow-offcanvasRight"
                 aria-labelledby="offcanvasRightLabel"
                 tabindex="-1"
                 tal:define="
                   available_views_for_row view/available_views_for_row;
                 "
            >
              <div class="offcanvas-header">
                <h5 class="offcanvas-title"
                    id="offcanvasRightLabel"
                    i18n:translate=""
                >Add new row</h5>
                <button class="btn-close"
                        aria-label="Close"
                        type="button"
                        data-bs-dismiss="offcanvas"
                        i18n:attributes="aria-label"
                ></button>
              </div>
              <div class="offcanvas-body">
                <ul class="list-unstyled row">
                  <li class="col-6 mb-2"
                      tal:repeat="item available_views_for_row"
                  >
                    <div class="p-5 bg-light rounded h-100 d-flex justify-content-center align-items-center">
                      <a href="${view/dynamic_page_folder_element_url}/add-row-content?row_type=${item/row_type}"
                         data-bs-title="${item/row_type}"
                         data-bs-toggle="tooltip"
                      >
                        <span tal:replace="structure python:icons.tag(item['row_type_icon'], tag_class='fs-1')"></span>
                      </a>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </tal:condition>
          <!-- Delete Confirmation Modal -->
          <div class="modal fade"
               id="deleteElementModal"
               aria-hidden="true"
               aria-labelledby="deleteElementModalLabel"
               tabindex="-1"
          >
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title"
                      id="deleteElementModalLabel"
                      i18n:translate=""
                  >Confirm Deletion</h5>
                  <button class="btn-close"
                          aria-label="Close"
                          type="button"
                          data-bs-dismiss="modal"
                          i18n:attributes="aria-label"
                  ></button>
                </div>
                <div class="modal-body">
                  <p i18n:translate="">Are you sure you want to delete this item? This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                  <button class="btn btn-secondary"
                          type="button"
                          data-bs-dismiss="modal"
                          i18n:translate=""
                  >Cancel</button>
                  <button class="btn btn-danger"
                          id="confirmDeleteElement"
                          type="button"
                          i18n:translate=""
                  >Delete</button>
                </div>
              </div>
            </div>
          </div>
          <script>
            // Selecciona todos los elementos con el atributo data-bs-toggle="tooltip"
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');

            // Crea una instancia de tooltip para cada elemento encontrado
            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
          </script>
        </tal:condition-configuration>
      </main>
    </metal:main>

  </body>

</html>
