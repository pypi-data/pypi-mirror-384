{# Copyright 2022 Karlsruhe Institute of Technology
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #     http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License. #}

<div class="card card-action {% if record == current_record %}bg-light{% endif %}">
  <div class="card-body">
    <a v-trim-ws href="{{ url_for('records.view_record', id=record.id) }}" class="text-default stretched-link">
      {% if record.type %}
        <span class="badge badge-primary badge-mt-plus font-weight-normal float-right elevated ml-3"
              title="{{ record.type }}">
          {{ record.type | truncate(20) }}
        </span>
      {% endif %}

      <div v-trim-ws class="d-flow-root">
        <small>
          <resource-visibility visibility="{{ record.visibility }}"></resource-visibility>
        </small>
        <strong class="ml-2">{{ record.title }}</strong>
      </div>
      <small>@{{ record.identifier }}</small>
    </a>
  </div>
</div>

{% if changes["record"]["count"] > 0 or changes["files"]["count"] > 0 %}
  <div class="card mt-2">
    <div class="card-header border-bottom-0 py-1 stretched-link-container">
      <collapse-item id="revision-info-{{ record.id }}" class="text-default stretched-link" :is-collapsed="true">
        <small>
          {% trans %}Changes since last update of record link{% endtrans %}
        </small>
      </collapse-item>
    </div>
    <div id="revision-info-{{ record.id }}" class="card-body py-2">
      {% if changes["record"]["count"] > 0 %}
        <div class="d-flex justify-content-between">
          <small class="mr-3">
            {{ ngettext("%(num)d new record revision", "%(num)d new record revisions", changes["record"]["count"]) }}
          </small>
          <a href="{{ url_for('records.view_record_revision', record_id=record.id,
                              revision_id=changes['record']['revision'].id, compare_latest='true') }}"
             class="text-right">
            <small>
              <strong>{% trans %}Compare changes{% endtrans %}</strong>
            </small>
          </a>
        </div>
      {% endif %}

      {% if changes["files"]["count"] > 0 %}
        {% if changes["record"]["count"] > 0 %}
          <hr class="my-2">
        {% endif %}

        <div class="d-flex justify-content-between">
          <small class="mr-3">
            {{ ngettext("%(num)d new file revision", "%(num)d new file revisions", changes["files"]["count"]) }}
          </small>
          <a href="{{ url_for('records.view_record', id=record.id, tab='revisions') }}" class="text-right">
            <small>
              <strong>{% trans %}View revisions{% endtrans %}</strong>
            </small>
          </a>
        </div>
      {% endif %}
    </div>
  </div>
{% endif %}
