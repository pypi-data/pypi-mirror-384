<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="view_picking_form" model="ir.ui.view">
        <field name="name">stock.picking.kardex.form</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form" />
        <field name="arch" type="xml">
            <!-- <xpath expr="//button[@name='button_validate']" position="attributes">
            <attribute name="invisible">
                <replace regex='"state in \((.*?)\)"' replacement='"state in (\1, 'waiting_for_kardex')"'/>
            </attribute>
        </xpath> -->
            <xpath
                expr="//button[@name='button_validate'][hasclass('oe_highlight')]"
                position="replace"
            >
                <button
                    name="button_validate"
                    invisible="state in ('waiting_for_kardex', 'draft', 'confirmed', 'done', 'cancel')"
                    string="Validate"
                    type="object"
                    class="oe_highlight"
                    groups="stock.group_stock_user"
                    data-hotkey="v"
                />
            </xpath>
            <xpath
                expr="//button[@name='button_validate'][hasclass('o_btn_validate')]"
                position="replace"
            >
                <button
                    name="button_validate"
                    invisible="state in ('waiting_for_kardex', 'waiting', 'assigned', 'done', 'cancel')"
                    string="Validate"
                    type="object"
                    groups="stock.group_stock_user"
                    class="o_btn_validate"
                    data-hotkey="v"
                />
            </xpath>
            <xpath expr="//page[@name='extra']" position="after">
                <page name="kardex" string="Kardex" invisible="not kardex">
                    <form string="Kardex Daten">
                        <header>
                            <button
                                name="check_kardex"
                                type="object"
                                string="Check SchnittstellenDB"
                            />
                            <button
                                name="send_to_kardex_picking"
                                type="object"
                                string="An Kardex senden"
                                invisible="kardex_done"
                            />
                            <button
                                name="update_status_from_kardex"
                                type="object"
                                string="Update Status"
                                invisible="not kardex_done"
                            />
                        </header>
                        <sheet>
                            <group>
                                <field name="kardex" readonly="0" />
                                <field name="kardex_status" readonly="1" />
                                <field name="kardex_row_create_time" />
                                <field name="kardex_row_update_time" />
                                <field name="kardex_done" />
                            </group>
                        </sheet>
                    </form>
                </page>
            </xpath>
            <xpath expr="//field[@name='backorder_id']" position="after">
                <field name="kardex_done" />
            </xpath>
            <xpath expr="//field[@name='origin']" position="after">
                <field name="kardex" readonly='0' />
                <field name="kardex_sync" string="Sync PPG-J" readonly="1" />
                <field name="kardex_status" string="Status" readonly="1" />
            </xpath>
            <xpath expr="//header" position="inside">
                <!-- <button
                                name="send_to_kardex_picking"
                                type="object"
                                string="An Kardex senden"
                                invisible="kardex_done or picking_type_id.id not in [6]"
                /> -->
                <button
                    name="send_to_kardex_picking"
                    type="object"
                    string="An Kardex senden"
                    invisible="not send_button_is_visible"
                />
                <button
                    name="update_status_from_kardex"
                    type="object"
                    string="Update Status"
                    invisible="not update_button_is_visible"
                />
            </xpath>
            <xpath expr="//list/field[@name='description_picking']" position="after">
                <field name="has_kardex_location" invisible="1" optional="hide" />
                <field name="location_id" optional="hide" />
                <field name="location_dest_id" optional="hide" />
                <field name="kardex_done" string="->Kardex" optional="hide" />
                <field name="kardex_id" string="KID" optional="hide" />
                <field
                    name="kardex_status"
                    string="KStatus"
                    optional="hide"
                    invisible="not has_kardex_location"
                />
                <field name="kardex_running_id_string" string="BzId" optional="hide" />
                <field name="kardex_journal_status" string="Kompl." optional="hide" />
                <field name="kardex_sync" string="JSync" optional="hide" />
            </xpath>
            <xpath expr="//list/field[@name='product_id']" position="before">
                <field name="tracking_type_badge" widget="html" string="T" />
                <!-- <field name="tracking_type_code" string="T" /> -->
            </xpath>

            <!--dlist/field[@name='product_id']" position="replace">
                <field name="product_id" domain="[('kardex', '=', True)]" context="{'default_detailed_type': 'product'}" required="1" readonly="(state != 'draft' and not additional) or move_lines_count &gt; 0" force_save="1"/>
            </xpath>
dlist/field[@name='product_id']" position="replace">
                <field name="products_domain" column_invisible="True"/>
                <field name="product_id" domain="products_domain" context="{'default_detailed_type': 'product'}" required="1" readonly="(state != 'draft' and not additional) or move_lines_count &gt; 0" force_save="1"/>
            </xpath>
             -->
        </field>
    </record>

    <record id="view_move_line_tree_inherit_kardex" model="ir.ui.view">
        <field name="name">stock.move.line.tree.inherit.inventory</field>
        <field name="model">stock.move.line</field>
        <field name="inherit_id" ref="stock.view_move_line_tree" />
        <field name="arch" type="xml">
            <xpath expr="//list/field[@name='product_id']" position="after">
                <field name="kardex_running_id" />
                <field name="kardex_status" />
            </xpath>
        </field>
    </record>
</odoo>
