{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://pristy.fr/schema/node_injector.schema.json",
  "title": "Pristy Node Injector",
  "description": "Node node to be inject in Pristy",
  "type": "object",
  "required": [
    "name",
    "path"
  ],
  "properties": {
    "name": {
      "description": "nom du contenu à créer",
      "type": "string",
      "pattern": "^[^*?\"><:/\\\\|]+[^*?\"><:/\\\\ .|]$"
    },
    "type": {
      "$ref": "#/$defs/shortType"
    },
    "createdAt": {
      "description": "Date de création 2024-05-05T18:54:10.988Z",
      "type": "string",
      "format": "date-time"
    },
    "owner": {
      "$ref": "#/$defs/owner"
    },
    "path": {
      "type": "object",
      "required": [
        "root"
      ],
      "properties": {
        "root": {
          "description": "'site:id_site', 'user:id_user', 'node:uuid_node', 'root', si root injection à la racine",
          "pattern": "^((site|user|node):[a-zA-Z0-9-]+|root)$",
          "type": "string"
        },
        "short": {
          "description": "Format court du chemin, /dossierA/dossierB/dossierC",
          "pattern": "^/.*",
          "type": "string"
        },
        "full": {
          "description": "Format complet du chemin",
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "name"
            ],
            "properties": {
              "name": {
                "description": "nom du contenu à créer",
                "type": "string"
              },
              "type": {
                "$ref": "#/$defs/shortType"
              },
              "createdAt": {
                "description": "Date de création 2024-05-05T18:54:10Z",
                "type": "string",
                "format": "date-time"
              },
              "owner": {
                "$ref": "#/$defs/owner"
              }
            }
          }
        }
      }
    },
    "source": {
      "required": [
        "type"
      ],
      "description": "Emplacement du binaire à injecter. Si source est absent, on créer un dossier.",
      "type": "object",
      "properties": {
        "type": {
          "description": "Protocole utilisé",
          "enum": [
            "local",
            "http",
            "alfresco",
            "smb",
            "webdav",
            "ftp",
            "s3",
            "base64"
          ]
        },
        "url": {
          "description": "Emplacement du fichier",
          "type": "string",
          "format": "uri"
        },
        "server": {
          "description": "Emplacement du fichier",
          "type": "string",
          "format": "uri"
        },
        "uuid": {
          "description": "identifiant du fichier",
          "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
          "type": "string"
        },
        "credential": {
          "type": "object",
          "properties": {
            "type": {
              "description": "Type d’authentification",
              "enum": [
                "basic",
                "hmac",
                "s3",
                "oidc"
              ]
            },
            "token": {
              "type": "string"
            }
          }
        },
        "mimeType": {
        },
        "size": {
          "type": "integer"
        }
      },
      "if": {
        "properties": {
          "type": {
            "const": "base64"
          }
        }
      },
      "then": {
        "required": [
          "base64",
          "mimeType",
          "size"
        ],
        "properties": {
          "base64": {
            "type": "string"
          }
        }
      },
      "patternProperties": {
        "^hash\\.[a-zA-Z0-9]+$": {
          "description": "Hash de control. Le suffix définit l’algorithme de hash",
          "type": "string"
        }
      }
    },
    "properties": {
      "type": "object",
      "propertyNames": {
        "pattern": "^[a-z]{2,}:[a-zA-Z]+"
      }
    }
  },
  "$defs": {
    "shortType": {
      "description": "Type du contenu à créer (Default cm:content ou cm:folder)",
      "pattern": "^[a-z0-9]{2,}:[a-zA-Z0-9_-]+$",
      "type": "string"
    },
    "owner": {
      "description": "login de l’utilisateur",
      "pattern": "^[a-zA-z0-9@._-]+$",
      "type": "string"
    }
  }
}

