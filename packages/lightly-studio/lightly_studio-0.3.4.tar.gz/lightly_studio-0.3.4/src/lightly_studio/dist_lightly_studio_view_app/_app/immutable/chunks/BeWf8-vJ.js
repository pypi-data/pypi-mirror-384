import"./CWj6FrbW.js";import{o as ye}from"./DQ8aZ1o-.js";import{p as ce,c as b,g as t,b as _,r as h,t as ae,a as fe,Y as B,ak as U,u as ie,aa as vt,f as q,s as K}from"./Frwd2CjB.js";import{b as gt,a as l,f as p,c as Y,t as pe}from"./CiaNZCBa.js";import{s as c,a as Pe,i as j}from"./-DXuGN29.js";import{e as _t,s as C,b as we,c as ht,d as Ie,u as pt,g as St,k as bt}from"./D_ynJAfY.js";import{p as Fe,b as xt}from"./Dafy4oEQ.js";import{f as yt,e as Pt,h as wt,_ as Se,i as It,j as Ft,k as jt,l as Ct,G as Ht,L as Ot,S as kt,n as Rt}from"./Cqo0Vpvt.js";import{u as je}from"./qIv1kPyv.js";import{u as At}from"./Bqz7dyEC.js";import{u as Mt,i as Vt,c as Wt,a as Lt}from"./DD63uD-T.js";import"./DSxvnAMh.js";import"./69_IOA4Y.js";import{u as Nt}from"./Cy4fgWTG.js";import{P as Et}from"./DzX_yyqb.js";import{r as qt}from"./CfQ4mGwl.js";import{S as Bt}from"./DmjAI-UV.js";import{b as Tt}from"./D5w4xp5l.js";var zt=gt('<svg style="position: absolute; top: 0; left: 0;"><g></g></svg>');function be(e,s){ce(s,!0);const r=()=>c(u,"$isHidden",f),[f,o]=Pe(),d=Fe(s,"sampleImageObjectFit",3,"contain"),{isHidden:u}=yt(),H=_(()=>s.sample.annotations.filter(a=>a.annotation_type!=="classification"));var S=zt(),V=b(S);let T;_t(V,21,()=>t(H),a=>a.annotation_id,(a,J)=>{Bt(a,{get annotation(){return t(J)},get showLabel(){return s.showLabel},get imageWidth(){return s.sample.width}})}),h(V),h(S),ae(a=>{C(S,"viewBox",`0 0 ${s.sample.width} ${s.sample.height}`),C(S,"preserveAspectRatio",d()==="contain"?"xMidYMid meet":"xMidYMid slice"),C(S,"width",s.containerWidth),C(S,"height",s.containerHeight),T=we(V,0,"",null,T,a)},[()=>({invisible:r()})]),l(e,S),fe(),o()}var Gt=p('<img loading="lazy"/>');function xe(e,s){ce(s,!0);const r=Fe(s,"objectFit",3,"contain"),{getDatasetVersion:f}=je();let o=U("");ye(async()=>{var u;(u=s.sample)!=null&&u.dataset_id&&B(o,await f(s.sample.dataset_id),!0)});var d=Gt();ae(u=>{C(d,"src",`${Et}/sample/${s.sample.sample_id}${t(o)?`?v=${t(o)}`:""}`),C(d,"alt",s.sample.file_path_abs),we(d,1,u,"svelte-1a2mlic"),Ie(d,`--object-fit: ${r()??""}`)},[()=>ht(Pt("sample-image rounded-lg bg-black",s.class))]),l(e,d),fe()}const Qt=e=>{const s=["readSamplesInfinite",e.dataset_id,e.mode,e.mode==="normal"?e.filters:e.classifierSamples,{metadata_values:e.metadata_values,text_embedding:e.text_embedding}];return Vt({queryKey:s,queryFn:async({pageParam:r=0,signal:f})=>{const o=Dt(e,r),{data:d}=await Tt({path:{dataset_id:e.dataset_id},body:o,signal:f,throwOnError:!0});return d},initialPageParam:0,getNextPageParam:r=>r.nextCursor??void 0,enabled:Kt(e)})},Dt=(e,s)=>{var f,o,d;const r={pagination:{offset:s,limit:100},text_embedding:e.text_embedding,filters:{metadata_filters:e.metadata_values?Wt(e.metadata_values):void 0}};if(e.mode==="classifier"&&e.classifierSamples){const u=[...e.classifierSamples.positiveSampleIds,...e.classifierSamples.negativeSampleIds];return{...r,sample_ids:u}}else if(e.mode==="normal"&&e.filters)return{...r,filters:{...r.filters,annotation_label_ids:(f=e.filters.annotation_label_ids)!=null&&f.length?e.filters.annotation_label_ids:void 0,tag_ids:(o=e.filters.tag_ids)!=null&&o.length?e.filters.tag_ids:void 0,width:e.filters.dimensions?{min:e.filters.dimensions.min_width,max:e.filters.dimensions.max_width}:void 0,height:e.filters.dimensions?{min:e.filters.dimensions.min_height,max:e.filters.dimensions.max_height}:void 0,sample_ids:(d=e.filters.sample_ids)!=null&&d.length?e.filters.sample_ids:void 0}};return r},Kt=e=>e.mode==="classifier"?!!(e.classifierSamples&&(e.classifierSamples.positiveSampleIds.length>0||e.classifierSamples.negativeSampleIds.length>0)):!0,Yt=e=>{const s=Qt(e),r=wt(s),f=Mt();return{samples:r,refresh:()=>{f.invalidateQueries({queryKey:s.queryKey})}}};var Ut=p('<div class="flex h-full w-full items-center justify-center"><div>Loading samples...</div></div>'),Jt=p('<div class="flex h-full w-full items-center justify-center"><div class="mb-2 font-medium">Error loading samples</div></div>'),Xt=p('<div class="flex h-full w-full items-center justify-center"><div class="text-center text-muted-foreground"><div class="mb-2 text-lg font-medium">No samples found</div> <div class="text-sm"><!></div></div></div>'),Zt=p('<a data-testid="sample-link" class="block"><!> <!></a>'),$t=p("<div><!> <!></div>"),es=p('<div class="relative"><div class="absolute right-7 top-1 z-10"><!></div> <!></div>'),ts=p('<div class="flex justify-center p-4"><!></div>'),ss=p("<!> <!>",1),is=p('<div class="viewport flex-1 svelte-w4icmb"><!></div>'),as=p('<div class="flex h-full w-full items-center justify-center"><div>Loading...</div></div>');function ws(e,s){ce(s,!0);const r=()=>c(Me,"$isCreateClassifiersPanelOpen",v),f=()=>c(Ve,"$isRefineClassifiersPanelOpen",v),o=()=>c(Le,"$classifierSamples",v),d=()=>c(s.selectedAnnotationFilterIds,"$selectedAnnotationFilterIds",v),u=()=>c(ke,"$tagsSelected",v),H=()=>c(Re,"$dimensions",v),S=()=>c(Ae,"$metadataValues",v),V=()=>c(s.textEmbedding,"$textEmbedding",v),T=()=>c(Te,"$filterParams",v),a=()=>c(t(Qe),"$infiniteSamples",v),J=()=>c(Oe,"$gridViewSampleRenderingStore",v),Ce=()=>c(We,"$selectedSampleIds",v),[v,He]=Pe(),{gridViewSampleRenderingStore:Oe}=pt(),{tagsSelected:ke}=Nt({dataset_id:s.dataset_id,kind:["sample"]}),{dimensionsValues:Re}=At(),{metadataValues:Ae}=Lt(s.dataset_id),{isCreateClassifiersPanelOpen:Me}=jt(),{isRefineClassifiersPanelOpen:Ve}=Ct(),{selectedSampleIds:We,classifierSamples:Le,toggleSampleSelection:Ne,getDatasetVersion:Ee,setSamplesTotalCount:qe}=je(),W=_(()=>r()||f()),Be=_(()=>{var i,n;return{dataset_id:s.dataset_id,mode:t(W)?"classifier":"normal",...t(W)?{classifierSamples:o()}:{filters:{annotation_label_ids:(i=d())!=null&&i.length?d():void 0,tag_ids:u().size>0?Array.from(u()):void 0,dimensions:H()}},metadata_values:S(),text_embedding:(n=V())==null?void 0:n.embedding}}),ue=i=>i.mode==="classifier"?i:{...i,filters:i.filters?Se.omit(i.filters,["sample_ids"]):void 0},{filterParams:Te,updateFilterParams:ze}=It();ie(()=>{var X;const i=t(Be),n=T();if(n&&Se.isEqual(ue(i),ue(n)))return;let k=i;if(k.mode==="normal"){const G=(n==null?void 0:n.mode)==="normal"?(X=n.filters)==null?void 0:X.sample_ids:void 0;G&&G.length>0&&(k={...k,filters:{...k.filters??{},sample_ids:G}})}ze(k)});const Ge=_(()=>Yt(T())),Qe=_(()=>t(Ge).samples),g=_(()=>a()&&a().data?a().data.pages.flatMap(i=>i.data):[]);let O=U(null),ve=U(!1),z=U(vt(J())),ne=U(0);const{initialize:De,savePosition:Ke,getRestoredPosition:Ye}=Ft("samples_scroll");ye(async()=>{De(),await Ee(s.dataset_id),B(ve,!0)});const ge=_(()=>{var n;return[d().join(","),Array.from(u()).join(","),`${H().min_width}-${H().max_width}`,`${H().min_height}-${H().max_height}`,JSON.stringify(S()),((n=V())==null?void 0:n.queryText)||"",t(W)?"classifier":"normal",t(W)&&o()?`pos:${o().positiveSampleIds.length},neg:${o().negativeSampleIds.length}`:""].filter(Boolean).join("|")}),Ue=_(()=>Ye(t(ge)));function Je(i){const n=i.target.scrollTop;Ke(n,t(ge))}ie(()=>{B(z,J(),!0)}),ie(()=>{var i;a().isSuccess&&((i=a().data)==null?void 0:i.pages.length)>0&&qe(a().data.pages[0].total_count)}),ie(()=>{if(!t(O))return;B(ne,t(O).clientHeight,!0);const i=new ResizeObserver(()=>{t(O)&&B(ne,t(O).clientHeight,!0)});return i.observe(t(O)),()=>{i.disconnect()}});function Xe(){a().hasNextPage&&!a().isFetchingNextPage&&a().fetchNextPage()}const _e=16,Ze=St(),[$e,ns]=Ze;var he=Y(),et=q(he);{var tt=i=>{var n=Ut();l(i,n)},st=i=>{var n=Y(),k=q(n);{var X=L=>{var Z=Jt();l(L,Z)},G=L=>{var Z=Y(),it=q(Z);{var at=N=>{var E=Xt(),$=b(E),ee=K(b($),2),le=b(ee);{var P=I=>{var R=pe("No samples available for this classifier.");l(I,R)},w=I=>{var R=pe("This dataset doesn't contain any samples.");l(I,R)};j(le,I=>{t(W)?I(P):I(w,!1)})}h(ee),h($),h(E),l(N,E)},nt=N=>{var E=Y(),$=q(E);{var ee=P=>{var w=is(),I=b(w);{const R=(re,x)=>{let m=()=>x==null?void 0:x().index,oe=()=>x==null?void 0:x().style;var te=Y(),A=q(te);{var M=Q=>{var se=es(),de=b(se),dt=b(de);{let F=_(()=>Ce().has(t(g)[m()].sample_id));kt(dt,{onSelect:()=>Ne(t(g)[m()].sample_id),get isSelected(){return t(F)}})}h(de);var mt=K(de,2);{var ct=F=>{var y=Zt(),D=b(y);xe(D,{get sample(){return t(g)[m()]},get objectFit(){return t(z)}});var me=K(D,2);be(me,{get sample(){return t(g)[m()]},get containerWidth(){return s.sampleWidth},get sampleImageObjectFit(){return t(z)},get containerHeight(){return s.sampleHeight}}),h(y),ae(ut=>{C(y,"href",ut),C(y,"data-sample-name",t(g)[m()].file_name)},[()=>$e(qt.toSample({sampleId:t(g)[m()].sample_id,datasetId:s.dataset_id,sampleIndex:m()}),void 0)]),l(F,y)},ft=F=>{var y=$t(),D=b(y);xe(D,{get sample(){return t(g)[m()]},get objectFit(){return t(z)}});var me=K(D,2);be(me,{get sample(){return t(g)[m()]},get containerWidth(){return s.sampleWidth},get sampleImageObjectFit(){return t(z)},get containerHeight(){return s.sampleHeight}}),h(y),l(F,y)};j(mt,F=>{t(W)?F(ft,!1):F(ct)})}h(se),ae(()=>Ie(se,oe())),l(Q,se)};j(A,Q=>{t(g)[m()]&&Q(M)})}l(re,te)},lt=re=>{var x=ss(),m=q(x);bt(m,()=>t(g).length,A=>{{let M=_(()=>!a().hasNextPage||a().isFetchingNextPage);Ot(A,{onIntersect:Xe,get disabled(){return t(M)}})}});var oe=K(m,2);{var te=A=>{var M=ts(),Q=b(M);Rt(Q,{}),h(M),l(A,M)};j(oe,A=>{a().isFetchingNextPage&&A(te)})}l(re,x)};let rt=_(()=>s.sampleHeight+_e),ot=_(()=>s.sampleWidth+_e);Ht(I,{get itemCount(){return t(g).length},get itemHeight(){return t(rt)},get itemWidth(){return t(ot)},get height(){return t(ne)},get scrollPosition(){return t(Ue)},onscroll:Je,class:"overflow-none overflow-y-auto dark:[color-scheme:dark]",get style(){return`--sample-width: ${s.sampleWidth??""}px; --sample-height: ${s.sampleHeight??""}px;`},overScan:100,item:R,footer:lt,$$slots:{item:!0,footer:!0}})}h(w),xt(w,R=>B(O,R),()=>t(O)),l(P,w)},le=P=>{var w=as();l(P,w)};j($,P=>{t(ve)?P(ee):P(le,!1)},!0)}l(N,E)};j(it,N=>{a().isSuccess&&t(g).length===0?N(at):N(nt,!1)},!0)}l(L,Z)};j(k,L=>{a().isError?L(X):L(G,!1)},!0)}l(i,n)};j(et,i=>{a().isPending?i(tt):i(st,!1)})}l(e,he),fe(),He()}export{ws as S};
