import"./CWj6FrbW.js";import{p as rt,g as e,ak as Q,u as ht,c as F,s as H,r as I,Y as X,t as G,b as R,a as nt,aM as dt,f as gt,aa as ft,aQ as mt}from"./Frwd2CjB.js";import{b as p,a as U}from"./CiaNZCBa.js";import{i as W,a as bt,s as yt}from"./-DXuGN29.js";import{s as l}from"./D_ynJAfY.js";import{p as C,b as lt}from"./Dafy4oEQ.js";import{J as it,K as xt,M as wt,o as vt,N as _t,w as $,O as Mt}from"./Cqo0Vpvt.js";import"./qIv1kPyv.js";import"./Bqz7dyEC.js";import"./D5w4xp5l.js";import"./DSxvnAMh.js";import"./69_IOA4Y.js";import{o as zt}from"./DQ8aZ1o-.js";import"./DzX_yyqb.js";import{s as J}from"./H60ATh8g.js";function tt(a,t,o=!1){const f={...a};if(o)return f.x=Math.round(Math.max(t.x,Math.min(f.x,t.x+t.width-f.width))),f.y=Math.round(Math.max(t.y,Math.min(f.y,t.y+t.height-f.height))),f;{const z=a.x,i=a.y,b=a.x+a.width,d=a.y+a.height,n=Math.max(t.x,z),u=Math.max(t.y,i),x=Math.min(t.x+t.width,b),s=Math.min(t.y+t.height,d),w={x:Math.round(n),y:Math.round(u),width:Math.round(x-n),height:Math.round(s-u)};return w.width=Math.max(1,w.width),w.height=Math.max(1,w.height),w}}function j(a){return typeof a=="string"?new it([[document.querySelector(a)]],[document.documentElement]):new it([[a]],xt)}function St(a){let t;for(;t=a.sourceEvent;)a=t;return a}function st(a,t){if(a=St(a),t===void 0&&(t=a.currentTarget),t){var o=t.ownerSVGElement||t;if(o.createSVGPoint){var c=o.createSVGPoint();return c.x=a.clientX,c.y=a.clientY,c=c.matrixTransform(t.getScreenCTM().inverse()),[c.x,c.y]}if(t.getBoundingClientRect){var f=t.getBoundingClientRect();return[a.clientX-f.left-t.clientLeft,a.clientY-f.top-t.clientTop]}}return[a.pageX,a.pageY]}const kt={passive:!1},V={capture:!0,passive:!1};function et(a){a.stopImmediatePropagation()}function Y(a){a.preventDefault(),a.stopImmediatePropagation()}function Et(a){var t=a.document.documentElement,o=j(a).on("dragstart.drag",Y,V);"onselectstart"in t?o.on("selectstart.drag",Y,V):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Dt(a,t){var o=a.document.documentElement,c=j(a).on("dragstart.drag",null);t&&(c.on("click.drag",Y,V),setTimeout(function(){c.on("click.drag",null)},0)),"onselectstart"in o?c.on("selectstart.drag",null):(o.style.MozUserSelect=o.__noselect,delete o.__noselect)}const K=a=>()=>a;function at(a,{sourceEvent:t,subject:o,target:c,identifier:f,active:z,x:i,y:b,dx:d,dy:n,dispatch:u}){Object.defineProperties(this,{type:{value:a,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:o,enumerable:!0,configurable:!0},target:{value:c,enumerable:!0,configurable:!0},identifier:{value:f,enumerable:!0,configurable:!0},active:{value:z,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:b,enumerable:!0,configurable:!0},dx:{value:d,enumerable:!0,configurable:!0},dy:{value:n,enumerable:!0,configurable:!0},_:{value:u}})}at.prototype.on=function(){var a=this._.on.apply(this._,arguments);return a===this._?this:a};function Rt(a){return!a.ctrlKey&&!a.button}function Nt(){return this.parentNode}function Tt(a,t){return t??{x:a.x,y:a.y}}function Ct(){return navigator.maxTouchPoints||"ontouchstart"in this}function ct(){var a=Rt,t=Nt,o=Tt,c=Ct,f={},z=wt("start","drag","end"),i=0,b,d,n,u,x=0;function s(r){r.on("mousedown.drag",w).filter(c).on("touchstart.drag",k).on("touchmove.drag",N,kt).on("touchend.drag touchcancel.drag",D).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function w(r,m){if(!(u||!a.call(this,r,m))){var M=P(this,t.call(this,r,m),r,m,"mouse");M&&(j(r.view).on("mousemove.drag",_,V).on("mouseup.drag",T,V),Et(r.view),et(r),n=!1,b=r.clientX,d=r.clientY,M("start",r))}}function _(r){if(Y(r),!n){var m=r.clientX-b,M=r.clientY-d;n=m*m+M*M>x}f.mouse("drag",r)}function T(r){j(r.view).on("mousemove.drag mouseup.drag",null),Dt(r.view,n),Y(r),f.mouse("end",r)}function k(r,m){if(a.call(this,r,m)){var M=r.changedTouches,g=t.call(this,r,m),h=M.length,v,L;for(v=0;v<h;++v)(L=P(this,g,r,m,M[v].identifier,M[v]))&&(et(r),L("start",r,M[v]))}}function N(r){var m=r.changedTouches,M=m.length,g,h;for(g=0;g<M;++g)(h=f[m[g].identifier])&&(Y(r),h("drag",r,m[g]))}function D(r){var m=r.changedTouches,M=m.length,g,h;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),g=0;g<M;++g)(h=f[m[g].identifier])&&(et(r),h("end",r,m[g]))}function P(r,m,M,g,h,v){var L=z.copy(),S=st(v||M,m),E,Z,A;if((A=o.call(r,new at("beforestart",{sourceEvent:M,target:s,identifier:h,active:i,x:S[0],y:S[1],dx:0,dy:0,dispatch:L}),g))!=null)return E=A.x-S[0]||0,Z=A.y-S[1]||0,function y(O,q,ut){var ot=S,B;switch(O){case"start":f[h]=y,B=i++;break;case"end":delete f[h],--i;case"drag":S=st(ut||q,m),B=i;break}L.call(O,r,new at(O,{sourceEvent:q,subject:A,target:s,identifier:h,active:B,x:S[0]+E,y:S[1]+Z,dx:S[0]-ot[0],dy:S[1]-ot[1],dispatch:L}),g)}}return s.filter=function(r){return arguments.length?(a=typeof r=="function"?r:K(!!r),s):a},s.container=function(r){return arguments.length?(t=typeof r=="function"?r:K(r),s):t},s.subject=function(r){return arguments.length?(o=typeof r=="function"?r:K(r),s):o},s.touchable=function(r){return arguments.length?(c=typeof r=="function"?r:K(!!r),s):c},s.on=function(){var r=z.on.apply(z,arguments);return r===z?s:r},s.clickDistance=function(r){return arguments.length?(x=(r=+r)*r,s):Math.sqrt(x)},s}function Lt({handle:a,getCurrentBbox:t,onResize:o,onDragEnd:c,onInteractionStart:f,onInteractionEnd:z}){let i;return ct().on("start",()=>{i=t(),f==null||f()}).on("drag",b=>{let d=i.x,n=i.y,u=i.width,x=i.height;const s=b.x-b.subject.x,w=b.y-b.subject.y;switch(a){case"nw":d=i.x+s,n=i.y+w,u=i.width-s,x=i.height-w;break;case"ne":n=i.y+w,u=i.width+s,x=i.height-w;break;case"sw":d=i.x+s,u=i.width-s,x=i.height+w;break;case"se":u=i.width+s,x=i.height+w;break;case"n":n=i.y+w,x=i.height-w;break;case"s":x=i.height+w;break;case"w":d=i.x+s,u=i.width-s;break;case"e":u=i.width+s;break}const _=1;u<_&&(u=_,a.includes("w")&&(d=i.x+i.width-_)),x<_&&(x=_,a.includes("n")&&(n=i.y+i.height-_));const T=Math.round(d),k=Math.round(n),N=Math.round(u),D=Math.round(x);o&&o({x:T,y:k,width:N,height:D})}).on("end",()=>{const{x:b,y:d,width:n,height:u}=t();c&&c({x:b,y:d,width:n,height:u}),z==null||z()})}function Ot({getCurrentBbox:a,onMove:t,onDragEnd:o,onInteractionStart:c,onInteractionEnd:f}){let z;return ct().on("start",()=>{z=a(),c==null||c()}).on("drag",i=>{const b=i.x-i.subject.x,d=i.y-i.subject.y,n=Math.round(z.x+b),u=Math.round(z.y+d);t&&t({x:n,y:u,width:z.width,height:z.height})}).on("end",()=>{const i=a();o&&o(i),f==null||f()})}var Xt=p('<text dominant-baseline="middle" text-anchor="end"> </text><text text-anchor="middle"> </text><text dominant-baseline="middle" text-anchor="end"> </text>',1),At=p('<g><rect stroke-width="2" pointer-events="all" vector-effect="non-scaling-stroke" class="movable-rectangle" style="cursor: move;"></rect><!></g>');function Ft(a,t){rt(t,!0);const o=C(t,"bbox",15),c=C(t,"colorStroke",3,"#007bff"),f=C(t,"colorFill",3,"transparent"),z=C(t,"opacity",3,.3),i=C(t,"handleSize",3,12),b=C(t,"scale",3,1),d=R(()=>o().x),n=R(()=>o().y),u=R(()=>o().width),x=R(()=>o().height);let s=Q(void 0),w=Q(!1);function _(){if(!e(s))return;const m=i()/b(),h=Math.max(3,Math.min(m,e(u)*.1,e(x)*.1,7)),v=[{id:"nw",x:e(d)-h/2,y:e(n)-h/2,cursor:"nwse-resize",label:"Resize northwest corner"},{id:"ne",x:e(d)+e(u)-h/2,y:e(n)-h/2,cursor:"nesw-resize",label:"Resize northeast corner"},{id:"sw",x:e(d)-h/2,y:e(n)+e(x)-h/2,cursor:"nesw-resize",label:"Resize southwest corner"},{id:"se",x:e(d)+e(u)-h/2,y:e(n)+e(x)-h/2,cursor:"nwse-resize",label:"Resize southeast corner"},{id:"n",x:e(d)+e(u)/2-h/2,y:e(n)-h/2,cursor:"ns-resize",label:"Resize top edge"},{id:"s",x:e(d)+e(u)/2-h/2,y:e(n)+e(x)-h/2,cursor:"ns-resize",label:"Resize bottom edge"},{id:"w",x:e(d)-h/2,y:e(n)+e(x)/2-h/2,cursor:"ew-resize",label:"Resize left edge"},{id:"e",x:e(d)+e(u)-h/2,y:e(n)+e(x)/2-h/2,cursor:"ew-resize",label:"Resize right edge"}],S=j(e(s)).selectAll(".resize-handle").data(v,E=>E.id);S.enter().append("rect").attr("class","resize-handle").attr("width",h).attr("height",h).attr("fill",c()).attr("stroke",c()).attr("stroke-width","1").attr("vector-effect","non-scaling-stroke").attr("role","button").attr("style",E=>`cursor: ${E.cursor};`).attr("data-testid",E=>`resize-handle-${E.id}`).attr("aria-label",E=>E.label).merge(S).attr("x",E=>E.x).attr("y",E=>E.y).attr("width",h).attr("height",h).attr("fill",c()).attr("stroke",c()),S.exit().remove()}function T(){if(!e(s))return;["nw","ne","sw","se","n","s","w","e"].forEach(g=>{if(!e(s))return;const h=e(s).querySelector(`[data-testid="resize-handle-${g}"]`);h&&j(h).call(Lt({handle:g,getCurrentBbox:()=>({x:e(d),y:e(n),width:e(u),height:e(x)}),onResize:v=>{o(o().x=v.x,!0),o(o().y=v.y,!0),o(o().width=v.width,!0),o(o().height=v.height,!0),t.onResize&&t.onResize(v),_()},onDragEnd:v=>{t.onDragEnd&&t.onDragEnd(v)},onInteractionStart:()=>{X(w,!0)},onInteractionEnd:()=>{X(w,!1)}}))});const M=e(s).querySelector(".movable-rectangle");M&&j(M).call(Ot({getCurrentBbox:()=>({x:e(d),y:e(n),width:e(u),height:e(x)}),onMove:g=>{o(o().x=g.x,!0),o(o().y=g.y,!0),o(o().width=g.width,!0),o(o().height=g.height,!0),t.onMove&&t.onMove(g),_()},onDragEnd:g=>{t.onDragEnd&&t.onDragEnd(g)},onInteractionStart:()=>{X(w,!0)},onInteractionEnd:()=>{X(w,!1)}}))}zt(()=>{e(s)&&(_(),T())});const k=async()=>{e(s)&&(await dt(),_(),T())};ht(()=>{_(),k()});var N=At(),D=F(N),P=H(D);{var r=m=>{var M=Xt(),g=gt(M),h=F(g);I(g);var v=H(g),L=F(v);I(v);var S=H(v),E=F(S);I(S),G(()=>{l(g,"x",e(d)-10/b()),l(g,"y",e(n)+1/b()),l(g,"fill",c()),l(g,"font-size",14/b()),J(h,`x: ${e(d)??""}, y: ${e(n)??""}`),l(v,"x",e(d)+e(u)/2),l(v,"y",e(n)+e(x)+20/b()),l(v,"fill",c()),l(v,"font-size",14/b()),J(L,`w: ${e(u)??""}px`),l(S,"x",e(d)-10/b()),l(S,"y",e(n)+e(x)/2),l(S,"fill",c()),l(S,"font-size",14/b()),J(E,`h: ${e(x)??""}px`)}),U(m,M)};W(P,m=>{e(w)&&m(r)})}I(N),lt(N,m=>X(s,m),()=>e(s)),G(()=>{l(D,"x",e(d)),l(D,"y",e(n)),l(D,"width",e(u)),l(D,"height",e(x)),l(D,"stroke",c()),l(D,"fill",f()),l(D,"fill-opacity",z())}),U(a,N),nt()}var It=p('<g data-testid="sample-annotation"><!><!><!></g>');function re(a,t){var Z,A;rt(t,!0);const o=()=>yt(d,"$customLabelColorsStore",c),[c,f]=bt(),z=C(t,"showLabel",3,!1),i=C(t,"isResizable",3,!1),b=C(t,"scale",3,1),{customLabelColorsStore:d}=Mt(),n=R(()=>t.annotation.annotation_label.annotation_label_name),u=(A=(Z=t.annotation)==null?void 0:Z.instance_segmentation_details)==null?void 0:A.segmentation_mask,x=R(()=>t.annotation.annotation_id),s=R(()=>$(e(n),1)),w=R(()=>{var y;return((y=o()[e(n)])==null?void 0:y.color)??$(e(n),1).color}),_=R(()=>{var y;return((y=o()[e(n)])==null?void 0:y.color)??$(e(n),.4).color}),T=R(()=>{var y;return((y=o()[e(n)])==null?void 0:y.alpha)*.4});let k=Q(ft(vt(t.annotation)));const N=y=>{X(k,t.constraintBox?tt(y,t.constraintBox,!1):y,!0)},D=y=>{X(k,t.constraintBox?tt(y,t.constraintBox,!0):y,!0)},P=y=>{var q;const O=t.constraintBox?tt(y,t.constraintBox,!0):y;X(k,O,!0),(q=t.onBoundingBoxChanged)==null||q.call(t,O)},r=R(()=>[e(k).x,e(k).y,e(k).width,e(k).height]);var m=It(),M=F(m);{var g=y=>{{let O=R(()=>[e(k).x,e(k).y]);Yt(y,{get coordinates(){return e(O)},get colorText(){return e(s)},get label(){return e(n)}})}};W(M,y=>{z()&&y(g)})}var h=H(M);{var v=y=>{_t(y,{get segmentation(){return u},get width(){return t.imageWidth},get colorFill(){return e(_)},get opacity(){return e(T)}})};W(h,y=>{u&&y(v)})}var L=H(h);{var S=y=>{Ft(y,{get colorStroke(){return e(w)},get colorFill(){return e(_)},get opacity(){return e(T)},get scale(){return b()},onResize:N,onMove:D,onDragEnd:P,get bbox(){return e(k)},set bbox(O){X(k,O,!0)}})},E=y=>{Pt(y,{get bbox(){return e(r)},get annotationId(){return e(x)},get label(){return e(n)},get colorStroke(){return e(w)},get colorFill(){return e(_)},get opacity(){return e(T)}})};W(L,y=>{i()&&t.constraintBox?y(S):y(E,!1)})}I(m),G(()=>{l(m,"data-annotation-label",e(n)),l(m,"data-annotation-id",e(x))}),U(a,m),nt(),f()}var jt=p('<rect vector-effect="non-scaling-stroke" stroke-width="2" pointer-events="all" data-testid="annotation_box"></rect>');function Pt(a,t){const o=C(t,"isPrediction",3,!1),[c,f,z,i]=t.bbox,b=o()?"5,5":"none",d=o()?.8:1;var n=jt();G(()=>{l(n,"x",c),l(n,"y",f),l(n,"width",z),l(n,"height",i),l(n,"stroke",t.colorStroke),l(n,"stroke-opacity",d),l(n,"stroke-dasharray",b),l(n,"fill",t.colorFill),l(n,"fill-opacity",t.opacity),l(n,"aria-label",t.label)}),U(a,n)}var Ht=p('<g class="unscaled"><rect></rect><text class="annotation-label-text" data-testid="svg-annotation-text"> </text></g>');function Yt(a,t){rt(t,!0);const o=C(t,"fontSize",3,14),c=C(t,"isPrediction",3,!1),f=R(()=>mt(t.coordinates,2)),z=R(()=>e(f)[0]),i=R(()=>e(f)[1]);let b=Q(null);const d=R(()=>e(b)?(e(b).textContent=c()?`${t.label} (pred)`:t.label,e(b).getBBox()):{width:0,height:0}),n=5,u=c()?.8:1,x=c()?"italic":"normal";var s=Ht(),w=F(s),_=H(w);l(_,"x",n),l(_,"y",-5);var T=F(_,!0);I(_),lt(_,k=>X(b,k),()=>e(b)),I(s),G(()=>{var k,N,D;l(s,"transform",`translate(${e(z)}, ${e(i)})`),l(s,"data-label",t.label),l(w,"y",-((k=e(d))==null?void 0:k.height)),l(w,"width",((N=e(d))==null?void 0:N.width)+n*2),l(w,"height",(D=e(d))==null?void 0:D.height),l(w,"fill",t.colorText.color),l(w,"opacity",u),l(_,"fill",t.colorText.contrastColor),l(_,"font-size",o()),l(_,"font-style",x),J(T,c()?`${t.label} (pred)`:t.label)}),U(a,s),nt()}export{Ft as R,re as S,Et as a,ct as d,st as p,j as s,Dt as y};
