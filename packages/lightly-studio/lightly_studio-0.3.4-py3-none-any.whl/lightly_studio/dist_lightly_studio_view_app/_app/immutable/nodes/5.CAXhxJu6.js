import"../chunks/CWj6FrbW.js";import{p as mt,f as _,n as re,a as gt,au as Qt,g as t,b as r,s as h,c as $,r as I,t as ut,m as vt,u as De,Y as s,ak as R,aa as te,$ as ee}from"../chunks/Frwd2CjB.js";import{c as J,a as c,f as Q,t as ae,b as $t}from"../chunks/CiaNZCBa.js";import{s as It}from"../chunks/DzX_yyqb.js";import{i as Y,s as j,a as zt}from"../chunks/-DXuGN29.js";import{p as yt}from"../chunks/DSxvnAMh.js";import{I as le,o as He,p as Fe,q as ze,r as At,f as Ne,s as Xe,_ as Ye,t as Ue,C as Ze,v as Ke,S as Oe,n as je,w as Ge,x as Ve}from"../chunks/Cqo0Vpvt.js";import{u as ie}from"../chunks/qIv1kPyv.js";import{u as de,k as We,t as ct,s as H,e as qe,b as Je}from"../chunks/D_ynJAfY.js";import"../chunks/Bqz7dyEC.js";import"../chunks/D5w4xp5l.js";import"../chunks/69_IOA4Y.js";import{a as Qe,g as ta}from"../chunks/DQ8aZ1o-.js";import{e as ne}from"../chunks/Dug7Bq1S.js";import{s as ce,r as ue,p as ea,b as oe}from"../chunks/Dafy4oEQ.js";import{S as aa}from"../chunks/CZGpyrcA.js";import{r as St}from"../chunks/CfQ4mGwl.js";import{S as na,s as oa,d as sa,R as ra}from"../chunks/DmjAI-UV.js";import{s as se}from"../chunks/H60ATh8g.js";import{B as la,a as ia,b as wt,c as Ht,H as da,d as Ft,D as ca,e as ua,u as me,Z as ma,g as ga}from"../chunks/u-it74zV.js";import{b as ha,d as va,e as fa,r as pa}from"../chunks/DD63uD-T.js";function _a(u,e){mt(e,!0);/**
 * @license @lucide/svelte v0.482.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let m=ue(e,["$$slots","$$events","$$legacy"]);const l=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["circle",{cx:"10",cy:"12",r:"2"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22"}]];le(u,ce({name:"file-image"},()=>m,{get iconNode(){return l},children:(n,i)=>{var d=J(),p=_(d);It(p,()=>e.children??re),c(n,d)},$$slots:{default:!0}})),gt()}function ba(u,e){mt(e,!0);/**
 * @license @lucide/svelte v0.482.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let m=ue(e,["$$slots","$$events","$$legacy"]);const l=[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18"}],["circle",{cx:"12",cy:"8",r:"2"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2"}]];le(u,ce({name:"images"},()=>m,{get iconNode(){return l},children:(n,i)=>{var d=J(),p=_(d);It(p,()=>e.children??re),c(n,d)},$$slots:{default:!0}})),gt()}var xa=Q('<!> <span class="hidden sm:inline">Home</span>',1),wa=Q('<!> <span class="max-w-[150px] truncate"> </span>',1),ya=Q('<!> <span class="hidden sm:inline">Samples</span>',1),Sa=Q('<!> <span class="max-w-[200px] truncate"><!></span>',1),$a=Q("<!> <!> <!> <!> <!> <!> <!>",1);function Ia(u,e){mt(e,!0);const m=()=>j(i,"$samplesTotalCount",l),[l,n]=zt(),{samplesTotalCount:i}=ie();la(u,{class:"mb-2","data-testid":"sample-details-breadcrumb",children:(d,p)=>{ia(d,{children:(tt,ot)=>{var F=$a(),w=_(F);wt(w,{children:(A,G)=>{{let g=r(()=>St.toHome());Ht(A,{get href(){return t(g)},class:"flex items-center gap-2",children:(P,T)=>{var b=xa(),y=_(b);da(y,{class:"h-4 w-4"}),Qt(2),c(P,b)},$$slots:{default:!0}})}},$$slots:{default:!0}});var z=h(w,2);Ft(z,{});var C=h(z,2);wt(C,{children:(A,G)=>{{let g=r(()=>St.toSamples(e.dataset.dataset_id));Ht(A,{get href(){return t(g)},class:"flex items-center gap-2",children:(P,T)=>{var b=wa(),y=_(b);ca(y,{class:"h-4 w-4"});var M=h(y,2),et=$(M,!0);I(M),ut(()=>se(et,e.dataset.name)),c(P,b)},$$slots:{default:!0}})}},$$slots:{default:!0}});var U=h(C,2);Ft(U,{});var N=h(U,2);wt(N,{children:(A,G)=>{{let g=r(()=>St.toSamples(e.dataset.dataset_id));Ht(A,{get href(){return t(g)},class:"flex items-center gap-2",children:(P,T)=>{var b=ya(),y=_(b);ba(y,{class:"h-4 w-4"}),Qt(2),c(P,b)},$$slots:{default:!0}})}},$$slots:{default:!0}});var st=h(N,2);Ft(st,{});var rt=h(st,2);wt(rt,{children:(A,G)=>{ua(A,{class:"flex items-center gap-2",children:(g,P)=>{var T=Sa(),b=_(T);_a(b,{class:"h-4 w-4"});var y=h(b,2),M=$(y);{var et=V=>{var lt=ae();ut(()=>se(lt,`Sample ${e.sampleIndex+1} of ${m()??""}`)),c(V,lt)},Pt=V=>{var lt=ae("Sample");c(V,lt)};Y(M,V=>{e.sampleIndex!==void 0?V(et):V(Pt,!1)})}I(y),c(g,T)},$$slots:{default:!0}})},$$slots:{default:!0}}),c(tt,F)},$$slots:{default:!0}})},$$slots:{default:!0}}),gt(),n()}function Aa(u,e){mt(e,!0);const m=()=>j(t(F),"$annotationResp",i),l=()=>j(t(U),"$sample",i),n=()=>j(tt,"$showAnnotationTextLabelsStore",i),[i,d]=zt(),p=ea(e,"isResizable",3,!1),{showAnnotationTextLabelsStore:tt}=de(),ot=r(()=>ze({datasetId:e.datasetId,annotationId:e.annotationId})),F=r(()=>t(ot).annotation),w=r(()=>t(ot).updateAnnotation);let z=r(()=>m().data);const C=r(()=>me({sampleId:e.sampleId,datasetId:e.datasetId})),U=r(()=>t(C).sample);let N=r(()=>m().data?He(m().data):void 0);const st=g=>{(async()=>{try{await t(w)({annotation_id:e.annotationId,dataset_id:e.datasetId,bounding_box:g})}catch(T){console.error("Failed to update annotation:",T.message)}})()};var rt=J(),A=_(rt);{var G=g=>{var P=J(),T=_(P);We(T,()=>t(N),b=>{Fe(b,{get groupId(){return t(z).annotation_id},get onSelect(){return e.toggleAnnotationSelection},get box(){return t(N)},get isSelected(){return e.isSelected},children:(y,M)=>{{let et=r(()=>({x:0,y:0,width:l().data.width,height:l().data.height}));na(y,{get annotation(){return t(z)},get showLabel(){return n()},get imageWidth(){return l().data.width},get constraintBox(){return t(et)},get isResizable(){return p()},onBoundingBoxChanged:st})}},$$slots:{default:!0}})}),c(g,P)};Y(A,g=>{t(z)&&l().data&&t(N)&&g(G)})}c(u,rt),gt(),d()}const Pa=({datasetId:u})=>{const e=At(ha());return e.subscribe(()=>{}),{createAnnotation:l=>new Promise((n,i)=>{vt(e).mutate({path:{dataset_id:u},body:l},{onSuccess:d=>{n(d)},onError:d=>{i(d)}})})}},Ma=()=>{const u=At(va());return u.subscribe(()=>{}),{createLabel:m=>new Promise((l,n)=>{vt(u).mutate({body:m},{onSuccess:i=>{l(i)},onError:i=>{n(i)}})})}},ka=({datasetId:u})=>{const e=At(fa());return e.subscribe(()=>{}),{deleteAnnotation:l=>new Promise((n,i)=>{vt(e).mutate({path:{dataset_id:u,annotation_id:l}},{onSuccess:()=>{n()},onError:d=>{i(d)}})})}},Ba=({datasetId:u})=>{const e=At(pa());return e.subscribe(()=>{}),{removeTagFromSample:(l,n)=>new Promise((i,d)=>{vt(e).mutate({path:{dataset_id:u,sample_id:l,tag_id:n}},{onSuccess:()=>i(),onError:p=>d(p)})})}};var Ea=$t('<line x1="0" stroke-width="1" vector-effect="non-scaling-stroke" stroke-dasharray="5,5" opacity="0.6"></line><line y1="0" vector-effect="non-scaling-stroke" stroke-width="1" stroke-dasharray="5,5" opacity="0.6"></line>',1),Ra=$t('<rect class="select-none" fill="transparent" role="button" style="outline: 0;cursor: crosshair;" tabindex="0"></rect>'),Ca=$t("<g><!><!><!></g><!>",1),Ta=$t("<image></image><!>",1),La=Q('<div class="h-full w-full overflow-hidden"><div class="sample relative h-full w-full"><div class="absolute right-4 top-2 z-30"><!></div> <!> <!></div></div>'),Da=Q('<div class="flex h-full w-full flex-col space-y-4"><div class="flex w-full items-center"><!></div> <!> <div class="flex min-h-0 flex-1 gap-4"><div class="flex-1"><!></div> <div class="relative w-[375px]"><!></div></div></div>');function Ha(u,e){mt(e,!0);const m=()=>j(T,"$labels",p),l=()=>j(y,"$isEditingMode",p),n=()=>j(t(G),"$sample",p),i=()=>j(ot,"$selectedSampleIds",p),d=()=>j(z,"$isHidden",p),[p,tt]=zt(),{selectedSampleIds:ot,toggleSampleSelection:F}=ie(),w=e.dataset.dataset_id,{isHidden:z,handleKeyEvent:C}=Ne(),{settingsStore:U}=de(),{deleteAnnotation:N}=ka({datasetId:w}),{removeTagFromSample:st}=Ba({datasetId:w}),rt=()=>{ta(St.toSamples(w))},A=r(()=>me({sampleId:e.sampleId,datasetId:w})),G=r(()=>t(A).sample),g=r(()=>t(A).refetch),{createAnnotation:P}=Pa({datasetId:w}),T=Xe(),{createLabel:b}=Ma(),{isEditingMode:y}=yt.data.globalStorage;let M=R(!1);const et=async({x:a,y:o,width:k,height:L,labelName:v})=>{if(!m().data)return;let B=m().data.find(x=>x.annotation_label_name===v);B||(B=await b({annotation_label_name:v}));try{const x=await P({sample_id:e.sampleId,annotation_type:"object_detection",x:Math.round(a),y:Math.round(o),width:Math.round(k),height:Math.round(L),annotation_label_id:B.annotation_label_id});return t(g)(),s(Z,x.annotation_id,!0),ct.success("Annotation created successfully"),x}catch(x){ct.error("Failed to create annotation. Please try again."),console.error("Error creating annotation:",x);return}},Pt=a=>{switch(a.key){case vt(U).key_go_back:rt();break;case" ":a.preventDefault(),a.stopPropagation(),console.log("space pressed in sample details"),l()?s(M,!0):F(e.sampleId);break}C(a)},V=a=>{a.key===" "&&s(M,!1),C(a)};let lt=r(()=>ga(e.sampleId)),Z=R(void 0);Qe(()=>{s(Z,void 0),s(Xt,void 0)});const Nt=a=>{t(M)||(t(Z)===a?s(Z,void 0):s(Z,a,!0))};let Xt=R(void 0),it=R(!1),S=R(null),W=R(null),K=R(null);const ge=()=>{s(it,!1),s(S,null),s(K,null)};let ht=R(!1);const Yt=10,he=()=>{if(!t(W))return;const a=oa(t(W));let o=null;const k=sa().on("start",L=>{if(!t(ht))return;s(it,!0);const v=t(W).getBoundingClientRect(),B=L.sourceEvent.clientX,x=L.sourceEvent.clientY,D=(B-v.left)/v.width*n().data.width,E=(x-v.top)/v.height*n().data.height;o={x:D,y:E},s(S,{x:D,y:E,width:0,height:0},!0),s(K,{x:D,y:E},!0)}).on("drag",L=>{if(!t(S)||!t(it)||!o)return;const v=t(W).getBoundingClientRect(),B=L.sourceEvent.clientX,x=L.sourceEvent.clientY;let D=(B-v.left)/v.width*n().data.width,E=(x-v.top)/v.height*n().data.height;const Bt=n().data.width,Et=n().data.height;D=Math.max(0,Math.min(D,Bt)),E=Math.max(0,Math.min(E,Et));const nt=Math.min(o.x,D),dt=Math.min(o.y,E),Rt=Math.abs(D-o.x),Ot=Math.abs(E-o.y);s(S,{x:nt,y:dt,width:Rt,height:Ot},!0),s(K,{x:D,y:E},!0)}).on("end",()=>{!t(S)||!t(it)||(t(S).width>Yt&&t(S).height>Yt&&t(at)&&et({x:t(S).x,y:t(S).y,width:t(S).width,height:t(S).height,labelName:t(at).label}),ge(),o=null)});return a.call(k),a.on("mousemove",fe),()=>{k.on("start",null).on("drag",null).on("end",null)}},ve=a=>{if(!t(W)||t(it))return;const o=t(W).getBoundingClientRect(),k=a.clientX,L=a.clientY,v=(k-o.left)/o.width*n().data.width,B=(L-o.top)/o.height*n().data.height;s(K,{x:v,y:B},!0),a.stopPropagation(),a.preventDefault()},fe=Ye.throttle(ve,50);De(()=>{he(),t(G).subscribe(a=>{if(a.isSuccess&&a.data){let o=Ue(a.data);s(Mt,o,!0)}else s(Mt,[],!0)})});let at=R(void 0),Mt=R(te([])),ft=R(te(new Set));const pe=a=>{const o=new Set(t(ft));o.has(a)?o.delete(a):o.add(a),s(ft,o,!0)},_e=r(()=>t(Mt).filter(a=>!t(ft).has(a.annotation_id))),kt=r(()=>t(at)?Ge(t(at).label,1).color:"blue"),be=async a=>{if(!n().data)return;(async()=>{try{await N(a),ct.success("Annotation deleted successfully"),t(g)(),t(Z)===a&&s(Z,void 0)}catch(k){ct.error("Failed to delete annotation. Please try again."),console.error("Error deleting annotation:",k)}})()},xe=async a=>{try{await st(e.sampleId,a),ct.success("Tag removed successfully"),t(g)()}catch(o){ct.error("Failed to remove tag. Please try again."),console.error("Error removing tag from sample:",o)}},we=r(()=>t(M)?"grab":t(ht)?"crosshair":"auto"),ye=r(()=>l()&&!t(M)),Ut=r(()=>t(ht)&&!t(M));let Zt=R(null);var Kt=J();ne("keydown",ee,Pt),ne("keyup",ee,V);var Se=_(Kt);{var $e=a=>{var o=Da(),k=$(o),L=$(k);Ia(L,{get dataset(){return e.dataset},get sampleIndex(){return e.sampleIndex}}),I(k);var v=h(k,2);aa(v,{class:"mb-4 bg-border-hard"});var B=h(v,2),x=$(B),D=$(x);Ze(D,{className:"h-full",children:(nt,dt)=>{Ke(nt,{className:"h-full",children:(Rt,Ot)=>{var Ct=La(),Tt=$(Ct),Lt=$(Tt),Ae=$(Lt);{let q=r(()=>i().has(e.sampleId));Oe(Ae,{onSelect:()=>F(e.sampleId),get isSelected(){return t(q)}})}I(Lt);var jt=h(Lt,2);{var Pe=q=>{var pt=J(),_t=_(pt);It(_t,()=>e.children),c(q,pt)};Y(jt,q=>{e.children&&q(Pe)})}var Me=h(jt,2);ma(Me,{get width(){return n().data.width},get height(){return n().data.height},get cursor(){return t(we)},get boundingBox(){return t(Xt)},zoomableContent:pt=>{var _t=Ta(),Gt=_(_t),ke=h(Gt);{var Be=Dt=>{var Vt=Ca(),bt=_(Vt);let Wt;var qt=$(bt);qe(qt,17,()=>t(_e),f=>f.annotation_id,(f,X)=>{{let O=r(()=>t(Z)===t(X).annotation_id);Aa(f,{get annotationId(){return t(X).annotation_id},get sampleId(){return e.sampleId},get datasetId(){return w},get isResizable(){return t(ye)},get isSelected(){return t(O)},toggleAnnotationSelection:Nt})}});var Jt=h(qt);{var Ee=f=>{ra(f,{get bbox(){return t(S)},get colorStroke(){return t(kt)},colorFill:"rgba(0, 123, 255, 0.1)",style:"outline: 0;",opacity:.8,scale:1})};Y(Jt,f=>{t(S)&&t(it)&&t(at)&&f(Ee)})}var Re=h(Jt);{var Ce=f=>{var X=Ea(),O=_(X),xt=h(O);ut(()=>{H(O,"y1",t(K).y),H(O,"x2",n().data.width),H(O,"y2",t(K).y),H(O,"stroke",t(kt)),H(xt,"x1",t(K).x),H(xt,"x2",t(K).x),H(xt,"y2",n().data.height),H(xt,"stroke",t(kt))}),c(f,X)};Y(Re,f=>{t(K)&&t(Ut)&&f(Ce)})}I(bt);var Te=h(bt);{var Le=f=>{var X=Ra();oe(X,O=>s(W,O),()=>t(W)),ut(()=>{H(X,"width",n().data.width),H(X,"height",n().data.height)}),c(f,X)};Y(Te,f=>{t(Ut)&&f(Le)})}ut(f=>Wt=Je(bt,0,"",null,Wt,f),[()=>({invisible:d()})]),c(Dt,Vt)};Y(ke,Dt=>{n().data&&Dt(Be)})}ut(()=>H(Gt,"href",t(lt))),c(pt,_t)},$$slots:{zoomableContent:!0}}),I(Tt),oe(Tt,q=>s(Zt,q),()=>t(Zt)),I(Ct),c(Rt,Ct)},$$slots:{default:!0}})},$$slots:{default:!0}}),I(x);var E=h(x,2),Bt=$(E);{var Et=nt=>{Ve(nt,{get sample(){return n().data},get annotationsIdsToHide(){return t(ft)},get selectedAnnotationId(){return t(Z)},onAnnotationClick:Nt,onToggleShowAnnotation:pe,onDeleteAnnotation:be,onRemoveTag:xe,get onUpdate(){return t(g)},get addAnnotationEnabled(){return t(ht)},set addAnnotationEnabled(dt){s(ht,dt,!0)},get addAnnotationLabel(){return t(at)},set addAnnotationLabel(dt){s(at,dt,!0)}})};Y(Bt,nt=>{n().data&&nt(Et)})}I(E),I(B),I(o),c(a,o)},Ie=a=>{je(a,{})};Y(Se,a=>{n().data?a($e):a(Ie,!1)})}c(u,Kt),gt(),tt()}var Fa=Q('<div class="flex h-full w-full space-x-4 px-4 pb-4" data-testid="sample-details"><div class="h-full w-full space-y-6 rounded-[1vw] bg-card p-4"><!></div></div>');function rn(u,e){mt(e,!0);const m=r(()=>yt.params.sampleId),l=yt.data.dataset,n=r(()=>Number(yt.params.sampleIndex));var i=Fa(),d=$(i),p=$(d);Ha(p,{get sampleId(){return t(m)},get dataset(){return l},get sampleIndex(){return t(n)},children:(tt,ot)=>{var F=J(),w=_(F);{var z=C=>{var U=J(),N=_(U);It(N,()=>e.children),c(C,U)};Y(w,C=>{e.children&&C(z)})}c(tt,F)},$$slots:{default:!0}}),I(d),I(i),c(u,i),gt()}export{rn as component};
