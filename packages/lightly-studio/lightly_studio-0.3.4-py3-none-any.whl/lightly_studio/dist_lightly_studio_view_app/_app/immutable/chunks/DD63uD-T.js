var lt=e=>{throw TypeError(e)};var H=(e,t,s)=>t.has(e)||lt("Cannot "+s);var a=(e,t,s)=>(H(e,t,"read from private field"),s?s.call(e):t.get(e)),y=(e,t,s)=>t.has(e)?lt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),d=(e,t,s,n)=>(H(e,t,"write to private field"),n?n.call(e,s):t.set(e,s),s),f=(e,t,s)=>(H(e,t,"access private method"),s);import{c as It,d as St,g as Ct,e as Et,f as Qt,h as Ft,i as At,j as Mt,k as Tt,u as xt,l as Ut,m as Dt,n as Lt}from"./D5w4xp5l.js";import{aN as qt,o as G,m as nt,w as Kt}from"./Frwd2CjB.js";import{u as rt}from"./qIv1kPyv.js";import{S as Bt,p as ft,r as R,s as J,a as V,n as jt,i as yt,b as mt,t as kt,f as Pt,c as _t,d as bt,e as wt,g as Vt,h as zt}from"./H4l0JFh9.js";var O,r,k,p,A,L,C,w,P,q,K,M,T,E,B,i,j,X,Y,Z,$,tt,et,st,Rt,vt,Nt=(vt=class extends Bt{constructor(t,s){super();y(this,i);y(this,O);y(this,r);y(this,k);y(this,p);y(this,A);y(this,L);y(this,C);y(this,w);y(this,P);y(this,q);y(this,K);y(this,M);y(this,T);y(this,E);y(this,B,new Set);this.options=s,d(this,O,t),d(this,w,null),d(this,C,ft()),this.options.experimental_prefetchInRender||a(this,C).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(a(this,r).addObserver(this),pt(a(this,r),this.options)?f(this,i,j).call(this):this.updateResult(),f(this,i,$).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return at(a(this,r),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return at(a(this,r),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,f(this,i,tt).call(this),f(this,i,et).call(this),a(this,r).removeObserver(this)}setOptions(t,s){const n=this.options,o=a(this,r);if(this.options=a(this,O).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof R(this.options.enabled,a(this,r))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");f(this,i,st).call(this),a(this,r).setOptions(this.options),n._defaulted&&!J(this.options,n)&&a(this,O).getQueryCache().notify({type:"observerOptionsUpdated",query:a(this,r),observer:this});const h=this.hasListeners();h&&Ot(a(this,r),o,this.options,n)&&f(this,i,j).call(this),this.updateResult(s),h&&(a(this,r)!==o||R(this.options.enabled,a(this,r))!==R(n.enabled,a(this,r))||V(this.options.staleTime,a(this,r))!==V(n.staleTime,a(this,r)))&&f(this,i,X).call(this);const l=f(this,i,Y).call(this);h&&(a(this,r)!==o||R(this.options.enabled,a(this,r))!==R(n.enabled,a(this,r))||l!==a(this,E))&&f(this,i,Z).call(this,l)}getOptimisticResult(t){const s=a(this,O).getQueryCache().build(a(this,O),t),n=this.createResult(s,t);return Ht(this,n)&&(d(this,p,n),d(this,L,this.options),d(this,A,a(this,r).state)),n}getCurrentResult(){return a(this,p)}trackResult(t,s){const n={};return Object.keys(t).forEach(o=>{Object.defineProperty(n,o,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(o),s==null||s(o),t[o])})}),n}trackProp(t){a(this,B).add(t)}getCurrentQuery(){return a(this,r)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const s=a(this,O).defaultQueryOptions(t),n=a(this,O).getQueryCache().build(a(this,O),s);return n.fetch().then(()=>this.createResult(n,s))}fetch(t){return f(this,i,j).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),a(this,p)))}createResult(t,s){var dt;const n=a(this,r),o=this.options,h=a(this,p),l=a(this,A),m=a(this,L),I=t!==n?t.state:a(this,k),{state:u}=t;let c={...u},Q=!1,g;if(s._optimisticResults){const b=this.hasListeners(),U=!b&&pt(t,s),D=b&&Ot(t,n,s,o);(U||D)&&(c={...c,..._t(u.data,t.options)}),s._optimisticResults==="isRestoring"&&(c.fetchStatus="idle")}let{error:ot,errorUpdatedAt:ut,status:F}=c;if(s.select&&c.data!==void 0)if(h&&c.data===(l==null?void 0:l.data)&&s.select===a(this,P))g=a(this,q);else try{d(this,P,s.select),g=s.select(c.data),g=bt(h==null?void 0:h.data,g,s),d(this,q,g),d(this,w,null)}catch(b){d(this,w,b)}else g=c.data;if(s.placeholderData!==void 0&&g===void 0&&F==="pending"){let b;if(h!=null&&h.isPlaceholderData&&s.placeholderData===(m==null?void 0:m.placeholderData))b=h.data;else if(b=typeof s.placeholderData=="function"?s.placeholderData((dt=a(this,K))==null?void 0:dt.state.data,a(this,K)):s.placeholderData,s.select&&b!==void 0)try{b=s.select(b),d(this,w,null)}catch(U){d(this,w,U)}b!==void 0&&(F="success",g=bt(h==null?void 0:h.data,b,s),Q=!0)}a(this,w)&&(ot=a(this,w),g=a(this,q),ut=Date.now(),F="error");const z=c.fetchStatus==="fetching",N=F==="pending",W=F==="error",ct=N&&z,ht=g!==void 0,v={status:F,fetchStatus:c.fetchStatus,isPending:N,isSuccess:F==="success",isError:W,isInitialLoading:ct,isLoading:ct,data:g,dataUpdatedAt:c.dataUpdatedAt,error:ot,errorUpdatedAt:ut,failureCount:c.fetchFailureCount,failureReason:c.fetchFailureReason,errorUpdateCount:c.errorUpdateCount,isFetched:c.dataUpdateCount>0||c.errorUpdateCount>0,isFetchedAfterMount:c.dataUpdateCount>I.dataUpdateCount||c.errorUpdateCount>I.errorUpdateCount,isFetching:z,isRefetching:z&&!N,isLoadingError:W&&!ht,isPaused:c.fetchStatus==="paused",isPlaceholderData:Q,isRefetchError:W&&ht,isStale:it(t,s),refetch:this.refetch,promise:a(this,C)};if(this.options.experimental_prefetchInRender){const b=_=>{v.status==="error"?_.reject(v.error):v.data!==void 0&&_.resolve(v.data)},U=()=>{const _=d(this,C,v.promise=ft());b(_)},D=a(this,C);switch(D.status){case"pending":t.queryHash===n.queryHash&&b(D);break;case"fulfilled":(v.status==="error"||v.data!==D.value)&&U();break;case"rejected":(v.status!=="error"||v.error!==D.reason)&&U();break}}return v}updateResult(t){const s=a(this,p),n=this.createResult(a(this,r),this.options);if(d(this,A,a(this,r).state),d(this,L,this.options),a(this,A).data!==void 0&&d(this,K,a(this,r)),J(n,s))return;d(this,p,n);const o={},h=()=>{if(!s)return!0;const{notifyOnChangeProps:l}=this.options,m=typeof l=="function"?l():l;if(m==="all"||!m&&!a(this,B).size)return!0;const S=new Set(m??a(this,B));return this.options.throwOnError&&S.add("error"),Object.keys(a(this,p)).some(I=>{const u=I;return a(this,p)[u]!==s[u]&&S.has(u)})};(t==null?void 0:t.listeners)!==!1&&h()&&(o.listeners=!0),f(this,i,Rt).call(this,{...o,...t})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&f(this,i,$).call(this)}},O=new WeakMap,r=new WeakMap,k=new WeakMap,p=new WeakMap,A=new WeakMap,L=new WeakMap,C=new WeakMap,w=new WeakMap,P=new WeakMap,q=new WeakMap,K=new WeakMap,M=new WeakMap,T=new WeakMap,E=new WeakMap,B=new WeakMap,i=new WeakSet,j=function(t){f(this,i,st).call(this);let s=a(this,r).fetch(this.options,t);return t!=null&&t.throwOnError||(s=s.catch(jt)),s},X=function(){f(this,i,tt).call(this);const t=V(this.options.staleTime,a(this,r));if(yt||a(this,p).isStale||!mt(t))return;const n=kt(a(this,p).dataUpdatedAt,t)+1;d(this,M,setTimeout(()=>{a(this,p).isStale||this.updateResult()},n))},Y=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(a(this,r)):this.options.refetchInterval)??!1},Z=function(t){f(this,i,et).call(this),d(this,E,t),!(yt||R(this.options.enabled,a(this,r))===!1||!mt(a(this,E))||a(this,E)===0)&&d(this,T,setInterval(()=>{(this.options.refetchIntervalInBackground||Pt.isFocused())&&f(this,i,j).call(this)},a(this,E)))},$=function(){f(this,i,X).call(this),f(this,i,Z).call(this,f(this,i,Y).call(this))},tt=function(){a(this,M)&&(clearTimeout(a(this,M)),d(this,M,void 0))},et=function(){a(this,T)&&(clearInterval(a(this,T)),d(this,T,void 0))},st=function(){const t=a(this,O).getQueryCache().build(a(this,O),this.options);if(t===a(this,r))return;const s=a(this,r);d(this,r,t),d(this,k,t.state),this.hasListeners()&&(s==null||s.removeObserver(this),t.addObserver(this))},Rt=function(t){wt.batch(()=>{t.listeners&&this.listeners.forEach(s=>{s(a(this,p))}),a(this,O).getQueryCache().notify({query:a(this,r),type:"observerResultsUpdated"})})},vt);function Wt(e,t){return R(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function pt(e,t){return Wt(e,t)||e.state.data!==void 0&&at(e,t,t.refetchOnMount)}function at(e,t,s){if(R(t.enabled,e)!==!1){const n=typeof s=="function"?s(e):s;return n==="always"||n!==!1&&it(e,t)}return!1}function Ot(e,t,s,n){return(e!==t||R(n.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&it(e,s)}function it(e,t){return R(t.enabled,e)!==!1&&e.isStaleByTime(V(t.staleTime,e))}function Ht(e,t){return!J(e.getCurrentResult(),t)}function Gt(){return Vt()}function Jt(e){return zt()}function Xt(e){return"subscribe"in e&&typeof e.subscribe=="function"}function Yt(){}function Zt(e,t,s){const n=Jt(),o=Gt(),h=Xt(e)?e:qt(e),l=G([h,o],([u,c])=>{const Q=n.defaultQueryOptions(u);return Q._optimisticResults=c?"isRestoring":"optimistic",Q}),m=new t(n,nt(l));l.subscribe(u=>{m.setOptions(u,{listeners:!1})});const S=G(o,(u,c)=>{const Q=u?Yt:m.subscribe(wt.batchCalls(c));return m.updateResult(),Q}),{subscribe:I}=G([S,l],([u,c])=>(u=m.getOptimisticResult(c),c.notifyOnChangeProps?u:m.trackResult(u)));return{subscribe:I}}function $t(e,t){return Zt(e,Nt)}function pe(e){return e}const x=(e,t,s)=>{const n={_id:e,baseUrl:(t==null?void 0:t.baseUrl)||((t==null?void 0:t.client)??It).getConfig().baseUrl};return s&&(n._infinite=s),t!=null&&t.body&&(n.body=t.body),t!=null&&t.headers&&(n.headers=t.headers),t!=null&&t.path&&(n.path=t.path),t!=null&&t.query&&(n.query=t.query),[n]},te=(e,t)=>{const s={...e[0]};return t.body&&(s.body={...e[0].body,...t.body}),t.headers&&(s.headers={...e[0].headers,...t.headers}),t.path&&(s.path={...e[0].path,...t.path}),t.query&&(s.query={...e[0].query,...t.query}),s},ee=e=>x("readSample",e),Oe=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:n}=await At({...e,...t[0],signal:s,throwOnError:!0});return n},queryKey:ee(e)}),ge=e=>({mutationFn:async s=>{const{data:n}=await Et({...e,...s,throwOnError:!0});return n}}),se=e=>x("readAnnotationLabels",e),ve=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:n}=await Mt({...e,...t[0],signal:s,throwOnError:!0});return n},queryKey:se(e)}),we=e=>({mutationFn:async s=>{const{data:n}=await Ft({...e,...s,throwOnError:!0});return n}}),ae=e=>x("readAnnotations",e,!0),Re=e=>({queryFn:async({pageParam:t,queryKey:s,signal:n})=>{const h=te(s,typeof t=="object"?t:{query:{cursor:t}}),{data:l}=await Ut({...e,...h,signal:n,throwOnError:!0});return l},queryKey:ae(e)}),Ie=e=>({mutationFn:async s=>{const{data:n}=await Qt({...e,...s,throwOnError:!0});return n}}),Se=e=>({mutationFn:async s=>{const{data:n}=await xt({...e,...s,throwOnError:!0});return n}}),ne=e=>x("countAnnotationsByDataset",e),Ce=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:n}=await Tt({...e,...t[0],signal:s,throwOnError:!0});return n},queryKey:ne(e)}),Ee=e=>({mutationFn:async s=>{const{data:n}=await St({...e,...s,throwOnError:!0});return n}}),re=e=>x("getAnnotation",e),Qe=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:n}=await Dt({...e,...t[0],signal:s,throwOnError:!0});return n},queryKey:re(e)}),ie=e=>x("getEmbeddings2dTsne",e),Fe=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:n}=await Lt({...e,...t[0],signal:s,throwOnError:!0});return n},queryKey:ie(e)}),oe=e=>x("getMetadataInfo",e),ue=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:n}=await Ct({...e,...t[0],signal:s,throwOnError:!0});return n},queryKey:oe(e)}),gt=Kt(!1),ce=async e=>{if(nt(gt))return;const t=ue({path:{dataset_id:e}});$t(t).subscribe(n=>{if(n.data){const o=n.data,{updateMetadataBounds:h,updateMetadataValues:l,updateMetadataInfo:m}=rt(),S={},I={};o.forEach(u=>{(u.type==="integer"||u.type==="float")&&u.min!=null&&u.max!=null&&(S[u.name]={min:u.min,max:u.max},I[u.name]={min:u.min,max:u.max})}),h(S),l(I),m(o),gt.set(!0)}})},he=e=>{const t=[],{metadataBounds:s}=rt();for(const[n,o]of Object.entries(e)){const l=nt(s)[n];l&&(o.min>l.min&&t.push({key:n,value:o.min,op:">="}),o.max<l.max&&t.push({key:n,value:o.max,op:"<="}))}return t},Ae=e=>{e&&ce(e);const{metadataBounds:t,metadataValues:s,metadataInfo:n,updateMetadataValues:o,updateMetadataBounds:h,updateMetadataInfo:l}=rt();return{metadataBounds:t,metadataValues:s,metadataInfo:n,updateMetadataValues:o,updateMetadataBounds:h,updateMetadataInfo:l,createMetadataFilters:he}};export{Nt as Q,Ae as a,Ie as b,he as c,we as d,Ee as e,Oe as f,$t as g,Ce as h,pe as i,Fe as j,Zt as k,Xt as l,Se as m,Yt as n,Re as o,ve as p,Qe as q,ge as r,Jt as u};
