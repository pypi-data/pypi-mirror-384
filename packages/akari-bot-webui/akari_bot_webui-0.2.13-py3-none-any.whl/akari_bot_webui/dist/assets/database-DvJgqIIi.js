import{_ as S,aC as v,f as P,u as L,i as n,w as r,a as o,e as a,A as F,d as b,t as _,E as R,L as N,c as m,y as k,F as E,x as w,aA as B,o as l,aD as U,r as K,I as T}from"./index-B83Nj5wy.js";import{E as A}from"./row-DVAQSDiX.js";import{E as H,a as q,b as D}from"./pagination-DR65BV4_.js";import"./select-DWPJjTK6.js";import{E as O}from"./empty-CWpByPlA.js";import{E as I}from"./card-DrdRfsqF.js";import{E as j}from"./col-BQ0dJrnG.js";import{E as G,a as J}from"./collapse-item-CBex9jK3.js";import"./_initCloneObject-D0WUAqkw.js";import"./raf-BESGV2Sv.js";const W={name:"SQLConsole",data(){const{t:e}=L();return{sql:"",show_result:!1,result:[],error:"",affectedRows:null,history:[],historyPage:1,resultPage:1,historyPageSize:5,resultPageSize:10,loading:!1,t:e}},computed:{pagedResult(){const e=(this.resultPage-1)*this.resultPageSize;return this.result.slice(e,e+this.resultPageSize)},pagedHistory(){const e=(this.historyPage-1)*this.historyPageSize;return this.history.slice(e,e+this.historyPageSize)}},methods:{async executeSQL(){if(this.sql){this.result=[],this.error="",this.affectedRows=null,this.show_result=!1,this.history.unshift(this.sql),this.loading=!0;try{const e=await v.post("/api/database/exec",{sql:this.sql});this.show_result=!0,e.data.success?(e.data.affected_rows!==void 0?this.affectedRows=e.data.affected_rows:this.result=e.data.data||[],this.error=""):(this.result=[],this.error=e.data.error)}catch(e){P.error(this.t("message.error.fetch")+e.message)}finally{this.loading=!1}}},clearSQL(){this.sql="",this.result=[],this.error="",this.show_result=!1,this.resultPage=1},setSQL(e){this.sql=e}}},X={class:"button-toolbar"},Y={class:"editor-area"},Z={class:"history"},$=["onClick"],ee={class:"pagination-wrapper"},te={class:"result-area"},se={key:0,class:"error"},le={key:1,class:"affected-rows"},oe={key:3},ae={class:"table-wrapper"},re={class:"pagination-wrapper"};function ne(e,s,C,x,t,u){const i=R,h=N,f=H,p=I,g=O,d=D,z=q,Q=B;return l(),n(p,{class:"sql-console",shadow:"never"},{default:r(()=>[o("div",X,[a(i,{type:"primary",size:"small",disabled:t.loading,onClick:u.executeSQL},{default:r(()=>[s[3]||(s[3]=o("i",{class:"mdi mdi-console-line"},null,-1)),b(" "+_(e.$t("database.button.execute")),1)]),_:1},8,["disabled","onClick"]),a(i,{size:"small",disabled:t.loading,onClick:u.clearSQL},{default:r(()=>[s[4]||(s[4]=o("i",{class:"mdi mdi-restart"},null,-1)),b(" "+_(e.$t("database.button.clear")),1)]),_:1},8,["disabled","onClick"])]),a(p,{class:"editor-card",shadow:"never"},{default:r(()=>[o("div",Y,[a(h,{type:"textarea",modelValue:t.sql,"onUpdate:modelValue":s[0]||(s[0]=c=>t.sql=c),placeholder:e.$t("database.input.sql"),resize:"none",rows:"9",class:"sql-input"},null,8,["modelValue","placeholder"]),a(p,{class:"history-area",shadow:"never"},{default:r(()=>[o("span",null,[s[5]||(s[5]=o("i",{class:"mdi mdi-history"},null,-1)),b(" "+_(e.$t("database.sql.history.title")),1)]),o("div",Z,[(l(!0),m(E,null,k(u.pagedHistory,(c,y)=>(l(),m("div",{key:y,class:"history-item",onClick:me=>u.setSQL(c)},_(c),9,$))),128))]),o("div",ee,[t.history.length>t.historyPageSize?(l(),n(f,{key:0,layout:"prev, pager, next","page-size":t.historyPageSize,total:t.history.length,"current-page":t.historyPage,"onUpdate:currentPage":s[1]||(s[1]=c=>t.historyPage=c)},null,8,["page-size","total","current-page"])):w("",!0)])]),_:1})])]),_:1}),F((l(),n(p,{class:"result-card",shadow:"never"},{default:r(()=>[o("h3",null,[s[6]||(s[6]=o("i",{class:"mdi mdi-console-line"},null,-1)),b(" "+_(e.$t("database.sql.result.title")),1)]),o("div",te,[t.error?(l(),m("div",se,_(t.error),1)):t.affectedRows!==null?(l(),m("div",le," ("+_(t.affectedRows)+" row(s) affected) ",1)):t.show_result&&!t.result.length?(l(),n(g,{key:2})):(l(),m("div",oe,[o("div",ae,[t.result.length?(l(),n(z,{key:0,data:u.pagedResult,stripe:"",width:"100%"},{default:r(()=>[(l(!0),m(E,null,k(t.result[0],(c,y)=>(l(),n(d,{key:y,prop:y,label:y},null,8,["prop","label"]))),128))]),_:1},8,["data"])):w("",!0)]),o("div",re,[t.result.length>t.resultPageSize?(l(),n(f,{key:0,background:"",layout:"prev, pager, next","page-size":t.resultPageSize,total:t.result.length,style:{"margin-top":"20px"},"current-page":t.resultPage,"onUpdate:currentPage":s[2]||(s[2]=c=>t.resultPage=c)},null,8,["page-size","total","current-page"])):w("",!0)])]))])]),_:1})),[[Q,t.loading]])]),_:1})}const M=S(W,[["render",ne],["__scopeId","data-v-30f9d324"]]),ie={name:"DataModels",data(){const{t:e}=L();return{modelList:[],expandedKeys:[],t:e}},methods:{async fetchModels(){try{const e=await v.get("/api/database/list");this.modelList=e.data.model_list.map(s=>({model:s,fields:[]}))}catch(e){P.error(this.t("message.error.fetch")+e.message)}},async fetchFields(e){if(!e.fields.length)try{const s=await v.get(`/api/database/field/${e.model}`);e.fields=s.data.model_fields}catch(s){P.error(this.t("message.error.fetch")+s.message)}}},mounted(){this.fetchModels()}},de={class:"models"};function ce(e,s,C,x,t,u){const i=D,h=q,f=G,p=J,g=I;return l(),n(g,{class:"data-models",shadow:"never"},{default:r(()=>[o("h3",null,[s[1]||(s[1]=o("i",{class:"mdi mdi-database"},null,-1)),b(" "+_(e.$t("database.models.title")),1)]),o("div",de,[a(p,{modelValue:t.expandedKeys,"onUpdate:modelValue":s[0]||(s[0]=d=>t.expandedKeys=d),accordion:"",style:{width:"100%"}},{default:r(()=>[(l(!0),m(E,null,k(t.modelList,d=>(l(),n(f,{key:d.model,title:d.model,name:d.model,onClick:z=>u.fetchFields(d)},{default:r(()=>[a(h,{data:d.fields,size:"small",style:{width:"100%"}},{default:r(()=>[a(i,{prop:"name",label:t.t("database.models.label.name")},null,8,["label"]),a(i,{prop:"type",label:t.t("database.models.label.type")},null,8,["label"]),a(i,{prop:"max_length",label:t.t("database.models.label.max_length")},null,8,["label"]),a(i,{prop:"nullable",label:t.t("database.models.label.nullable")},null,8,["label"])]),_:1},8,["data"])]),_:2},1032,["title","name","onClick"]))),128))]),_:1},8,["modelValue"])])]),_:1})}const V=S(ie,[["render",ce],["__scopeId","data-v-297a33ac"]]),ue={name:"DatabasePage",components:{DataModels:V,SQLConsole:M,NotFound:U},data(){return{isDevelopMode:localStorage.getItem("isDevelopMode")==="true"&&!T}}},pe={key:0};function _e(e,s,C,x,t,u){const i=V,h=j,f=M,p=A,g=K("NotFound");return t.isDevelopMode?(l(),m("div",pe,[a(p,{gutter:"24"},{default:r(()=>[a(h,{span:6,xs:24},{default:r(()=>[a(i)]),_:1}),a(h,{span:18,xs:24},{default:r(()=>[a(f)]),_:1})]),_:1})])):(l(),n(g,{key:1}))}const Se=S(ue,[["render",_e],["__scopeId","data-v-30cdab50"]]);export{Se as default};
