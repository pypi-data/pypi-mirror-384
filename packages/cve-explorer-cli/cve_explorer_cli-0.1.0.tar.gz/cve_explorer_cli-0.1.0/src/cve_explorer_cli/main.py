import requests
import time
import argparse
from typing import Any
from yaspin import yaspin

def __request_cve(cve_id: str) -> Any:
    """Request CVE information from First (api.first.org)

    Args:
        cve_id (str): ID of CVE (ex: CVE-2022-27225)

    Returns:
        _type_: _description_
    """
    res = requests.get(
        f'https://api.first.org/data/v1/epss?cve={cve_id}',
        timeout=10
    )
    response_json = res.json()
    return response_json['data']

def main():
    print("Welcome to the CVE Explorer CLI!")

    parser = argparse.ArgumentParser(description="CVE Explorer CLI")
    subparsers = parser.add_subparsers(dest="command")

    # CVE Lookup
    cve_lookup = subparsers.add_parser("lookup", help="Request a single CVE")
    cve_lookup.add_argument("--id", type=str)

    args = parser.parse_args()

    if args.command == "lookup":
        with yaspin(text="Getting CVE...", color="green") as spinner:
            res = __request_cve(cve_id=args.id)
            print(res)
            spinner.ok("âœ…")
    else:
        parser.print_help()

        # # Simple example with a spinner while something runs
        # with yaspin(text="Processing...", color="cyan") as spinner:
        #     try:
        #         # # Simulate a long-running task
        #         # time.sleep(3)
        #         # res = __request_cve(cve_id='CVE-2022-27225')
        #         res = __request_cve(cve_id=args.id)
        #         print(res)

        #         # If success
        #         spinner.ok("âœ… ")
        #     except Exception as e:
        #         spinner.fail("ðŸ’¥ ")
        #         print(f"Error: {e}")

if __name__ == "__main__":
    main()
