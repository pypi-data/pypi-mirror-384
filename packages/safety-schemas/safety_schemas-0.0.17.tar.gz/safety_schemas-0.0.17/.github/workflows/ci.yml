name: CI

on:
    push:
      branches:
        - 'main'
    pull_request:
      types: [opened, synchronize, reopened]
    workflow_dispatch:

env:
    BRANCH_NAME: ${{ github.head_ref || github.ref_name }}

jobs:
    test:
        name: Python ${{ matrix.python-version }} on ${{ startsWith(matrix.os, 'macos-') && 'macOS' || startsWith(matrix.os, 'windows-') && 'Windows' || 'Linux' }}
        runs-on: ${{ matrix.os }}
        strategy:
          fail-fast: false
          matrix:
            python-version: [ "3.8", "3.9", "3.10", "3.11", "3.12", "3.13"]
            os: [ubuntu-latest, windows-latest, macos-latest]
        steps:
            - uses: actions/checkout@v4

            - name: Set up Python ${{ matrix.python-version }}
              uses: actions/setup-python@v5
              with:
                python-version: ${{ matrix.python-version }}

            - name: Install Hatch
              run: pip install --upgrade hatch

            - name: Run tests
              run: hatch run test:cov
