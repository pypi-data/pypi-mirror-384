import"../chunks/DsnmJJEf.js";import{o as ct,s as dt}from"../chunks/CfPWzxx9.js";import{p as _t,s as u,b as x,u as Se,d as s,g as e,l as f,t as vt,h as L,i as _,f as $,a as g,j as ft,c as ge,n as gt,m as ae,r as se,v as mt}from"../chunks/XfyNEFST.js";import{i as h}from"../chunks/CyI3pj5p.js";import{u as ht,a as ze,b as oe,e as pt,i as bt}from"../chunks/CXfFsfRJ.js";import{s as qe}from"../chunks/CvUL_eGA.js";import{F as xt,e as me,b as he,S as yt,c as wt,t as Ct,f as St,h as Ge,r as Ot}from"../chunks/Ds6lQle8.js";import{A as U}from"../chunks/CNlXD7nS.js";import{R as jt}from"../chunks/BpBF44Cg.js";import{T as He}from"../chunks/Dsl-dlBH.js";import{B as Pt}from"../chunks/BMP9UOh8.js";import{g as Tt}from"../chunks/CqS7hfz2.js";import{u as V}from"../chunks/gMw3n3N4.js";var $t=L('<label class="col-6 col-md-2">Subdivision</label> <div class="col-4 col-md-2"><!></div>',1),Lt=L('<div class="row mb-2"><label class="col-6 col-md-3 fw-medium fs-4"> </label> <div class="col-4 col-md-2"><!></div> <!></div>'),kt=L("<h3>Technologies (for Capex/Opex)</h3> <!> <!> <!> <!> <!>",1),At=L("<!> <!> <!>",1),Et=L("<!> <!> <!>",1),Rt=L("<!> <!>",1),Dt=L('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Ft=L('<div class="text-center">No data with this selection.</div>'),Bt=L('<div class="text-center">Please select at least one year.</div>'),It=L('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Costs</h1> <!> <div class="mt-4"><!></div>',1);function Xt(Je,Ke){_t(Ke,!0);const i="Techology / Carrier",Oe=" (Capex)",je=" (Opex)",Qe="Capex",We="Opex",Xe="Carrier",Ze="Shed Demand";let Pe=u(x([])),Te=u(x([])),Y=u(x([]));const $e=["Location",i];let le=u(null),W=u(null),C=u(null),k=u(null),X=u(null),ne=u(x({})),z=u(x([])),a=u(null),E=u(x([])),B=u(x([])),I=u(x([])),q=u(x([])),G=u(x([])),H=u(x([])),ie=u("Location"),pe=null,be=null,xe=null,ye=null,we=null,Le="",ke="",Ae="",Ee="",Re="",De="",Fe="",Z=u(!1),ee=u(!1),S=x({capex:{title:"Capex",show:!0,subdivision:!1,show_subdivision:!0,label:Qe},opex:{title:"Opex",show:!0,subdivision:!1,show_subdivision:!0,label:We},carrier:{title:"Carrier",show:!0,subdivision:!1,show_subdivision:!0,label:Xe},shed_demand:{title:"Shed Demand",show:!0,subdivision:!1,show_subdivision:!0,label:Ze},carbon_emission:{title:"Carbon Emissions",show:!0,subdivision:!1,show_subdivision:!1}}),et=f(()=>{if(!e(a))return"";let t=e(a).solution_name.split(".");return[t[t.length-1],e(a).scenario_name,"costs"].join("_")}),Be=f(()=>e(K).length>0?e(ne)[e(K)[0]]||"":e(J).length>0?e(ne)[e(J)[0]]||"":e(Q).length>0&&e(ne)[e(Q)[0]]||""),tt=f(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Costs [${e(Be)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"},plugins:{tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue} ${e(Be)}`}}}})),rt=f(()=>e(E).map(t=>t.toString())),ue=f(()=>!e(C)||!e(k)?new Set:new Set([...e(C).data.map(t=>t[i])||[],...e(k).data.map(t=>t[i])||[]])),J=f(()=>!e(a)||e(ue).size==0?(console.log("No transport technologies"),[]):e(a).detail.system.set_transport_technologies.filter(t=>e(ue).has(t))),K=f(()=>!e(a)||!e(C)||!e(k)?[]:me(e(a).detail.system.set_conversion_technologies.filter(t=>e(ue).has(t)))),Q=f(()=>!e(a)||!e(C)||!e(k)?[]:me(e(a).detail.system.set_storage_technologies.filter(t=>e(ue).has(t)))),ce=f(()=>!e(a)||!e(W)?.data?[]:me(e(W).data.map(t=>t[i]))),de=f(()=>!e(a)||!e(X)?.data?[]:me(e(X).data.map(t=>t[i]))),_e=f(()=>e(a)?Object.keys(e(a).detail.edges).concat(e(a).detail.system.set_nodes):[]);V(()=>e(J),()=>!!e(a)&&!!e(C)&&!!e(k),()=>Le,()=>pe,t=>s(q,t,!0),t=>Le=t,t=>pe=t),V(()=>e(K),()=>!!e(a)&&!!e(C)&&!!e(k),()=>ke,()=>be,t=>s(H,t,!0),t=>ke=t,t=>be=t),V(()=>e(Q),()=>!!e(a)&&!!e(C)&&!!e(k),()=>Ae,()=>xe,t=>s(G,t,!0),t=>Ae=t,t=>xe=t),V(()=>e(ce),()=>!!e(a)&&!!e(W)?.data,()=>Ee,()=>ye,t=>s(B,t,!0),t=>Ee=t,t=>ye=t),V(()=>e(de),()=>!!e(a)&&!!e(X)?.data,()=>Re,()=>we,t=>s(I,t,!0),t=>Re=t,t=>we=t),V(()=>e(_e),()=>!!e(a),()=>De,()=>null,t=>s(z,t,!0),t=>De=t,()=>{}),V(()=>e(Y),()=>!!e(a),()=>Fe,()=>null,t=>s(E,t,!0),t=>Fe=t,()=>{}),Se(()=>{s(z,e(_e),!0)}),Se(()=>{s(E,e(Y),!0)}),ct(()=>{Object.entries(S).forEach(([t,r])=>{r.show=ze(t,r.show),r.subdivision=ze(t+"_sub",r.subdivision)}),pe=oe("tran"),be=oe("conv"),xe=oe("stor"),ye=oe("cost"),we=oe("demand")}),Se(()=>{e(q),e(H),e(G),e(B),e(I),Object.values(S).forEach(t=>{t.show,t.subdivision}),vt().then(()=>{let t={tran:e(q).map(r=>e(J).indexOf(r)).join("~"),conv:e(H).map(r=>e(K).indexOf(r)).join("~"),stor:e(G).map(r=>e(Q).indexOf(r)).join("~"),cost:e(B).map(r=>e(ce).indexOf(r)).join("~"),demand:e(I).map(r=>e(de).indexOf(r)).join("~")};Object.entries(S).forEach(([r,m])=>{t[r]=m.show?"1":"0",t[r+"_sub"]=m.subdivision?"1":"0"}),ht(t)})});function at(){e(a)&&st()}function ve(t,r){return!t||!t.data||(t.data=t.data.map(m=>r.reduce((A,[p,O])=>{if(!(p in m))return A;const{[p]:y,...j}=A;return{...j,[O]:y}},m))),t}async function st(){if(!e(a))return;s(ee,!0);let t=await St(e(a).solution_name,["cost_capex_yearly","cost_opex_yearly","cost_carbon_emissions_total","cost_carrier","cost_shed_demand"].map(r=>Tt(r,e(a)?.version)),e(a).scenario_name);s(C,ve(t.cost_capex_yearly||null,[["technology",i]]),!0),s(k,ve(t.cost_opex_yearly||null,[["technology",i]]),!0),s(le,t.cost_carbon_emissions_total||null,!0),s(W,ve(t.cost_carrier||null,[["node","location"],["carrier",i]]),!0),s(X,ve(t.cost_shed_demand||null,[["node","location"],["carrier",i]]),!0),t.unit?.data&&s(ne,Object.fromEntries(t.unit.data.map(r=>[r.technology,r[0]||r.units])),!0),s(ee,!1)}let Ce=f(()=>{let t=[...e(H).concat(e(G)).concat(e(q)).flatMap(o=>[o+Oe,o+je]),...e(B),...e(I)],r=e(Y).filter(o=>!e(E).includes(o));const m=[{key:"capex",data:(e(C)?.data||[]).map(o=>({...o,[i]:o[i]+Oe}))},{key:"opex",data:(e(k)?.data||[]).map(o=>({...o,[i]:o[i]+je}))},{key:"carrier",data:(e(W)?.data||[]).filter(o=>e(B).includes(o[i]))},{key:"shed_demand",data:(e(X)?.data||[]).filter(o=>e(I).includes(o[i]))||null}];let A=m.flatMap(({key:o,data:l})=>!S[o].show||!l?[]:S[o].subdivision?l:Ge(l,{location:e(z)},{[i]:t},r,!1).map(w=>({...w.data,location:w.label,[i]:S[o].label})));m.forEach(({key:o})=>{S[o].label&&t.push(S[o].label)});let p,O;e(ie)==i?(p={location:e(_e)},O={[i]:t}):(p={[i]:t},O={location:e(z)}),Ot();let y=Ge(A,p,O,[],!1),j=[];return e(le)?.data&&e(le).data.length>0&&S.carbon_emission.show&&(j=[{data:Object.entries(e(le).data[0]).filter(([l])=>!r.includes(Number(l))).map(([l,w])=>w),label:"Total Carbon Costs",type:"bar"}]),[...y,...j]});var Ie=It(),Me=_($(Ie),2);xt(Me,{children:(t,r)=>{var m=Rt(),A=$(m);he(A,{title:"Solution Selection",children:(y,j)=>{{let o=f(()=>e(ee)||e(Z));yt(y,{solution_selected:at,get disabled(){return e(o)},get carriers(){return e(Pe)},set carriers(l){s(Pe,l,!0)},get nodes(){return e(Te)},set nodes(l){s(Te,l,!0)},get years(){return e(Y)},set years(l){s(Y,l,!0)},get selected_solution(){return e(a)},set selected_solution(l){s(a,l,!0)},get loading(){return e(Z)},set loading(l){s(Z,l,!0)}})}}});var p=_(A,2);{var O=y=>{var j=Et(),o=$(j);he(o,{title:"Cost Selection",children:(M,fe)=>{var P=ge(),v=$(P);pt(v,17,()=>Object.values(S),bt,(R,b,D)=>{var F=Lt(),c=ae(F);qe(c,"for","variables"+D);var T=ae(c,!0);se(c);var N=_(c,2),te=ae(N);He(te,{formId:"variables"+D,get value(){return e(b).show},set value(d){e(b).show=d}}),se(N);var re=_(N,2);{var n=d=>{var Ue=$t(),Ve=$(Ue);qe(Ve,"for","subdivision"+D);var Ye=_(Ve,2),it=ae(Ye);He(it,{formId:"subdivision"+D,get value(){return e(b).subdivision},set value(ut){e(b).subdivision=ut}}),se(Ye),g(d,Ue)};h(re,d=>{e(b).show&&e(b).show_subdivision&&d(n)})}se(F),mt(()=>dt(T,e(b).title)),g(R,F)}),g(M,P)}});var l=_(o,2);he(l,{title:"Technology Selection",children:(M,fe)=>{var P=kt(),v=_($(P),2);{var R=n=>{U(n,{label:"Transport",get elements(){return e(J)},get value(){return e(q)},set value(d){s(q,d,!0)}})};h(v,n=>{e(J).length>0&&n(R)})}var b=_(v,2);{var D=n=>{U(n,{label:"Storage",get elements(){return e(Q)},get value(){return e(G)},set value(d){s(G,d,!0)}})};h(b,n=>{e(Q).length>0&&n(D)})}var F=_(b,2);{var c=n=>{U(n,{label:"Conversion",get elements(){return e(K)},get value(){return e(H)},set value(d){s(H,d,!0)}})};h(F,n=>{e(K).length>0&&n(c)})}var T=_(F,2);{var N=n=>{U(n,{label:"Cost of Carrier",get elements(){return e(ce)},get value(){return e(B)},set value(d){s(B,d,!0)}})};h(T,n=>{e(ce).length>0&&n(N)})}var te=_(T,2);{var re=n=>{U(n,{label:"Shed Demand",get elements(){return e(de)},get value(){return e(I)},set value(d){s(I,d,!0)}})};h(te,n=>{e(de).length>0&&n(re)})}g(M,P)}});var w=_(l,2);he(w,{title:"Data Selection",children:(M,fe)=>{var P=At(),v=$(P);wt(v,{label:"Aggregation",content:(T,N=gt)=>{{let te=f(()=>Ct($e));jt(T,{get formId(){return N()},get options(){return e(te)},get value(){return e(ie)},set value(re){s(ie,re,!0)}})}}});var R=_(v,2);{var b=c=>{U(c,{label:"Locations",get elements(){return e(_e)},get value(){return e(z)},set value(T){s(z,T,!0)}})};h(R,c=>{e(ie)==$e[1]&&c(b)})}var D=_(R,2);{var F=c=>{U(c,{label:"Years",get elements(){return e(Y)},get value(){return e(E)},set value(T){s(E,T,!0)}})};h(D,c=>{e(E)&&c(F)})}g(M,P)}}),g(y,j)};h(p,y=>{!e(ee)&&!e(Z)&&e(C)&&e(a)!=null&&y(O)})}g(t,m)}});var Ne=_(Me,2),ot=ae(Ne);{var lt=t=>{var r=Dt();g(t,r)},nt=t=>{var r=ge(),m=$(r);{var A=p=>{var O=ge(),y=$(O);{var j=l=>{var w=Ft();g(l,w)},o=l=>{var w=ge(),M=$(w);{var fe=v=>{var R=Bt();g(v,R)},P=v=>{Pt(v,{type:"line",get options(){return e(tt)},get datasets(){return e(Ce)},get labels(){return e(rt)},get plot_name(){return e(et)}})};h(M,v=>{e(E).length==0?v(fe):v(P,!1)},!0)}g(l,w)};h(y,l=>{e(Ce).length==0||e(Ce)[0].data.length==0?l(j):l(o,!1)})}g(p,O)};h(m,p=>{e(a)!=null&&p(A)},!0)}g(t,r)};h(ot,t=>{e(Z)||e(ee)?t(lt):t(nt,!1)})}se(Ne),g(Je,Ie),ft()}export{Xt as component};
