import"../chunks/DsnmJJEf.js";import{o as Ge}from"../chunks/CfPWzxx9.js";import{p as Je,s,b as ie,u as L,g as e,d as r,e as Y,l as _,t as Pe,o as Qe,h as y,i as N,f as k,a as g,j as Xe,n as ue,m as et,r as tt,c as G}from"../chunks/XfyNEFST.js";import{i as T,b as $e}from"../chunks/CyI3pj5p.js";import{T as rt}from"../chunks/Dsl-dlBH.js";import{d as at,F as lt,n as ot,e as ce,r as nt,b as fe,S as st,c as de,t as ve}from"../chunks/Ds6lQle8.js";import{A as je}from"../chunks/CNlXD7nS.js";import{B as Ae}from"../chunks/BMP9UOh8.js";import{D as me}from"../chunks/BQVz1yab.js";import{u as it,g as pe}from"../chunks/CXfFsfRJ.js";var ut=y("<!> <!> <!>",1),dt=y("<!> <!> <!>",1),gt=y("<!> <!>",1),_t=y("<!> <!>",1),ct=y('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),ft=y('<div class="text-center">No technologies with this selection.</div>'),vt=y('<div class="text-center">No carriers with this selection.</div>'),mt=y('<div class="text-center">No solution selected.</div>'),pt=y('<div class="text-center">No locations with this selection.</div>'),ht=y('<div class="text-center">No data available for this selection.</div>'),bt=y("<!> <!>",1),wt=y('<h1 class="mt-2 mb-4">The Energy Balance &ndash; Storage</h1> <!> <div class="mt-4 plot"><!></div>',1);function $t(De,Te){Je(Te,!0);let x=null,J=null,Q=null,X=null,ee=null,te=s(0),he=s(ie({})),I=s(ie([]));const Ie=["Hourly","Daily","Weekly","Monthly"];let n=s(null),m=s(null),S=s(""),R=s("Hourly"),E=s(!0),P=s(ie([])),$=s(ie([])),M=s(!1),j=s(!1),re=s(void 0),ae=s(void 0),be=_(()=>e(H).length>0?e(he)[e(H)[0]]:""),we=_(()=>{if(!e(n)||!e(n).solution_name)return"";let a=e(n).solution_name.split(".");return[a[a.length-1],e(n).scenario_name,"storage_level",e(m)].join("_")}),Re=_(()=>e(we)+"_flows"),Ee=_(()=>xe("Storage Level")),Me=_(()=>xe("Storage Flow")),K=s(null),ye=s(0);L(()=>{e(n)?.detail?.system.unaggregated_time_steps_per_year!==void 0&&r(ye,e(n).detail.system.unaggregated_time_steps_per_year,!0)}),L(()=>{e(ye),Y(()=>{r(K,null)})});function xe(a){return{animation:!1,normalized:!0,parsing:!1,elements:{point:{radius:0},line:{borderWidth:1}},responsive:!0,scales:{x:{type:"linear",stacked:!0,title:{display:!0,text:"Time"},ticks:{maxRotation:0,autoSkip:!0,callback:t=>Number(t).toFixed(0)},min:0,max:(e(n)?.detail?.system.unaggregated_time_steps_per_year||0)-1},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`${a} [${e(be)}]`}}},plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x"},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x"},limits:{x:{minRange:10,min:"original",max:"original"}}},tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue} ${e(be)}`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}let Z=_(()=>(e(te),x?ce(x.map(a=>a.index.node)).sort():[])),W=_(()=>{if(e(te),!x||!e(n))return[];let a=Array.from(x.map(t=>t.index.technology));return ce(x.filter(t=>a.includes(t.index.technology)).map(t=>e(n).detail.reference_carrier[t.index.technology]))}),H=_(()=>(e(te),!x||!e(n)||e(W).length===0?[]:ce(x.map(t=>t.index.technology)).filter(t=>e(n).detail.reference_carrier[t]==e(m))));L(()=>{e(H),Y(()=>{r(P,e(H),!0)})}),L(()=>{e(Z),Y(()=>{r($,e(Z),!0)})}),L(()=>{e(W),Y(()=>{e(W).length>0&&(!e(m)||!e(W).includes(e(m)))&&(r(m,e(W)[0],!0),oe())})}),L(()=>{e(I),Y(()=>{e(I).length>0&&(!e(S)||!e(I).includes(Number(e(S))))&&(r(S,e(I)[0].toString(),!0),oe())})}),L(()=>{e(m),e(E),e(P),e($),Y(oe)}),Ge(()=>{r(m,pe("car")||e(m),!0),r(S,pe("year")||e(S),!0),r(R,pe("window")||e(R),!0)}),L(()=>{e(S),e(m),e(R),Pe().then(()=>{it({year:e(S),car:e(m),window:e(R)})})}),L(()=>{We()});async function We(){if(e(n)===null||!e(S))return;r(j,!0);let a={Daily:24,Weekly:168,Monthly:720}[e(R)]||1;const t=await at(e(n).solution_name,["storage_level","flow_storage_charge","flow_storage_discharge","flow_storage_spillage","flow_storage_inflow"],e(n).scenario_name,"storage_level",Number(e(S)),a);x=t.components.storage_level||null,J=t.components.flow_storage_charge||null,Q=t.components.flow_storage_discharge||null,X=t.components.flow_storage_spillage||null,ee=t.components.flow_storage_inflow||null,Qe(te),t.unit?.data&&r(he,Object.fromEntries(t.unit.data.map(c=>[c.technology,c[0]||c.units])),!0),r(j,!1),oe()}let Se=_(()=>Array.from({length:e(ke)},(a,t)=>t.toString())),le=[],ge=[],_e=s(0),Be=s(0),ke=s(0);function Oe(){return e($).length==0||e(P).length==0||!x||!J||!Q||!ee||!X?[]:ze(x,{technology:e(P),node:e($)},e(E)?["technology"]:[],e(E)?void 0:()=>({label:"Storage Level",borderColor:"rgb(0, 0, 0)",backgroundColor:"rgba(0, 0, 0, 0.2)"}))}function He(){return e(n)===null||e(j)||e($).length==0||e(P).length==0||!x||!J||!Q||!ee||!X?[]:[{data:J,label_suffix:"_charge",label_aggregated:"Flow Storage Charge",negate:!1,color:"rgb(54, 162, 235)"},{data:Q,label_suffix:"_discharge",label_aggregated:"Flow Storage Discharge",negate:!0,color:"rgb(255, 99, 132)"},{data:ee,label_suffix:"_inflow",label_aggregated:"Flow Storage Inflow",negate:!1,color:"rgb(75, 192, 192)"},{data:X,label_suffix:"_spillage",label_aggregated:"Flow Storage Spillage",negate:!0,color:"rgb(255, 99, 132)"}].flatMap(({data:a,label_suffix:t,label_aggregated:c,negate:A,color:D})=>ze(a,{technology:e(P),node:e($)},e(E)?["technology"]:[],e(E)?o=>({label:o.index.column+t}):()=>({label:c,borderColor:D,backgroundColor:D}),o=>A?-o:o))}async function oe(){nt(),le=Oe(),ge=He(),r(_e,le.length,!0),r(Be,ge.length,!0),r(ke,e(_e)>0?le[0].data.length:0,!0),await Pe(),e(re)&&e(re).updateChart(le),e(ae)&&e(ae).updateChart(ge)}function ze(a,t,c,A=()=>({}),D=o=>o){let o=a.filter(l=>Object.entries(t).every(([i,u])=>u.includes(l.index[i]))).map(l=>({index:l.index,data:l.data.map(D)}));if(o.length===0)return[];if(c){const l=Array.isArray(c)?c:[0],i={};o.forEach(u=>{const d=l.map(f=>u.index[f]).join("_");i[d]||(i[d]=new Array(u.data.length).fill(0)),u.data.forEach((f,p)=>{i[d][p]+=f})}),o=Object.entries(i).map(([u,d])=>({index:{column:u},data:d}))}return o.map(l=>{const i=A(l),u=i.borderColor||ot();return{...i,data:l.data.map((d,f)=>({x:f,y:d})),label:i.label||l.index.column,type:"line",fill:"origin",stepped:!0,borderColor:u,backgroundColor:i.backgroundColor||u}})}var Ce=wt(),Fe=N(k(Ce),2);lt(Fe,{children:(a,t)=>{var c=_t(),A=k(c);fe(A,{title:"Solution Selection",children:(l,i)=>{{let u=_(()=>e(j)||e(M));st(l,{get disabled(){return e(u)},get selected_solution(){return e(n)},set selected_solution(d){r(n,d,!0)},get loading(){return e(M)},set loading(d){r(M,d,!0)},get years(){return e(I)},set years(d){r(I,d,!0)}})}}});var D=N(A,2);{var o=l=>{var i=gt(),u=k(i);fe(u,{title:"Variable Selection",children:(p,ne)=>{var q=ut(),B=k(q);de(B,{label:"Year",content:(b,C=ue)=>{{let v=_(()=>ve(e(I).map(F=>F.toString()))),w=_(()=>e(j)||e(M));me(b,{get formId(){return C()},get options(){return e(v)},get disabled(){return e(w)},get value(){return e(S)},set value(F){r(S,F,!0)}})}}});var h=N(B,2);de(h,{label:"Carrier",content:(b,C=ue)=>{{let v=_(()=>ve(e(W))),w=_(()=>e(j)||e(M));me(b,{get formId(){return C()},get options(){return e(v)},get disabled(){return e(w)},get value(){return e(m)},set value(F){r(m,F,!0)}})}}});var z=N(h,2);de(z,{label:"Smoothing Window Size",content:(b,C=ue)=>{{let v=_(()=>ve(Ie)),w=_(()=>e(j)||e(M));me(b,{get formId(){return C()},get options(){return e(v)},get disabled(){return e(w)},get value(){return e(R)},set value(F){r(R,F,!0)}})}}}),g(p,q)}});var d=N(u,2);{var f=p=>{fe(p,{title:"Data Selection",children:(ne,q)=>{var B=dt(),h=k(B);de(h,{label:"Technology Subdivision",content:(C,v=ue)=>{rt(C,{get formId(){return v()},get value(){return e(E)},set value(w){r(E,w,!0)}})}});var z=N(h,2);je(z,{label:"Technologies",get elements(){return e(H)},get value(){return e(P)},set value(b){r(P,b,!0)}});var U=N(z,2);je(U,{label:"Nodes",get elements(){return e(Z)},get value(){return e($)},set value(b){r($,b,!0)}}),g(ne,B)}})};T(d,p=>{e(m)&&e(Z).length>0&&p(f)})}g(l,i)};T(D,l=>{e(n)&&l(o)})}g(a,c)}});var Le=N(Fe,2),Ue=et(Le);{var Ve=a=>{var t=ct();g(a,t)},Ye=a=>{var t=G(),c=k(t);{var A=o=>{var l=ft();g(o,l)},D=o=>{var l=G(),i=k(l);{var u=f=>{var p=vt();g(f,p)},d=f=>{var p=G(),ne=k(p);{var q=h=>{var z=mt();g(h,z)},B=h=>{var z=G(),U=k(z);{var b=v=>{var w=pt();g(v,w)},C=v=>{var w=G(),F=k(w);{var Ke=V=>{var se=ht();g(V,se)},Ze=V=>{var se=bt(),Ne=k(se);$e(Ae(Ne,{id:"level_chart",type:"line",get labels(){return e(Se)},datasets:[],get options(){return e(Ee)},get plot_name(){return e(we)},zoom:!0,get zoomLevel(){return e(K)},set zoomLevel(O){r(K,O,!0)}}),O=>r(re,O,!0),()=>e(re));var qe=N(Ne,2);$e(Ae(qe,{id:"flow_chart",type:"line",get labels(){return e(Se)},datasets:[],get options(){return e(Me)},get plot_name(){return e(Re)},zoom:!0,get zoomLevel(){return e(K)},set zoomLevel(O){r(K,O,!0)}}),O=>r(ae,O,!0),()=>e(ae)),g(V,se)};T(F,V=>{e(_e)==0?V(Ke):V(Ze,!1)},!0)}g(v,w)};T(U,v=>{e(Z).length==0?v(b):v(C,!1)},!0)}g(h,z)};T(ne,h=>{e(n)==null?h(q):h(B,!1)},!0)}g(f,p)};T(i,f=>{e(W).length==0?f(u):f(d,!1)},!0)}g(o,l)};T(c,o=>{e(H).length==0?o(A):o(D,!1)},!0)}g(a,t)};T(Ue,a=>{e(M)||e(j)?a(Ve):a(Ye,!1)})}tt(Le),g(De,Ce),Xe()}export{$t as component};
