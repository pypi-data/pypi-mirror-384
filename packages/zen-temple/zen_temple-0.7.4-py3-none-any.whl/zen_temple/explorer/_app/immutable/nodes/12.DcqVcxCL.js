import"../chunks/DsnmJJEf.js";import{s as we,o as Ze}from"../chunks/CfPWzxx9.js";import{p as Be,c as te,f as j,a as v,j as Me,h as P,m as E,r as F,i as p,g as e,l as s,v as Te,s as C,b as H,u as Ie,e as et,t as tt,d as u,n as Le}from"../chunks/XfyNEFST.js";import{i as U}from"../chunks/CyI3pj5p.js";import{u as rt,g as ot,a as Ae,b as Ee,e as at,i as nt}from"../chunks/CXfFsfRJ.js";import{s as Fe}from"../chunks/CvUL_eGA.js";import{B as ye,C as st}from"../chunks/BMP9UOh8.js";import{F as lt,e as it,b as se,S as dt,c as Re,r as ut,i as ct,f as _t,t as vt,h as ft}from"../chunks/Ds6lQle8.js";import{A as ue}from"../chunks/CNlXD7nS.js";import{D as gt}from"../chunks/BQVz1yab.js";import{T as be}from"../chunks/Dsl-dlBH.js";import{u as ce}from"../chunks/gMw3n3N4.js";var mt=P('<div class="text-center text-muted">Click on a bar to see a production and consumption breakdown.</div>'),ht=P('<div class="row"><div class="col-lg-6"><h3 class="text-center h4"> </h3> <!></div> <div class="col-lg-6"><h3 class="text-center h4"> </h3> <!></div></div>');function pt(_e,S){Be(S,!0);let R=s(()=>{if(S.year==null)return[];const n=S.labels.findIndex(o=>o===S.year);return S.datasets.map(o=>({data:o.data.find((k,N)=>N===n),color:o.backgroundColor,label:o.label}))});function W(n){return{animation:{duration:0},responsive:!0,plugins:{tooltip:{callbacks:{label:o=>{const k=Number(o.raw||0),N=o.dataset.data.map(l=>Number(l||0)).reduce((l,b)=>l+b,0),q=(k*100/N).toFixed(2);return`${o.dataset.label}: ${o.formattedValue}${S.tooltipSuffix} (${q}%)`}}},legend:{position:"top"}}}}function J(n,o){if(S.year==null)return[];const k=e(R).filter(l=>l.data&&n(Number(l.data))),N=k.map(l=>l.data),q=k.map(l=>l.color);return[{label:o,data:N,backgroundColor:q}]}function M(n){return S.year==null?[]:e(R).filter(o=>o.data&&n(Number(o.data))).map(o=>o.label||"")}let a=s(()=>J(n=>n>1e-6,"Production")),_=s(()=>M(n=>n>1e-6)),z=s(()=>W()),V=s(()=>J(n=>n<-1e-6,"Consumption")),le=s(()=>M(n=>n<-1e-6)),T=s(()=>W());var Y=te(),$=j(Y);{var K=n=>{var o=mt();v(n,o)},re=n=>{var o=ht(),k=E(o),N=E(k),q=E(N);F(N);var l=p(N,2);ye(l,{type:"pie",get datasets(){return e(a)},get labels(){return e(_)},get options(){return e(z)},downloadable:!1}),F(k);var b=p(k,2),oe=E(b),ie=E(oe);F(oe);var de=p(oe,2);ye(de,{type:"pie",get datasets(){return e(V)},get labels(){return e(le)},get options(){return e(T)},downloadable:!1}),F(b),F(o),Te(()=>{we(q,`Breakdown of Production for ${S.year??""}`),we(ie,`Breakdown of Consumption for ${S.year??""}`)}),v(n,o)};U($,n=>{S.year==null?n(K):n(re,!1)})}v(_e,Y),Me()}var bt=P('<label class="col-6 col-md-2 fw-medium fs-5">Subdivision</label> <div class="col-4 col-md-2"><!></div>',1),wt=P('<div class="row align-items-baseline"><label class="col-6 col-md-3 fw-medium fs-4"> </label> <div class="col-4 col-md-3"><!></div> <!></div>'),yt=P("<!> <!>",1),xt=P("<!> <!> <!>",1),Ct=P("<!> <!> <!> <!>",1),St=P("<!> <!>",1),Pt=P('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),kt=P("<div></div>"),Nt=P('<div class="text-center">No carriers with this selection.</div>'),Ot=P('<div class="text-center">No data with this selection.</div>'),jt=P('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Production</h1> <!> <h2 class="visually-hidden">Plots</h2> <div class="plot mt-4"><!></div> <div class="my-4"><!></div>',1);function zt(_e,S){Be(S,!0);let R=C(null),W=C(H([])),J=C(H([])),M=H([{id:"conversion",short_id:"conv",title:"Conversion",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_conversion_output",positive_label:"Conversion output",negative:"flow_conversion_input",negative_label:"Conversion input"},{id:"storage",short_id:"stor",title:"Storage",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_storage_discharge",positive_label:"Storage discharge",positive_suffix:" (discharge)",negative:"flow_storage_charge",negative_label:"Storage charge",negative_suffix:" (charge)"},{id:"import_export",short_id:"imp_exp",title:"Import/Export",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"flow_import",positive_label:"Import",negative:"flow_export",negative_label:"Export"},{id:"demand_shed_demand",short_id:"dem_shed",title:"Demand/Shed Demand",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"shed_demand",positive_label:"Shed Demand",negative:"demand",negative_label:"Demand"}]),a=C(null),_=C(null),z=C(H([])),V=C(H([])),le=s(()=>[...e(z),...e(V)]),T=C(!1),Y=C(H([])),$=C(H([])),K=C(null),re=null,n=null,o="",k="",N="",q="",l=C(!1),b=C(!1),oe=s(()=>{if(!e(a)?.solution_name||!e(_))return"";let t=e(a).solution_name.split(".");return[t[t?.length-1],e(a).scenario_name,e(_)].join("_")}),ie=C(H([])),de=s(()=>{let t=null;return!t&&e(_)&&(t=e(ie).find(r=>r.carrier==e(_))),t&&(t[0]||t.units)||""}),xe=s(()=>e($).map(t=>t.toString())),Ce=s(()=>e(T)?"":` ${e(de)}`),Ue=s(()=>({datasets:{bar:{borderColor:"rgb(255, 0, 0)",borderWidth:t=>e(K)&&t.chart.data.labels[t.dataIndex]==e(K)?5:0,borderRadius:2,borderSkipped:"middle"}},animation:{duration:0},responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:"Production"+(e(T)?"":` [${e(de)}]`)},max:e(T)?1:void 0,suggestedMin:e(T)?-1:void 0}},plugins:{tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue}${e(Ce)}`,labelColor:t=>({borderColor:t.dataset.backgroundColor,backgroundColor:t.dataset.backgroundColor,borderWidth:0})},filter:t=>Math.abs(t.parsed.y)>1e-6,borderWidth:0},legend:{labels:{generateLabels:t=>{const r=t.data.datasets;return r.length?r.map((i,c)=>({text:i.label||"",fillStyle:i.backgroundColor,strokeStyle:i.borderColor,lineWidth:0,hidden:!t.isDatasetVisible(c),datasetIndex:c,fontColor:st.defaults.color})):[]}}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}})),Q=s(()=>e(a)?e(a).detail.system.set_carriers.slice().sort():[]),ve=s(()=>e(a)?it(Object.entries(e(a).detail.carriers_input).concat(Object.entries(e(a).detail.carriers_output)).filter(t=>e(_)&&t[1].includes(e(_))).map(t=>t[0])):[]),fe=s(()=>e(a)?e(a).detail.system.set_storage_technologies.filter(t=>e(a)?.detail.reference_carrier[t]==e(_)):[]);Ie(()=>{e(Q),et(()=>{e(a)&&e(Q).length>0&&(!e(_)||e(_)&&!e(Q).includes(e(_)))&&u(_,e(Q)[0],!0)})}),ce(()=>e(ve),()=>!!e(a),()=>o,()=>re,t=>u(z,t,!0),t=>o=t,t=>re=t),ce(()=>e(fe),()=>!!e(a),()=>k,()=>n,t=>u(V,t,!0),t=>k=t,t=>n=t),ce(()=>e(J),()=>!!e(a),()=>N,()=>null,t=>u(Y,t,!0),t=>N=t,()=>{}),ce(()=>e(W),()=>!!e(a),()=>q,()=>null,t=>u($,t,!0),t=>q=t,()=>{}),Ze(()=>{u(_,ot("car")||null,!0),M.forEach(t=>{t.show=Ae(t.short_id,t.show),t.subdivision=Ae(t.short_id+"_sub",t.subdivision)}),re=Ee("conv_tech"),n=Ee("stor_tech")}),Ie(()=>{e(_),M.forEach(t=>{t.show,t.subdivision}),e(z),e(V),tt().then(()=>{let t={car:e(_),conv_tech:e(z).map(r=>e(ve).indexOf(r)).join("~"),stor_tech:e(V).map(r=>e(fe).indexOf(r)).join("~")};M.forEach(r=>{t[r.short_id]=r.show?"1":"0",t[r.short_id+"_sub"]=r.subdivision?"1":"0"}),rt(t)})});async function We(){await Ve()}function ze(t){t&&u(K,e(K)!==t?t:null,!0)}async function Ve(){if(e(a)===null)return;u(b,!0),u(R,null);const t=await _t(e(a).solution_name,["flow_conversion_output","flow_conversion_input","flow_storage_discharge","flow_storage_charge","flow_import","flow_export","shed_demand","demand"],e(a).scenario_name,"demand");u(R,M.flatMap(r=>[t[r.positive]||null,t[r.negative]||null]),!0),t.unit?.data&&u(ie,t.unit.data,!0),u(b,!1)}function Ye(t,r,i){return r.subdivision?t:Object.entries(t.reduce((c,y)=>{const f=y.node,m=y.technology;if(i&&!i.includes(m))return c;let D=Object.fromEntries(Object.entries(y).filter(([w])=>!isNaN(Number(w))).map(([w,d])=>[w,Number(d)]));return c[f]=c[f]||{technology:r.title,data:{}},c[f].data=Object.fromEntries(Object.entries(D).map(([w,d])=>[w,(d||0)+(c[f].data[w]||0)])),c},{})).map(([c,y])=>({...y.data,technology:y.technology,node:c}))}function Se(t,r,i,c,y,f){if(t===null)return[];let m={technology:[...e(le),r.title]},D={node:e(Y)};const w=Ye(t.data.filter(x=>x.carrier===void 0||x.carrier==e(_)),r,r.filter_by_technologies?e(le):void 0);let d=ft(w,m,D,i,!1,void 0,y||"").map(x=>({...x,borderColor:"rgb(0, 0, 0)"}));return f!==void 0&&(d=d.map(f)),!r.subdivision&&d.length>0&&(d[0].label=c),d}let ge=s(()=>{if(e(Y).length==0||e($).length==0||!e(R)||e(R).length==0)return[];let t=e(W).filter(i=>!e($).includes(i));ut();let r=M.flatMap((i,c)=>{if(!i.show||!e(R))return[];let y=Se(e(R)[2*c],i,t,i.positive_label,i.positive_suffix,void 0),f=Se(e(R)[2*c+1],i,t,i.negative_label,i.negative_suffix,m=>({...m,data:Object.values(m.data).map(D=>-Number(D))}));return[...y,...f]});return e(T)?ct(r):r});var Pe=jt(),ke=p(j(Pe),2);lt(ke,{children:(t,r)=>{var i=St(),c=j(i);se(c,{title:"Solution Selection",children:(m,D)=>{{let w=s(()=>e(b)||e(l));dt(m,{solution_selected:We,get disabled(){return e(w)},get selected_solution(){return e(a)},set selected_solution(d){u(a,d,!0)},get years(){return e(W)},set years(d){u(W,d,!0)},get nodes(){return e(J)},set nodes(d){u(J,d,!0)},get loading(){return e(l)},set loading(d){u(l,d,!0)}})}}});var y=p(c,2);{var f=m=>{var D=Ct(),w=j(D);se(w,{title:"Carrier Selection",children:(I,ee)=>{var h=te(),L=j(h);{var G=g=>{Re(g,{label:"Carrier",content:(B,O=Le)=>{{let ae=s(()=>vt(e(Q))),X=s(()=>e(l)||e(b));gt(B,{get formId(){return O()},get options(){return e(ae)},get disabled(){return e(X)},get value(){return e(_)},set value(pe){u(_,pe,!0)}})}}})};U(L,g=>{e(Q).length>0&&g(G)})}v(I,h)}});var d=p(w,2);se(d,{title:"Production Component Selection",children:(I,ee)=>{var h=te(),L=j(h);at(L,17,()=>M,nt,(G,g,A)=>{var B=wt(),O=E(B);Fe(O,"for","variables"+A);var ae=E(O,!0);F(O);var X=p(O,2),pe=E(X);be(pe,{formId:"variables"+A,get value(){return e(g).show},set value(ne){e(g).show=ne}}),F(X);var Je=p(X,2);{var Ke=ne=>{var Oe=bt(),je=j(Oe);Fe(je,"for","subdivision"+A);var De=p(je,2),Qe=E(De);be(Qe,{formId:"subdivision"+A,get value(){return e(g).subdivision},set value(Xe){e(g).subdivision=Xe}}),F(De),v(ne,Oe)};U(Je,ne=>{e(g).show&&e(g).show_subdivision&&ne(Ke)})}F(B),Te(()=>we(ae,e(g).title)),v(G,B)}),v(I,h)}});var x=p(d,2);se(x,{title:"Technology Selection",children:(I,ee)=>{var h=yt(),L=j(h);{let g=s(()=>e(l)||e(b));ue(L,{label:"Conversion",get elements(){return e(ve)},get disabled(){return e(g)},get value(){return e(z)},set value(A){u(z,A,!0)}})}var G=p(L,2);{let g=s(()=>e(l)||e(b));ue(G,{label:"Storage",get elements(){return e(fe)},get disabled(){return e(g)},get value(){return e(V)},set value(A){u(V,A,!0)}})}v(I,h)}});var Z=p(x,2);{var he=I=>{se(I,{title:"Data Selection",children:(ee,h)=>{var L=xt(),G=j(L);Re(G,{label:"Normalization",content:(O,ae=Le)=>{be(O,{get formId(){return ae()},get value(){return e(T)},set value(X){u(T,X,!0)}})}});var g=p(G,2);{let B=s(()=>e(l)||e(b));ue(g,{label:"Nodes",get elements(){return e(J)},get disabled(){return e(B)},get value(){return e(Y)},set value(O){u(Y,O,!0)}})}var A=p(g,2);{let B=s(()=>e(l)||e(b));ue(A,{label:"Years",get elements(){return e(W)},get disabled(){return e(B)},get value(){return e($)},set value(O){u($,O,!0)}})}v(ee,L)}})};U(Z,I=>{!e(b)&&e(_)!=null&&I(he)})}v(m,D)};U(y,m=>{!e(l)&&e(a)&&m(f)})}v(t,i)}});var me=p(ke,4),$e=E(me);{var qe=t=>{var r=Pt();v(t,r)},Ge=t=>{var r=te(),i=j(r);{var c=f=>{var m=kt();v(f,m)},y=f=>{var m=te(),D=j(m);{var w=x=>{var Z=Nt();v(x,Z)},d=x=>{var Z=te(),he=j(Z);{var I=h=>{var L=Ot();v(h,L)},ee=h=>{ye(h,{type:"bar",get options(){return e(Ue)},get labels(){return e(xe)},get datasets(){return e(ge)},get plot_name(){return e(oe)},onclick:ze})};U(he,h=>{e(ge).length==0?h(I):h(ee,!1)},!0)}v(x,Z)};U(D,x=>{e(Q).length==0?x(w):x(d,!1)},!0)}v(f,m)};U(i,f=>{e(a)==null?f(c):f(y,!1)},!0)}v(t,r)};U($e,t=>{e(l)||e(b)?t(qe):t(Ge,!1)})}F(me);var Ne=p(me,2),He=E(Ne);pt(He,{get datasets(){return e(ge)},get labels(){return e(xe)},get year(){return e(K)},get tooltipSuffix(){return e(Ce)}}),F(Ne),v(_e,Pe),Me()}export{zt as component};
