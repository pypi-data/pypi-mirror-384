import"../chunks/DsnmJJEf.js";import{o as Ye}from"../chunks/CfPWzxx9.js";import{p as De,s as l,b as j,u as D,d as a,g as e,l as i,t as qe,h as y,i as h,f as S,a as _,j as Ge,n as Q,m as He,r as Je,c as je}from"../chunks/XfyNEFST.js";import{i as f}from"../chunks/CyI3pj5p.js";import{F as Ke,e as de,b as _e,S as Qe,c as W,f as We,a as Xe,t as Ze,r as et,h as Se,i as tt}from"../chunks/Ds6lQle8.js";import{A as X}from"../chunks/CNlXD7nS.js";import{R as $e}from"../chunks/BpBF44Cg.js";import{B as at}from"../chunks/BMP9UOh8.js";import{T as Ee}from"../chunks/Dsl-dlBH.js";import{g as p}from"../chunks/CqS7hfz2.js";import{u as rt,a as nt,g as lt}from"../chunks/CXfFsfRJ.js";var ot=y("<!> <!>",1),st=y("<!> <!>",1),it=y("<!> <!> <!>",1),ut=y("<!> <!>",1),ct=y("<!> <!> <!>",1),dt=y('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),_t=y('<div class="text-center">No solution selected</div>'),mt=y('<div class="text-center">No data with this selection.</div>'),vt=y('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Emissions</h1> <!> <div class="mt-4"><!></div>',1);function $t(Le,Oe){De(Oe,!0);let $=l(null),m=l(null),Z=l(null),ee=l(null),te=l(null),E=l(null),me=l(j({})),ve=l(j({})),L=l(!1),R=l(!1),ge=l(j([])),T=l(j([]));const ke=[{label:"Location",value:"location"},{label:"Technology & Carrier",value:"technology_carrier"}],Ce=["Annual","Cumulative"];let r=l(null),u=l(!0),b=l("Annual"),q=l(j([])),G=l(j([])),M=l("location"),O=l(!1),H=l(j([])),B=l(j([])),Re=i(()=>{if(!e(r)?.solution_name)return"";let t=e(r).solution_name.split(".");return[t[t.length-1],e(r).scenario_name,e(ae)].join("_")}),fe=i(()=>e(u)?Object.values(e(me))[0]||"":Object.values(e(ve))[0]||""),Te=i(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:"Emissions"+(e(O)?"":` [${e(fe)}]`)},max:e(O)?1:void 0,suggestedMin:e(O)?-1:void 0}},plugins:{tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue}`+(e(O)?"":` ${e(fe)}`)}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}})),ae=i(()=>e(u)?p("carbon_emissions_carrier",e(r)?.version):e(b)=="Annual"?p("carbon_emissions_annual",e(r)?.version):p("carbon_emissions_cumulative",e(r)?.version)),J=i(()=>e($)?.data?de(e($).data.map(t=>t.technology)):[]),K=i(()=>e(m)?.data?de(e(m).data.map(t=>t.carrier)):[]),re=i(()=>!e($)?.data&&!e(m)?.data?[]:de([...e($)?.data||[],...e(m)?.data||[]].map(t=>t.location)));D(()=>{a(G,e(J),!0)}),D(()=>{a(q,e(K),!0)}),D(()=>{a(H,e(re),!0)}),D(()=>{a(B,e(T),!0)}),Ye(()=>{a(u,nt("subdiv",e(u)),!0),a(b,lt("cumul")||e(b),!0)}),D(()=>{e(u),e(b),qe().then(()=>{rt({subdiv:e(u)?"1":"0",cumul:e(b)})})});function Be(){Fe()}async function Fe(){if(e(r)===null)return;a(R,!0);const t={technology:p("carbon_emissions_technology",e(r).version),carrier:p("carbon_emissions_carrier",e(r).version),annual_limit:p("carbon_emissions_annual_limit",e(r).version),budget:p("carbon_emissions_budget",e(r).version),annual:p("carbon_emissions_annual",e(r).version),cumulative:p("carbon_emissions_cumulative",e(r).version)};let[n,c]=await Promise.all([We(e(r).solution_name,Object.values(t),e(r).scenario_name,t.carrier),Xe(e(r).solution_name,t.annual,e(r).scenario_name)]);if(a($,n[t.technology],!0),a(m,n[t.carrier],!0),a(te,n[t.annual_limit],!0),a(E,n[t.budget],!0),a(Z,n[t.annual],!0),a(ee,n[t.cumulative],!0),e(m)?.data&&(e(m).data=e(m).data.map(o=>({...o,location:o.location||o.node}))),e(E)&&e(E).data.length>0){const o=Number(Object.values(e(E).data[0])[0]);e(E).data[0]=Object.fromEntries(e(T).map(F=>[F,o]))}n.unit?.data&&a(me,Object.fromEntries(n.unit.data.map(o=>[o.carrier,o[0]||o.units])),!0),c.data&&a(ve,Object.fromEntries(c.data.map(o=>[o.carrier,o[0]||o.units])),!0),a(R,!1)}let pe=i(()=>e(u)?e(M)=="location"?{technology_carrier:e(J).concat(e(K))}:{location:e(re)}:{}),be=i(()=>e(u)?e(M)=="location"?{location:e(H)}:{technology_carrier:e(G).concat(e(q))}:{}),he=i(()=>e(T).filter(t=>!e(B).includes(t))),we=i(()=>{if(e(r)===null||!e(Z)?.data||!e(ee)?.data||!e(m)?.data||!e($)?.data)return[];let t;e(u)?t=e(m).data.map(c=>({...c,technology_carrier:c.carrier})).concat(e($).data.map(c=>({...c,technology_carrier:c.technology}))):e(b)=="Annual"?t=e(Z).data:t=e(ee).data,et();const n=Se(t,e(pe),e(be),e(he));return n.length==1&&(n[0].label=e(ae)),e(O)?tt(n):n}),Ie=i(()=>{if(e(r)===null||e(te)===null||e(E)===null)return[];let t=null;if(e(ae)==p("carbon_emissions_annual",e(r)?.version)?t=e(te).data:t=e(E).data,t==null||t?.length==0)return[];let n=Se(t,e(pe),e(be),e(he));return n.length==0?[]:(n[0].label=e(b)=="Annual"?"Annual Emissions Limit":"Carbon Emissions Budget",n[0].type="line",n)}),ye=i(()=>e(we).concat(e(Ie)));var xe=vt(),Ae=h(S(xe),2);Ke(Ae,{children:(t,n)=>{var c=ct(),o=S(c);_e(o,{title:"Solution Selection",children:(d,I)=>{{let v=i(()=>e(R)||e(L));Qe(d,{get disabled(){return e(v)},solution_selected:Be,get selected_solution(){return e(r)},set selected_solution(s){a(r,s,!0)},get nodes(){return e(ge)},set nodes(s){a(ge,s,!0)},get years(){return e(T)},set years(s){a(T,s,!0)},get loading(){return e(L)},set loading(s){a(L,s,!0)}})}}});var F=h(o,2);{var x=d=>{_e(d,{title:"Variable Selection",children:(I,v)=>{var s=ot(),k=S(s);W(k,{label:"Subdivision",content:(V,N=Q)=>{Ee(V,{get formId(){return N()},get value(){return e(u)},set value(z){a(u,z,!0)}})}});var le=h(k,2);{var oe=g=>{W(g,{label:"Cumulation",content:(N,z=Q)=>{{let se=i(()=>Ze(Ce)),ie=i(()=>e(R)||e(L));$e(N,{get formId(){return z()},get options(){return e(se)},get disabled(){return e(ie)},get value(){return e(b)},set value(ue){a(b,ue,!0)}})}}})};f(le,g=>{e(u)||g(oe)})}_(I,s)}})};f(F,d=>{!e(L)&&e(r)&&d(x)})}var w=h(F,2);{var ne=d=>{_e(d,{title:"Data Selection",children:(I,v)=>{var s=ut(),k=S(s);{var le=g=>{var V=it(),N=S(V);W(N,{label:"Aggregation",content:(P,U=Q)=>{$e(P,{get formId(){return U()},get options(){return ke},get value(){return e(M)},set value(Y){a(M,Y,!0)}})}});var z=h(N,2);W(z,{label:"Normalization",content:(P,U=Q)=>{Ee(P,{get formId(){return U()},get value(){return e(O)},set value(Y){a(O,Y,!0)}})}});var se=h(z,2);{var ie=A=>{X(A,{label:"Locations",get elements(){return e(re)},get value(){return e(H)},set value(P){a(H,P,!0)}})},ue=A=>{var P=st(),U=S(P);{var Y=C=>{X(C,{label:"Technologies",get elements(){return e(J)},get value(){return e(G)},set value(ce){a(G,ce,!0)}})};f(U,C=>{e(J).length>0&&C(Y)})}var Me=h(U,2);{var Ve=C=>{X(C,{label:"Carriers",get elements(){return e(K)},get value(){return e(q)},set value(ce){a(q,ce,!0)}})};f(Me,C=>{e(K).length>0&&C(Ve)})}_(A,P)};f(se,A=>{e(M)=="location"?A(ie):A(ue,!1)})}_(g,V)};f(k,g=>{e(u)&&g(le)})}var oe=h(k,2);X(oe,{label:"Years",get elements(){return e(T)},get value(){return e(B)},set value(g){a(B,g,!0)}}),_(I,s)}})};f(w,d=>{!e(L)&&e(r)&&!e(R)&&d(ne)})}_(t,c)}});var Pe=h(Ae,2),Ne=He(Pe);{var ze=t=>{var n=dt();_(t,n)},Ue=t=>{var n=je(),c=S(n);{var o=x=>{var w=_t();_(x,w)},F=x=>{var w=je(),ne=S(w);{var d=v=>{var s=mt();_(v,s)},I=v=>{{let s=i(()=>e(B).map(k=>k.toString()));at(v,{type:"bar",get options(){return e(Te)},get labels(){return e(s)},get datasets(){return e(ye)},get plot_name(){return e(Re)}})}};f(ne,v=>{e(ye).length==0||e(B).length==0?v(d):v(I,!1)},!0)}_(x,w)};f(c,x=>{e(r)==null?x(o):x(F,!1)},!0)}_(t,n)};f(Ne,t=>{e(L)||e(R)?t(ze):t(Ue,!1)})}Je(Pe),_(Le,xe),Ge()}export{$t as component};
