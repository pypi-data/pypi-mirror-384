import"../chunks/DsnmJJEf.js";import{o as qe,s as Ae}from"../chunks/CfPWzxx9.js";import{p as pt,u as Be,e as tt,s as C,b as de,d as x,g as e,l as ue,k as ot,h as ne,aZ as st,m as ae,c as Ie,f as se,a as R,a_ as nt,v as be,r as K,i as Y,j as _t,t as wt,n as Et}from"../chunks/XfyNEFST.js";import{p as Ct,i as ge,b as Nt}from"../chunks/CyI3pj5p.js";import{F as $t,n as Fe,r as Ot,b as Ke,S as Bt,c as Tt,t as St,f as Dt}from"../chunks/Ds6lQle8.js";import{e as We,i as Xe,u as Rt,g as It,b as it}from"../chunks/CXfFsfRJ.js";import{A as lt}from"../chunks/CNlXD7nS.js";import{D as Lt}from"../chunks/BQVz1yab.js";import{s as P,c as kt}from"../chunks/CvUL_eGA.js";import{s as Mt}from"../chunks/5DMf3Tuo.js";import{d as At,e as Je}from"../chunks/B8ie1dNX.js";import{s as ut}from"../chunks/fAgV3R1g.js";import{d as zt,n as jt,s as Re,a as ct,b as Pt,c as Qe,e as et,y as Yt,p as rt,i as ft,f as Ft,T as Ht}from"../chunks/DOoZHLXD.js";import{u as dt}from"../chunks/gMw3n3N4.js";class ee{entries;constructor(a){this.entries=a}static fromRows(a){return new ee(a.map(r=>{const l={},o=[];return Object.entries(r).forEach(([v,g])=>{if(isNaN(g)){l[v]=g;return}else o.push(Number(g))}),{index:l,data:o}}))}filterByCriteria(a){const r=this.entries.filter(l=>Object.entries(a).every(([o,v])=>Object.keys(l.index).includes(o)?v.includes(l.index[o]):!0));return new ee(r)}groupBy(a){const r={},l={};return this.entries.forEach(o=>{const v=Object.fromEntries(a.map(d=>[d,o.index[d]])),g=Object.values(v).join("_");l[g]||(l[g]=v),r[g]?o.data.forEach((d,m)=>{r[g][m]+=Number(d)}):r[g]=o.data.slice()}),new ee(Object.entries(r).map(([o,v])=>({index:l[o],data:v})))}dump(){return console.table(this.entries.map(a=>({...a.index,...Object.fromEntries(a.data.map((r,l)=>[l.toString(),r]))}))),this}*[Symbol.iterator](){return this.entries[Symbol.iterator]()}forEach(a){return this.entries.forEach(a),this}reduce(a,r){return this.entries.reduce(a,r)}find(a){return this.entries.find(a)}filter(a){return new ee(this.entries.filter(a))}get length(){return this.entries.length}get(a){return this.entries[a]}toArray(){return this.entries}}const ze=140,gt=16,Ut=200,Wt=140,Xt=32,He=5,Ve=20,ht=-10,vt=2,De=16;let F=[],Te=[];function je(n,a){return n.reduce((r,l)=>r+a(l),0)}function Vt(){F.forEach(n=>{n.linksOut=Te.filter(a=>a.source===n),n.linksIn=Te.filter(a=>a.target===n)})}function Gt(){F.forEach(n=>{n.value=Math.max(je(n.linksIn,a=>a.value),je(n.linksOut,a=>a.value))})}function Zt(){F=F.filter(n=>n.linksIn.length>0||n.linksOut.length>0)}function qt(){let n=0,a=[];Te.forEach(r=>{xt(r.source,r.target,a)?(r.causesCycle=!0,r.cycleIndex=++n):(r.causesCycle=!1,a.push(r))})}function xt(n,a,r){let l=r.filter(o=>o.source===a);return r.length==0||l.length==0?!1:l.some(o=>o.target===n||xt(n,o.target,r))}function Kt(){let n=F,a=[],r=0;for(;n.length;)a=[],n.forEach(l=>{l.x=r,l.linksOut.forEach(o=>{o.causesCycle||a.push(o.target)})}),n=a,r++;for(n=F;n.length;)a=[],n.forEach(l=>{if(l.linksOut.length>0){const o=l.linksOut.filter(v=>!v.causesCycle).map(v=>v.target.x);o.length>0&&(l.x=Math.max(l.x,Math.min(...o)-1))}l.linksIn.forEach(o=>{o.causesCycle||a.push(o.source)})}),n=a;Jt(Wt+ze)}function Jt(n){F.forEach(a=>{a.x*=n})}function Qt(){let n={};return F.forEach(a=>{const r=a.x;n[r]||(n[r]=[]),n[r].push(a)}),Object.values(n).sort((a,r)=>a[0].x-r[0].x)}function Ge(n){return n.y+n.dy/2}function er(){let n=Qt();a(),o();for(let g=1,d=0;d<Xt;++d,g*=.99)l(g),o(),r(g),o();v();function a(){const g=Math.min(...F.map(d=>d.value>1e-6?Ut/d.value:1/0));n.forEach(d=>{let m=0;d.forEach(p=>{p.y=m,p.dy=p.value*g,m+=p.dy+gt})}),Te.forEach(d=>{d.dy=d.value*g})}function r(g){n.forEach(d=>{d.forEach(m=>{if(m.linksIn.length==0)return;const p=je(m.linksIn,y=>Ge(y.source)*y.value)/je(m.linksIn,y=>y.value);m.y+=(p-Ge(m))*g})})}function l(g){n.slice().reverse().forEach(d=>{d.forEach(m=>{if(m.linksOut.length==0)return;const p=je(m.linksOut,y=>Ge(y.target)*y.value)/je(m.linksOut,y=>y.value);m.y+=(p-Ge(m))*g})})}function o(){n.forEach(g=>{let d=g[0],m,p=0,y=g.length,oe;for(g.sort((L,he)=>L.y-he.y),oe=0;oe<y;++oe)d=g[oe],m=p-d.y,m>0&&(d.y+=m),p=d.y+d.dy+gt})}function v(){let g=Math.min(...F.map(d=>d.y));F.forEach(d=>{d.y-=g})}}function bt(){let n=a=>(r,l)=>r.causesCycle&&l.causesCycle?r.cycleIndex-l.cycleIndex:r.causesCycle?-1:l.causesCycle?1:r[a].y-l[a].y;F.forEach(a=>{a.linksIn.sort(n("source")),a.linksOut.sort(n("target"))}),F.forEach(a=>{let r=0,l=0;a.linksOut.forEach(o=>{o.sy=r,r+=o.dy}),a.linksIn.forEach(o=>{o.ty=l,l+=o.dy})})}function tr(n,a){F=n,Te=a,Vt(),Gt(),Zt(),qt(),Kt(),er(),bt()}function rr(n,a){n<0||n>=F.length||(F[n].y=a,bt())}function mt(){const n=F.map(r=>({label:r.label,color:r.color,value:r.value,unit:r.unit,x:r.x,y:r.y,dy:r.dy,linksIn:Te.map((l,o)=>l.target===r?o:-1).filter(l=>l>=0),linksOut:Te.map((l,o)=>l.source===r?o:-1).filter(l=>l>=0)})),a=Te.map(r=>({source:n[F.indexOf(r.source)],target:n[F.indexOf(r.target)],value:r.value,color:r.color,unit:r.unit,causesCycle:r.causesCycle,cycleIndex:r.cycleIndex,dy:r.dy,sy:r.sy,ty:r.ty}));return[n,a]}const Ze=n=>()=>n;function at(n,{sourceEvent:a,subject:r,target:l,identifier:o,active:v,x:g,y:d,dx:m,dy:p,dispatch:y}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:a,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:l,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:v,enumerable:!0,configurable:!0},x:{value:g,enumerable:!0,configurable:!0},y:{value:d,enumerable:!0,configurable:!0},dx:{value:m,enumerable:!0,configurable:!0},dy:{value:p,enumerable:!0,configurable:!0},_:{value:y}})}at.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n};function ar(n){return!n.ctrlKey&&!n.button}function nr(){return this.parentNode}function or(n,a){return a??{x:n.x,y:n.y}}function sr(){return navigator.maxTouchPoints||"ontouchstart"in this}function ir(){var n=ar,a=nr,r=or,l=sr,o={},v=zt("start","drag","end"),g=0,d,m,p,y,oe=0;function L(s){s.on("mousedown.drag",he).filter(l).on("touchstart.drag",ve).on("touchmove.drag",Ce,jt).on("touchend.drag touchcancel.drag",Ne).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function he(s,$){if(!(y||!n.call(this,s,$))){var D=ce(this,a.call(this,s,$),s,$,"mouse");D&&(Re(s.view).on("mousemove.drag",we,ct).on("mouseup.drag",Ee,ct),Pt(s.view),Qe(s),p=!1,d=s.clientX,m=s.clientY,D("start",s))}}function we(s){if(et(s),!p){var $=s.clientX-d,D=s.clientY-m;p=$*$+D*D>oe}o.mouse("drag",s)}function Ee(s){Re(s.view).on("mousemove.drag mouseup.drag",null),Yt(s.view,p),et(s),o.mouse("end",s)}function ve(s,$){if(n.call(this,s,$)){var D=s.changedTouches,S=a.call(this,s,$),U=D.length,te,fe;for(te=0;te<U;++te)(fe=ce(this,S,s,$,D[te].identifier,D[te]))&&(Qe(s),fe("start",s,D[te]))}}function Ce(s){var $=s.changedTouches,D=$.length,S,U;for(S=0;S<D;++S)(U=o[$[S].identifier])&&(et(s),U("drag",s,$[S]))}function Ne(s){var $=s.changedTouches,D=$.length,S,U;for(y&&clearTimeout(y),y=setTimeout(function(){y=null},500),S=0;S<D;++S)(U=o[$[S].identifier])&&(Qe(s),U("end",s,$[S]))}function ce(s,$,D,S,U,te){var fe=v.copy(),W=rt(te||D,$),V,G,_e;if((_e=r.call(s,new at("beforestart",{sourceEvent:D,target:L,identifier:U,active:g,x:W[0],y:W[1],dx:0,dy:0,dispatch:fe}),S))!=null)return V=_e.x-W[0]||0,G=_e.y-W[1]||0,function O(k,$e,Le){var Se=W,Oe;switch(k){case"start":o[U]=O,Oe=g++;break;case"end":delete o[U],--g;case"drag":W=rt(Le||$e,$),Oe=g;break}fe.call(k,s,new at(k,{sourceEvent:$e,subject:_e,target:L,identifier:U,active:Oe,x:W[0]+V,y:W[1]+G,dx:W[0]-Se[0],dy:W[1]-Se[1],dispatch:fe}),S)}}return L.filter=function(s){return arguments.length?(n=typeof s=="function"?s:Ze(!!s),L):n},L.container=function(s){return arguments.length?(a=typeof s=="function"?s:Ze(s),L):a},L.subject=function(s){return arguments.length?(r=typeof s=="function"?s:Ze(s),L):r},L.touchable=function(s){return arguments.length?(l=typeof s=="function"?s:Ze(!!s),L):l},L.on=function(){var s=v.on.apply(v,arguments);return s===v?L:s},L.clickDistance=function(s){return arguments.length?(oe=(s=+s)*s,L):Math.sqrt(oe)},L}function lr(n,a){let r;return function(...l){clearTimeout(r),r=setTimeout(()=>n(...l),a)}}function yt(n,a){let r=0;for(let l of n)(l=+l)&&(r+=l);return r}var ur=nt('<path class="cycle-link svelte-1wzhsk8"></path>'),cr=nt('<path class="link svelte-1wzhsk8"></path>'),fr=nt('<g class="node svelte-1wzhsk8"><rect class="svelte-1wzhsk8"></rect><text text-anchor="middle"> </text></g>'),dr=ne('<div class="fs-8 px-2 text-no-break svelte-1wzhsk8"><svg width="12" height="12" class="svelte-1wzhsk8"><rect width="12" height="12"></rect></svg> </div>'),gr=ne('<div class="fw-bold mt-1 fs-7 px-2 svelte-1wzhsk8">Inflows:</div> <!> <div><strong>Total:</strong> </div>',1),hr=ne('<div class="fs-8 px-2 text-no-break svelte-1wzhsk8"><svg width="12" height="12" class="svelte-1wzhsk8"><rect width="12" height="12"></rect></svg> </div>'),vr=ne('<div class="fw-bold mt-1 fs-7 px-2 svelte-1wzhsk8">Outflows:</div> <!> <div class="fs-8 px-2 text-no-break svelte-1wzhsk8"><strong>Total:</strong> </div>',1),mr=ne('<div class="fw-bold fs-7 px-2 svelte-1wzhsk8"> </div> <!> <!>',1),yr=ne('<div class="position-relative border rounded"><svg class="svelte-1wzhsk8"><g><g class="links"></g><g class="nodes"></g></g></svg> <div class="position-absolute top-0 end-0 m-2"><button class="btn btn-secondary"><i class="bi bi-house"></i> <div class="visually-hidden">Reset zoom</div></button></div> <!></div>');function pr(n,a){pt(a,!0);let r=C(936),l=800,o=C(void 0),v=Ct(a,"id",3,"diagram"),g=lr(L,100);Be(()=>{a.nodes.length&&tt(()=>{oe(a.nodes,a.links),g()})});let d=[],m=[],p=C(de([])),y=C(de([]));function oe(t,i){d=t.map(f=>({label:f.label??"Unnamed",color:f.color??"#ccc",id:f.id??"",value:0,unit:f.unit??"",linksIn:[],linksOut:[],x:0,y:0,dy:0})),m=i.flatMap(f=>{let h=d.find(_=>_.id===f.source.id&&_.label===f.source.label),b=d.find(_=>_.id===f.target.id&&_.label===f.target.label);return!h||!b?(console.warn("Link refers to unknown node",f),[]):[{source:h,target:b,value:f.value,color:f.color,unit:f.unit,causesCycle:!1,cycleIndex:0,dy:0,sy:0,ty:0}]})}function L(){tr(d,m),(t=>{var i=ot(t,2);x(p,i[0],!0),x(y,i[1],!0)})(mt())}function he(t,i){return f=>t*(1-f)+i*f}function we(t){if(t.causesCycle){const N=He,w=t.source.x+ze,M=t.source.y+t.sy+t.dy,T=t.target.x,A=t.target.y,X=w+Ve,q=M,u=X,E=ht-t.cycleIndex*(N+vt),I=T-Ve,J=E,me=I,le=A+t.ty+t.dy,Q=De/2-He;return`M${w},${M}L${X},${q}C${X+De},${q} ${u+De},${E} ${u},${E}H${I-N}C${I-De},${J} ${me-De},${le} ${me},${le}H${T}V${A+t.ty}H${me}C${me-Q},${A} ${I-Q},${J+N} ${I},${J+N}H${u-N}C${u+Q},${E+N} ${X+Q},${q-t.dy} ${X},${q-t.dy}L${w},${M-t.dy}`}const i=t.source.x+ze,f=t.target.x,b=he(i,f)(.5),_=t.source.y+t.sy+t.dy/2,B=t.target.y+t.ty+t.dy/2;return`M${i},${_} C${b},${_} ${b},${B} ${f},${B}`}let Ee=ue(()=>{if(!e(y).length)return 0;const t=Math.max(...e(y).map(i=>i.cycleIndex));return t==0?0:ht-t*(He+vt)}),ve=ue(()=>e(p).length&&e(p).some(t=>t.x===0&&t.linksIn.length>0)?-Ve-He-De:0),Ce=ue(()=>{if(!e(p).length)return e(r);const t=Math.max(...e(p).map(i=>i.x+ze));return e(p).some(i=>i.x===t&&i.linksOut.length>0)?t+Ve+He+De-e(ve):t-e(ve)}),Ne=ue(()=>e(p).length?Math.max(...e(p).map(t=>t.y+t.dy)):l);function ce(t,i=6){const f=10**i;return Math.round(t*f)/f}function s(t){let i,f,h,b=/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/;const _=t.match(b);if(_)i=parseInt(_[1],10),f=parseInt(_[2],10),h=parseInt(_[3],10);else return!1;return .299*i+.587*f+.114*h<85}function $(){if(!e(o))return;const{width:t}=e(o).parentElement.getBoundingClientRect();x(r,t,!0),g()}qe($);let D=C(de(ft.toString())),S=Ft().scaleExtent([1,1/0]).on("zoom",t=>{x(D,t.transform.toString(),!0),$e()}).on("end",()=>{$e()});Be(()=>{S=S.translateExtent([[e(ve)-5,e(Ee)-5],[e(Ce)+5,e(Ne)+5]])}),qe(()=>{e(o)&&Re(e(o)).call(S)});function U(){e(o)&&Re(e(o)).call(S.transform,ft)}let te=ir().on("start",function(){this.parentNode&&this.parentNode.appendChild(this)}).on("drag",function(t){const i=Number(this.dataset.idx);isNaN(i)||(fe(t,i),V(t))});Be(()=>{e(p),e(o)&&Re(e(o)).selectAll(".node").call(te)});function fe(t,i){if(t.clientY===0||i<0||i>=e(p).length)return;const f=e(p)[i].y+t.dy,h=Math.max(0,Math.min(l-e(p)[i].dy,f));rr(i,h),(b=>{var _=ot(b,2);x(p,_[0],!0),x(y,_[1],!0)})(mt())}let W=C(null);function V(t){e(o)&&x(W,rt(t,e(o).parentElement),!0)}let G=C(null);function _e(){e(o)&&x(G,e(o).getBoundingClientRect(),!0)}qe(_e);let O=ue(()=>{if(!e(W)||!e(o))return null;let[t,i]=e(W),f=e(o).getBoundingClientRect(),h=Re(e(o)).selectAll(".node").nodes().findLast(_=>{let B=_.getBoundingClientRect(),N=B.left-f.left,w=B.top-f.top;return t>=N&&t<=N+B.width&&i>=w&&i<=w+B.height});if(!h)return null;let b=Number(h.dataset.idx);return isNaN(b)||b<0||b>=e(p).length?null:e(p)[b]}),k=C(null);function $e(){if(e(O)===null||!e(o))return;const t=e(p).findIndex(f=>f===e(O));if(t===-1)return;const i=Re(e(o)).selectAll(`.node[data-idx="${t}"]`).nodes()[0];i&&x(k,i.getBoundingClientRect(),!0)}Be($e);let Le=ue(()=>e(k)===null||e(G)===null?0:e(k).left-e(G).left+e(k).width/2),Se=ue(()=>e(k)===null||e(G)===null?0:e(k).top-e(G).top+e(k).height/2),Oe=ue(()=>e(k)===null?0:e(k).height/2),Ue=ue(()=>e(k)===null||e(G)===null?!1:e(k).top-e(G).top>l/2);var Pe=yr();Je("resize",st,$),Je("scroll",st,_e);var ie=ae(Pe);P(ie,"height",l),ie.__mousemove=V;var Ye=ae(ie),c=ae(Ye);We(c,21,()=>e(y).toSorted((t,i)=>i.value-t.value),Xe,(t,i)=>{var f=Ie(),h=se(f);{var b=B=>{var N=ur();let w;be((M,T)=>{P(N,"d",M),w=ut(N,"",w,T)},[()=>we(e(i)),()=>({fill:e(i).color})]),R(B,N)},_=B=>{var N=cr();let w;be((M,T)=>{P(N,"d",M),w=ut(N,"",w,T)},[()=>we(e(i)),()=>({stroke:e(i).color,"stroke-width":Math.max(1,e(i).dy)})]),R(B,N)};ge(h,B=>{e(i).causesCycle?B(b):B(_,!1)})}R(t,f)}),K(c);var z=Y(c);We(z,21,()=>e(p),Xe,(t,i,f)=>{var h=fr();P(h,"data-idx",f);var b=ae(h),_=Y(b),B=ae(_,!0);K(_),K(h),be((N,w)=>{P(b,"x",e(i).x),P(b,"y",e(i).y+1),P(b,"width",ze),P(b,"height",N),P(b,"fill",e(i).color),P(_,"x",e(i).x+ze/2),P(_,"y",e(i).dy>16?e(i).y+e(i).dy/2:e(i).y-2),P(_,"dominant-baseline",e(i).dy>16?"middle":"auto"),P(_,"fill",w),Ae(B,e(i).label)},[()=>Math.max(.1,e(i).dy-2),()=>e(i).dy>16&&s(e(i).color)?"#fff":"#000"]),R(t,h)}),K(z),K(Ye),K(ie),Nt(ie,t=>x(o,t),()=>e(o));var re=Y(ie,2),H=ae(re);H.__click=U,K(re);var j=Y(re,2);{var Z=t=>{Ht(t,{get x(){return e(Le)},get y(){return e(Se)},get yOffset(){return e(Oe)},get isOnTop(){return e(Ue)},content:f=>{var h=mr(),b=se(h),_=ae(b,!0);K(b);var B=Y(b,2);{var N=T=>{var A=gr(),X=Y(se(A),2);We(X,17,()=>e(O).linksIn,Xe,(E,I)=>{var J=Ie(),me=se(J);{var le=Q=>{var ye=dr(),pe=ae(ye),ke=ae(pe);K(pe);var Me=Y(pe);K(ye),be(xe=>{P(ke,"fill",e(y)[e(I)].source.color),Ae(Me,` ${e(y)[e(I)].source.label??""}: ${xe??""}
								${e(y)[e(I)].unit??""}`)},[()=>ce(e(y)[e(I)].value)]),R(Q,ye)};ge(me,Q=>{e(y)[e(I)]&&Q(le)})}R(E,J)});var q=Y(X,2),u=Y(ae(q));K(q),be(E=>{Mt(q,1,kt(["fs-8 px-2 text-no-break",e(O).linksOut.length>0&&"border-bottom border-secondary pb-1"]),"svelte-1wzhsk8"),Ae(u,` ${E??""}
						${e(O).unit??""}`)},[()=>ce(yt(e(O).linksIn.map(E=>e(y)[E]?.value||0)))]),R(T,A)};ge(B,T=>{e(O).linksIn.length>0&&T(N)})}var w=Y(B,2);{var M=T=>{var A=vr(),X=Y(se(A),2);We(X,17,()=>e(O).linksOut,Xe,(E,I)=>{var J=Ie(),me=se(J);{var le=Q=>{var ye=hr(),pe=ae(ye),ke=ae(pe);K(pe);var Me=Y(pe);K(ye),be(xe=>{P(ke,"fill",e(y)[e(I)].target.color),Ae(Me,` ${e(y)[e(I)].target.label??""}: ${xe??""}
								${e(y)[e(I)].unit??""}`)},[()=>ce(e(y)[e(I)].value)]),R(Q,ye)};ge(me,Q=>{e(y)[e(I)]&&Q(le)})}R(E,J)});var q=Y(X,2),u=Y(ae(q));K(q),be(E=>Ae(u,` ${E??""}
						${e(O).unit??""}`),[()=>ce(yt(e(O).linksOut.map(E=>e(y)[E]?.value||0)))]),R(T,A)};ge(w,T=>{e(O).linksOut.length>0&&T(M)})}be(()=>Ae(_,e(O).label)),R(f,h)},$$slots:{content:!0}})};ge(j,t=>{e(O)!==null&&t(Z)})}K(Pe),be(()=>{P(ie,"id",v()),P(ie,"width",e(r)),P(ie,"viewBox",`${e(ve)-1} ${e(Ee)} ${e(Ce)+4} ${e(Ne)}`),P(Ye,"transform",e(D))}),Je("mouseleave",ie,()=>x(W,null)),R(n,Pe),_t()}At(["mousemove","click"]);var _r=ne("<!> <!>",1),xr=ne("<!> <!> <!>",1),br=ne('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),wr=ne('<div class="text-center">No solution selected</div>'),Er=ne('<div class="text-center">No carriers selected</div>'),Cr=ne('<div class="text-center">No nodes selected</div>'),Nr=ne('<div class="text-center">No data available for the selected filters</div>'),$r=ne('<h1 class="mt-2 mb-4">The Energy System</h1> <!> <h2 class="visually-hidden">Sankey Diagram</h2> <div class="plot my-4"><!></div>',1);function Yr(n,a){pt(a,!0);let r=C(de([])),l=C(!1),o=C(!1),v=C(null),g=C(de([])),d=C(de([])),m=C(null),p=null,y=null,oe="",L="",he="",we=C(null),Ee=C(null),ve=C(null),Ce=C(null),Ne=C(null),ce=C(null),s=C(null),$=C(null),D=C(null),S=C(null),U=C(de([])),te=C(de([])),fe=C(de([]));function W(){_e()}let V=C(de([])),G=C(de([]));Be(()=>{if(!e(r).length){x(m,null);return}he&&e(r).includes(Number(he))?x(m,he,!0):x(m,e(r)[0].toString(),!0)}),Be(()=>{e(m)&&(he=e(m))}),dt(()=>e(V),()=>!!e(v),()=>oe,()=>p,c=>x(g,c,!0),c=>oe=c,c=>p=c),dt(()=>e(G),()=>!!e(v),()=>L,()=>y,c=>x(d,c,!0),c=>L=c,c=>y=c),Be(()=>{e(g),e(d),e(m),tt(()=>{Le()})}),Be(()=>{e(m),e(g),e(d),wt().then(()=>{tt(()=>{Rt({year:e(m),car:e(g).map(c=>e(V).indexOf(c)).join("~")||null,nodes:e(d).map(c=>e(G).indexOf(c)).join("~")||null})})})}),qe(()=>{x(m,It("year"),!0),p=it("car"),y=it("nodes")});async function _e(){if(!e(v))return;x(o,!0);let c=await Dt(e(v).solution_name,["flow_conversion_input","flow_conversion_output","flow_storage_charge","flow_storage_discharge","flow_import","flow_export","demand","shed_demand","flow_storage_inflow","flow_storage_spillage"],e(v).scenario_name,"demand");x(we,ee.fromRows(c.flow_conversion_input?.data??[])),x(Ee,ee.fromRows(c.flow_conversion_output?.data??[]),!0),x(ve,ee.fromRows(c.flow_storage_charge?.data??[]),!0),x(Ce,ee.fromRows(c.flow_storage_discharge?.data??[]),!0),x(Ne,ee.fromRows(c.flow_import?.data??[]),!0),x(ce,ee.fromRows(c.flow_export?.data??[]),!0),x(s,ee.fromRows(c.demand?.data??[]),!0),x($,ee.fromRows(c.shed_demand?.data??[]),!0),x(D,ee.fromRows(c.flow_storage_inflow?.data??[]),!0),x(S,ee.fromRows(c.flow_storage_spillage?.data??[]),!0),x(U,c.unit?.data||[],!0),x(o,!1),Le()}function O(c){let z=e(U).find(re=>re.carrier===c)||{};return z[0]||z.units||""}function k(c){return e(v)&&e(v).detail.reference_carrier[c]||""}function $e(c){return e(v)?e(v).detail.system.set_technologies.filter(z=>{const re=e(v)?.detail.carriers_input[z]||[],H=e(v)?.detail.carriers_output[z]||[],j=e(v)?.detail.reference_carrier[z];return[...re,...H].some(Z=>c.includes(Z))||j&&c.includes(j)}):[]}function Le(){if(!e(v)||!e(we)||!e(Ee)||!e(ve)||!e(Ce)||!e(Ne)||!e(ce)||!e(s)||!e($)||!e(D)||!e(S))return[];const c="rgb(180,180,180)",z=e(v)?.detail.system.set_storage_technologies||[],re=e(v)?.detail.system.set_conversion_technologies||[];function H(u,E,I,J){return{id:u,label:E,color:I,unit:J}}Ot();const j=e(V).map(u=>H(u,u+" ["+O(u)+"]",Fe(),O(u))),Z=re.map(u=>H(u,u,c,O(k(u)))),t=z.map(u=>H(u,u,c,O(k(u)))),i=z.map(u=>H(u,u+"_inflow",c,O(k(u)))),f=z.map(u=>H(u,u+"_spillage",c,O(k(u))));let h=Fe();const b=e(V).map(u=>H(u,u+"_import",h,O(u)));h=Fe();const _=e(V).map(u=>H(u,u+"_export",h,O(u)));h=Fe();const B=e(V).map(u=>H(u,u+"_shed_demand",h,O(u)));h=Fe();const N=e(V).map(u=>H(u,u+"_demand ["+O(u)+"]",h,O(u))),w={carrier:e(g),node:e(d),technology:$e(e(g))},M=e(r).indexOf(Number(e(m)));if(M===-1)return;const T=[];function A(u,E,I,J,me=0){return le=>{const Q=le.data[M]-me;if(Math.abs(Q)<1e-6)return;const ye=u.find(xe=>xe.id===le.index[E]),pe=I.find(xe=>xe.id===le.index[J]);if(!ye||!pe)return;let ke=c;const Me=j.find(xe=>xe.id===le.index.carrier);Me&&(ke=Me.color||c),T.push({source:ye,target:pe,value:Q,color:ke,unit:O(le.index.carrier)})}}function X(u){const E=k(u.index.technology);E&&(u.index.carrier=E)}e(we).filterByCriteria(w).groupBy(["technology","carrier"]).forEach(A(j,"carrier",Z,"technology")),e(Ee).filterByCriteria(w).groupBy(["technology","carrier"]).forEach(A(Z,"technology",j,"carrier")),e(ve).filterByCriteria(w).groupBy(["technology"]).forEach(u=>{const E=k(u.index.technology);E&&(u.index.carrier=E)}).forEach(A(j,"carrier",t,"technology")),e(Ce).filterByCriteria(w).groupBy(["technology"]).forEach(X).forEach(A(t,"technology",j,"carrier")),e(D).filterByCriteria(w).groupBy(["technology"]).forEach(X).forEach(A(i,"technology",t,"technology")),e(S).filterByCriteria(w).groupBy(["technology"]).forEach(X).forEach(A(t,"technology",f,"technology")),e(Ne).filterByCriteria(w).groupBy(["carrier"]).forEach(A(b,"carrier",j,"carrier")),e(ce).filterByCriteria(w).groupBy(["carrier"]).forEach(A(j,"carrier",_,"carrier"));const q=e($).filterByCriteria(w).groupBy(["carrier"]);q.forEach(A(B,"carrier",N,"carrier")),e(s).filterByCriteria(w).groupBy(["carrier"]).forEach(u=>{const E=q.find(J=>J.index.carrier===u.index.carrier),I=E?E.data[M]:0;A(j,"carrier",N,"carrier",I)(u)}),x(te,[...j,...Z,...t,...i,...f,...b,..._,...B,...N],!0),x(fe,T,!0)}var Se=$r(),Oe=Y(se(Se),2);$t(Oe,{children:(c,z)=>{var re=xr(),H=se(re);Ke(H,{title:"Solution Selection",children:(t,i)=>{{let f=ue(()=>e(o)||e(l));Bt(t,{solution_selected:W,get disabled(){return e(f)},get years(){return e(r)},set years(h){x(r,h,!0)},get selected_solution(){return e(v)},set selected_solution(h){x(v,h,!0)},get carriers(){return e(V)},set carriers(h){x(V,h,!0)},get nodes(){return e(G)},set nodes(h){x(G,h,!0)},get loading(){return e(l)},set loading(h){x(l,h,!0)}})}}});var j=Y(H,2);Ke(j,{title:"Carrier Selection",children:(t,i)=>{lt(t,{label:"Carriers",get elements(){return e(V)},get value(){return e(g)},set value(f){x(g,f,!0)}})}});var Z=Y(j,2);Ke(Z,{title:"Data Selection",children:(t,i)=>{var f=_r(),h=se(f);Tt(h,{label:"Year",content:(B,N=Et)=>{{let w=ue(()=>St(e(r).map(T=>T.toString()))),M=ue(()=>e(o)||e(l));Lt(B,{get formId(){return N()},get options(){return e(w)},get disabled(){return e(M)},get value(){return e(m)},set value(T){x(m,T,!0)}})}}});var b=Y(h,2);lt(b,{label:"Nodes",get elements(){return e(G)},get value(){return e(d)},set value(_){x(d,_,!0)}}),R(t,f)}}),R(c,re)}});var Ue=Y(Oe,4),Pe=ae(Ue);{var ie=c=>{var z=br();R(c,z)},Ye=c=>{var z=Ie(),re=se(z);{var H=Z=>{var t=wr();R(Z,t)},j=Z=>{var t=Ie(),i=se(t);{var f=b=>{var _=Er();R(b,_)},h=b=>{var _=Ie(),B=se(_);{var N=M=>{var T=Cr();R(M,T)},w=M=>{var T=Ie(),A=se(T);{var X=u=>{var E=Nr();R(u,E)},q=u=>{pr(u,{get nodes(){return e(te)},get links(){return e(fe)}})};ge(A,u=>{e(te).length===0?u(X):u(q,!1)},!0)}R(M,T)};ge(B,M=>{e(d).length===0?M(N):M(w,!1)},!0)}R(b,_)};ge(i,b=>{e(g).length===0?b(f):b(h,!1)},!0)}R(Z,t)};ge(re,Z=>{e(v)?Z(j,!1):Z(H)},!0)}R(c,z)};ge(Pe,c=>{e(l)||e(o)?c(ie):c(Ye,!1)})}K(Ue),R(n,Se),_t()}export{Yr as component};
